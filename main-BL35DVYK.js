import{A as LT,B as sn,C as Gr,D as yd,E as hu,F as pm,G as jT,H as UT,I as B,J as Vt,K as nt,L as gm,M as BT,N as fu,O as ie,P as qt,Q as _d,R as mm,S as on,T as zr,U as $i,V as vd,W as $T,X as Dn,Y as pt,a as x,b as he,c as dm,d as v,e as xT,f as hd,g as MT,h as RT,i as D,j as no,k as fd,l as NT,m as PT,n as ot,o as pd,p as du,q as hm,r as kT,s as Hn,t as fm,u as gd,v as OT,w as FT,x as md,y as ze,z as VT}from"./chunk-EMU53QTL.js";var HT=null;var ym=1,qT=Symbol("SIGNAL");function Gt(t){let e=HT;return HT=t,e}var GT={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function M1(t){if(!(wm(t)&&!t.dirty)&&!(!t.dirty&&t.lastCleanEpoch===ym)){if(!t.producerMustRecompute(t)&&!_m(t)){t.dirty=!1,t.lastCleanEpoch=ym;return}t.producerRecomputeValue(t),t.dirty=!1,t.lastCleanEpoch=ym}}function zT(t){return t&&(t.nextProducerIndex=0),Gt(t)}function WT(t,e){if(Gt(e),!(!t||t.producerNode===void 0||t.producerIndexOfThis===void 0||t.producerLastReadVersion===void 0)){if(wm(t))for(let n=t.nextProducerIndex;n<t.producerNode.length;n++)vm(t.producerNode[n],t.producerIndexOfThis[n]);for(;t.producerNode.length>t.nextProducerIndex;)t.producerNode.pop(),t.producerLastReadVersion.pop(),t.producerIndexOfThis.pop()}}function _m(t){wd(t);for(let e=0;e<t.producerNode.length;e++){let n=t.producerNode[e],r=t.producerLastReadVersion[e];if(r!==n.version||(M1(n),r!==n.version))return!0}return!1}function KT(t){if(wd(t),wm(t))for(let e=0;e<t.producerNode.length;e++)vm(t.producerNode[e],t.producerIndexOfThis[e]);t.producerNode.length=t.producerLastReadVersion.length=t.producerIndexOfThis.length=0,t.liveConsumerNode&&(t.liveConsumerNode.length=t.liveConsumerIndexOfThis.length=0)}function vm(t,e){if(R1(t),wd(t),t.liveConsumerNode.length===1)for(let r=0;r<t.producerNode.length;r++)vm(t.producerNode[r],t.producerIndexOfThis[r]);let n=t.liveConsumerNode.length-1;if(t.liveConsumerNode[e]=t.liveConsumerNode[n],t.liveConsumerIndexOfThis[e]=t.liveConsumerIndexOfThis[n],t.liveConsumerNode.length--,t.liveConsumerIndexOfThis.length--,e<t.liveConsumerNode.length){let r=t.liveConsumerIndexOfThis[e],i=t.liveConsumerNode[e];wd(i),i.producerIndexOfThis[r]=e}}function wm(t){return t.consumerIsAlwaysLive||(t?.liveConsumerNode?.length??0)>0}function wd(t){t.producerNode??=[],t.producerIndexOfThis??=[],t.producerLastReadVersion??=[]}function R1(t){t.liveConsumerNode??=[],t.liveConsumerIndexOfThis??=[]}function N1(){throw new Error}var P1=N1;function QT(t){P1=t}function q(t){return typeof t=="function"}function ro(t){let n=t(r=>{Error.call(r),r.stack=new Error().stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Ed=ro(t=>function(n){t(this),this.message=n?`${n.length} errors occurred during unsubscription:
${n.map((r,i)=>`${i+1}) ${r.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=n});function Hi(t,e){if(t){let n=t.indexOf(e);0<=n&&t.splice(n,1)}}var Ue=class t{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;let{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(let s of n)s.remove(this);else n.remove(this);let{initialTeardown:r}=this;if(q(r))try{r()}catch(s){e=s instanceof Ed?s.errors:[s]}let{_finalizers:i}=this;if(i){this._finalizers=null;for(let s of i)try{YT(s)}catch(o){e=e??[],o instanceof Ed?e=[...e,...o.errors]:e.push(o)}}if(e)throw new Ed(e)}}add(e){var n;if(e&&e!==this)if(this.closed)YT(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}}_hasParent(e){let{_parentage:n}=this;return n===e||Array.isArray(n)&&n.includes(e)}_addParent(e){let{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e}_removeParent(e){let{_parentage:n}=this;n===e?this._parentage=null:Array.isArray(n)&&Hi(n,e)}remove(e){let{_finalizers:n}=this;n&&Hi(n,e),e instanceof t&&e._removeParent(this)}};Ue.EMPTY=(()=>{let t=new Ue;return t.closed=!0,t})();var Em=Ue.EMPTY;function Id(t){return t instanceof Ue||t&&"closed"in t&&q(t.remove)&&q(t.add)&&q(t.unsubscribe)}function YT(t){q(t)?t():t.unsubscribe()}var Tn={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var io={setTimeout(t,e,...n){let{delegate:r}=io;return r?.setTimeout?r.setTimeout(t,e,...n):setTimeout(t,e,...n)},clearTimeout(t){let{delegate:e}=io;return(e?.clearTimeout||clearTimeout)(t)},delegate:void 0};function Cd(t){io.setTimeout(()=>{let{onUnhandledError:e}=Tn;if(e)e(t);else throw t})}function qi(){}var ZT=Im("C",void 0,void 0);function XT(t){return Im("E",void 0,t)}function JT(t){return Im("N",t,void 0)}function Im(t,e,n){return{kind:t,value:e,error:n}}var Gi=null;function so(t){if(Tn.useDeprecatedSynchronousErrorHandling){let e=!Gi;if(e&&(Gi={errorThrown:!1,error:null}),t(),e){let{errorThrown:n,error:r}=Gi;if(Gi=null,n)throw r}}else t()}function e0(t){Tn.useDeprecatedSynchronousErrorHandling&&Gi&&(Gi.errorThrown=!0,Gi.error=t)}var zi=class extends Ue{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,Id(e)&&e.add(this)):this.destination=F1}static create(e,n,r){return new Ir(e,n,r)}next(e){this.isStopped?Dm(JT(e),this):this._next(e)}error(e){this.isStopped?Dm(XT(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?Dm(ZT,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},k1=Function.prototype.bind;function Cm(t,e){return k1.call(t,e)}var Tm=class{constructor(e){this.partialObserver=e}next(e){let{partialObserver:n}=this;if(n.next)try{n.next(e)}catch(r){Dd(r)}}error(e){let{partialObserver:n}=this;if(n.error)try{n.error(e)}catch(r){Dd(r)}else Dd(e)}complete(){let{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(n){Dd(n)}}},Ir=class extends zi{constructor(e,n,r){super();let i;if(q(e)||!e)i={next:e??void 0,error:n??void 0,complete:r??void 0};else{let s;this&&Tn.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=()=>this.unsubscribe(),i={next:e.next&&Cm(e.next,s),error:e.error&&Cm(e.error,s),complete:e.complete&&Cm(e.complete,s)}):i=e}this.destination=new Tm(i)}};function Dd(t){Tn.useDeprecatedSynchronousErrorHandling?e0(t):Cd(t)}function O1(t){throw t}function Dm(t,e){let{onStoppedNotification:n}=Tn;n&&io.setTimeout(()=>n(t,e))}var F1={closed:!0,next:qi,error:O1,complete:qi};var oo=typeof Symbol=="function"&&Symbol.observable||"@@observable";function gt(t){return t}function bm(...t){return Sm(t)}function Sm(t){return t.length===0?gt:t.length===1?t[0]:function(n){return t.reduce((r,i)=>i(r),n)}}var J=(()=>{class t{constructor(n){n&&(this._subscribe=n)}lift(n){let r=new t;return r.source=this,r.operator=n,r}subscribe(n,r,i){let s=L1(n)?n:new Ir(n,r,i);return so(()=>{let{operator:o,source:a}=this;s.add(o?o.call(s,a):a?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(n){try{return this._subscribe(n)}catch(r){n.error(r)}}forEach(n,r){return r=t0(r),new r((i,s)=>{let o=new Ir({next:a=>{try{n(a)}catch(u){s(u),o.unsubscribe()}},error:s,complete:i});this.subscribe(o)})}_subscribe(n){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(n)}[oo](){return this}pipe(...n){return Sm(n)(this)}toPromise(n){return n=t0(n),new n((r,i)=>{let s;this.subscribe(o=>s=o,o=>i(o),()=>r(s))})}}return t.create=e=>new t(e),t})();function t0(t){var e;return(e=t??Tn.Promise)!==null&&e!==void 0?e:Promise}function V1(t){return t&&q(t.next)&&q(t.error)&&q(t.complete)}function L1(t){return t&&t instanceof zi||V1(t)&&Id(t)}function Am(t){return q(t?.lift)}function W(t){return e=>{if(Am(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function G(t,e,n,r,i){return new xm(t,e,n,r,i)}var xm=class extends zi{constructor(e,n,r,i,s,o){super(e),this.onFinalize=s,this.shouldUnsubscribe=o,this._next=n?function(a){try{n(a)}catch(u){e.error(u)}}:super._next,this._error=i?function(a){try{i(a)}catch(u){e.error(u)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:n}=this;super.unsubscribe(),!n&&((e=this.onFinalize)===null||e===void 0||e.call(this))}}};function ao(){return W((t,e)=>{let n=null;t._refCount++;let r=G(e,void 0,void 0,void 0,()=>{if(!t||t._refCount<=0||0<--t._refCount){n=null;return}let i=t._connection,s=n;n=null,i&&(!s||i===s)&&i.unsubscribe(),e.unsubscribe()});t.subscribe(r),r.closed||(n=t.connect())})}var uo=class extends J{constructor(e,n){super(),this.source=e,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,Am(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){let e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new Ue;let n=this.getSubject();e.add(this.source.subscribe(G(n,void 0,()=>{this._teardown(),n.complete()},r=>{this._teardown(),n.error(r)},()=>this._teardown()))),e.closed&&(this._connection=null,e=Ue.EMPTY)}return e}refCount(){return ao()(this)}};var n0=ro(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var rt=(()=>{class t extends J{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){let r=new Td(this,this);return r.operator=n,r}_throwIfClosed(){if(this.closed)throw new n0}next(n){so(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let r of this.currentObservers)r.next(n)}})}error(n){so(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;let{observers:r}=this;for(;r.length;)r.shift().error(n)}})}complete(){so(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){let{hasError:r,isStopped:i,observers:s}=this;return r||i?Em:(this.currentObservers=null,s.push(n),new Ue(()=>{this.currentObservers=null,Hi(s,n)}))}_checkFinalizedStatuses(n){let{hasError:r,thrownError:i,isStopped:s}=this;r?n.error(i):s&&n.complete()}asObservable(){let n=new J;return n.source=this,n}}return t.create=(e,n)=>new Td(e,n),t})(),Td=class extends rt{constructor(e,n){super(),this.destination=e,this.source=n}next(e){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.next)===null||r===void 0||r.call(n,e)}error(e){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.error)===null||r===void 0||r.call(n,e)}complete(){var e,n;(n=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||n===void 0||n.call(e)}_subscribe(e){var n,r;return(r=(n=this.source)===null||n===void 0?void 0:n.subscribe(e))!==null&&r!==void 0?r:Em}};var mt=class extends rt{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){let n=super._subscribe(e);return!n.closed&&e.next(this._value),n}getValue(){let{hasError:e,thrownError:n,_value:r}=this;if(e)throw n;return this._throwIfClosed(),r}next(e){super.next(this._value=e)}};var pu={now(){return(pu.delegate||Date).now()},delegate:void 0};var bd=class extends rt{constructor(e=1/0,n=1/0,r=pu){super(),this._bufferSize=e,this._windowTime=n,this._timestampProvider=r,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=n===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,n)}next(e){let{isStopped:n,_buffer:r,_infiniteTimeWindow:i,_timestampProvider:s,_windowTime:o}=this;n||(r.push(e),!i&&r.push(s.now()+o)),this._trimBuffer(),super.next(e)}_subscribe(e){this._throwIfClosed(),this._trimBuffer();let n=this._innerSubscribe(e),{_infiniteTimeWindow:r,_buffer:i}=this,s=i.slice();for(let o=0;o<s.length&&!e.closed;o+=r?1:2)e.next(s[o]);return this._checkFinalizedStatuses(e),n}_trimBuffer(){let{_bufferSize:e,_timestampProvider:n,_buffer:r,_infiniteTimeWindow:i}=this,s=(i?1:2)*e;if(e<1/0&&s<r.length&&r.splice(0,r.length-s),!i){let o=n.now(),a=0;for(let u=1;u<r.length&&r[u]<=o;u+=2)a=u;a&&r.splice(0,a+1)}}};var Sd=class extends Ue{constructor(e,n){super()}schedule(e,n=0){return this}};var gu={setInterval(t,e,...n){let{delegate:r}=gu;return r?.setInterval?r.setInterval(t,e,...n):setInterval(t,e,...n)},clearInterval(t){let{delegate:e}=gu;return(e?.clearInterval||clearInterval)(t)},delegate:void 0};var co=class extends Sd{constructor(e,n){super(e,n),this.scheduler=e,this.work=n,this.pending=!1}schedule(e,n=0){var r;if(this.closed)return this;this.state=e;let i=this.id,s=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(s,i,n)),this.pending=!0,this.delay=n,this.id=(r=this.id)!==null&&r!==void 0?r:this.requestAsyncId(s,this.id,n),this}requestAsyncId(e,n,r=0){return gu.setInterval(e.flush.bind(e,this),r)}recycleAsyncId(e,n,r=0){if(r!=null&&this.delay===r&&this.pending===!1)return n;n!=null&&gu.clearInterval(n)}execute(e,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let r=this._execute(e,n);if(r)return r;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,n){let r=!1,i;try{this.work(e)}catch(s){r=!0,i=s||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),i}unsubscribe(){if(!this.closed){let{id:e,scheduler:n}=this,{actions:r}=n;this.work=this.state=this.scheduler=null,this.pending=!1,Hi(r,this),e!=null&&(this.id=this.recycleAsyncId(n,e,null)),this.delay=null,super.unsubscribe()}}};var lo=class t{constructor(e,n=t.now){this.schedulerActionCtor=e,this.now=n}schedule(e,n=0,r){return new this.schedulerActionCtor(this,e).schedule(r,n)}};lo.now=pu.now;var ho=class extends lo{constructor(e,n=lo.now){super(e,n),this.actions=[],this._active=!1}flush(e){let{actions:n}=this;if(this._active){n.push(e);return}let r;this._active=!0;do if(r=e.execute(e.state,e.delay))break;while(e=n.shift());if(this._active=!1,r){for(;e=n.shift();)e.unsubscribe();throw r}}};var Wi=new ho(co);var Ad=class extends co{constructor(e,n){super(e,n),this.scheduler=e,this.work=n}schedule(e,n=0){return n>0?super.schedule(e,n):(this.delay=n,this.state=e,this.scheduler.flush(this),this)}execute(e,n){return n>0||this.closed?super.execute(e,n):this._execute(e,n)}requestAsyncId(e,n,r=0){return r!=null&&r>0||r==null&&this.delay>0?super.requestAsyncId(e,n,r):(e.flush(this),0)}};var xd=class extends ho{};var Mm=new xd(Ad);var Lt=new J(t=>t.complete());function r0(t){return t&&q(t.schedule)}function Rm(t){return t[t.length-1]}function fo(t){return q(Rm(t))?t.pop():void 0}function qn(t){return r0(Rm(t))?t.pop():void 0}function i0(t,e){return typeof Rm(t)=="number"?t.pop():e}var Md=t=>t&&typeof t.length=="number"&&typeof t!="function";function Rd(t){return q(t?.then)}function Nd(t){return q(t[oo])}function Pd(t){return Symbol.asyncIterator&&q(t?.[Symbol.asyncIterator])}function kd(t){return new TypeError(`You provided ${t!==null&&typeof t=="object"?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function j1(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Od=j1();function Fd(t){return q(t?.[Od])}function Vd(t){return MT(this,arguments,function*(){let n=t.getReader();try{for(;;){let{value:r,done:i}=yield hd(n.read());if(i)return yield hd(void 0);yield yield hd(r)}}finally{n.releaseLock()}})}function Ld(t){return q(t?.getReader)}function we(t){if(t instanceof J)return t;if(t!=null){if(Nd(t))return U1(t);if(Md(t))return B1(t);if(Rd(t))return $1(t);if(Pd(t))return s0(t);if(Fd(t))return H1(t);if(Ld(t))return q1(t)}throw kd(t)}function U1(t){return new J(e=>{let n=t[oo]();if(q(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function B1(t){return new J(e=>{for(let n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function $1(t){return new J(e=>{t.then(n=>{e.closed||(e.next(n),e.complete())},n=>e.error(n)).then(null,Cd)})}function H1(t){return new J(e=>{for(let n of t)if(e.next(n),e.closed)return;e.complete()})}function s0(t){return new J(e=>{G1(t,e).catch(n=>e.error(n))})}function q1(t){return s0(Vd(t))}function G1(t,e){var n,r,i,s;return xT(this,void 0,void 0,function*(){try{for(n=RT(t);r=yield n.next(),!r.done;){let o=r.value;if(e.next(o),e.closed)return}}catch(o){i={error:o}}finally{try{r&&!r.done&&(s=n.return)&&(yield s.call(n))}finally{if(i)throw i.error}}e.complete()})}function jt(t,e,n,r=0,i=!1){let s=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!i)return s}function an(t,e=0){return W((n,r)=>{n.subscribe(G(r,i=>jt(r,t,()=>r.next(i),e),()=>jt(r,t,()=>r.complete(),e),i=>jt(r,t,()=>r.error(i),e)))})}function bn(t,e=0){return W((n,r)=>{r.add(t.schedule(()=>n.subscribe(r),e))})}function o0(t,e){return we(t).pipe(bn(e),an(e))}function a0(t,e){return we(t).pipe(bn(e),an(e))}function u0(t,e){return new J(n=>{let r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function c0(t,e){return new J(n=>{let r;return jt(n,e,()=>{r=t[Od](),jt(n,e,()=>{let i,s;try{({value:i,done:s}=r.next())}catch(o){n.error(o);return}s?n.complete():n.next(i)},0,!0)}),()=>q(r?.return)&&r.return()})}function jd(t,e){if(!t)throw new Error("Iterable cannot be null");return new J(n=>{jt(n,e,()=>{let r=t[Symbol.asyncIterator]();jt(n,e,()=>{r.next().then(i=>{i.done?n.complete():n.next(i.value)})},0,!0)})})}function l0(t,e){return jd(Vd(t),e)}function d0(t,e){if(t!=null){if(Nd(t))return o0(t,e);if(Md(t))return u0(t,e);if(Rd(t))return a0(t,e);if(Pd(t))return jd(t,e);if(Fd(t))return c0(t,e);if(Ld(t))return l0(t,e)}throw kd(t)}function fe(t,e){return e?d0(t,e):we(t)}function V(...t){let e=qn(t);return fe(t,e)}function po(t,e){let n=q(t)?t:()=>t,r=i=>i.error(n());return new J(e?i=>e.schedule(r,0,i):r)}function Nm(t){return!!t&&(t instanceof J||q(t.lift)&&q(t.subscribe))}var Cr=ro(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"});function F(t,e){return W((n,r)=>{let i=0;n.subscribe(G(r,s=>{r.next(t.call(e,s,i++))}))})}var{isArray:z1}=Array;function W1(t,e){return z1(e)?t(...e):t(e)}function Ud(t){return F(e=>W1(t,e))}var{isArray:K1}=Array,{getPrototypeOf:Q1,prototype:Y1,keys:Z1}=Object;function Bd(t){if(t.length===1){let e=t[0];if(K1(e))return{args:e,keys:null};if(X1(e)){let n=Z1(e);return{args:n.map(r=>e[r]),keys:n}}}return{args:t,keys:null}}function X1(t){return t&&typeof t=="object"&&Q1(t)===Y1}function $d(t,e){return t.reduce((n,r,i)=>(n[r]=e[i],n),{})}function mu(...t){let e=qn(t),n=fo(t),{args:r,keys:i}=Bd(t);if(r.length===0)return fe([],e);let s=new J(J1(r,e,i?o=>$d(i,o):gt));return n?s.pipe(Ud(n)):s}function J1(t,e,n=gt){return r=>{h0(e,()=>{let{length:i}=t,s=new Array(i),o=i,a=i;for(let u=0;u<i;u++)h0(e,()=>{let c=fe(t[u],e),l=!1;c.subscribe(G(r,d=>{s[u]=d,l||(l=!0,a--),a||r.next(n(s.slice()))},()=>{--o||r.complete()}))},r)},r)}}function h0(t,e,n){t?jt(n,t,e):e()}function f0(t,e,n,r,i,s,o,a){let u=[],c=0,l=0,d=!1,h=()=>{d&&!u.length&&!c&&e.complete()},f=g=>c<r?p(g):u.push(g),p=g=>{s&&e.next(g),c++;let _=!1;we(n(g,l++)).subscribe(G(e,C=>{i?.(C),s?f(C):e.next(C)},()=>{_=!0},void 0,()=>{if(_)try{for(c--;u.length&&c<r;){let C=u.shift();o?jt(e,o,()=>p(C)):p(C)}h()}catch(C){e.error(C)}}))};return t.subscribe(G(e,f,()=>{d=!0,h()})),()=>{a?.()}}function We(t,e,n=1/0){return q(e)?We((r,i)=>F((s,o)=>e(r,s,i,o))(we(t(r,i))),n):(typeof e=="number"&&(n=e),W((r,i)=>f0(r,i,t,n)))}function Wr(t=1/0){return We(gt,t)}function p0(){return Wr(1)}function go(...t){return p0()(fe(t,qn(t)))}function Hd(t){return new J(e=>{we(t()).subscribe(e)})}function Pm(...t){let e=fo(t),{args:n,keys:r}=Bd(t),i=new J(s=>{let{length:o}=n;if(!o){s.complete();return}let a=new Array(o),u=o,c=o;for(let l=0;l<o;l++){let d=!1;we(n[l]).subscribe(G(s,h=>{d||(d=!0,c--),a[l]=h},()=>u--,void 0,()=>{(!u||!d)&&(c||s.next(r?$d(r,a):a),s.complete())}))}});return e?i.pipe(Ud(e)):i}function mo(...t){let e=qn(t),n=i0(t,1/0),r=t;return r.length?r.length===1?we(r[0]):Wr(n)(fe(r,e)):Lt}function yt(t,e){return W((n,r)=>{let i=0;n.subscribe(G(r,s=>t.call(e,s,i++)&&r.next(s)))})}function Kr(t){return W((e,n)=>{let r=null,i=!1,s;r=e.subscribe(G(n,void 0,void 0,o=>{s=we(t(o,Kr(t)(e))),r?(r.unsubscribe(),r=null,s.subscribe(n)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(n))})}function g0(t,e,n,r,i){return(s,o)=>{let a=n,u=e,c=0;s.subscribe(G(o,l=>{let d=c++;u=a?t(u,l,d):(a=!0,l),r&&o.next(u)},i&&(()=>{a&&o.next(u),o.complete()})))}}function Ki(t,e){return q(e)?We(t,e,1):We(t,1)}function Qr(t){return W((e,n)=>{let r=!1;e.subscribe(G(n,i=>{r=!0,n.next(i)},()=>{r||n.next(t),n.complete()}))})}function Dr(t){return t<=0?()=>Lt:W((e,n)=>{let r=0;e.subscribe(G(n,i=>{++r<=t&&(n.next(i),t<=r&&n.complete())}))})}function km(t){return F(()=>t)}function yu(t,e=gt){return t=t??eV,W((n,r)=>{let i,s=!0;n.subscribe(G(r,o=>{let a=e(o);(s||!t(i,a))&&(s=!1,i=a,r.next(o))}))})}function eV(t,e){return t===e}function qd(t=tV){return W((e,n)=>{let r=!1;e.subscribe(G(n,i=>{r=!0,n.next(i)},()=>r?n.complete():n.error(t())))})}function tV(){return new Cr}function _u(t){return W((e,n)=>{try{e.subscribe(n)}finally{n.add(t)}})}function un(t,e){let n=arguments.length>=2;return r=>r.pipe(t?yt((i,s)=>t(i,s,r)):gt,Dr(1),n?Qr(e):qd(()=>new Cr))}function yo(t){return t<=0?()=>Lt:W((e,n)=>{let r=[];e.subscribe(G(n,i=>{r.push(i),t<r.length&&r.shift()},()=>{for(let i of r)n.next(i);n.complete()},void 0,()=>{r=null}))})}function Om(t,e){let n=arguments.length>=2;return r=>r.pipe(t?yt((i,s)=>t(i,s,r)):gt,yo(1),n?Qr(e):qd(()=>new Cr))}function vu(){return W((t,e)=>{let n,r=!1;t.subscribe(G(e,i=>{let s=n;n=i,r&&e.next([s,i]),r=!0}))})}function Gn(t,e){return W(g0(t,e,arguments.length>=2,!0))}function wu(t={}){let{connector:e=()=>new rt,resetOnError:n=!0,resetOnComplete:r=!0,resetOnRefCountZero:i=!0}=t;return s=>{let o,a,u,c=0,l=!1,d=!1,h=()=>{a?.unsubscribe(),a=void 0},f=()=>{h(),o=u=void 0,l=d=!1},p=()=>{let g=o;f(),g?.unsubscribe()};return W((g,_)=>{c++,!d&&!l&&h();let C=u=u??e();_.add(()=>{c--,c===0&&!d&&!l&&(a=Fm(p,i))}),C.subscribe(_),!o&&c>0&&(o=new Ir({next:M=>C.next(M),error:M=>{d=!0,h(),a=Fm(f,n,M),C.error(M)},complete:()=>{l=!0,h(),a=Fm(f,r),C.complete()}}),we(g).subscribe(o))})(s)}}function Fm(t,e,...n){if(e===!0){t();return}if(e===!1)return;let r=new Ir({next:()=>{r.unsubscribe(),t()}});return we(e(...n)).subscribe(r)}function Gd(t,e,n){let r,i=!1;return t&&typeof t=="object"?{bufferSize:r=1/0,windowTime:e=1/0,refCount:i=!1,scheduler:n}=t:r=t??1/0,wu({connector:()=>new bd(r,e,n),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:i})}function Vm(t){return W((e,n)=>{let r=!1,i=0;e.subscribe(G(n,s=>(r||(r=!t(s,i++)))&&n.next(s)))})}function Qi(...t){let e=qn(t);return W((n,r)=>{(e?go(t,n,e):go(t,n)).subscribe(r)})}function Me(t,e){return W((n,r)=>{let i=null,s=0,o=!1,a=()=>o&&!i&&r.complete();n.subscribe(G(r,u=>{i?.unsubscribe();let c=0,l=s++;we(t(u,l)).subscribe(i=G(r,d=>r.next(e?e(u,d,l,c++):d),()=>{i=null,a()}))},()=>{o=!0,a()}))})}function zd(t,e){return q(e)?Me(()=>t,e):Me(()=>t)}function Lm(t){return W((e,n)=>{we(t).subscribe(G(n,()=>n.complete(),qi)),!n.closed&&e.subscribe(n)})}function Ke(t,e,n){let r=q(t)||e||n?{next:t,error:e,complete:n}:t;return r?W((i,s)=>{var o;(o=r.subscribe)===null||o===void 0||o.call(r);let a=!0;i.subscribe(G(s,u=>{var c;(c=r.next)===null||c===void 0||c.call(r,u),s.next(u)},()=>{var u;a=!1,(u=r.complete)===null||u===void 0||u.call(r),s.complete()},u=>{var c;a=!1,(c=r.error)===null||c===void 0||c.call(r,u),s.error(u)},()=>{var u,c;a&&((u=r.unsubscribe)===null||u===void 0||u.call(r)),(c=r.finalize)===null||c===void 0||c.call(r)}))}):gt}function jm(...t){let e=fo(t);return W((n,r)=>{let i=t.length,s=new Array(i),o=t.map(()=>!1),a=!1;for(let u=0;u<i;u++)we(t[u]).subscribe(G(r,c=>{s[u]=c,!a&&!o[u]&&(o[u]=!0,(a=o.every(gt))&&(o=null))},qi));n.subscribe(G(r,u=>{if(a){let c=[u,...s];r.next(e?e(...c):c)}}))})}var nV="https://g.co/ng/security#xss",U=class extends Error{constructor(e,n){super($y(e,n)),this.code=e}};function $y(t,e){return`${`NG0${Math.abs(t)}`}${e?": "+e:""}`}function Ee(t){for(let e in t)if(t[e]===Ee)return e;throw Error("Could not find renamed property on target object.")}function rV(t,e){for(let n in e)e.hasOwnProperty(n)&&!t.hasOwnProperty(n)&&(t[n]=e[n])}function Ut(t){if(typeof t=="string")return t;if(Array.isArray(t))return"["+t.map(Ut).join(", ")+"]";if(t==null)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;let e=t.toString();if(e==null)return""+e;let n=e.indexOf(`
`);return n===-1?e:e.substring(0,n)}function m0(t,e){return t==null||t===""?e===null?"":e:e==null||e===""?t:t+" "+e}var iV=Ee({__forward_ref__:Ee});function ku(t){return t.__forward_ref__=ku,t.toString=function(){return Ut(this())},t}function xt(t){return tb(t)?t():t}function tb(t){return typeof t=="function"&&t.hasOwnProperty(iV)&&t.__forward_ref__===ku}function nb(t){return t&&!!t.\u0275providers}var sV=Ee({\u0275cmp:Ee}),oV=Ee({\u0275dir:Ee}),aV=Ee({\u0275pipe:Ee}),uV=Ee({\u0275mod:Ee}),nh=Ee({\u0275fac:Ee}),Eu=Ee({__NG_ELEMENT_ID__:Ee}),y0=Ee({__NG_ENV_ID__:Ee});function rb(t){return typeof t=="string"?t:t==null?"":String(t)}function cV(t){return typeof t=="function"?t.name||t.toString():typeof t=="object"&&t!=null&&typeof t.type=="function"?t.type.name||t.type.toString():rb(t)}function lV(t,e){let n=e?`. Dependency path: ${e.join(" > ")} > ${t}`:"";throw new U(-200,t)}function Hy(t,e){throw new U(-201,!1)}function k(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function Qe(t){return{providers:t.providers||[],imports:t.imports||[]}}function Ch(t){return _0(t,sb)||_0(t,ob)}function ib(t){return Ch(t)!==null}function _0(t,e){return t.hasOwnProperty(e)?t[e]:null}function dV(t){let e=t&&(t[sb]||t[ob]);return e||null}function v0(t){return t&&(t.hasOwnProperty(w0)||t.hasOwnProperty(hV))?t[w0]:null}var sb=Ee({\u0275prov:Ee}),w0=Ee({\u0275inj:Ee}),ob=Ee({ngInjectableDef:Ee}),hV=Ee({ngInjectorDef:Ee}),ne=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}(ne||{}),ey;function ab(){return ey}function cn(t){let e=ey;return ey=t,e}function ub(t,e,n){let r=Ch(t);if(r&&r.providedIn=="root")return r.value===void 0?r.value=r.factory():r.value;if(n&ne.Optional)return null;if(e!==void 0)return e;Hy(t,"Injector")}var zt=globalThis;var P=class{constructor(e,n){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof n=="number"?this.__NG_ELEMENT_ID__=n:n!==void 0&&(this.\u0275prov=k({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};var fV={},Cu=fV,ty="__NG_DI_FLAG__",rh="ngTempTokenPath",pV="ngTokenPath",gV=/\n/gm,mV="\u0275",E0="__source",Io;function yV(){return Io}function Yr(t){let e=Io;return Io=t,e}function _V(t,e=ne.Default){if(Io===void 0)throw new U(-203,!1);return Io===null?ub(t,void 0,e):Io.get(t,e&ne.Optional?null:void 0,e)}function I(t,e=ne.Default){return(ab()||_V)(xt(t),e)}function R(t,e=ne.Default){return I(t,Dh(e))}function Dh(t){return typeof t>"u"||typeof t=="number"?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function ny(t){let e=[];for(let n=0;n<t.length;n++){let r=xt(t[n]);if(Array.isArray(r)){if(r.length===0)throw new U(900,!1);let i,s=ne.Default;for(let o=0;o<r.length;o++){let a=r[o],u=vV(a);typeof u=="number"?u===-1?i=a.token:s|=u:i=a}e.push(I(i,s))}else e.push(I(r))}return e}function cb(t,e){return t[ty]=e,t.prototype[ty]=e,t}function vV(t){return t[ty]}function wV(t,e,n,r){let i=t[rh];throw e[E0]&&i.unshift(e[E0]),t.message=EV(`
`+t.message,i,n,r),t[pV]=i,t[rh]=null,t}function EV(t,e,n,r=null){t=t&&t.charAt(0)===`
`&&t.charAt(1)==mV?t.slice(2):t;let i=Ut(e);if(Array.isArray(e))i=e.map(Ut).join(" -> ");else if(typeof e=="object"){let s=[];for(let o in e)if(e.hasOwnProperty(o)){let a=e[o];s.push(o+":"+(typeof a=="string"?JSON.stringify(a):Ut(a)))}i=`{${s.join(", ")}}`}return`${n}${r?"("+r+")":""}[${i}]: ${t.replace(gV,`
  `)}`}function Ou(t){return{toString:t}.toString()}var lb=function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t}(lb||{}),Kn=function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}(Kn||{}),Do={},ln=[],hn=function(t){return t[t.None=0]="None",t[t.SignalBased=1]="SignalBased",t[t.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",t}(hn||{});function db(t,e,n){let r=t.length;for(;;){let i=t.indexOf(e,n);if(i===-1)return i;if(i===0||t.charCodeAt(i-1)<=32){let s=e.length;if(i+s===r||t.charCodeAt(i+s)<=32)return i}n=i+1}}function ry(t,e,n){let r=0;for(;r<n.length;){let i=n[r];if(typeof i=="number"){if(i!==0)break;r++;let s=n[r++],o=n[r++],a=n[r++];t.setAttribute(e,o,a,s)}else{let s=i,o=n[++r];CV(s)?t.setProperty(e,s,o):t.setAttribute(e,s,o),r++}}return r}function IV(t){return t===3||t===4||t===6}function CV(t){return t.charCodeAt(0)===64}function Du(t,e){if(!(e===null||e.length===0))if(t===null||t.length===0)t=e.slice();else{let n=-1;for(let r=0;r<e.length;r++){let i=e[r];typeof i=="number"?n=i:n===0||(n===-1||n===2?I0(t,n,i,null,e[++r]):I0(t,n,i,null,null))}}return t}function I0(t,e,n,r,i){let s=0,o=t.length;if(e===-1)o=-1;else for(;s<t.length;){let a=t[s++];if(typeof a=="number"){if(a===e){o=-1;break}else if(a>e){o=s-1;break}}}for(;s<t.length;){let a=t[s];if(typeof a=="number")break;if(a===n){if(r===null){i!==null&&(t[s+1]=i);return}else if(r===t[s+1]){t[s+2]=i;return}}s++,r!==null&&s++,i!==null&&s++}o!==-1&&(t.splice(o,0,e),s=o+1),t.splice(s++,0,n),r!==null&&t.splice(s++,0,r),i!==null&&t.splice(s++,0,i)}var hb="ng-template";function DV(t,e,n){let r=0,i=!0;for(;r<t.length;){let s=t[r++];if(typeof s=="string"&&i){let o=t[r++];if(n&&s==="class"&&db(o.toLowerCase(),e,0)!==-1)return!0}else if(s===1){for(;r<t.length&&typeof(s=t[r++])=="string";)if(s.toLowerCase()===e)return!0;return!1}else typeof s=="number"&&(i=!1)}return!1}function fb(t){return t.type===4&&t.value!==hb}function TV(t,e,n){let r=t.type===4&&!n?hb:t.value;return e===r}function bV(t,e,n){let r=4,i=t.attrs||[],s=xV(i),o=!1;for(let a=0;a<e.length;a++){let u=e[a];if(typeof u=="number"){if(!o&&!Sn(r)&&!Sn(u))return!1;if(o&&Sn(u))continue;o=!1,r=u|r&1;continue}if(!o)if(r&4){if(r=2|r&1,u!==""&&!TV(t,u,n)||u===""&&e.length===1){if(Sn(r))return!1;o=!0}}else{let c=r&8?u:e[++a];if(r&8&&t.attrs!==null){if(!DV(t.attrs,c,n)){if(Sn(r))return!1;o=!0}continue}let l=r&8?"class":u,d=SV(l,i,fb(t),n);if(d===-1){if(Sn(r))return!1;o=!0;continue}if(c!==""){let h;d>s?h="":h=i[d+1].toLowerCase();let f=r&8?h:null;if(f&&db(f,c,0)!==-1||r&2&&c!==h){if(Sn(r))return!1;o=!0}}}}return Sn(r)||o}function Sn(t){return(t&1)===0}function SV(t,e,n,r){if(e===null)return-1;let i=0;if(r||!n){let s=!1;for(;i<e.length;){let o=e[i];if(o===t)return i;if(o===3||o===6)s=!0;else if(o===1||o===2){let a=e[++i];for(;typeof a=="string";)a=e[++i];continue}else{if(o===4)break;if(o===0){i+=4;continue}}i+=s?1:2}return-1}else return MV(e,t)}function AV(t,e,n=!1){for(let r=0;r<e.length;r++)if(bV(t,e[r],n))return!0;return!1}function xV(t){for(let e=0;e<t.length;e++){let n=t[e];if(IV(n))return e}return t.length}function MV(t,e){let n=t.indexOf(4);if(n>-1)for(n++;n<t.length;){let r=t[n];if(typeof r=="number")return-1;if(r===e)return n;n++}return-1}function C0(t,e){return t?":not("+e.trim()+")":e}function RV(t){let e=t[0],n=1,r=2,i="",s=!1;for(;n<t.length;){let o=t[n];if(typeof o=="string")if(r&2){let a=t[++n];i+="["+o+(a.length>0?'="'+a+'"':"")+"]"}else r&8?i+="."+o:r&4&&(i+=" "+o);else i!==""&&!Sn(o)&&(e+=C0(s,i),i=""),r=o,s=s||!Sn(r);n++}return i!==""&&(e+=C0(s,i)),e}function NV(t){return t.map(RV).join(",")}function PV(t){let e=[],n=[],r=1,i=2;for(;r<t.length;){let s=t[r];if(typeof s=="string")i===2?s!==""&&e.push(s,t[++r]):i===8&&n.push(s);else{if(!Sn(i))break;i=s}r++}return{attrs:e,classes:n}}function No(t){return Ou(()=>{let e=_b(t),n=he(x({},e),{decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===lb.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&t.dependencies||null,getStandaloneInjector:null,signals:t.signals??!1,data:t.data||{},encapsulation:t.encapsulation||Kn.Emulated,styles:t.styles||ln,_:null,schemas:t.schemas||null,tView:null,id:""});vb(n);let r=t.dependencies;return n.directiveDefs=T0(r,!1),n.pipeDefs=T0(r,!0),n.id=FV(n),n})}function kV(t){return Xr(t)||pb(t)}function OV(t){return t!==null}function Ye(t){return Ou(()=>({type:t.type,bootstrap:t.bootstrap||ln,declarations:t.declarations||ln,imports:t.imports||ln,exports:t.exports||ln,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function D0(t,e){if(t==null)return Do;let n={};for(let r in t)if(t.hasOwnProperty(r)){let i=t[r],s,o,a=hn.None;Array.isArray(i)?(a=i[0],s=i[1],o=i[2]??s):(s=i,o=i),e?(n[s]=a!==hn.None?[r,a]:r,e[s]=o):n[s]=r}return n}function Xn(t){return Ou(()=>{let e=_b(t);return vb(e),e})}function Xr(t){return t[sV]||null}function pb(t){return t[oV]||null}function gb(t){return t[aV]||null}function mb(t){let e=Xr(t)||pb(t)||gb(t);return e!==null?e.standalone:!1}function yb(t,e){let n=t[uV]||null;if(!n&&e===!0)throw new Error(`Type ${Ut(t)} does not have '\u0275mod' property.`);return n}function _b(t){let e={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:e,inputTransforms:null,inputConfig:t.inputs||Do,exportAs:t.exportAs||null,standalone:t.standalone===!0,signals:t.signals===!0,selectors:t.selectors||ln,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:D0(t.inputs,e),outputs:D0(t.outputs),debugInfo:null}}function vb(t){t.features?.forEach(e=>e(t))}function T0(t,e){if(!t)return null;let n=e?gb:kV;return()=>(typeof t=="function"?t():t).map(r=>n(r)).filter(OV)}function FV(t){let e=0,n=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,t.consts,t.vars,t.decls,t.encapsulation,t.standalone,t.signals,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery].join("|");for(let i of n)e=Math.imul(31,e)+i.charCodeAt(0)<<0;return e+=2147483648,"c"+e}var Sr=0,ue=1,H=2,Et=3,An=4,Mn=5,ih=6,Tu=7,xn=8,To=9,Jr=10,It=11,bu=12,b0=13,Po=14,Qn=15,Th=16,_o=17,Su=18,bh=19,wb=20,Zr=21,Um=22,Xi=23,ei=25,Eb=1;var Ji=7,sh=8,oh=9,dn=10,qy=function(t){return t[t.None=0]="None",t[t.HasTransplantedViews=2]="HasTransplantedViews",t}(qy||{});function Yi(t){return Array.isArray(t)&&typeof t[Eb]=="object"}function Ar(t){return Array.isArray(t)&&t[Eb]===!0}function Ib(t){return(t.flags&4)!==0}function Sh(t){return t.componentOffset>-1}function Gy(t){return(t.flags&1)===1}function ti(t){return!!t.template}function VV(t){return(t[H]&512)!==0}function bo(t,e){let n=t.hasOwnProperty(nh);return n?t[nh]:null}var iy=class{constructor(e,n,r){this.previousValue=e,this.currentValue=n,this.firstChange=r}isFirstChange(){return this.firstChange}};function Cb(t,e,n,r){e!==null?e.applyValueToInputSignal(e,r):t[n]=r}function ko(){return Db}function Db(t){return t.type.prototype.ngOnChanges&&(t.setInput=jV),LV}ko.ngInherit=!0;function LV(){let t=bb(this),e=t?.current;if(e){let n=t.previous;if(n===Do)t.previous=e;else for(let r in e)n[r]=e[r];t.current=null,this.ngOnChanges(e)}}function jV(t,e,n,r,i){let s=this.declaredInputs[r],o=bb(t)||UV(t,{previous:Do,current:null}),a=o.current||(o.current={}),u=o.previous,c=u[s];a[s]=new iy(c&&c.currentValue,n,u===Do),Cb(t,e,i,n)}var Tb="__ngSimpleChanges__";function bb(t){return t[Tb]||null}function UV(t,e){return t[Tb]=e}var S0=null;var zn=function(t,e,n){S0?.(t,e,n)},BV="svg",$V="math",HV=!1;function qV(){return HV}function Yn(t){for(;Array.isArray(t);)t=t[Sr];return t}function Sb(t,e){return Yn(e[t])}function Rn(t,e){return Yn(e[t.index])}function Ab(t,e){return t.data[e]}function ri(t,e){let n=e[t];return Yi(n)?n:n[Sr]}function zy(t){return(t[H]&128)===128}function GV(t){return Ar(t[Et])}function ah(t,e){return e==null?null:t[e]}function xb(t){t[_o]=0}function zV(t){t[H]&1024||(t[H]|=1024,zy(t)&&Au(t))}function WV(t,e){for(;t>0;)e=e[Po],t--;return e}function Wy(t){return!!(t[H]&9216||t[Xi]?.dirty)}function sy(t){Wy(t)?Au(t):t[H]&64&&(qV()?(t[H]|=1024,Au(t)):t[Jr].changeDetectionScheduler?.notify())}function Au(t){t[Jr].changeDetectionScheduler?.notify();let e=xu(t);for(;e!==null&&!(e[H]&8192||(e[H]|=8192,!zy(e)));)e=xu(e)}function Mb(t,e){if((t[H]&256)===256)throw new U(911,!1);t[Zr]===null&&(t[Zr]=[]),t[Zr].push(e)}function KV(t,e){if(t[Zr]===null)return;let n=t[Zr].indexOf(e);n!==-1&&t[Zr].splice(n,1)}function xu(t){let e=t[Et];return Ar(e)?e[Et]:e}var oe={lFrame:Ub(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function QV(){return oe.lFrame.elementDepthCount}function YV(){oe.lFrame.elementDepthCount++}function ZV(){oe.lFrame.elementDepthCount--}function Rb(){return oe.bindingsEnabled}function XV(){return oe.skipHydrationRootTNode!==null}function JV(t){return oe.skipHydrationRootTNode===t}function eL(){oe.skipHydrationRootTNode=null}function Be(){return oe.lFrame.lView}function Jn(){return oe.lFrame.tView}function Nb(t){return oe.lFrame.contextLView=t,t[xn]}function Pb(t){return oe.lFrame.contextLView=null,t}function fn(){let t=kb();for(;t!==null&&t.type===64;)t=t.parent;return t}function kb(){return oe.lFrame.currentTNode}function tL(){let t=oe.lFrame,e=t.currentTNode;return t.isParent?e:e.parent}function Fu(t,e){let n=oe.lFrame;n.currentTNode=t,n.isParent=e}function Ob(){return oe.lFrame.isParent}function nL(){oe.lFrame.isParent=!1}function rL(t){return oe.lFrame.bindingIndex=t}function Fb(){return oe.lFrame.bindingIndex++}function iL(t){let e=oe.lFrame,n=e.bindingIndex;return e.bindingIndex=e.bindingIndex+t,n}function sL(){return oe.lFrame.inI18n}function oL(t,e){let n=oe.lFrame;n.bindingIndex=n.bindingRootIndex=t,oy(e)}function aL(){return oe.lFrame.currentDirectiveIndex}function oy(t){oe.lFrame.currentDirectiveIndex=t}function uL(t){let e=oe.lFrame.currentDirectiveIndex;return e===-1?null:t[e]}function Vb(t){oe.lFrame.currentQueryIndex=t}function cL(t){let e=t[ue];return e.type===2?e.declTNode:e.type===1?t[Mn]:null}function Lb(t,e,n){if(n&ne.SkipSelf){let i=e,s=t;for(;i=i.parent,i===null&&!(n&ne.Host);)if(i=cL(s),i===null||(s=s[Po],i.type&10))break;if(i===null)return!1;e=i,t=s}let r=oe.lFrame=jb();return r.currentTNode=e,r.lView=t,!0}function Ky(t){let e=jb(),n=t[ue];oe.lFrame=e,e.currentTNode=n.firstChild,e.lView=t,e.tView=n,e.contextLView=t,e.bindingIndex=n.bindingStartIndex,e.inI18n=!1}function jb(){let t=oe.lFrame,e=t===null?null:t.child;return e===null?Ub(t):e}function Ub(t){let e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return t!==null&&(t.child=e),e}function Bb(){let t=oe.lFrame;return oe.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}var $b=Bb;function Qy(){let t=Bb();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function lL(t){return(oe.lFrame.contextLView=WV(t,oe.lFrame.contextLView))[xn]}function Oo(){return oe.lFrame.selectedIndex}function es(t){oe.lFrame.selectedIndex=t}function dL(){let t=oe.lFrame;return Ab(t.tView,t.selectedIndex)}function hL(){return oe.lFrame.currentNamespace}var Hb=!0;function Yy(){return Hb}function Zy(t){Hb=t}function fL(t,e,n){let{ngOnChanges:r,ngOnInit:i,ngDoCheck:s}=e.type.prototype;if(r){let o=Db(e);(n.preOrderHooks??=[]).push(t,o),(n.preOrderCheckHooks??=[]).push(t,o)}i&&(n.preOrderHooks??=[]).push(0-t,i),s&&((n.preOrderHooks??=[]).push(t,s),(n.preOrderCheckHooks??=[]).push(t,s))}function Xy(t,e){for(let n=e.directiveStart,r=e.directiveEnd;n<r;n++){let s=t.data[n].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:a,ngAfterViewInit:u,ngAfterViewChecked:c,ngOnDestroy:l}=s;o&&(t.contentHooks??=[]).push(-n,o),a&&((t.contentHooks??=[]).push(n,a),(t.contentCheckHooks??=[]).push(n,a)),u&&(t.viewHooks??=[]).push(-n,u),c&&((t.viewHooks??=[]).push(n,c),(t.viewCheckHooks??=[]).push(n,c)),l!=null&&(t.destroyHooks??=[]).push(n,l)}}function Zd(t,e,n){qb(t,e,3,n)}function Xd(t,e,n,r){(t[H]&3)===n&&qb(t,e,n,r)}function Bm(t,e){let n=t[H];(n&3)===e&&(n&=16383,n+=1,t[H]=n)}function qb(t,e,n,r){let i=r!==void 0?t[_o]&65535:0,s=r??-1,o=e.length-1,a=0;for(let u=i;u<o;u++)if(typeof e[u+1]=="number"){if(a=e[u],r!=null&&a>=r)break}else e[u]<0&&(t[_o]+=65536),(a<s||s==-1)&&(pL(t,n,e,u),t[_o]=(t[_o]&4294901760)+u+2),u++}function A0(t,e){zn(4,t,e);let n=Gt(null);try{e.call(t)}finally{Gt(n),zn(5,t,e)}}function pL(t,e,n,r){let i=n[r]<0,s=n[r+1],o=i?-n[r]:n[r],a=t[o];i?t[H]>>14<t[_o]>>16&&(t[H]&3)===e&&(t[H]+=16384,A0(a,s)):A0(a,s)}var Co=-1,ts=class{constructor(e,n,r){this.factory=e,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=r}};function gL(t){return t instanceof ts}function mL(t){return(t.flags&8)!==0}function yL(t){return(t.flags&16)!==0}function Gb(t){return t!==Co}function uh(t){return t&32767}function _L(t){return t>>16}function ch(t,e){let n=_L(t),r=e;for(;n>0;)r=r[Po],n--;return r}var ay=!0;function x0(t){let e=ay;return ay=t,e}var vL=256,zb=vL-1,Wb=5,wL=0,Wn={};function EL(t,e,n){let r;typeof n=="string"?r=n.charCodeAt(0)||0:n.hasOwnProperty(Eu)&&(r=n[Eu]),r==null&&(r=n[Eu]=wL++);let i=r&zb,s=1<<i;e.data[t+(i>>Wb)]|=s}function lh(t,e){let n=Kb(t,e);if(n!==-1)return n;let r=e[ue];r.firstCreatePass&&(t.injectorIndex=e.length,$m(r.data,t),$m(e,null),$m(r.blueprint,null));let i=Jy(t,e),s=t.injectorIndex;if(Gb(i)){let o=uh(i),a=ch(i,e),u=a[ue].data;for(let c=0;c<8;c++)e[s+c]=a[o+c]|u[o+c]}return e[s+8]=i,s}function $m(t,e){t.push(0,0,0,0,0,0,0,0,e)}function Kb(t,e){return t.injectorIndex===-1||t.parent&&t.parent.injectorIndex===t.injectorIndex||e[t.injectorIndex+8]===null?-1:t.injectorIndex}function Jy(t,e){if(t.parent&&t.parent.injectorIndex!==-1)return t.parent.injectorIndex;let n=0,r=null,i=e;for(;i!==null;){if(r=Jb(i),r===null)return Co;if(n++,i=i[Po],r.injectorIndex!==-1)return r.injectorIndex|n<<16}return Co}function uy(t,e,n){EL(t,e,n)}function Qb(t,e,n){if(n&ne.Optional||t!==void 0)return t;Hy(e,"NodeInjector")}function Yb(t,e,n,r){if(n&ne.Optional&&r===void 0&&(r=null),!(n&(ne.Self|ne.Host))){let i=t[To],s=cn(void 0);try{return i?i.get(e,r,n&ne.Optional):ub(e,r,n&ne.Optional)}finally{cn(s)}}return Qb(r,e,n)}function Zb(t,e,n,r=ne.Default,i){if(t!==null){if(e[H]&2048&&!(r&ne.Self)){let o=bL(t,e,n,r,Wn);if(o!==Wn)return o}let s=Xb(t,e,n,r,Wn);if(s!==Wn)return s}return Yb(e,n,r,i)}function Xb(t,e,n,r,i){let s=DL(n);if(typeof s=="function"){if(!Lb(e,t,r))return r&ne.Host?Qb(i,n,r):Yb(e,n,r,i);try{let o;if(o=s(r),o==null&&!(r&ne.Optional))Hy(n);else return o}finally{$b()}}else if(typeof s=="number"){let o=null,a=Kb(t,e),u=Co,c=r&ne.Host?e[Qn][Mn]:null;for((a===-1||r&ne.SkipSelf)&&(u=a===-1?Jy(t,e):e[a+8],u===Co||!R0(r,!1)?a=-1:(o=e[ue],a=uh(u),e=ch(u,e)));a!==-1;){let l=e[ue];if(M0(s,a,l.data)){let d=IL(a,e,n,o,r,c);if(d!==Wn)return d}u=e[a+8],u!==Co&&R0(r,e[ue].data[a+8]===c)&&M0(s,a,e)?(o=l,a=uh(u),e=ch(u,e)):a=-1}}return i}function IL(t,e,n,r,i,s){let o=e[ue],a=o.data[t+8],u=r==null?Sh(a)&&ay:r!=o&&(a.type&3)!==0,c=i&ne.Host&&s===a,l=CL(a,o,n,u,c);return l!==null?So(e,o,l,a):Wn}function CL(t,e,n,r,i){let s=t.providerIndexes,o=e.data,a=s&1048575,u=t.directiveStart,c=t.directiveEnd,l=s>>20,d=r?a:a+l,h=i?a+l:c;for(let f=d;f<h;f++){let p=o[f];if(f<u&&n===p||f>=u&&p.type===n)return f}if(i){let f=o[u];if(f&&ti(f)&&f.type===n)return u}return null}function So(t,e,n,r){let i=t[n],s=e.data;if(gL(i)){let o=i;o.resolving&&lV(cV(s[n]));let a=x0(o.canSeeViewProviders);o.resolving=!0;let u,c=o.injectImpl?cn(o.injectImpl):null,l=Lb(t,r,ne.Default);try{i=t[n]=o.factory(void 0,s,t,r),e.firstCreatePass&&n>=r.directiveStart&&fL(n,s[n],e)}finally{c!==null&&cn(c),x0(a),o.resolving=!1,$b()}}return i}function DL(t){if(typeof t=="string")return t.charCodeAt(0)||0;let e=t.hasOwnProperty(Eu)?t[Eu]:void 0;return typeof e=="number"?e>=0?e&zb:TL:e}function M0(t,e,n){let r=1<<t;return!!(n[e+(t>>Wb)]&r)}function R0(t,e){return!(t&ne.Self)&&!(t&ne.Host&&e)}var Zi=class{constructor(e,n){this._tNode=e,this._lView=n}get(e,n,r){return Zb(this._tNode,this._lView,e,Dh(r),n)}};function TL(){return new Zi(fn(),Be())}function Vu(t){return Ou(()=>{let e=t.prototype.constructor,n=e[nh]||cy(e),r=Object.prototype,i=Object.getPrototypeOf(t.prototype).constructor;for(;i&&i!==r;){let s=i[nh]||cy(i);if(s&&s!==n)return s;i=Object.getPrototypeOf(i)}return s=>new s})}function cy(t){return tb(t)?()=>{let e=cy(xt(t));return e&&e()}:bo(t)}function bL(t,e,n,r,i){let s=t,o=e;for(;s!==null&&o!==null&&o[H]&2048&&!(o[H]&512);){let a=Xb(s,o,n,r|ne.Self,Wn);if(a!==Wn)return a;let u=s.parent;if(!u){let c=o[wb];if(c){let l=c.get(n,Wn,r);if(l!==Wn)return l}u=Jb(o),o=o[Po]}s=u}return i}function Jb(t){let e=t[ue],n=e.type;return n===2?e.declTNode:n===1?t[Mn]:null}var Wd="__parameters__";function SL(t){return function(...n){if(t){let r=t(...n);for(let i in r)this[i]=r[i]}}}function eS(t,e,n){return Ou(()=>{let r=SL(e);function i(...s){if(this instanceof i)return r.apply(this,s),this;let o=new i(...s);return a.annotation=o,a;function a(u,c,l){let d=u.hasOwnProperty(Wd)?u[Wd]:Object.defineProperty(u,Wd,{value:[]})[Wd];for(;d.length<=l;)d.push(null);return(d[l]=d[l]||[]).push(o),u}}return n&&(i.prototype=Object.create(n.prototype)),i.prototype.ngMetadataName=t,i.annotationCls=i,i})}function AL(t){let e=zt.ng;if(e&&e.\u0275compilerFacade)return e.\u0275compilerFacade;throw new Error("JIT compiler unavailable")}function xL(t){return typeof t=="function"}function e_(t,e){t.forEach(n=>Array.isArray(n)?e_(n,e):e(n))}function tS(t,e,n){e>=t.length?t.push(n):t.splice(e,0,n)}function dh(t,e){return e>=t.length-1?t.pop():t.splice(e,1)[0]}function ML(t,e,n,r){let i=t.length;if(i==e)t.push(n,r);else if(i===1)t.push(r,t[0]),t[0]=n;else{for(i--,t.push(t[i-1],t[i]);i>e;){let s=i-2;t[i]=t[s],i--}t[e]=n,t[e+1]=r}}function RL(t,e,n){let r=Lu(t,e);return r>=0?t[r|1]=n:(r=~r,ML(t,r,e,n)),r}function Hm(t,e){let n=Lu(t,e);if(n>=0)return t[n|1]}function Lu(t,e){return NL(t,e,1)}function NL(t,e,n){let r=0,i=t.length>>n;for(;i!==r;){let s=r+(i-r>>1),o=t[s<<n];if(e===o)return s<<n;o>e?i=s:r=s+1}return~(i<<n)}var Fo=cb(eS("Optional"),8);var t_=cb(eS("SkipSelf"),4);function PL(t){let e=[],n=new Map;function r(i){let s=n.get(i);if(!s){let o=t(i);n.set(i,s=o.then(VL))}return s}return hh.forEach((i,s)=>{let o=[];i.templateUrl&&o.push(r(i.templateUrl).then(c=>{i.template=c}));let a=typeof i.styles=="string"?[i.styles]:i.styles||[];if(i.styles=a,i.styleUrl&&i.styleUrls?.length)throw new Error("@Component cannot define both `styleUrl` and `styleUrls`. Use `styleUrl` if the component has one stylesheet, or `styleUrls` if it has multiple");if(i.styleUrls?.length){let c=i.styles.length,l=i.styleUrls;i.styleUrls.forEach((d,h)=>{a.push(""),o.push(r(d).then(f=>{a[c+h]=f,l.splice(l.indexOf(d),1),l.length==0&&(i.styleUrls=void 0)}))})}else i.styleUrl&&o.push(r(i.styleUrl).then(c=>{a.push(c),i.styleUrl=void 0}));let u=Promise.all(o).then(()=>LL(s));e.push(u)}),OL(),Promise.all(e).then(()=>{})}var hh=new Map,kL=new Set;function OL(){let t=hh;return hh=new Map,t}function FL(){return hh.size===0}function VL(t){return typeof t=="string"?t:t.text()}function LL(t){kL.delete(t)}var Ao=new P(""),nS=new P("",-1),rS=new P(""),fh=class{get(e,n=Cu){if(n===Cu){let r=new Error(`NullInjectorError: No provider for ${Ut(e)}!`);throw r.name="NullInjectorError",r}return n}};function jL(...t){return{\u0275providers:iS(!0,t),\u0275fromNgModule:!0}}function iS(t,...e){let n=[],r=new Set,i,s=o=>{n.push(o)};return e_(e,o=>{let a=o;ly(a,s,[],r)&&(i||=[],i.push(a))}),i!==void 0&&sS(i,s),n}function sS(t,e){for(let n=0;n<t.length;n++){let{ngModule:r,providers:i}=t[n];n_(i,s=>{e(s,r)})}}function ly(t,e,n,r){if(t=xt(t),!t)return!1;let i=null,s=v0(t),o=!s&&Xr(t);if(!s&&!o){let u=t.ngModule;if(s=v0(u),s)i=u;else return!1}else{if(o&&!o.standalone)return!1;i=t}let a=r.has(i);if(o){if(a)return!1;if(r.add(i),o.dependencies){let u=typeof o.dependencies=="function"?o.dependencies():o.dependencies;for(let c of u)ly(c,e,n,r)}}else if(s){if(s.imports!=null&&!a){r.add(i);let c;try{e_(s.imports,l=>{ly(l,e,n,r)&&(c||=[],c.push(l))})}finally{}c!==void 0&&sS(c,e)}if(!a){let c=bo(i)||(()=>new i);e({provide:i,useFactory:c,deps:ln},i),e({provide:rS,useValue:i,multi:!0},i),e({provide:Ao,useValue:()=>I(i),multi:!0},i)}let u=s.providers;if(u!=null&&!a){let c=t;n_(u,l=>{e(l,c)})}}else return!1;return i!==t&&t.providers!==void 0}function n_(t,e){for(let n of t)nb(n)&&(n=n.\u0275providers),Array.isArray(n)?n_(n,e):e(n)}var UL=Ee({provide:String,useValue:Ee});function oS(t){return t!==null&&typeof t=="object"&&UL in t}function BL(t){return!!(t&&t.useExisting)}function $L(t){return!!(t&&t.useFactory)}function xo(t){return typeof t=="function"}function HL(t){return!!t.useClass}var Ah=new P(""),Jd={},qL={},qm;function r_(){return qm===void 0&&(qm=new fh),qm}var Wt=class{},Mu=class extends Wt{get destroyed(){return this._destroyed}constructor(e,n,r,i){super(),this.parent=n,this.source=r,this.scopes=i,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,hy(e,o=>this.processProvider(o)),this.records.set(nS,vo(void 0,this)),i.has("environment")&&this.records.set(Wt,vo(void 0,this));let s=this.records.get(Ah);s!=null&&typeof s.value=="string"&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(rS,ln,ne.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(let n of this._ngOnDestroyHooks)n.ngOnDestroy();let e=this._onDestroyHooks;this._onDestroyHooks=[];for(let n of e)n()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(e){return this.assertNotDestroyed(),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){this.assertNotDestroyed();let n=Yr(this),r=cn(void 0),i;try{return e()}finally{Yr(n),cn(r)}}get(e,n=Cu,r=ne.Default){if(this.assertNotDestroyed(),e.hasOwnProperty(y0))return e[y0](this);r=Dh(r);let i,s=Yr(this),o=cn(void 0);try{if(!(r&ne.SkipSelf)){let u=this.records.get(e);if(u===void 0){let c=QL(e)&&Ch(e);c&&this.injectableDefInScope(c)?u=vo(dy(e),Jd):u=null,this.records.set(e,u)}if(u!=null)return this.hydrate(e,u)}let a=r&ne.Self?r_():this.parent;return n=r&ne.Optional&&n===Cu?null:n,a.get(e,n)}catch(a){if(a.name==="NullInjectorError"){if((a[rh]=a[rh]||[]).unshift(Ut(e)),s)throw a;return wV(a,e,"R3InjectorError",this.source)}else throw a}finally{cn(o),Yr(s)}}resolveInjectorInitializers(){let e=Yr(this),n=cn(void 0),r;try{let i=this.get(Ao,ln,ne.Self);for(let s of i)s()}finally{Yr(e),cn(n)}}toString(){let e=[],n=this.records;for(let r of n.keys())e.push(Ut(r));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new U(205,!1)}processProvider(e){e=xt(e);let n=xo(e)?e:xt(e&&e.provide),r=zL(e);if(!xo(e)&&e.multi===!0){let i=this.records.get(n);i||(i=vo(void 0,Jd,!0),i.factory=()=>ny(i.multi),this.records.set(n,i)),n=e,i.multi.push(e)}this.records.set(n,r)}hydrate(e,n){return n.value===Jd&&(n.value=qL,n.value=n.factory()),typeof n.value=="object"&&n.value&&KL(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}injectableDefInScope(e){if(!e.providedIn)return!1;let n=xt(e.providedIn);return typeof n=="string"?n==="any"||this.scopes.has(n):this.injectorDefTypes.has(n)}removeOnDestroy(e){let n=this._onDestroyHooks.indexOf(e);n!==-1&&this._onDestroyHooks.splice(n,1)}};function dy(t){let e=Ch(t),n=e!==null?e.factory:bo(t);if(n!==null)return n;if(t instanceof P)throw new U(204,!1);if(t instanceof Function)return GL(t);throw new U(204,!1)}function GL(t){if(t.length>0)throw new U(204,!1);let n=dV(t);return n!==null?()=>n.factory(t):()=>new t}function zL(t){if(oS(t))return vo(void 0,t.useValue);{let e=aS(t);return vo(e,Jd)}}function aS(t,e,n){let r;if(xo(t)){let i=xt(t);return bo(i)||dy(i)}else if(oS(t))r=()=>xt(t.useValue);else if($L(t))r=()=>t.useFactory(...ny(t.deps||[]));else if(BL(t))r=()=>I(xt(t.useExisting));else{let i=xt(t&&(t.useClass||t.provide));if(WL(t))r=()=>new i(...ny(t.deps));else return bo(i)||dy(i)}return r}function vo(t,e,n=!1){return{factory:t,value:e,multi:n?[]:void 0}}function WL(t){return!!t.deps}function KL(t){return t!==null&&typeof t=="object"&&typeof t.ngOnDestroy=="function"}function QL(t){return typeof t=="function"||typeof t=="object"&&t instanceof P}function hy(t,e){for(let n of t)Array.isArray(n)?hy(n,e):n&&nb(n)?hy(n.\u0275providers,e):e(n)}function ii(t,e){t instanceof Mu&&t.assertNotDestroyed();let n,r=Yr(t),i=cn(void 0);try{return e()}finally{Yr(r),cn(i)}}function YL(t){if(!ab()&&!yV())throw new U(-203,!1)}function N0(t,e=null,n=null,r){let i=uS(t,e,n,r);return i.resolveInjectorInitializers(),i}function uS(t,e=null,n=null,r,i=new Set){let s=[n||ln,jL(t)];return r=r||(typeof t=="object"?void 0:Ut(t)),new Mu(s,e||r_(),r||null,i)}var Nn=(()=>{let e=class e{static create(r,i){if(Array.isArray(r))return N0({name:""},i,r,"");{let s=r.name??"";return N0({name:s},r.parent,r.providers,s)}}};e.THROW_IF_NOT_FOUND=Cu,e.NULL=new fh,e.\u0275prov=k({token:e,providedIn:"any",factory:()=>I(nS)}),e.__NG_ELEMENT_ID__=-1;let t=e;return t})();var fy;function cS(t){fy=t}function ZL(){if(fy!==void 0)return fy;if(typeof document<"u")return document;throw new U(210,!1)}var xh=new P("",{providedIn:"root",factory:()=>XL}),XL="ng",i_=new P(""),Ct=new P("",{providedIn:"platform",factory:()=>"unknown"});var s_=new P("",{providedIn:"root",factory:()=>ZL().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});function lS(t){return t instanceof Function?t():t}function JL(t){return(t??R(Nn)).get(Ct)==="browser"}function dS(t){return(t.flags&128)===128}var Tr=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}(Tr||{});var hS=new Map,ej=0;function tj(){return ej++}function nj(t){hS.set(t[bh],t)}function rj(t){hS.delete(t[bh])}var P0="__ngContext__";function ns(t,e){Yi(e)?(t[P0]=e[bh],nj(e)):t[P0]=e}var ij;function o_(t,e){return ij(t,e)}function wo(t,e,n,r,i){if(r!=null){let s,o=!1;Ar(r)?s=r:Yi(r)&&(o=!0,r=r[Sr]);let a=Yn(r);t===0&&n!==null?i==null?yS(e,n,a):ph(e,n,a,i||null,!0):t===1&&n!==null?ph(e,n,a,i||null,!0):t===2?Ej(e,a,o):t===3&&e.destroyNode(a),s!=null&&Cj(e,t,s,n,i)}}function sj(t,e){return t.createText(e)}function oj(t,e,n){t.setValue(e,n)}function fS(t,e,n){return t.createElement(e,n)}function aj(t,e){pS(t,e),e[Sr]=null,e[Mn]=null}function uj(t,e,n,r,i,s){r[Sr]=i,r[Mn]=e,Mh(t,r,n,1,i,s)}function pS(t,e){Mh(t,e,e[It],2,null,null)}function cj(t){let e=t[bu];if(!e)return Gm(t[ue],t);for(;e;){let n=null;if(Yi(e))n=e[bu];else{let r=e[dn];r&&(n=r)}if(!n){for(;e&&!e[An]&&e!==t;)Yi(e)&&Gm(e[ue],e),e=e[Et];e===null&&(e=t),Yi(e)&&Gm(e[ue],e),n=e&&e[An]}e=n}}function lj(t,e,n,r){let i=dn+r,s=n.length;r>0&&(n[i-1][An]=e),r<s-dn?(e[An]=n[i],tS(n,dn+r,e)):(n.push(e),e[An]=null),e[Et]=n;let o=e[Th];o!==null&&n!==o&&dj(o,e);let a=e[Su];a!==null&&a.insertView(t),sy(e),e[H]|=128}function dj(t,e){let n=t[oh],i=e[Et][Et][Qn];e[Qn]!==i&&(t[H]|=qy.HasTransplantedViews),n===null?t[oh]=[e]:n.push(e)}function gS(t,e){let n=t[oh],r=n.indexOf(e);n.splice(r,1)}function py(t,e){if(t.length<=dn)return;let n=dn+e,r=t[n];if(r){let i=r[Th];i!==null&&i!==t&&gS(i,r),e>0&&(t[n-1][An]=r[An]);let s=dh(t,dn+e);aj(r[ue],r);let o=s[Su];o!==null&&o.detachView(s[ue]),r[Et]=null,r[An]=null,r[H]&=-129}return r}function mS(t,e){if(!(e[H]&256)){let n=e[It];n.destroyNode&&Mh(t,e,n,3,null,null),cj(e)}}function Gm(t,e){if(!(e[H]&256)){e[H]&=-129,e[H]|=256,e[Xi]&&KT(e[Xi]),fj(t,e),hj(t,e),e[ue].type===1&&e[It].destroy();let n=e[Th];if(n!==null&&Ar(e[Et])){n!==e[Et]&&gS(n,e);let r=e[Su];r!==null&&r.detachView(t)}rj(e)}}function hj(t,e){let n=t.cleanup,r=e[Tu];if(n!==null)for(let s=0;s<n.length-1;s+=2)if(typeof n[s]=="string"){let o=n[s+3];o>=0?r[o]():r[-o].unsubscribe(),s+=2}else{let o=r[n[s+1]];n[s].call(o)}r!==null&&(e[Tu]=null);let i=e[Zr];if(i!==null){e[Zr]=null;for(let s=0;s<i.length;s++){let o=i[s];o()}}}function fj(t,e){let n;if(t!=null&&(n=t.destroyHooks)!=null)for(let r=0;r<n.length;r+=2){let i=e[n[r]];if(!(i instanceof ts)){let s=n[r+1];if(Array.isArray(s))for(let o=0;o<s.length;o+=2){let a=i[s[o]],u=s[o+1];zn(4,a,u);try{u.call(a)}finally{zn(5,a,u)}}else{zn(4,i,s);try{s.call(i)}finally{zn(5,i,s)}}}}}function pj(t,e,n){return gj(t,e.parent,n)}function gj(t,e,n){let r=e;for(;r!==null&&r.type&40;)e=r,r=e.parent;if(r===null)return n[Sr];{let{componentOffset:i}=r;if(i>-1){let{encapsulation:s}=t.data[r.directiveStart+i];if(s===Kn.None||s===Kn.Emulated)return null}return Rn(r,n)}}function ph(t,e,n,r,i){t.insertBefore(e,n,r,i)}function yS(t,e,n){t.appendChild(e,n)}function k0(t,e,n,r,i){r!==null?ph(t,e,n,r,i):yS(t,e,n)}function mj(t,e,n,r){t.removeChild(e,n,r)}function a_(t,e){return t.parentNode(e)}function yj(t,e){return t.nextSibling(e)}function _j(t,e,n){return wj(t,e,n)}function vj(t,e,n){return t.type&40?Rn(t,n):null}var wj=vj,O0;function u_(t,e,n,r){let i=pj(t,r,e),s=e[It],o=r.parent||e[Mn],a=_j(o,r,e);if(i!=null)if(Array.isArray(n))for(let u=0;u<n.length;u++)k0(s,i,n[u],a,!1);else k0(s,i,n,a,!1);O0!==void 0&&O0(s,r,e,n,i)}function eh(t,e){if(e!==null){let n=e.type;if(n&3)return Rn(e,t);if(n&4)return gy(-1,t[e.index]);if(n&8){let r=e.child;if(r!==null)return eh(t,r);{let i=t[e.index];return Ar(i)?gy(-1,i):Yn(i)}}else{if(n&32)return o_(e,t)()||Yn(t[e.index]);{let r=_S(t,e);if(r!==null){if(Array.isArray(r))return r[0];let i=xu(t[Qn]);return eh(i,r)}else return eh(t,e.next)}}}return null}function _S(t,e){if(e!==null){let r=t[Qn][Mn],i=e.projection;return r.projection[i]}return null}function gy(t,e){let n=dn+t+1;if(n<e.length){let r=e[n],i=r[ue].firstChild;if(i!==null)return eh(r,i)}return e[Ji]}function Ej(t,e,n){let r=a_(t,e);r&&mj(t,r,e,n)}function c_(t,e,n,r,i,s,o){for(;n!=null;){let a=r[n.index],u=n.type;if(o&&e===0&&(a&&ns(Yn(a),r),n.flags|=2),(n.flags&32)!==32)if(u&8)c_(t,e,n.child,r,i,s,!1),wo(e,t,i,a,s);else if(u&32){let c=o_(n,r),l;for(;l=c();)wo(e,t,i,l,s);wo(e,t,i,a,s)}else u&16?Ij(t,e,r,n,i,s):wo(e,t,i,a,s);n=o?n.projectionNext:n.next}}function Mh(t,e,n,r,i,s){c_(n,r,t.firstChild,e,i,s,!1)}function Ij(t,e,n,r,i,s){let o=n[Qn],u=o[Mn].projection[r.projection];if(Array.isArray(u))for(let c=0;c<u.length;c++){let l=u[c];wo(e,t,i,l,s)}else{let c=u,l=o[Et];dS(r)&&(c.flags|=128),c_(t,e,c,l,i,s,!0)}}function Cj(t,e,n,r,i){let s=n[Ji],o=Yn(n);s!==o&&wo(e,t,r,s,i);for(let a=dn;a<n.length;a++){let u=n[a];Mh(u[ue],u,t,e,r,s)}}function Dj(t,e,n,r,i){if(e)i?t.addClass(n,r):t.removeClass(n,r);else{let s=r.indexOf("-")===-1?void 0:Tr.DashCase;i==null?t.removeStyle(n,r,s):(typeof i=="string"&&i.endsWith("!important")&&(i=i.slice(0,-10),s|=Tr.Important),t.setStyle(n,r,i,s))}}function Tj(t,e,n){t.setAttribute(e,"style",n)}function vS(t,e,n){n===""?t.removeAttribute(e,"class"):t.setAttribute(e,"class",n)}function wS(t,e,n){let{mergedAttrs:r,classes:i,styles:s}=n;r!==null&&ry(t,e,r),i!==null&&vS(t,e,i),s!==null&&Tj(t,e,s)}var my=class{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${nV})`}};function l_(t){return t instanceof my?t.changingThisBreaksApplicationSecurity:t}var yy=class{};var bj="h",Sj="b";var Aj=()=>null;function d_(t,e,n=!1){return Aj(t,e,n)}var _y=class{},gh=class{};function xj(t){let e=Error(`No component factory found for ${Ut(t)}.`);return e[Mj]=t,e}var Mj="ngComponent";var vy=class{resolveComponentFactory(e){throw xj(e)}},Rh=(()=>{let e=class e{};e.NULL=new vy;let t=e;return t})();function Rj(){return Nh(fn(),Be())}function Nh(t,e){return new ss(Rn(t,e))}var ss=(()=>{let e=class e{constructor(r){this.nativeElement=r}};e.__NG_ELEMENT_ID__=Rj;let t=e;return t})();var Ru=class{},Vo=(()=>{let e=class e{constructor(){this.destroyNode=null}};e.__NG_ELEMENT_ID__=()=>Nj();let t=e;return t})();function Nj(){let t=Be(),e=fn(),n=ri(e.index,t);return(Yi(n)?n:t)[It]}var Pj=(()=>{let e=class e{};e.\u0275prov=k({token:e,providedIn:"root",factory:()=>null});let t=e;return t})(),zm={};function ES(t){return Oj(t)?Array.isArray(t)||!(t instanceof Map)&&Symbol.iterator in t:!1}function kj(t,e){if(Array.isArray(t))for(let n=0;n<t.length;n++)e(t[n]);else{let n=t[Symbol.iterator](),r;for(;!(r=n.next()).done;)e(r.value)}}function Oj(t){return t!==null&&(typeof t=="function"||typeof t=="object")}var wy=class{constructor(){}supports(e){return ES(e)}create(e){return new Ey(e)}},Fj=(t,e)=>e,Ey=class{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||Fj}forEachItem(e){let n;for(n=this._itHead;n!==null;n=n._next)e(n)}forEachOperation(e){let n=this._itHead,r=this._removalsHead,i=0,s=null;for(;n||r;){let o=!r||n&&n.currentIndex<F0(r,i,s)?n:r,a=F0(o,i,s),u=o.currentIndex;if(o===r)i--,r=r._nextRemoved;else if(n=n._next,o.previousIndex==null)i++;else{s||(s=[]);let c=a-i,l=u-i;if(c!=l){for(let h=0;h<c;h++){let f=h<s.length?s[h]:s[h]=0,p=f+h;l<=p&&p<c&&(s[h]=f+1)}let d=o.previousIndex;s[d]=l-c}}a!==u&&e(o,a,u)}}forEachPreviousItem(e){let n;for(n=this._previousItHead;n!==null;n=n._nextPrevious)e(n)}forEachAddedItem(e){let n;for(n=this._additionsHead;n!==null;n=n._nextAdded)e(n)}forEachMovedItem(e){let n;for(n=this._movesHead;n!==null;n=n._nextMoved)e(n)}forEachRemovedItem(e){let n;for(n=this._removalsHead;n!==null;n=n._nextRemoved)e(n)}forEachIdentityChange(e){let n;for(n=this._identityChangesHead;n!==null;n=n._nextIdentityChange)e(n)}diff(e){if(e==null&&(e=[]),!ES(e))throw new U(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let n=this._itHead,r=!1,i,s,o;if(Array.isArray(e)){this.length=e.length;for(let a=0;a<this.length;a++)s=e[a],o=this._trackByFn(a,s),n===null||!Object.is(n.trackById,o)?(n=this._mismatch(n,s,o,a),r=!0):(r&&(n=this._verifyReinsertion(n,s,o,a)),Object.is(n.item,s)||this._addIdentityChange(n,s)),n=n._next}else i=0,kj(e,a=>{o=this._trackByFn(i,a),n===null||!Object.is(n.trackById,o)?(n=this._mismatch(n,a,o,i),r=!0):(r&&(n=this._verifyReinsertion(n,a,o,i)),Object.is(n.item,a)||this._addIdentityChange(n,a)),n=n._next,i++}),this.length=i;return this._truncate(n),this.collection=e,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;e!==null;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;e!==null;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;e!==null;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,n,r,i){let s;return e===null?s=this._itTail:(s=e._prev,this._remove(e)),e=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null),e!==null?(Object.is(e.item,n)||this._addIdentityChange(e,n),this._reinsertAfter(e,s,i)):(e=this._linkedRecords===null?null:this._linkedRecords.get(r,i),e!==null?(Object.is(e.item,n)||this._addIdentityChange(e,n),this._moveAfter(e,s,i)):e=this._addAfter(new Iy(n,r),s,i)),e}_verifyReinsertion(e,n,r,i){let s=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null);return s!==null?e=this._reinsertAfter(s,e._prev,i):e.currentIndex!=i&&(e.currentIndex=i,this._addToMoves(e,i)),e}_truncate(e){for(;e!==null;){let n=e._next;this._addToRemovals(this._unlink(e)),e=n}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,n,r){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(e);let i=e._prevRemoved,s=e._nextRemoved;return i===null?this._removalsHead=s:i._nextRemoved=s,s===null?this._removalsTail=i:s._prevRemoved=i,this._insertAfter(e,n,r),this._addToMoves(e,r),e}_moveAfter(e,n,r){return this._unlink(e),this._insertAfter(e,n,r),this._addToMoves(e,r),e}_addAfter(e,n,r){return this._insertAfter(e,n,r),this._additionsTail===null?this._additionsTail=this._additionsHead=e:this._additionsTail=this._additionsTail._nextAdded=e,e}_insertAfter(e,n,r){let i=n===null?this._itHead:n._next;return e._next=i,e._prev=n,i===null?this._itTail=e:i._prev=e,n===null?this._itHead=e:n._next=e,this._linkedRecords===null&&(this._linkedRecords=new mh),this._linkedRecords.put(e),e.currentIndex=r,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){this._linkedRecords!==null&&this._linkedRecords.remove(e);let n=e._prev,r=e._next;return n===null?this._itHead=r:n._next=r,r===null?this._itTail=n:r._prev=n,e}_addToMoves(e,n){return e.previousIndex===n||(this._movesTail===null?this._movesTail=this._movesHead=e:this._movesTail=this._movesTail._nextMoved=e),e}_addToRemovals(e){return this._unlinkedRecords===null&&(this._unlinkedRecords=new mh),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,n){return e.item=n,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=e:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=e,e}},Iy=class{constructor(e,n){this.item=e,this.trackById=n,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}},Cy=class{constructor(){this._head=null,this._tail=null}add(e){this._head===null?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,n){let r;for(r=this._head;r!==null;r=r._nextDup)if((n===null||n<=r.currentIndex)&&Object.is(r.trackById,e))return r;return null}remove(e){let n=e._prevDup,r=e._nextDup;return n===null?this._head=r:n._nextDup=r,r===null?this._tail=n:r._prevDup=n,this._head===null}},mh=class{constructor(){this.map=new Map}put(e){let n=e.trackById,r=this.map.get(n);r||(r=new Cy,this.map.set(n,r)),r.add(e)}get(e,n){let r=e,i=this.map.get(r);return i?i.get(e,n):null}remove(e){let n=e.trackById;return this.map.get(n).remove(e)&&this.map.delete(n),e}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function F0(t,e,n){let r=t.previousIndex;if(r===null)return r;let i=0;return n&&r<n.length&&(i=n[r]),r+e+i}function V0(){return new h_([new wy])}var h_=(()=>{let e=class e{constructor(r){this.factories=r}static create(r,i){if(i!=null){let s=i.factories.slice();r=r.concat(s)}return new e(r)}static extend(r){return{provide:e,useFactory:i=>e.create(r,i||V0()),deps:[[e,new t_,new Fo]]}}find(r){let i=this.factories.find(s=>s.supports(r));if(i!=null)return i;throw new U(901,!1)}};e.\u0275prov=k({token:e,providedIn:"root",factory:V0});let t=e;return t})();function yh(t,e,n,r,i=!1){for(;n!==null;){let s=e[n.index];s!==null&&r.push(Yn(s)),Ar(s)&&Vj(s,r);let o=n.type;if(o&8)yh(t,e,n.child,r);else if(o&32){let a=o_(n,e),u;for(;u=a();)r.push(u)}else if(o&16){let a=_S(e,n);if(Array.isArray(a))r.push(...a);else{let u=xu(e[Qn]);yh(u[ue],u,a,r,!0)}}n=i?n.projectionNext:n.next}return r}function Vj(t,e){for(let n=dn;n<t.length;n++){let r=t[n],i=r[ue].firstChild;i!==null&&yh(r[ue],r,i,e)}t[Ji]!==t[Sr]&&e.push(t[Ji])}var IS=[];function Lj(t){return t[Xi]??jj(t)}function jj(t){let e=IS.pop()??Object.create(Bj);return e.lView=t,e}function Uj(t){t.lView[Xi]!==t&&(t.lView=null,IS.push(t))}var Bj=he(x({},GT),{consumerIsAlwaysLive:!0,consumerMarkedDirty:t=>{Au(t.lView)},consumerOnSignalRead(){this.lView[Xi]=this}});function CS(t){return TS(t[bu])}function DS(t){return TS(t[An])}function TS(t){for(;t!==null&&!Ar(t);)t=t[An];return t}var $j="ngOriginalError";function Wm(t){return t[$j]}var Zn=class{constructor(){this._console=console}handleError(e){let n=this._findOriginalError(e);this._console.error("ERROR",e),n&&this._console.error("ORIGINAL ERROR",n)}_findOriginalError(e){let n=e&&Wm(e);for(;n&&Wm(n);)n=Wm(n);return n||null}},bS=new P("",{providedIn:"root",factory:()=>R(Zn).handleError.bind(void 0)});var SS=!1,Hj=new P("",{providedIn:"root",factory:()=>SS});var Lo={};function er(t=1){AS(Jn(),Be(),Oo()+t,!1)}function AS(t,e,n,r){if(!r)if((e[H]&3)===3){let s=t.preOrderCheckHooks;s!==null&&Zd(e,s,n)}else{let s=t.preOrderHooks;s!==null&&Xd(e,s,0,n)}es(n)}function ke(t,e=ne.Default){let n=Be();if(n===null)return I(t,e);let r=fn();return Zb(r,n,xt(t),e)}function xS(){let t="invalid";throw new Error(t)}function MS(t,e,n,r,i,s){let o=Gt(null);try{let a=null;i&hn.SignalBased&&(a=e[r][qT]),a!==null&&a.transformFn!==void 0&&(s=a.transformFn(s)),i&hn.HasDecoratorInputTransform&&(s=t.inputTransforms[r].call(e,s)),t.setInput!==null?t.setInput(e,a,s,n,r):Cb(e,a,r,s)}finally{Gt(o)}}function qj(t,e){let n=t.hostBindingOpCodes;if(n!==null)try{for(let r=0;r<n.length;r++){let i=n[r];if(i<0)es(~i);else{let s=i,o=n[++r],a=n[++r];oL(o,s);let u=e[s];a(2,u)}}}finally{es(-1)}}function Ph(t,e,n,r,i,s,o,a,u,c,l){let d=e.blueprint.slice();return d[Sr]=i,d[H]=r|4|128|8|64,(c!==null||t&&t[H]&2048)&&(d[H]|=2048),xb(d),d[Et]=d[Po]=t,d[xn]=n,d[Jr]=o||t&&t[Jr],d[It]=a||t&&t[It],d[To]=u||t&&t[To]||null,d[Mn]=s,d[bh]=tj(),d[ih]=l,d[wb]=c,d[Qn]=e.type==2?t[Qn]:d,d}function kh(t,e,n,r,i){let s=t.data[e];if(s===null)s=Gj(t,e,n,r,i),sL()&&(s.flags|=32);else if(s.type&64){s.type=n,s.value=r,s.attrs=i;let o=tL();s.injectorIndex=o===null?-1:o.injectorIndex}return Fu(s,!0),s}function Gj(t,e,n,r,i){let s=kb(),o=Ob(),a=o?s:s&&s.parent,u=t.data[e]=Yj(t,a,n,e,r,i);return t.firstChild===null&&(t.firstChild=u),s!==null&&(o?s.child==null&&u.parent!==null&&(s.child=u):s.next===null&&(s.next=u,u.prev=s)),u}function RS(t,e,n,r){if(n===0)return-1;let i=e.length;for(let s=0;s<n;s++)e.push(r),t.blueprint.push(r),t.data.push(null);return i}function NS(t,e,n,r,i){let s=Oo(),o=r&2;try{es(-1),o&&e.length>ei&&AS(t,e,ei,!1),zn(o?2:0,i),n(r,i)}finally{es(s),zn(o?3:1,i)}}function PS(t,e,n){if(Ib(e)){let r=Gt(null);try{let i=e.directiveStart,s=e.directiveEnd;for(let o=i;o<s;o++){let a=t.data[o];a.contentQueries&&a.contentQueries(1,n[o],o)}}finally{Gt(r)}}}function kS(t,e,n){Rb()&&(r2(t,e,n,Rn(n,e)),(n.flags&64)===64&&jS(t,e,n))}function OS(t,e,n=Rn){let r=e.localNames;if(r!==null){let i=e.index+1;for(let s=0;s<r.length;s+=2){let o=r[s+1],a=o===-1?n(e,t):t[o];t[i++]=a}}}function FS(t){let e=t.tView;return e===null||e.incompleteFirstPass?t.tView=f_(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):e}function f_(t,e,n,r,i,s,o,a,u,c,l){let d=ei+r,h=d+i,f=zj(d,h),p=typeof c=="function"?c():c;return f[ue]={type:t,blueprint:f,template:n,queries:null,viewQuery:a,declTNode:e,data:f.slice().fill(null,d),bindingStartIndex:d,expandoStartIndex:h,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof s=="function"?s():s,pipeRegistry:typeof o=="function"?o():o,firstChild:null,schemas:u,consts:p,incompleteFirstPass:!1,ssrId:l}}function zj(t,e){let n=[];for(let r=0;r<e;r++)n.push(r<t?null:Lo);return n}function Wj(t,e,n,r){let s=r.get(Hj,SS)||n===Kn.ShadowDom,o=t.selectRootElement(e,s);return Kj(o),o}function Kj(t){Qj(t)}var Qj=()=>null;function Yj(t,e,n,r,i,s){let o=e?e.injectorIndex:-1,a=0;return XV()&&(a|=128),{type:n,index:r,insertBeforeIndex:null,injectorIndex:o,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:i,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function L0(t,e,n,r,i){for(let s in e){if(!e.hasOwnProperty(s))continue;let o=e[s];if(o===void 0)continue;r??={};let a,u=hn.None;Array.isArray(o)?(a=o[0],u=o[1]):a=o;let c=s;if(i!==null){if(!i.hasOwnProperty(s))continue;c=i[s]}t===0?j0(r,n,c,a,u):j0(r,n,c,a)}return r}function j0(t,e,n,r,i){let s;t.hasOwnProperty(n)?(s=t[n]).push(e,r):s=t[n]=[e,r],i!==void 0&&s.push(i)}function Zj(t,e,n){let r=e.directiveStart,i=e.directiveEnd,s=t.data,o=e.attrs,a=[],u=null,c=null;for(let l=r;l<i;l++){let d=s[l],h=n?n.get(d):null,f=h?h.inputs:null,p=h?h.outputs:null;u=L0(0,d.inputs,l,u,f),c=L0(1,d.outputs,l,c,p);let g=u!==null&&o!==null&&!fb(e)?h2(u,l,o):null;a.push(g)}u!==null&&(u.hasOwnProperty("class")&&(e.flags|=8),u.hasOwnProperty("style")&&(e.flags|=16)),e.initialInputs=a,e.inputs=u,e.outputs=c}function Xj(t){return t==="class"?"className":t==="for"?"htmlFor":t==="formaction"?"formAction":t==="innerHtml"?"innerHTML":t==="readonly"?"readOnly":t==="tabindex"?"tabIndex":t}function Jj(t,e,n,r,i,s,o,a){let u=Rn(e,n),c=e.inputs,l;!a&&c!=null&&(l=c[r])?(p_(t,n,l,r,i),Sh(e)&&e2(n,e.index)):e.type&3?(r=Xj(r),i=o!=null?o(i,e.value||"",r):i,s.setProperty(u,r,i)):e.type&12}function e2(t,e){let n=ri(e,t);n[H]&16||(n[H]|=64)}function VS(t,e,n,r){if(Rb()){let i=r===null?null:{"":-1},s=s2(t,n),o,a;s===null?o=a=null:[o,a]=s,o!==null&&LS(t,e,n,o,i,a),i&&o2(n,r,i)}n.mergedAttrs=Du(n.mergedAttrs,n.attrs)}function LS(t,e,n,r,i,s){for(let c=0;c<r.length;c++)uy(lh(n,e),t,r[c].type);u2(n,t.data.length,r.length);for(let c=0;c<r.length;c++){let l=r[c];l.providersResolver&&l.providersResolver(l)}let o=!1,a=!1,u=RS(t,e,r.length,null);for(let c=0;c<r.length;c++){let l=r[c];n.mergedAttrs=Du(n.mergedAttrs,l.hostAttrs),c2(t,n,e,u,l),a2(u,l,i),l.contentQueries!==null&&(n.flags|=4),(l.hostBindings!==null||l.hostAttrs!==null||l.hostVars!==0)&&(n.flags|=64);let d=l.type.prototype;!o&&(d.ngOnChanges||d.ngOnInit||d.ngDoCheck)&&((t.preOrderHooks??=[]).push(n.index),o=!0),!a&&(d.ngOnChanges||d.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(n.index),a=!0),u++}Zj(t,n,s)}function t2(t,e,n,r,i){let s=i.hostBindings;if(s){let o=t.hostBindingOpCodes;o===null&&(o=t.hostBindingOpCodes=[]);let a=~e.index;n2(o)!=a&&o.push(a),o.push(n,r,s)}}function n2(t){let e=t.length;for(;e>0;){let n=t[--e];if(typeof n=="number"&&n<0)return n}return 0}function r2(t,e,n,r){let i=n.directiveStart,s=n.directiveEnd;Sh(n)&&l2(e,n,t.data[i+n.componentOffset]),t.firstCreatePass||lh(n,e),ns(r,e);let o=n.initialInputs;for(let a=i;a<s;a++){let u=t.data[a],c=So(e,t,a,n);if(ns(c,e),o!==null&&d2(e,a-i,c,u,n,o),ti(u)){let l=ri(n.index,e);l[xn]=So(e,t,a,n)}}}function jS(t,e,n){let r=n.directiveStart,i=n.directiveEnd,s=n.index,o=aL();try{es(s);for(let a=r;a<i;a++){let u=t.data[a],c=e[a];oy(a),(u.hostBindings!==null||u.hostVars!==0||u.hostAttrs!==null)&&i2(u,c)}}finally{es(-1),oy(o)}}function i2(t,e){t.hostBindings!==null&&t.hostBindings(1,e)}function s2(t,e){let n=t.directiveRegistry,r=null,i=null;if(n)for(let s=0;s<n.length;s++){let o=n[s];if(AV(e,o.selectors,!1))if(r||(r=[]),ti(o))if(o.findHostDirectiveDefs!==null){let a=[];i=i||new Map,o.findHostDirectiveDefs(o,a,i),r.unshift(...a,o);let u=a.length;Dy(t,e,u)}else r.unshift(o),Dy(t,e,0);else i=i||new Map,o.findHostDirectiveDefs?.(o,r,i),r.push(o)}return r===null?null:[r,i]}function Dy(t,e,n){e.componentOffset=n,(t.components??=[]).push(e.index)}function o2(t,e,n){if(e){let r=t.localNames=[];for(let i=0;i<e.length;i+=2){let s=n[e[i+1]];if(s==null)throw new U(-301,!1);r.push(e[i],s)}}}function a2(t,e,n){if(n){if(e.exportAs)for(let r=0;r<e.exportAs.length;r++)n[e.exportAs[r]]=t;ti(e)&&(n[""]=t)}}function u2(t,e,n){t.flags|=1,t.directiveStart=e,t.directiveEnd=e+n,t.providerIndexes=e}function c2(t,e,n,r,i){t.data[r]=i;let s=i.factory||(i.factory=bo(i.type,!0)),o=new ts(s,ti(i),ke);t.blueprint[r]=o,n[r]=o,t2(t,e,r,RS(t,n,i.hostVars,Lo),i)}function l2(t,e,n){let r=Rn(e,t),i=FS(n),s=t[Jr].rendererFactory,o=16;n.signals?o=4096:n.onPush&&(o=64);let a=Oh(t,Ph(t,i,null,o,r,e,null,s.createRenderer(r,n),null,null,null));t[e.index]=a}function d2(t,e,n,r,i,s){let o=s[e];if(o!==null)for(let a=0;a<o.length;){let u=o[a++],c=o[a++],l=o[a++],d=o[a++];MS(r,n,u,c,l,d)}}function h2(t,e,n){let r=null,i=0;for(;i<n.length;){let s=n[i];if(s===0){i+=4;continue}else if(s===5){i+=2;continue}if(typeof s=="number")break;if(t.hasOwnProperty(s)){r===null&&(r=[]);let o=t[s];for(let a=0;a<o.length;a+=3)if(o[a]===e){r.push(s,o[a+1],o[a+2],n[i+1]);break}}i+=2}return r}function US(t,e,n,r){return[t,!0,0,e,null,r,null,n,null,null]}function BS(t,e){let n=t.contentQueries;if(n!==null){let r=Gt(null);try{for(let i=0;i<n.length;i+=2){let s=n[i],o=n[i+1];if(o!==-1){let a=t.data[o];Vb(s),a.contentQueries(2,e[o],o)}}}finally{Gt(r)}}}function Oh(t,e){return t[bu]?t[b0][An]=e:t[bu]=e,t[b0]=e,e}function Ty(t,e,n){Vb(0);let r=Gt(null);try{e(t,n)}finally{Gt(r)}}function f2(t){return t[Tu]||(t[Tu]=[])}function p2(t){return t.cleanup||(t.cleanup=[])}function $S(t,e){let n=t[To],r=n?n.get(Zn,null):null;r&&r.handleError(e)}function p_(t,e,n,r,i){for(let s=0;s<n.length;){let o=n[s++],a=n[s++],u=n[s++],c=e[o],l=t.data[o];MS(l,c,r,a,u,i)}}function g2(t,e,n){let r=Sb(e,t);oj(t[It],r,n)}var HS=100;function qS(t,e=!0,n=0){let r=t[Jr],i=r.rendererFactory,s=!1;s||i.begin?.();try{m2(t,n)}catch(o){throw e&&$S(t,o),o}finally{s||(i.end?.(),r.inlineEffectRunner?.flush())}}function m2(t,e){by(t,e);let n=0;for(;Wy(t);){if(n===HS)throw new U(103,!1);n++,by(t,1)}}function y2(t,e,n,r){let i=e[H];if((i&256)===256)return;let s=!1;!s&&e[Jr].inlineEffectRunner?.flush(),Ky(e);let o=null,a=null;!s&&_2(t)&&(a=Lj(e),o=zT(a));try{xb(e),rL(t.bindingStartIndex),n!==null&&NS(t,e,n,2,r);let u=(i&3)===3;if(!s)if(u){let d=t.preOrderCheckHooks;d!==null&&Zd(e,d,null)}else{let d=t.preOrderHooks;d!==null&&Xd(e,d,0,null),Bm(e,0)}if(v2(e),GS(e,0),t.contentQueries!==null&&BS(t,e),!s)if(u){let d=t.contentCheckHooks;d!==null&&Zd(e,d)}else{let d=t.contentHooks;d!==null&&Xd(e,d,1),Bm(e,1)}qj(t,e);let c=t.components;c!==null&&WS(e,c,0);let l=t.viewQuery;if(l!==null&&Ty(2,l,r),!s)if(u){let d=t.viewCheckHooks;d!==null&&Zd(e,d)}else{let d=t.viewHooks;d!==null&&Xd(e,d,2),Bm(e,2)}if(t.firstUpdatePass===!0&&(t.firstUpdatePass=!1),e[Um]){for(let d of e[Um])d();e[Um]=null}s||(e[H]&=-73)}catch(u){throw Au(e),u}finally{a!==null&&(WT(a,o),Uj(a)),Qy()}}function _2(t){return t.type!==2}function GS(t,e){for(let n=CS(t);n!==null;n=DS(n))for(let r=dn;r<n.length;r++){let i=n[r];zS(i,e)}}function v2(t){for(let e=CS(t);e!==null;e=DS(e)){if(!(e[H]&qy.HasTransplantedViews))continue;let n=e[oh];for(let r=0;r<n.length;r++){let i=n[r],s=i[Et];zV(i)}}}function w2(t,e,n){let r=ri(e,t);zS(r,n)}function zS(t,e){zy(t)&&by(t,e)}function by(t,e){let r=t[ue],i=t[H],s=t[Xi],o=!!(e===0&&i&16);if(o||=!!(i&64&&e===0),o||=!!(i&1024),o||=!!(s?.dirty&&_m(s)),s&&(s.dirty=!1),t[H]&=-9217,o)y2(r,t,r.template,t[xn]);else if(i&8192){GS(t,1);let a=r.components;a!==null&&WS(t,a,1)}}function WS(t,e,n){for(let r=0;r<e.length;r++)w2(t,e[r],n)}function g_(t){for(t[Jr].changeDetectionScheduler?.notify();t;){t[H]|=64;let e=xu(t);if(VV(t)&&!e)return t;t=e}return null}var rs=class{get rootNodes(){let e=this._lView,n=e[ue];return yh(n,e,n.firstChild,[])}constructor(e,n,r=!0){this._lView=e,this._cdRefInjectingView=n,this.notifyErrorHandler=r,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[xn]}set context(e){this._lView[xn]=e}get destroyed(){return(this._lView[H]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let e=this._lView[Et];if(Ar(e)){let n=e[sh],r=n?n.indexOf(this):-1;r>-1&&(py(e,r),dh(n,r))}this._attachedToViewContainer=!1}mS(this._lView[ue],this._lView)}onDestroy(e){Mb(this._lView,e)}markForCheck(){g_(this._cdRefInjectingView||this._lView)}detach(){this._lView[H]&=-129}reattach(){sy(this._lView),this._lView[H]|=128}detectChanges(){this._lView[H]|=1024,qS(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new U(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,pS(this._lView[ue],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new U(902,!1);this._appRef=e,sy(this._lView)}},jo=(()=>{let e=class e{};e.__NG_ELEMENT_ID__=E2;let t=e;return t})();function E2(t){return I2(fn(),Be(),(t&16)===16)}function I2(t,e,n){if(Sh(t)&&!n){let r=ri(t.index,e);return new rs(r,r)}else if(t.type&47){let r=e[Qn];return new rs(r,e)}return null}var KS=(()=>{let e=class e{};e.__NG_ELEMENT_ID__=C2,e.__NG_ENV_ID__=r=>r;let t=e;return t})(),Sy=class extends KS{constructor(e){super(),this._lView=e}onDestroy(e){return Mb(this._lView,e),()=>KV(this._lView,e)}};function C2(){return new Sy(Be())}var U0=new Set;function m_(t){U0.has(t)||(U0.add(t),performance?.mark?.("mark_feature_usage",{detail:{feature:t}}))}var Ay=class extends rt{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,n,r){let i=e,s=n||(()=>null),o=r;if(e&&typeof e=="object"){let u=e;i=u.next?.bind(u),s=u.error?.bind(u),o=u.complete?.bind(u)}this.__isAsync&&(s=Km(s),i&&(i=Km(i)),o&&(o=Km(o)));let a=super.subscribe({next:i,error:s,complete:o});return e instanceof Ue&&e.add(a),a}};function Km(t){return e=>{setTimeout(t,void 0,e)}}var it=Ay;function B0(...t){}function D2(){let t=typeof zt.requestAnimationFrame=="function",e=zt[t?"requestAnimationFrame":"setTimeout"],n=zt[t?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&e&&n){let r=e[Zone.__symbol__("OriginalDelegate")];r&&(e=r);let i=n[Zone.__symbol__("OriginalDelegate")];i&&(n=i)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:n}}var se=class t{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new it(!1),this.onMicrotaskEmpty=new it(!1),this.onStable=new it(!1),this.onError=new it(!1),typeof Zone>"u")throw new U(908,!1);Zone.assertZonePatched();let i=this;i._nesting=0,i._outer=i._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(i._inner=i._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(i._inner=i._inner.fork(Zone.longStackTraceZoneSpec)),i.shouldCoalesceEventChangeDetection=!r&&n,i.shouldCoalesceRunChangeDetection=r,i.lastRequestAnimationFrameId=-1,i.nativeRequestAnimationFrame=D2().nativeRequestAnimationFrame,S2(i)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get("isAngularZone")===!0}static assertInAngularZone(){if(!t.isInAngularZone())throw new U(909,!1)}static assertNotInAngularZone(){if(t.isInAngularZone())throw new U(909,!1)}run(e,n,r){return this._inner.run(e,n,r)}runTask(e,n,r,i){let s=this._inner,o=s.scheduleEventTask("NgZoneEvent: "+i,e,T2,B0,B0);try{return s.runTask(o,n,r)}finally{s.cancelTask(o)}}runGuarded(e,n,r){return this._inner.runGuarded(e,n,r)}runOutsideAngular(e){return this._outer.run(e)}},T2={};function y_(t){if(t._nesting==0&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function b2(t){t.isCheckStableRunning||t.lastRequestAnimationFrameId!==-1||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(zt,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,xy(t),t.isCheckStableRunning=!0,y_(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),xy(t))}function S2(t){let e=()=>{b2(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,r,i,s,o,a)=>{if(A2(a))return n.invokeTask(i,s,o,a);try{return $0(t),n.invokeTask(i,s,o,a)}finally{(t.shouldCoalesceEventChangeDetection&&s.type==="eventTask"||t.shouldCoalesceRunChangeDetection)&&e(),H0(t)}},onInvoke:(n,r,i,s,o,a,u)=>{try{return $0(t),n.invoke(i,s,o,a,u)}finally{t.shouldCoalesceRunChangeDetection&&e(),H0(t)}},onHasTask:(n,r,i,s)=>{n.hasTask(i,s),r===i&&(s.change=="microTask"?(t._hasPendingMicrotasks=s.microTask,xy(t),y_(t)):s.change=="macroTask"&&(t.hasPendingMacrotasks=s.macroTask))},onHandleError:(n,r,i,s)=>(n.handleError(i,s),t.runOutsideAngular(()=>t.onError.emit(s)),!1)})}function xy(t){t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&t.lastRequestAnimationFrameId!==-1?t.hasPendingMicrotasks=!0:t.hasPendingMicrotasks=!1}function $0(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function H0(t){t._nesting--,y_(t)}var My=class{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new it,this.onMicrotaskEmpty=new it,this.onStable=new it,this.onError=new it}run(e,n,r){return e.apply(n,r)}runGuarded(e,n,r){return e.apply(n,r)}runOutsideAngular(e){return e()}runTask(e,n,r,i){return e.apply(n,r)}};function A2(t){return!Array.isArray(t)||t.length!==1?!1:t[0].data?.__ignore_ng_zone__===!0}function x2(t="zone.js",e){return t==="noop"?new My:t==="zone.js"?new se(e):t}var Eo=function(t){return t[t.EarlyRead=0]="EarlyRead",t[t.Write=1]="Write",t[t.MixedReadWrite=2]="MixedReadWrite",t[t.Read=3]="Read",t}(Eo||{}),M2={destroy(){}};function __(t,e){!e&&YL(__);let n=e?.injector??R(Nn);if(!JL(n))return M2;m_("NgAfterNextRender");let r=n.get(v_),i=r.handler??=new Ny,s=e?.phase??Eo.MixedReadWrite,o=()=>{i.unregister(u),a()},a=n.get(KS).onDestroy(o),u=new Ry(n,s,()=>{o(),t()});return i.register(u),{destroy:o}}var Ry=class{constructor(e,n,r){this.phase=n,this.callbackFn=r,this.zone=e.get(se),this.errorHandler=e.get(Zn,null,{optional:!0})}invoke(){try{this.zone.runOutsideAngular(this.callbackFn)}catch(e){this.errorHandler?.handleError(e)}}},Ny=class{constructor(){this.executingCallbacks=!1,this.buckets={[Eo.EarlyRead]:new Set,[Eo.Write]:new Set,[Eo.MixedReadWrite]:new Set,[Eo.Read]:new Set},this.deferredCallbacks=new Set}register(e){(this.executingCallbacks?this.deferredCallbacks:this.buckets[e.phase]).add(e)}unregister(e){this.buckets[e.phase].delete(e),this.deferredCallbacks.delete(e)}execute(){this.executingCallbacks=!0;for(let e of Object.values(this.buckets))for(let n of e)n.invoke();this.executingCallbacks=!1;for(let e of this.deferredCallbacks)this.buckets[e.phase].add(e);this.deferredCallbacks.clear()}destroy(){for(let e of Object.values(this.buckets))e.clear();this.deferredCallbacks.clear()}},v_=(()=>{let e=class e{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){let r=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let i of r)i();this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}};e.\u0275prov=k({token:e,providedIn:"root",factory:()=>new e});let t=e;return t})();function R2(t,e){let n=ri(e,t),r=n[ue];N2(r,n);let i=n[Sr];i!==null&&n[ih]===null&&(n[ih]=d_(i,n[To])),w_(r,n,n[xn])}function N2(t,e){for(let n=e.length;n<t.blueprint.length;n++)e.push(t.blueprint[n])}function w_(t,e,n){Ky(e);try{let r=t.viewQuery;r!==null&&Ty(1,r,n);let i=t.template;i!==null&&NS(t,e,i,1,n),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&BS(t,e),t.staticViewQueries&&Ty(2,t.viewQuery,n);let s=t.components;s!==null&&P2(e,s)}catch(r){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),r}finally{e[H]&=-5,Qy()}}function P2(t,e){for(let n=0;n<e.length;n++)R2(t,e[n])}function Py(t,e,n){let r=n?t.styles:null,i=n?t.classes:null,s=0;if(e!==null)for(let o=0;o<e.length;o++){let a=e[o];if(typeof a=="number")s=a;else if(s==1)i=m0(i,a);else if(s==2){let u=a,c=e[++o];r=m0(r,u+": "+c+";")}}n?t.styles=r:t.stylesWithoutHost=r,n?t.classes=i:t.classesWithoutHost=i}var _h=class extends Rh{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){let n=Xr(e);return new Mo(n,this.ngModule)}};function q0(t){let e=[];for(let n in t){if(!t.hasOwnProperty(n))continue;let r=t[n];r!==void 0&&e.push({propName:Array.isArray(r)?r[0]:r,templateName:n})}return e}function k2(t){let e=t.toLowerCase();return e==="svg"?BV:e==="math"?$V:null}var ky=class{constructor(e,n){this.injector=e,this.parentInjector=n}get(e,n,r){r=Dh(r);let i=this.injector.get(e,zm,r);return i!==zm||n===zm?i:this.parentInjector.get(e,n,r)}},Mo=class extends gh{get inputs(){let e=this.componentDef,n=e.inputTransforms,r=q0(e.inputs);if(n!==null)for(let i of r)n.hasOwnProperty(i.propName)&&(i.transform=n[i.propName]);return r}get outputs(){return q0(this.componentDef.outputs)}constructor(e,n){super(),this.componentDef=e,this.ngModule=n,this.componentType=e.type,this.selector=NV(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!n}create(e,n,r,i){i=i||this.ngModule;let s=i instanceof Wt?i:i?.injector;s&&this.componentDef.getStandaloneInjector!==null&&(s=this.componentDef.getStandaloneInjector(s)||s);let o=s?new ky(e,s):e,a=o.get(Ru,null);if(a===null)throw new U(407,!1);let u=o.get(Pj,null),c=o.get(v_,null),l=o.get(yy,null),d={rendererFactory:a,sanitizer:u,inlineEffectRunner:null,afterRenderEventManager:c,changeDetectionScheduler:l},h=a.createRenderer(null,this.componentDef),f=this.componentDef.selectors[0][0]||"div",p=r?Wj(h,r,this.componentDef.encapsulation,o):fS(h,f,k2(f)),g=512;this.componentDef.signals?g|=4096:this.componentDef.onPush||(g|=16);let _=null;p!==null&&(_=d_(p,o,!0));let C=f_(0,null,null,1,0,null,null,null,null,null,null),M=Ph(null,C,null,g,null,null,d,h,o,null,_);Ky(M);let T,j;try{let $=this.componentDef,Y,xe=null;$.findHostDirectiveDefs?(Y=[],xe=new Map,$.findHostDirectiveDefs($,Y,xe),Y.push($)):Y=[$];let rn=O2(M,p),lm=F2(rn,p,$,Y,M,d,h);j=Ab(C,ei),p&&j2(h,$,p,r),n!==void 0&&U2(j,this.ngContentSelectors,n),T=L2(lm,$,Y,xe,M,[B2]),w_(C,M,null)}finally{Qy()}return new Oy(this.componentType,T,Nh(j,M),M,j)}},Oy=class extends _y{constructor(e,n,r,i,s){super(),this.location=r,this._rootLView=i,this._tNode=s,this.previousInputValues=null,this.instance=n,this.hostView=this.changeDetectorRef=new rs(i,void 0,!1),this.componentType=e}setInput(e,n){let r=this._tNode.inputs,i;if(r!==null&&(i=r[e])){if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),n))return;let s=this._rootLView;p_(s[ue],s,i,e,n),this.previousInputValues.set(e,n);let o=ri(this._tNode.index,s);g_(o)}}get injector(){return new Zi(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}};function O2(t,e){let n=t[ue],r=ei;return t[r]=e,kh(n,r,2,"#host",null)}function F2(t,e,n,r,i,s,o){let a=i[ue];V2(r,t,e,o);let u=null;e!==null&&(u=d_(e,i[To]));let c=s.rendererFactory.createRenderer(e,n),l=16;n.signals?l=4096:n.onPush&&(l=64);let d=Ph(i,FS(n),null,l,i[t.index],t,s,c,null,null,u);return a.firstCreatePass&&Dy(a,t,r.length-1),Oh(i,d),i[t.index]=d}function V2(t,e,n,r){for(let i of t)e.mergedAttrs=Du(e.mergedAttrs,i.hostAttrs);e.mergedAttrs!==null&&(Py(e,e.mergedAttrs,!0),n!==null&&wS(r,n,e))}function L2(t,e,n,r,i,s){let o=fn(),a=i[ue],u=Rn(o,i);LS(a,i,o,n,null,r);for(let l=0;l<n.length;l++){let d=o.directiveStart+l,h=So(i,a,d,o);ns(h,i)}jS(a,i,o),u&&ns(u,i);let c=So(i,a,o.directiveStart+o.componentOffset,o);if(t[xn]=i[xn]=c,s!==null)for(let l of s)l(c,e);return PS(a,o,t),c}function j2(t,e,n,r){if(r)ry(t,n,["ng-version","17.1.3"]);else{let{attrs:i,classes:s}=PV(e.selectors[0]);i&&ry(t,n,i),s&&s.length>0&&vS(t,n,s.join(" "))}}function U2(t,e,n){let r=t.projection=[];for(let i=0;i<e.length;i++){let s=n[i];r.push(s!=null?Array.from(s):null)}}function B2(){let t=fn();Xy(Be()[ue],t)}function $2(t){return Object.getPrototypeOf(t.prototype).constructor}function Uo(t){let e=$2(t.type),n=!0,r=[t];for(;e;){let i;if(ti(t))i=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new U(903,!1);i=e.\u0275dir}if(i){if(n){r.push(i);let o=t;o.inputs=Kd(t.inputs),o.inputTransforms=Kd(t.inputTransforms),o.declaredInputs=Kd(t.declaredInputs),o.outputs=Kd(t.outputs);let a=i.hostBindings;a&&W2(t,a);let u=i.viewQuery,c=i.contentQueries;if(u&&G2(t,u),c&&z2(t,c),H2(t,i),rV(t.outputs,i.outputs),ti(i)&&i.data.animation){let l=t.data;l.animation=(l.animation||[]).concat(i.data.animation)}}let s=i.features;if(s)for(let o=0;o<s.length;o++){let a=s[o];a&&a.ngInherit&&a(t),a===Uo&&(n=!1)}}e=Object.getPrototypeOf(e)}q2(r)}function H2(t,e){for(let n in e.inputs){if(!e.inputs.hasOwnProperty(n)||t.inputs.hasOwnProperty(n))continue;let r=e.inputs[n];if(r!==void 0&&(t.inputs[n]=r,t.declaredInputs[n]=e.declaredInputs[n],e.inputTransforms!==null)){let i=Array.isArray(r)?r[0]:r;if(!e.inputTransforms.hasOwnProperty(i))continue;t.inputTransforms??={},t.inputTransforms[i]=e.inputTransforms[i]}}}function q2(t){let e=0,n=null;for(let r=t.length-1;r>=0;r--){let i=t[r];i.hostVars=e+=i.hostVars,i.hostAttrs=Du(i.hostAttrs,n=Du(n,i.hostAttrs))}}function Kd(t){return t===Do?{}:t===ln?[]:t}function G2(t,e){let n=t.viewQuery;n?t.viewQuery=(r,i)=>{e(r,i),n(r,i)}:t.viewQuery=e}function z2(t,e){let n=t.contentQueries;n?t.contentQueries=(r,i,s)=>{e(r,i,s),n(r,i,s)}:t.contentQueries=e}function W2(t,e){let n=t.hostBindings;n?t.hostBindings=(r,i)=>{e(r,i),n(r,i)}:t.hostBindings=e}var EZ=new RegExp(`^(\\d+)*(${Sj}|${bj})*(.*)`);var K2=()=>null;function G0(t,e){return K2(t,e)}function Q2(t,e,n,r){let i=e.tView,o=t[H]&4096?4096:16,a=Ph(t,i,n,o,null,e,null,null,null,r?.injector??null,r?.dehydratedView??null),u=t[e.index];a[Th]=u;let c=t[Su];return c!==null&&(a[Su]=c.createEmbeddedView(i)),w_(i,a,n),a}function z0(t,e){return!e||e.firstChild===null||dS(t)}function Y2(t,e,n,r=!0){let i=e[ue];if(lj(i,e,t,n),r){let o=gy(n,t),a=e[It],u=a_(a,t[Ji]);u!==null&&uj(i,t[Mn],a,e,u,o)}let s=e[ih];s!==null&&s.firstChild!==null&&(s.firstChild=null)}var ju=(()=>{let e=class e{};e.__NG_ELEMENT_ID__=Z2;let t=e;return t})();function Z2(){let t=fn();return J2(t,Be())}var X2=ju,QS=class extends X2{constructor(e,n,r){super(),this._lContainer=e,this._hostTNode=n,this._hostLView=r}get element(){return Nh(this._hostTNode,this._hostLView)}get injector(){return new Zi(this._hostTNode,this._hostLView)}get parentInjector(){let e=Jy(this._hostTNode,this._hostLView);if(Gb(e)){let n=ch(e,this._hostLView),r=uh(e),i=n[ue].data[r+8];return new Zi(i,n)}else return new Zi(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){let n=W0(this._lContainer);return n!==null&&n[e]||null}get length(){return this._lContainer.length-dn}createEmbeddedView(e,n,r){let i,s;typeof r=="number"?i=r:r!=null&&(i=r.index,s=r.injector);let o=G0(this._lContainer,e.ssrId),a=e.createEmbeddedViewImpl(n||{},s,o);return this.insertImpl(a,i,z0(this._hostTNode,o)),a}createComponent(e,n,r,i,s){let o=e&&!xL(e),a;if(o)a=n;else{let p=n||{};a=p.index,r=p.injector,i=p.projectableNodes,s=p.environmentInjector||p.ngModuleRef}let u=o?e:new Mo(Xr(e)),c=r||this.parentInjector;if(!s&&u.ngModule==null){let g=(o?c:this.parentInjector).get(Wt,null);g&&(s=g)}let l=Xr(u.componentType??{}),d=G0(this._lContainer,l?.id??null),h=d?.firstChild??null,f=u.create(c,i,h,s);return this.insertImpl(f.hostView,a,z0(this._hostTNode,d)),f}insert(e,n){return this.insertImpl(e,n,!0)}insertImpl(e,n,r){let i=e._lView;if(GV(i)){let a=this.indexOf(e);if(a!==-1)this.detach(a);else{let u=i[Et],c=new QS(u,u[Mn],u[Et]);c.detach(c.indexOf(e))}}let s=this._adjustIndex(n),o=this._lContainer;return Y2(o,i,s,r),e.attachToViewContainerRef(),tS(Qm(o),s,e),e}move(e,n){return this.insert(e,n)}indexOf(e){let n=W0(this._lContainer);return n!==null?n.indexOf(e):-1}remove(e){let n=this._adjustIndex(e,-1),r=py(this._lContainer,n);r&&(dh(Qm(this._lContainer),n),mS(r[ue],r))}detach(e){let n=this._adjustIndex(e,-1),r=py(this._lContainer,n);return r&&dh(Qm(this._lContainer),n)!=null?new rs(r):null}_adjustIndex(e,n=0){return e??this.length+n}};function W0(t){return t[sh]}function Qm(t){return t[sh]||(t[sh]=[])}function J2(t,e){let n,r=e[t.index];return Ar(r)?n=r:(n=US(r,e,null,t),e[t.index]=n,Oh(e,n)),tU(n,e,t,r),new QS(n,t,e)}function eU(t,e){let n=t[It],r=n.createComment(""),i=Rn(e,t),s=a_(n,i);return ph(n,s,r,yj(n,i),!1),r}var tU=iU,nU=()=>!1;function rU(t,e,n){return nU(t,e,n)}function iU(t,e,n,r){if(t[Ji])return;let i;n.type&8?i=Yn(r):i=eU(e,n),t[Ji]=i}var ni=class{},Nu=class{};var vh=class extends ni{constructor(e,n,r){super(),this._parent=n,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new _h(this);let i=yb(e);this._bootstrapComponents=lS(i.bootstrap),this._r3Injector=uS(e,n,[{provide:ni,useValue:this},{provide:Rh,useValue:this.componentFactoryResolver},...r],Ut(e),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(e)}get injector(){return this._r3Injector}destroy(){let e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}},wh=class extends Nu{constructor(e){super(),this.moduleType=e}create(e){return new vh(this.moduleType,e,[])}};function sU(t,e,n){return new vh(t,e,n)}var Fy=class extends ni{constructor(e){super(),this.componentFactoryResolver=new _h(this),this.instance=null;let n=new Mu([...e.providers,{provide:ni,useValue:this},{provide:Rh,useValue:this.componentFactoryResolver}],e.parent||r_(),e.debugName,new Set(["environment"]));this.injector=n,e.runEnvironmentInitializers&&n.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}};function Fh(t,e,n=null){return new Fy({providers:t,parent:e,debugName:n,runEnvironmentInitializers:!0}).injector}var Vh=(()=>{let e=class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new mt(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let r=this.taskId++;return this.pendingTasks.add(r),r}remove(r){this.pendingTasks.delete(r),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function E_(t,e,n){let r=t[e];return Object.is(r,n)?!1:(t[e]=n,!0)}function oU(t,e,n,r,i,s,o,a,u){let c=e.consts,l=kh(e,t,4,o||null,ah(c,a));VS(e,n,l,ah(c,u)),Xy(e,l);let d=l.tView=f_(2,l,r,i,s,e.directiveRegistry,e.pipeRegistry,null,e.schemas,c,null);return e.queries!==null&&(e.queries.template(e,l),d.queries=e.queries.embeddedTView(l)),l}function I_(t,e,n,r,i,s,o,a){let u=Be(),c=Jn(),l=t+ei,d=c.firstCreatePass?oU(l,c,u,e,n,r,i,s,o):c.data[l];Fu(d,!1);let h=aU(c,u,d,t);Yy()&&u_(c,u,h,d),ns(h,u);let f=US(h,u,h,d);return u[l]=f,Oh(u,f),rU(f,d,u),Gy(d)&&kS(c,u,d),o!=null&&OS(u,d,a),I_}var aU=uU;function uU(t,e,n,r){return Zy(!0),e[It].createComment("")}function cU(t,e,n,r){return E_(t,Fb(),n)?e+rb(n)+r:Lo}function Qd(t,e){return t<<17|e<<2}function is(t){return t>>17&32767}function lU(t){return(t&2)==2}function dU(t,e){return t&131071|e<<17}function Vy(t){return t|2}function Ro(t){return(t&131068)>>2}function Ym(t,e){return t&-131069|e<<2}function hU(t){return(t&1)===1}function Ly(t){return t|1}function fU(t,e,n,r,i,s){let o=s?e.classBindings:e.styleBindings,a=is(o),u=Ro(o);t[r]=n;let c=!1,l;if(Array.isArray(n)){let d=n;l=d[1],(l===null||Lu(d,l)>0)&&(c=!0)}else l=n;if(i)if(u!==0){let h=is(t[a+1]);t[r+1]=Qd(h,a),h!==0&&(t[h+1]=Ym(t[h+1],r)),t[a+1]=dU(t[a+1],r)}else t[r+1]=Qd(a,0),a!==0&&(t[a+1]=Ym(t[a+1],r)),a=r;else t[r+1]=Qd(u,0),a===0?a=r:t[u+1]=Ym(t[u+1],r),u=r;c&&(t[r+1]=Vy(t[r+1])),K0(t,l,r,!0),K0(t,l,r,!1),pU(e,l,t,r,s),o=Qd(a,u),s?e.classBindings=o:e.styleBindings=o}function pU(t,e,n,r,i){let s=i?t.residualClasses:t.residualStyles;s!=null&&typeof e=="string"&&Lu(s,e)>=0&&(n[r+1]=Ly(n[r+1]))}function K0(t,e,n,r){let i=t[n+1],s=e===null,o=r?is(i):Ro(i),a=!1;for(;o!==0&&(a===!1||s);){let u=t[o],c=t[o+1];gU(u,e)&&(a=!0,t[o+1]=r?Ly(c):Vy(c)),o=r?is(c):Ro(c)}a&&(t[n+1]=r?Vy(i):Ly(i))}function gU(t,e){return t===null||e==null||(Array.isArray(t)?t[1]:t)===e?!0:Array.isArray(t)&&typeof e=="string"?Lu(t,e)>=0:!1}function os(t,e,n){let r=Be(),i=Fb();if(E_(r,i,e)){let s=Jn(),o=dL();Jj(s,o,r,t,e,r[It],n,!1)}return os}function Q0(t,e,n,r,i){let s=e.inputs,o=i?"class":"style";p_(t,n,s[o],o,r)}function C_(t,e){return mU(t,e,null,!0),C_}function mU(t,e,n,r){let i=Be(),s=Jn(),o=iL(2);if(s.firstUpdatePass&&_U(s,t,o,r),e!==Lo&&E_(i,o,e)){let a=s.data[Oo()];CU(s,a,i,i[It],t,i[o+1]=DU(e,n),r,o)}}function yU(t,e){return e>=t.expandoStartIndex}function _U(t,e,n,r){let i=t.data;if(i[n+1]===null){let s=i[Oo()],o=yU(t,n);TU(s,r)&&e===null&&!o&&(e=!1),e=vU(i,s,e,r),fU(i,s,e,n,o,r)}}function vU(t,e,n,r){let i=uL(t),s=r?e.residualClasses:e.residualStyles;if(i===null)(r?e.classBindings:e.styleBindings)===0&&(n=Zm(null,t,e,n,r),n=Pu(n,e.attrs,r),s=null);else{let o=e.directiveStylingLast;if(o===-1||t[o]!==i)if(n=Zm(i,t,e,n,r),s===null){let u=wU(t,e,r);u!==void 0&&Array.isArray(u)&&(u=Zm(null,t,e,u[1],r),u=Pu(u,e.attrs,r),EU(t,e,r,u))}else s=IU(t,e,r)}return s!==void 0&&(r?e.residualClasses=s:e.residualStyles=s),n}function wU(t,e,n){let r=n?e.classBindings:e.styleBindings;if(Ro(r)!==0)return t[is(r)]}function EU(t,e,n,r){let i=n?e.classBindings:e.styleBindings;t[is(i)]=r}function IU(t,e,n){let r,i=e.directiveEnd;for(let s=1+e.directiveStylingLast;s<i;s++){let o=t[s].hostAttrs;r=Pu(r,o,n)}return Pu(r,e.attrs,n)}function Zm(t,e,n,r,i){let s=null,o=n.directiveEnd,a=n.directiveStylingLast;for(a===-1?a=n.directiveStart:a++;a<o&&(s=e[a],r=Pu(r,s.hostAttrs,i),s!==t);)a++;return t!==null&&(n.directiveStylingLast=a),r}function Pu(t,e,n){let r=n?1:2,i=-1;if(e!==null)for(let s=0;s<e.length;s++){let o=e[s];typeof o=="number"?i=o:i===r&&(Array.isArray(t)||(t=t===void 0?[]:["",t]),RL(t,o,n?!0:e[++s]))}return t===void 0?null:t}function CU(t,e,n,r,i,s,o,a){if(!(e.type&3))return;let u=t.data,c=u[a+1],l=hU(c)?Y0(u,e,n,i,Ro(c),o):void 0;if(!Eh(l)){Eh(s)||lU(c)&&(s=Y0(u,null,n,i,a,o));let d=Sb(Oo(),n);Dj(r,o,d,i,s)}}function Y0(t,e,n,r,i,s){let o=e===null,a;for(;i>0;){let u=t[i],c=Array.isArray(u),l=c?u[1]:u,d=l===null,h=n[i+1];h===Lo&&(h=d?ln:void 0);let f=d?Hm(h,r):l===r?h:void 0;if(c&&!Eh(f)&&(f=Hm(u,r)),Eh(f)&&(a=f,o))return a;let p=t[i+1];i=o?is(p):Ro(p)}if(e!==null){let u=s?e.residualClasses:e.residualStyles;u!=null&&(a=Hm(u,r))}return a}function Eh(t){return t!==void 0}function DU(t,e){return t==null||t===""||(typeof e=="string"?t=t+e:typeof t=="object"&&(t=Ut(l_(t)))),t}function TU(t,e){return(t.flags&(e?8:16))!==0}function bU(t,e,n,r,i,s){let o=e.consts,a=ah(o,i),u=kh(e,t,2,r,a);return VS(e,n,u,ah(o,s)),u.attrs!==null&&Py(u,u.attrs,!1),u.mergedAttrs!==null&&Py(u,u.mergedAttrs,!0),e.queries!==null&&e.queries.elementStart(e,u),u}function Ie(t,e,n,r){let i=Be(),s=Jn(),o=ei+t,a=i[It],u=s.firstCreatePass?bU(o,s,i,e,n,r):s.data[o],c=SU(s,i,u,a,e,t);i[o]=c;let l=Gy(u);return Fu(u,!0),wS(a,c,u),(u.flags&32)!==32&&Yy()&&u_(s,i,c,u),QV()===0&&ns(c,i),YV(),l&&(kS(s,i,u),PS(s,u,i)),r!==null&&OS(i,u),Ie}function ye(){let t=fn();Ob()?nL():(t=t.parent,Fu(t,!1));let e=t;JV(e)&&eL(),ZV();let n=Jn();return n.firstCreatePass&&(Xy(n,t),Ib(t)&&n.queries.elementEnd(t)),e.classesWithoutHost!=null&&mL(e)&&Q0(n,e,Be(),e.classesWithoutHost,!0),e.stylesWithoutHost!=null&&yL(e)&&Q0(n,e,Be(),e.stylesWithoutHost,!1),ye}function Pn(t,e,n,r){return Ie(t,e,n,r),ye(),Pn}var SU=(t,e,n,r,i,s)=>(Zy(!0),fS(r,i,hL()));function YS(){return Be()}var Ih="en-US";var AU=Ih;function xU(t){typeof t=="string"&&(AU=t.toLowerCase().replace(/_/g,"-"))}function as(t){return!!t&&typeof t.then=="function"}function ZS(t){return!!t&&typeof t.subscribe=="function"}function Kt(t,e,n,r){let i=Be(),s=Jn(),o=fn();return RU(s,i,i[It],o,t,e,r),Kt}function MU(t,e,n,r){let i=t.cleanup;if(i!=null)for(let s=0;s<i.length-1;s+=2){let o=i[s];if(o===n&&i[s+1]===r){let a=e[Tu],u=i[s+2];return a.length>u?a[u]:null}typeof o=="string"&&(s+=2)}return null}function RU(t,e,n,r,i,s,o){let a=Gy(r),c=t.firstCreatePass&&p2(t),l=e[xn],d=f2(e),h=!0;if(r.type&3||o){let g=Rn(r,e),_=o?o(g):g,C=d.length,M=o?j=>o(Yn(j[r.index])):r.index,T=null;if(!o&&a&&(T=MU(t,e,i,r.index)),T!==null){let j=T.__ngLastListenerFn__||T;j.__ngNextListenerFn__=s,T.__ngLastListenerFn__=s,h=!1}else{s=X0(r,e,l,s,!1);let j=n.listen(_,i,s);d.push(s,j),c&&c.push(i,M,C,C+1)}}else s=X0(r,e,l,s,!1);let f=r.outputs,p;if(h&&f!==null&&(p=f[i])){let g=p.length;if(g)for(let _=0;_<g;_+=2){let C=p[_],M=p[_+1],$=e[C][M].subscribe(s),Y=d.length;d.push(s,$),c&&c.push(i,r.index,Y,-(Y+1))}}}function Z0(t,e,n,r){try{return zn(6,e,n),n(r)!==!1}catch(i){return $S(t,i),!1}finally{zn(7,e,n)}}function X0(t,e,n,r,i){return function s(o){if(o===Function)return r;let a=t.componentOffset>-1?ri(t.index,e):e;g_(a);let u=Z0(e,n,r,o),c=s.__ngNextListenerFn__;for(;c;)u=Z0(e,n,c,o)&&u,c=c.__ngNextListenerFn__;return i&&u===!1&&o.preventDefault(),u}}function XS(t=1){return lL(t)}var D_=(()=>{let e=class e{};e.__NG_ELEMENT_ID__=kU;let t=e;return t})(),NU=D_,PU=class extends NU{constructor(e,n,r){super(),this._declarationLView=e,this._declarationTContainer=n,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(e,n){return this.createEmbeddedViewImpl(e,n)}createEmbeddedViewImpl(e,n,r){let i=Q2(this._declarationLView,this._declarationTContainer,e,{injector:n,dehydratedView:r});return new rs(i)}};function kU(){return OU(fn(),Be())}function OU(t,e){return t.type&4?new PU(e,t,Nh(t,e)):null}function Re(t,e=""){let n=Be(),r=Jn(),i=t+ei,s=r.firstCreatePass?kh(r,i,1,e,null):r.data[i],o=FU(r,n,s,e,t);n[i]=o,Yy()&&u_(r,n,o,s),Fu(s,!1)}var FU=(t,e,n,r,i)=>(Zy(!0),sj(e[It],r));function Bo(t){return JS("",t,""),Bo}function JS(t,e,n){let r=Be(),i=cU(r,t,e,n);return i!==Lo&&g2(r,Oo(),i),JS}function VU(t,e,n){let r=Jn();if(r.firstCreatePass){let i=ti(t);jy(n,r.data,r.blueprint,i,!0),jy(e,r.data,r.blueprint,i,!1)}}function jy(t,e,n,r,i){if(t=xt(t),Array.isArray(t))for(let s=0;s<t.length;s++)jy(t[s],e,n,r,i);else{let s=Jn(),o=Be(),a=fn(),u=xo(t)?t:xt(t.provide),c=aS(t),l=a.providerIndexes&1048575,d=a.directiveStart,h=a.providerIndexes>>20;if(xo(t)||!t.multi){let f=new ts(c,i,ke),p=Jm(u,e,i?l:l+h,d);p===-1?(uy(lh(a,o),s,u),Xm(s,t,e.length),e.push(u),a.directiveStart++,a.directiveEnd++,i&&(a.providerIndexes+=1048576),n.push(f),o.push(f)):(n[p]=f,o[p]=f)}else{let f=Jm(u,e,l+h,d),p=Jm(u,e,l,l+h),g=f>=0&&n[f],_=p>=0&&n[p];if(i&&!_||!i&&!g){uy(lh(a,o),s,u);let C=UU(i?jU:LU,n.length,i,r,c);!i&&_&&(n[p].providerFactory=C),Xm(s,t,e.length,0),e.push(u),a.directiveStart++,a.directiveEnd++,i&&(a.providerIndexes+=1048576),n.push(C),o.push(C)}else{let C=eA(n[i?p:f],c,!i&&r);Xm(s,t,f>-1?f:p,C)}!i&&r&&_&&n[p].componentProviders++}}}function Xm(t,e,n,r){let i=xo(e),s=HL(e);if(i||s){let u=(s?xt(e.useClass):e).prototype.ngOnDestroy;if(u){let c=t.destroyHooks||(t.destroyHooks=[]);if(!i&&e.multi){let l=c.indexOf(n);l===-1?c.push(n,[r,u]):c[l+1].push(r,u)}else c.push(n,u)}}}function eA(t,e,n){return n&&t.componentProviders++,t.multi.push(e)-1}function Jm(t,e,n,r){for(let i=n;i<r;i++)if(e[i]===t)return i;return-1}function LU(t,e,n,r){return Uy(this.multi,[])}function jU(t,e,n,r){let i=this.multi,s;if(this.providerFactory){let o=this.providerFactory.componentProviders,a=So(n,n[ue],this.providerFactory.index,r);s=a.slice(0,o),Uy(i,s);for(let u=o;u<a.length;u++)s.push(a[u])}else s=[],Uy(i,s);return s}function Uy(t,e){for(let n=0;n<t.length;n++){let r=t[n];e.push(r())}return e}function UU(t,e,n,r,i){let s=new ts(t,n,ke);return s.multi=[],s.index=e,s.componentProviders=0,eA(s,i,r&&!n),s}function T_(t,e=[]){return n=>{n.providersResolver=(r,i)=>VU(r,i?i(t):t,e)}}var BU=(()=>{let e=class e{constructor(r){this._injector=r,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(r){if(!r.standalone)return null;if(!this.cachedInjectors.has(r)){let i=iS(!1,r.type),s=i.length>0?Fh([i],this._injector,`Standalone[${r.type.name}]`):null;this.cachedInjectors.set(r,s)}return this.cachedInjectors.get(r)}ngOnDestroy(){try{for(let r of this.cachedInjectors.values())r!==null&&r.destroy()}finally{this.cachedInjectors.clear()}}};e.\u0275prov=k({token:e,providedIn:"environment",factory:()=>new e(I(Wt))});let t=e;return t})();function tA(t){m_("NgStandalone"),t.getStandaloneInjector=e=>e.get(BU).getOrCreateStandaloneInjector(t)}var Yd=null;function $U(t){Yd!==null&&(t.defaultEncapsulation!==Yd.defaultEncapsulation||t.preserveWhitespaces!==Yd.preserveWhitespaces)||(Yd=t)}var br=class{constructor(e){this.full=e;let n=e.split(".");this.major=n[0],this.minor=n[1],this.patch=n.slice(2).join(".")}},nA=new br("17.1.3"),Lh=(()=>{let e=class e{log(r){console.log(r)}warn(r){console.warn(r)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"platform"});let t=e;return t})(),By=class{constructor(e,n){this.ngModuleFactory=e,this.componentFactories=n}},jh=(()=>{let e=class e{compileModuleSync(r){return new wh(r)}compileModuleAsync(r){return Promise.resolve(this.compileModuleSync(r))}compileModuleAndAllComponentsSync(r){let i=this.compileModuleSync(r),s=yb(r),o=lS(s.declarations).reduce((a,u)=>{let c=Xr(u);return c&&a.push(new Mo(c)),a},[]);return new By(i,o)}compileModuleAndAllComponentsAsync(r){return Promise.resolve(this.compileModuleAndAllComponentsSync(r))}clearCache(){}clearCacheFor(r){}getModuleId(r){}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})(),HU=new P("");var b_=new P(""),Uu=new P(""),Uh=(()=>{let e=class e{constructor(r,i,s){this._ngZone=r,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._callbacks=[],this.taskTrackingZone=null,S_||(qU(s),s.addToWindow(i)),this._watchAngularEvents(),r.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{se.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&this._pendingCount===0&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;this._callbacks.length!==0;){let r=this._callbacks.pop();clearTimeout(r.timeoutId),r.doneCb()}});else{let r=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>i.updateCb&&i.updateCb(r)?(clearTimeout(i.timeoutId),!1):!0)}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(r=>({source:r.source,creationLocation:r.creationLocation,data:r.data})):[]}addCallback(r,i,s){let o=-1;i&&i>0&&(o=setTimeout(()=>{this._callbacks=this._callbacks.filter(a=>a.timeoutId!==o),r()},i)),this._callbacks.push({doneCb:r,timeoutId:o,updateCb:s})}whenStable(r,i,s){if(s&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(r,i,s),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(r){this.registry.registerApplication(r,this)}unregisterApplication(r){this.registry.unregisterApplication(r)}findProviders(r,i,s){return[]}};e.\u0275fac=function(i){return new(i||e)(I(se),I(Bh),I(Uu))},e.\u0275prov=k({token:e,factory:e.\u0275fac});let t=e;return t})(),Bh=(()=>{let e=class e{constructor(){this._applications=new Map}registerApplication(r,i){this._applications.set(r,i)}unregisterApplication(r){this._applications.delete(r)}unregisterAllApplications(){this._applications.clear()}getTestability(r){return this._applications.get(r)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(r,i=!0){return S_?.findTestabilityInTree(this,r,i)??null}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"platform"});let t=e;return t})();function qU(t){S_=t}var S_,$h=new P(""),rA=(()=>{let e=class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,i)=>{this.resolve=r,this.reject=i}),this.appInits=R($h,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let r=[];for(let s of this.appInits){let o=s();if(as(o))r.push(o);else if(ZS(o)){let a=new Promise((u,c)=>{o.subscribe({complete:u,error:c})});r.push(a)}}let i=()=>{this.done=!0,this.resolve()};Promise.all(r).then(()=>{i()}).catch(s=>{this.reject(s)}),r.length===0&&i(),this.initialized=!0}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})(),A_=new P("");function GU(t,e,n){let r=new wh(n);return Promise.resolve(r)}function zU(){QT(()=>{throw new U(600,!1)})}function WU(t){return t.isBoundToModule}function KU(t,e,n){try{let r=n();return as(r)?r.catch(i=>{throw e.runOutsideAngular(()=>t.handleError(i)),i}):r}catch(r){throw e.runOutsideAngular(()=>t.handleError(r)),r}}function iA(t,e){return Array.isArray(e)?e.reduce(iA,t):x(x({},t),e)}var $o=(()=>{let e=class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=R(bS),this.afterRenderEffectManager=R(v_),this.componentTypes=[],this.components=[],this.isStable=R(Vh).hasPendingTasks.pipe(F(r=>!r)),this._injector=R(Wt)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(r,i){let s=r instanceof gh;if(!this._injector.get(rA).done){let f=!s&&mb(r),p=!1;throw new U(405,p)}let a;s?a=r:a=this._injector.get(Rh).resolveComponentFactory(r),this.componentTypes.push(a.componentType);let u=WU(a)?void 0:this._injector.get(ni),c=i||a.selector,l=a.create(Nn.NULL,[],c,u),d=l.location.nativeElement,h=l.injector.get(b_,null);return h?.registerApplication(d),l.onDestroy(()=>{this.detachView(l.hostView),th(this.components,l),h?.unregisterApplication(d)}),this._loadComponent(l),l}tick(){if(this._runningTick)throw new U(101,!1);try{this._runningTick=!0,this.detectChangesInAttachedViews()}catch(r){this.internalErrorHandler(r)}finally{this._runningTick=!1}}detectChangesInAttachedViews(){let r=0;do{if(r===HS)throw new U(103,!1);let i=r===0;for(let{_lView:s,notifyErrorHandler:o}of this._views)!i&&!eb(s)||this.detectChangesInView(s,o,i);this.afterRenderEffectManager.execute(),r++}while(this._views.some(({_lView:i})=>eb(i)))}detectChangesInView(r,i,s){let o;s?(o=0,r[H]|=1024):r[H]&64?o=0:o=1,qS(r,i,o)}attachView(r){let i=r;this._views.push(i),i.attachToAppRef(this)}detachView(r){let i=r;th(this._views,i),i.detachFromAppRef()}_loadComponent(r){this.attachView(r.hostView),this.tick(),this.components.push(r);let i=this._injector.get(A_,[]);[...this._bootstrapListeners,...i].forEach(s=>s(r))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(r=>r()),this._views.slice().forEach(r=>r.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(r){return this._destroyListeners.push(r),()=>th(this._destroyListeners,r)}destroy(){if(this._destroyed)throw new U(406,!1);let r=this._injector;r.destroy&&!r.destroyed&&r.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function th(t,e){let n=t.indexOf(e);n>-1&&t.splice(n,1)}function J0(t){for(let e=t.length-1;e>=0;e--)if(t[e]!==void 0)return t[e]}function eb(t){return Wy(t)}var QU=(()=>{let e=class e{constructor(){this.zone=R(se),this.applicationRef=R($o)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function YU(t){return[{provide:se,useFactory:t},{provide:Ao,multi:!0,useFactory:()=>{let e=R(QU,{optional:!0});return()=>e.initialize()}},{provide:Ao,multi:!0,useFactory:()=>{let e=R(JU);return()=>{e.initialize()}}},{provide:bS,useFactory:ZU}]}function ZU(){let t=R(se),e=R(Zn);return n=>t.runOutsideAngular(()=>e.handleError(n))}function XU(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:t?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:t?.runCoalescing??!1}}var JU=(()=>{let e=class e{constructor(){this.subscription=new Ue,this.initialized=!1,this.zone=R(se),this.pendingTasks=R(Vh)}initialize(){if(this.initialized)return;this.initialized=!0;let r=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(r=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{se.assertNotInAngularZone(),queueMicrotask(()=>{r!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(r),r=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{se.assertInAngularZone(),r??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function eB(){return typeof $localize<"u"&&$localize.locale||Ih}var x_=new P("",{providedIn:"root",factory:()=>R(x_,ne.Optional|ne.SkipSelf)||eB()});var sA=new P(""),oA=(()=>{let e=class e{constructor(r){this._injector=r,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(r,i){let s=x2(i?.ngZone,XU({eventCoalescing:i?.ngZoneEventCoalescing,runCoalescing:i?.ngZoneRunCoalescing}));return s.run(()=>{let o=sU(r.moduleType,this.injector,YU(()=>s)),a=o.injector.get(Zn,null);return s.runOutsideAngular(()=>{let u=s.onError.subscribe({next:c=>{a.handleError(c)}});o.onDestroy(()=>{th(this._modules,o),u.unsubscribe()})}),KU(a,s,()=>{let u=o.injector.get(rA);return u.runInitializers(),u.donePromise.then(()=>{let c=o.injector.get(x_,Ih);return xU(c||Ih),this._moduleDoBootstrap(o),o})})})}bootstrapModule(r,i=[]){let s=iA({},i);return GU(this.injector,s,r).then(o=>this.bootstrapModuleFactory(o,s))}_moduleDoBootstrap(r){let i=r.injector.get($o);if(r._bootstrapComponents.length>0)r._bootstrapComponents.forEach(s=>i.bootstrap(s));else if(r.instance.ngDoBootstrap)r.instance.ngDoBootstrap(i);else throw new U(-403,!1);this._modules.push(r)}onDestroy(r){this._destroyListeners.push(r)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new U(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());let r=this._injector.get(sA,null);r&&(r.forEach(i=>i()),r.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}};e.\u0275fac=function(i){return new(i||e)(I(Nn))},e.\u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"platform"});let t=e;return t})(),Iu=null,aA=new P("");function tB(t){if(Iu&&!Iu.get(aA,!1))throw new U(400,!1);zU(),Iu=t;let e=t.get(oA);return iB(t),e}function M_(t,e,n=[]){let r=`Platform: ${e}`,i=new P(r);return(s=[])=>{let o=uA();if(!o||o.injector.get(aA,!1)){let a=[...n,...s,{provide:i,useValue:!0}];t?t(a):tB(nB(a,r))}return rB(i)}}function nB(t=[],e){return Nn.create({name:e,providers:[{provide:Ah,useValue:"platform"},{provide:sA,useValue:new Set([()=>Iu=null])},...t]})}function rB(t){let e=uA();if(!e)throw new U(401,!1);return e}function uA(){return Iu?.get(oA)??null}function iB(t){t.get(i_,null)?.forEach(n=>n())}function R_(){return!1}var cA=M_(null,"core",[]),lA=(()=>{let e=class e{constructor(r){}};e.\u0275fac=function(i){return new(i||e)(I($o))},e.\u0275mod=Ye({type:e}),e.\u0275inj=Qe({});let t=e;return t})();function Hh(t){return typeof t=="boolean"?t:t!=null&&t!=="false"}function dA(t){let e=Xr(t);if(!e)return null;let n=new Mo(e);return{get selector(){return n.selector},get type(){return n.componentType},get inputs(){return n.inputs},get outputs(){return n.outputs},get ngContentSelectors(){return n.ngContentSelectors},get isStandalone(){return e.standalone},get isSignal(){return e.signals}}}var gA=null;function tr(){return gA}function mA(t){gA??=t}var qh=class{},$t=new P(""),O_=(()=>{let e=class e{historyGo(r){throw new Error("")}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=k({token:e,factory:()=>R(aB),providedIn:"platform"});let t=e;return t})(),yA=new P(""),aB=(()=>{let e=class e extends O_{constructor(){super(),this._doc=R($t),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return tr().getBaseHref(this._doc)}onPopState(r){let i=tr().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",r,!1),()=>i.removeEventListener("popstate",r)}onHashChange(r){let i=tr().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",r,!1),()=>i.removeEventListener("hashchange",r)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(r){this._location.pathname=r}pushState(r,i,s){this._history.pushState(r,i,s)}replaceState(r,i,s){this._history.replaceState(r,i,s)}forward(){this._history.forward()}back(){this._history.back()}historyGo(r=0){this._history.go(r)}getState(){return this._history.state}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=k({token:e,factory:()=>new e,providedIn:"platform"});let t=e;return t})();function F_(t,e){if(t.length==0)return e;if(e.length==0)return t;let n=0;return t.endsWith("/")&&n++,e.startsWith("/")&&n++,n==2?t+e.substring(1):n==1?t+e:t+"/"+e}function hA(t){let e=t.match(/#|\?|$/),n=e&&e.index||t.length,r=n-(t[n-1]==="/"?1:0);return t.slice(0,r)+t.slice(n)}function xr(t){return t&&t[0]!=="?"?"?"+t:t}var us=(()=>{let e=class e{historyGo(r){throw new Error("")}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=k({token:e,factory:()=>R(V_),providedIn:"root"});let t=e;return t})(),_A=new P(""),V_=(()=>{let e=class e extends us{constructor(r,i){super(),this._platformLocation=r,this._removeListenerFns=[],this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??R($t).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(r){this._removeListenerFns.push(this._platformLocation.onPopState(r),this._platformLocation.onHashChange(r))}getBaseHref(){return this._baseHref}prepareExternalUrl(r){return F_(this._baseHref,r)}path(r=!1){let i=this._platformLocation.pathname+xr(this._platformLocation.search),s=this._platformLocation.hash;return s&&r?`${i}${s}`:i}pushState(r,i,s,o){let a=this.prepareExternalUrl(s+xr(o));this._platformLocation.pushState(r,i,a)}replaceState(r,i,s,o){let a=this.prepareExternalUrl(s+xr(o));this._platformLocation.replaceState(r,i,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(r=0){this._platformLocation.historyGo?.(r)}};e.\u0275fac=function(i){return new(i||e)(I(O_),I(_A,8))},e.\u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})(),vA=(()=>{let e=class e extends us{constructor(r,i){super(),this._platformLocation=r,this._baseHref="",this._removeListenerFns=[],i!=null&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(r){this._removeListenerFns.push(this._platformLocation.onPopState(r),this._platformLocation.onHashChange(r))}getBaseHref(){return this._baseHref}path(r=!1){let i=this._platformLocation.hash??"#";return i.length>0?i.substring(1):i}prepareExternalUrl(r){let i=F_(this._baseHref,r);return i.length>0?"#"+i:i}pushState(r,i,s,o){let a=this.prepareExternalUrl(s+xr(o));a.length==0&&(a=this._platformLocation.pathname),this._platformLocation.pushState(r,i,a)}replaceState(r,i,s,o){let a=this.prepareExternalUrl(s+xr(o));a.length==0&&(a=this._platformLocation.pathname),this._platformLocation.replaceState(r,i,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(r=0){this._platformLocation.historyGo?.(r)}};e.\u0275fac=function(i){return new(i||e)(I(O_),I(_A,8))},e.\u0275prov=k({token:e,factory:e.\u0275fac});let t=e;return t})(),Ho=(()=>{let e=class e{constructor(r){this._subject=new it,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=r;let i=this._locationStrategy.getBaseHref();this._basePath=lB(hA(fA(i))),this._locationStrategy.onPopState(s=>{this._subject.emit({url:this.path(!0),pop:!0,state:s.state,type:s.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(r=!1){return this.normalize(this._locationStrategy.path(r))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(r,i=""){return this.path()==this.normalize(r+xr(i))}normalize(r){return e.stripTrailingSlash(cB(this._basePath,fA(r)))}prepareExternalUrl(r){return r&&r[0]!=="/"&&(r="/"+r),this._locationStrategy.prepareExternalUrl(r)}go(r,i="",s=null){this._locationStrategy.pushState(s,"",r,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(r+xr(i)),s)}replaceState(r,i="",s=null){this._locationStrategy.replaceState(s,"",r,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(r+xr(i)),s)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(r=0){this._locationStrategy.historyGo?.(r)}onUrlChange(r){return this._urlChangeListeners.push(r),this._urlChangeSubscription??=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}),()=>{let i=this._urlChangeListeners.indexOf(r);this._urlChangeListeners.splice(i,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(r="",i){this._urlChangeListeners.forEach(s=>s(r,i))}subscribe(r,i,s){return this._subject.subscribe({next:r,error:i,complete:s})}};e.normalizeQueryParams=xr,e.joinWithSlash=F_,e.stripTrailingSlash=hA,e.\u0275fac=function(i){return new(i||e)(I(us))},e.\u0275prov=k({token:e,factory:()=>uB(),providedIn:"root"});let t=e;return t})();function uB(){return new Ho(I(us))}function cB(t,e){if(!t||!e.startsWith(t))return e;let n=e.substring(t.length);return n===""||["/",";","?","#"].includes(n[0])?n:e}function fA(t){return t.replace(/\/index.html$/,"")}function lB(t){if(new RegExp("^(https?:)?//").test(t)){let[,n]=t.split(/\/\/[^\/]+/);return n}return t}function wA(t,e){e=encodeURIComponent(e);for(let n of t.split(";")){let r=n.indexOf("="),[i,s]=r==-1?[n,""]:[n.slice(0,r),n.slice(r+1)];if(i.trim()===e)return decodeURIComponent(s)}return null}var N_=class{constructor(e,n,r,i){this.$implicit=e,this.ngForOf=n,this.index=r,this.count=i}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},EA=(()=>{let e=class e{set ngForOf(r){this._ngForOf=r,this._ngForOfDirty=!0}set ngForTrackBy(r){this._trackByFn=r}get ngForTrackBy(){return this._trackByFn}constructor(r,i,s){this._viewContainer=r,this._template=i,this._differs=s,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(r){r&&(this._template=r)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let r=this._ngForOf;if(!this._differ&&r)if(0)try{}catch{}else this._differ=this._differs.find(r).create(this.ngForTrackBy)}if(this._differ){let r=this._differ.diff(this._ngForOf);r&&this._applyChanges(r)}}_applyChanges(r){let i=this._viewContainer;r.forEachOperation((s,o,a)=>{if(s.previousIndex==null)i.createEmbeddedView(this._template,new N_(s.item,this._ngForOf,-1,-1),a===null?void 0:a);else if(a==null)i.remove(o===null?void 0:o);else if(o!==null){let u=i.get(o);i.move(u,a),pA(u,s)}});for(let s=0,o=i.length;s<o;s++){let u=i.get(s).context;u.index=s,u.count=o,u.ngForOf=this._ngForOf}r.forEachIdentityChange(s=>{let o=i.get(s.currentIndex);pA(o,s)})}static ngTemplateContextGuard(r,i){return!0}};e.\u0275fac=function(i){return new(i||e)(ke(ju),ke(D_),ke(h_))},e.\u0275dir=Xn({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0});let t=e;return t})();function pA(t,e){t.context.$implicit=e.item}var IA=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Ye({type:e}),e.\u0275inj=Qe({});let t=e;return t})(),L_="browser",dB="server";function hB(t){return t===L_}function cs(t){return t===dB}var CA=(()=>{let e=class e{};e.\u0275prov=k({token:e,providedIn:"root",factory:()=>hB(R(Ct))?new P_(R($t),window):new k_});let t=e;return t})(),P_=class{constructor(e,n){this.document=e,this.window=n,this.offset=()=>[0,0]}setOffset(e){Array.isArray(e)?this.offset=()=>e:this.offset=e}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(e){this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){let n=fB(this.document,e);n&&(this.scrollToElement(n),n.focus())}setHistoryScrollRestoration(e){this.window.history.scrollRestoration=e}scrollToElement(e){let n=e.getBoundingClientRect(),r=n.left+this.window.pageXOffset,i=n.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(r-s[0],i-s[1])}};function fB(t,e){let n=t.getElementById(e)||t.getElementsByName(e)[0];if(n)return n;if(typeof t.createTreeWalker=="function"&&t.body&&typeof t.body.attachShadow=="function"){let r=t.createTreeWalker(t.body,NodeFilter.SHOW_ELEMENT),i=r.currentNode;for(;i;){let s=i.shadowRoot;if(s){let o=s.getElementById(e)||s.querySelector(`[name="${e}"]`);if(o)return o}i=r.nextNode()}}return null}var k_=class{setOffset(e){}getScrollPosition(){return[0,0]}scrollToPosition(e){}scrollToAnchor(e){}setHistoryScrollRestoration(e){}},Gh=class{};var B_=class extends qh{constructor(){super(...arguments),this.supportsDOMEvents=!0}},$_=class t extends B_{static makeCurrent(){mA(new t)}onAndCancel(e,n,r){return e.addEventListener(n,r),()=>{e.removeEventListener(n,r)}}dispatchEvent(e,n){e.dispatchEvent(n)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,n){return n=n||this.getDefaultDocument(),n.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,n){return n==="window"?window:n==="document"?e:n==="body"?e.body:null}getBaseHref(e){let n=mB();return n==null?null:yB(n)}resetBaseElement(){Bu=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return wA(document.cookie,e)}},Bu=null;function mB(){return Bu=Bu||document.querySelector("base"),Bu?Bu.getAttribute("href"):null}function yB(t){return new URL(t,document.baseURI).pathname}var H_=class{addToWindow(e){zt.getAngularTestability=(r,i=!0)=>{let s=e.findTestabilityInTree(r,i);if(s==null)throw new U(5103,!1);return s},zt.getAllAngularTestabilities=()=>e.getAllTestabilities(),zt.getAllAngularRootElements=()=>e.getAllRootElements();let n=r=>{let i=zt.getAllAngularTestabilities(),s=i.length,o=function(){s--,s==0&&r()};i.forEach(a=>{a.whenStable(o)})};zt.frameworkStabilizers||(zt.frameworkStabilizers=[]),zt.frameworkStabilizers.push(n)}findTestabilityInTree(e,n,r){if(n==null)return null;let i=e.getTestability(n);return i??(r?tr().isShadowRoot(n)?this.findTestabilityInTree(e,n.host,!0):this.findTestabilityInTree(e,n.parentElement,!0):null)}},_B=(()=>{let e=class e{build(){return new XMLHttpRequest}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=k({token:e,factory:e.\u0275fac});let t=e;return t})(),q_=new P(""),SA=(()=>{let e=class e{constructor(r,i){this._zone=i,this._eventNameToPlugin=new Map,r.forEach(s=>{s.manager=this}),this._plugins=r.slice().reverse()}addEventListener(r,i,s){return this._findPluginFor(i).addEventListener(r,i,s)}getZone(){return this._zone}_findPluginFor(r){let i=this._eventNameToPlugin.get(r);if(i)return i;if(i=this._plugins.find(o=>o.supports(r)),!i)throw new U(5101,!1);return this._eventNameToPlugin.set(r,i),i}};e.\u0275fac=function(i){return new(i||e)(I(q_),I(se))},e.\u0275prov=k({token:e,factory:e.\u0275fac});let t=e;return t})(),zh=class{constructor(e){this._doc=e}},j_="ng-app-id",AA=(()=>{let e=class e{constructor(r,i,s,o={}){this.doc=r,this.appId=i,this.nonce=s,this.platformId=o,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=cs(o),this.resetHostNodes()}addStyles(r){for(let i of r)this.changeUsageCount(i,1)===1&&this.onStyleAdded(i)}removeStyles(r){for(let i of r)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){let r=this.styleNodesInDOM;r&&(r.forEach(i=>i.remove()),r.clear());for(let i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(r){this.hostNodes.add(r);for(let i of this.getAllStyles())this.addStyleToHost(r,i)}removeHost(r){this.hostNodes.delete(r)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(r){for(let i of this.hostNodes)this.addStyleToHost(i,r)}onStyleRemoved(r){let i=this.styleRef;i.get(r)?.elements?.forEach(s=>s.remove()),i.delete(r)}collectServerRenderedStyles(){let r=this.doc.head?.querySelectorAll(`style[${j_}="${this.appId}"]`);if(r?.length){let i=new Map;return r.forEach(s=>{s.textContent!=null&&i.set(s.textContent,s)}),i}return null}changeUsageCount(r,i){let s=this.styleRef;if(s.has(r)){let o=s.get(r);return o.usage+=i,o.usage}return s.set(r,{usage:i,elements:[]}),i}getStyleElement(r,i){let s=this.styleNodesInDOM,o=s?.get(i);if(o?.parentNode===r)return s.delete(i),o.removeAttribute(j_),o;{let a=this.doc.createElement("style");return this.nonce&&a.setAttribute("nonce",this.nonce),a.textContent=i,this.platformIsServer&&a.setAttribute(j_,this.appId),r.appendChild(a),a}}addStyleToHost(r,i){let s=this.getStyleElement(r,i),o=this.styleRef,a=o.get(i)?.elements;a?a.push(s):o.set(i,{elements:[s],usage:1})}resetHostNodes(){let r=this.hostNodes;r.clear(),r.add(this.doc.head)}};e.\u0275fac=function(i){return new(i||e)(I($t),I(xh),I(s_,8),I(Ct))},e.\u0275prov=k({token:e,factory:e.\u0275fac});let t=e;return t})(),U_={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},z_=/%COMP%/g,xA="%COMP%",vB=`_nghost-${xA}`,wB=`_ngcontent-${xA}`,EB=!0,IB=new P("",{providedIn:"root",factory:()=>EB});function CB(t){return wB.replace(z_,t)}function DB(t){return vB.replace(z_,t)}function MA(t,e){return e.map(n=>n.replace(z_,t))}var DA=(()=>{let e=class e{constructor(r,i,s,o,a,u,c,l=null){this.eventManager=r,this.sharedStylesHost=i,this.appId=s,this.removeStylesOnCompDestroy=o,this.doc=a,this.platformId=u,this.ngZone=c,this.nonce=l,this.rendererByCompId=new Map,this.platformIsServer=cs(u),this.defaultRenderer=new $u(r,a,c,this.platformIsServer)}createRenderer(r,i){if(!r||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===Kn.ShadowDom&&(i=he(x({},i),{encapsulation:Kn.Emulated}));let s=this.getOrCreateRenderer(r,i);return s instanceof Wh?s.applyToHost(r):s instanceof Hu&&s.applyStyles(),s}getOrCreateRenderer(r,i){let s=this.rendererByCompId,o=s.get(i.id);if(!o){let a=this.doc,u=this.ngZone,c=this.eventManager,l=this.sharedStylesHost,d=this.removeStylesOnCompDestroy,h=this.platformIsServer;switch(i.encapsulation){case Kn.Emulated:o=new Wh(c,l,i,this.appId,d,a,u,h);break;case Kn.ShadowDom:return new G_(c,l,r,i,a,u,this.nonce,h);default:o=new Hu(c,l,i,d,a,u,h);break}s.set(i.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}};e.\u0275fac=function(i){return new(i||e)(I(SA),I(AA),I(xh),I(IB),I($t),I(Ct),I(se),I(s_))},e.\u0275prov=k({token:e,factory:e.\u0275fac});let t=e;return t})(),$u=class{constructor(e,n,r,i){this.eventManager=e,this.doc=n,this.ngZone=r,this.platformIsServer=i,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(e,n){return n?this.doc.createElementNS(U_[n]||n,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,n){(TA(e)?e.content:e).appendChild(n)}insertBefore(e,n,r){e&&(TA(e)?e.content:e).insertBefore(n,r)}removeChild(e,n){e&&e.removeChild(n)}selectRootElement(e,n){let r=typeof e=="string"?this.doc.querySelector(e):e;if(!r)throw new U(-5104,!1);return n||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,n,r,i){if(i){n=i+":"+n;let s=U_[i];s?e.setAttributeNS(s,n,r):e.setAttribute(n,r)}else e.setAttribute(n,r)}removeAttribute(e,n,r){if(r){let i=U_[r];i?e.removeAttributeNS(i,n):e.removeAttribute(`${r}:${n}`)}else e.removeAttribute(n)}addClass(e,n){e.classList.add(n)}removeClass(e,n){e.classList.remove(n)}setStyle(e,n,r,i){i&(Tr.DashCase|Tr.Important)?e.style.setProperty(n,r,i&Tr.Important?"important":""):e.style[n]=r}removeStyle(e,n,r){r&Tr.DashCase?e.style.removeProperty(n):e.style[n]=""}setProperty(e,n,r){e!=null&&(e[n]=r)}setValue(e,n){e.nodeValue=n}listen(e,n,r){if(typeof e=="string"&&(e=tr().getGlobalEventTarget(this.doc,e),!e))throw new Error(`Unsupported event target ${e} for event ${n}`);return this.eventManager.addEventListener(e,n,this.decoratePreventDefault(r))}decoratePreventDefault(e){return n=>{if(n==="__ngUnwrap__")return e;(this.platformIsServer?this.ngZone.runGuarded(()=>e(n)):e(n))===!1&&n.preventDefault()}}};function TA(t){return t.tagName==="TEMPLATE"&&t.content!==void 0}var G_=class extends $u{constructor(e,n,r,i,s,o,a,u){super(e,s,o,u),this.sharedStylesHost=n,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let c=MA(i.id,i.styles);for(let l of c){let d=document.createElement("style");a&&d.setAttribute("nonce",a),d.textContent=l,this.shadowRoot.appendChild(d)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,n){return super.appendChild(this.nodeOrShadowRoot(e),n)}insertBefore(e,n,r){return super.insertBefore(this.nodeOrShadowRoot(e),n,r)}removeChild(e,n){return super.removeChild(this.nodeOrShadowRoot(e),n)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Hu=class extends $u{constructor(e,n,r,i,s,o,a,u){super(e,s,o,a),this.sharedStylesHost=n,this.removeStylesOnCompDestroy=i,this.styles=u?MA(u,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},Wh=class extends Hu{constructor(e,n,r,i,s,o,a,u){let c=i+"-"+r.id;super(e,n,r,s,o,a,u,c),this.contentAttr=CB(c),this.hostAttr=DB(c)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,n){let r=super.createElement(e,n);return super.setAttribute(r,this.contentAttr,""),r}},TB=(()=>{let e=class e extends zh{constructor(r){super(r)}supports(r){return!0}addEventListener(r,i,s){return r.addEventListener(i,s,!1),()=>this.removeEventListener(r,i,s)}removeEventListener(r,i,s){return r.removeEventListener(i,s)}};e.\u0275fac=function(i){return new(i||e)(I($t))},e.\u0275prov=k({token:e,factory:e.\u0275fac});let t=e;return t})(),bA=["alt","control","meta","shift"],bB={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},SB={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey},AB=(()=>{let e=class e extends zh{constructor(r){super(r)}supports(r){return e.parseEventName(r)!=null}addEventListener(r,i,s){let o=e.parseEventName(i),a=e.eventCallback(o.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>tr().onAndCancel(r,o.domEventName,a))}static parseEventName(r){let i=r.toLowerCase().split("."),s=i.shift();if(i.length===0||!(s==="keydown"||s==="keyup"))return null;let o=e._normalizeKey(i.pop()),a="",u=i.indexOf("code");if(u>-1&&(i.splice(u,1),a="code."),bA.forEach(l=>{let d=i.indexOf(l);d>-1&&(i.splice(d,1),a+=l+".")}),a+=o,i.length!=0||o.length===0)return null;let c={};return c.domEventName=s,c.fullKey=a,c}static matchEventFullKeyCode(r,i){let s=bB[r.key]||r.key,o="";return i.indexOf("code.")>-1&&(s=r.code,o="code."),s==null||!s?!1:(s=s.toLowerCase(),s===" "?s="space":s==="."&&(s="dot"),bA.forEach(a=>{if(a!==s){let u=SB[a];u(r)&&(o+=a+".")}}),o+=s,o===i)}static eventCallback(r,i,s){return o=>{e.matchEventFullKeyCode(o,r)&&s.runGuarded(()=>i(o))}}static _normalizeKey(r){return r==="esc"?"escape":r}};e.\u0275fac=function(i){return new(i||e)(I($t))},e.\u0275prov=k({token:e,factory:e.\u0275fac});let t=e;return t})();function xB(){$_.makeCurrent()}function MB(){return new Zn}function RB(){return cS(document),document}var NB=[{provide:Ct,useValue:L_},{provide:i_,useValue:xB,multi:!0},{provide:$t,useFactory:RB,deps:[]}],RA=M_(cA,"browser",NB),PB=new P(""),kB=[{provide:Uu,useClass:H_,deps:[]},{provide:b_,useClass:Uh,deps:[se,Bh,Uu]},{provide:Uh,useClass:Uh,deps:[se,Bh,Uu]}],OB=[{provide:Ah,useValue:"root"},{provide:Zn,useFactory:MB,deps:[]},{provide:q_,useClass:TB,multi:!0,deps:[$t,se,Ct]},{provide:q_,useClass:AB,multi:!0,deps:[$t]},DA,AA,SA,{provide:Ru,useExisting:DA},{provide:Gh,useClass:_B,deps:[]},[]],NA=(()=>{let e=class e{constructor(r){}static withServerTransition(r){return{ngModule:e,providers:[{provide:xh,useValue:r.appId}]}}};e.\u0275fac=function(i){return new(i||e)(I(PB,12))},e.\u0275mod=Ye({type:e}),e.\u0275inj=Qe({providers:[...OB,...kB],imports:[IA,lA]});let t=e;return t})();var PA=(()=>{let e=class e{constructor(r){this._doc=r}getTitle(){return this._doc.title}setTitle(r){this._doc.title=r||""}};e.\u0275fac=function(i){return new(i||e)(I($t))},e.\u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var X="primary",ic=Symbol("RouteTitle"),Z_=class{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let n=this.params[e];return Array.isArray(n)?n[0]:n}return null}getAll(e){if(this.has(e)){let n=this.params[e];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}};function Ko(t){return new Z_(t)}function VB(t,e,n){let r=n.path.split("/");if(r.length>t.length||n.pathMatch==="full"&&(e.hasChildren()||r.length<t.length))return null;let i={};for(let s=0;s<r.length;s++){let o=r[s],a=t[s];if(o.startsWith(":"))i[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:t.slice(0,r.length),posParams:i}}function LB(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!nr(t[n],e[n]))return!1;return!0}function nr(t,e){let n=t?X_(t):void 0,r=e?X_(e):void 0;if(!n||!r||n.length!=r.length)return!1;let i;for(let s=0;s<n.length;s++)if(i=n[s],!HA(t[i],e[i]))return!1;return!0}function X_(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}function HA(t,e){if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;let n=[...t].sort(),r=[...e].sort();return n.every((i,s)=>r[s]===i)}else return t===e}function qA(t){return t.length>0?t[t.length-1]:null}function ui(t){return Nm(t)?t:as(t)?fe(Promise.resolve(t)):V(t)}var jB={exact:zA,subset:WA},GA={exact:UB,subset:BB,ignored:()=>!0};function OA(t,e,n){return jB[n.paths](t.root,e.root,n.matrixParams)&&GA[n.queryParams](t.queryParams,e.queryParams)&&!(n.fragment==="exact"&&t.fragment!==e.fragment)}function UB(t,e){return nr(t,e)}function zA(t,e,n){if(!ds(t.segments,e.segments)||!Yh(t.segments,e.segments,n)||t.numberOfChildren!==e.numberOfChildren)return!1;for(let r in e.children)if(!t.children[r]||!zA(t.children[r],e.children[r],n))return!1;return!0}function BB(t,e){return Object.keys(e).length<=Object.keys(t).length&&Object.keys(e).every(n=>HA(t[n],e[n]))}function WA(t,e,n){return KA(t,e,e.segments,n)}function KA(t,e,n,r){if(t.segments.length>n.length){let i=t.segments.slice(0,n.length);return!(!ds(i,n)||e.hasChildren()||!Yh(i,n,r))}else if(t.segments.length===n.length){if(!ds(t.segments,n)||!Yh(t.segments,n,r))return!1;for(let i in e.children)if(!t.children[i]||!WA(t.children[i],e.children[i],r))return!1;return!0}else{let i=n.slice(0,t.segments.length),s=n.slice(t.segments.length);return!ds(t.segments,i)||!Yh(t.segments,i,r)||!t.children[X]?!1:KA(t.children[X],e,s,r)}}function Yh(t,e,n){return e.every((r,i)=>GA[n](t[i].parameters,r.parameters))}var si=class{constructor(e=new me([],{}),n={},r=null){this.root=e,this.queryParams=n,this.fragment=r}get queryParamMap(){return this._queryParamMap??=Ko(this.queryParams),this._queryParamMap}toString(){return qB.serialize(this)}},me=class{constructor(e,n){this.segments=e,this.children=n,this.parent=null,Object.values(n).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Zh(this)}},ls=class{constructor(e,n){this.path=e,this.parameters=n}get parameterMap(){return this._parameterMap??=Ko(this.parameters),this._parameterMap}toString(){return YA(this)}};function $B(t,e){return ds(t,e)&&t.every((n,r)=>nr(n.parameters,e[r].parameters))}function ds(t,e){return t.length!==e.length?!1:t.every((n,r)=>n.path===e[r].path)}function HB(t,e){let n=[];return Object.entries(t.children).forEach(([r,i])=>{r===X&&(n=n.concat(e(i,r)))}),Object.entries(t.children).forEach(([r,i])=>{r!==X&&(n=n.concat(e(i,r)))}),n}var sc=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=k({token:e,factory:()=>new Yu,providedIn:"root"});let t=e;return t})(),Yu=class{parse(e){let n=new ev(e);return new si(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(e){let n=`/${qu(e.root,!0)}`,r=WB(e.queryParams),i=typeof e.fragment=="string"?`#${GB(e.fragment)}`:"";return`${n}${r}${i}`}},qB=new Yu;function Zh(t){return t.segments.map(e=>YA(e)).join("/")}function qu(t,e){if(!t.hasChildren())return Zh(t);if(e){let n=t.children[X]?qu(t.children[X],!1):"",r=[];return Object.entries(t.children).forEach(([i,s])=>{i!==X&&r.push(`${i}:${qu(s,!1)}`)}),r.length>0?`${n}(${r.join("//")})`:n}else{let n=HB(t,(r,i)=>i===X?[qu(t.children[X],!1)]:[`${i}:${qu(r,!1)}`]);return Object.keys(t.children).length===1&&t.children[X]!=null?`${Zh(t)}/${n[0]}`:`${Zh(t)}/(${n.join("//")})`}}function QA(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Kh(t){return QA(t).replace(/%3B/gi,";")}function GB(t){return encodeURI(t)}function J_(t){return QA(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Xh(t){return decodeURIComponent(t)}function FA(t){return Xh(t.replace(/\+/g,"%20"))}function YA(t){return`${J_(t.path)}${zB(t.parameters)}`}function zB(t){return Object.entries(t).map(([e,n])=>`;${J_(e)}=${J_(n)}`).join("")}function WB(t){let e=Object.entries(t).map(([n,r])=>Array.isArray(r)?r.map(i=>`${Kh(n)}=${Kh(i)}`).join("&"):`${Kh(n)}=${Kh(r)}`).filter(n=>n);return e.length?`?${e.join("&")}`:""}var KB=/^[^\/()?;#]+/;function W_(t){let e=t.match(KB);return e?e[0]:""}var QB=/^[^\/()?;=#]+/;function YB(t){let e=t.match(QB);return e?e[0]:""}var ZB=/^[^=?&#]+/;function XB(t){let e=t.match(ZB);return e?e[0]:""}var JB=/^[^&#]+/;function e$(t){let e=t.match(JB);return e?e[0]:""}var ev=class{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new me([],{}):new me([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(n).length>0)&&(r[X]=new me(e,n)),r}parseSegment(){let e=W_(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new U(4009,!1);return this.capture(e),new ls(Xh(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let n=YB(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){let i=W_(this.remaining);i&&(r=i,this.capture(r))}e[Xh(n)]=Xh(r)}parseQueryParam(e){let n=XB(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){let o=e$(this.remaining);o&&(r=o,this.capture(r))}let i=FA(n),s=FA(r);if(e.hasOwnProperty(i)){let o=e[i];Array.isArray(o)||(o=[o],e[i]=o),o.push(s)}else e[i]=s}parseParens(e){let n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=W_(this.remaining),i=this.remaining[r.length];if(i!=="/"&&i!==")"&&i!==";")throw new U(4010,!1);let s;r.indexOf(":")>-1?(s=r.slice(0,r.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=X);let o=this.parseChildren();n[s]=Object.keys(o).length===1?o[X]:new me([],o),this.consumeOptional("//")}return n}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new U(4011,!1)}};function ZA(t){return t.segments.length>0?new me([],{[X]:t}):t}function XA(t){let e={};for(let[r,i]of Object.entries(t.children)){let s=XA(i);if(r===X&&s.segments.length===0&&s.hasChildren())for(let[o,a]of Object.entries(s.children))e[o]=a;else(s.segments.length>0||s.hasChildren())&&(e[r]=s)}let n=new me(t.segments,e);return t$(n)}function t$(t){if(t.numberOfChildren===1&&t.children[X]){let e=t.children[X];return new me(t.segments.concat(e.segments),e.children)}return t}function Qo(t){return t instanceof si}function n$(t,e,n=null,r=null){let i=JA(t);return ex(i,e,n,r)}function JA(t){let e;function n(s){let o={};for(let u of s.children){let c=n(u);o[u.outlet]=c}let a=new me(s.url,o);return s===t&&(e=a),a}let r=n(t.root),i=ZA(r);return e??i}function ex(t,e,n,r){let i=t;for(;i.parent;)i=i.parent;if(e.length===0)return K_(i,i,i,n,r);let s=r$(e);if(s.toRoot())return K_(i,i,new me([],{}),n,r);let o=i$(s,i,t),a=o.processChildren?Wu(o.segmentGroup,o.index,s.commands):nx(o.segmentGroup,o.index,s.commands);return K_(i,o.segmentGroup,a,n,r)}function Jh(t){return typeof t=="object"&&t!=null&&!t.outlets&&!t.segmentPath}function Zu(t){return typeof t=="object"&&t!=null&&t.outlets}function K_(t,e,n,r,i){let s={};r&&Object.entries(r).forEach(([u,c])=>{s[u]=Array.isArray(c)?c.map(l=>`${l}`):`${c}`});let o;t===e?o=n:o=tx(t,e,n);let a=ZA(XA(o));return new si(a,s,i)}function tx(t,e,n){let r={};return Object.entries(t.children).forEach(([i,s])=>{s===e?r[i]=n:r[i]=tx(s,e,n)}),new me(t.segments,r)}var ef=class{constructor(e,n,r){if(this.isAbsolute=e,this.numberOfDoubleDots=n,this.commands=r,e&&r.length>0&&Jh(r[0]))throw new U(4003,!1);let i=r.find(Zu);if(i&&i!==qA(r))throw new U(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function r$(t){if(typeof t[0]=="string"&&t.length===1&&t[0]==="/")return new ef(!0,0,t);let e=0,n=!1,r=t.reduce((i,s,o)=>{if(typeof s=="object"&&s!=null){if(s.outlets){let a={};return Object.entries(s.outlets).forEach(([u,c])=>{a[u]=typeof c=="string"?c.split("/"):c}),[...i,{outlets:a}]}if(s.segmentPath)return[...i,s.segmentPath]}return typeof s!="string"?[...i,s]:o===0?(s.split("/").forEach((a,u)=>{u==0&&a==="."||(u==0&&a===""?n=!0:a===".."?e++:a!=""&&i.push(a))}),i):[...i,s]},[]);return new ef(n,e,r)}var zo=class{constructor(e,n,r){this.segmentGroup=e,this.processChildren=n,this.index=r}};function i$(t,e,n){if(t.isAbsolute)return new zo(e,!0,0);if(!n)return new zo(e,!1,NaN);if(n.parent===null)return new zo(n,!0,0);let r=Jh(t.commands[0])?0:1,i=n.segments.length-1+r;return s$(n,i,t.numberOfDoubleDots)}function s$(t,e,n){let r=t,i=e,s=n;for(;s>i;){if(s-=i,r=r.parent,!r)throw new U(4005,!1);i=r.segments.length}return new zo(r,!1,i-s)}function o$(t){return Zu(t[0])?t[0].outlets:{[X]:t}}function nx(t,e,n){if(t??=new me([],{}),t.segments.length===0&&t.hasChildren())return Wu(t,e,n);let r=a$(t,e,n),i=n.slice(r.commandIndex);if(r.match&&r.pathIndex<t.segments.length){let s=new me(t.segments.slice(0,r.pathIndex),{});return s.children[X]=new me(t.segments.slice(r.pathIndex),t.children),Wu(s,0,i)}else return r.match&&i.length===0?new me(t.segments,{}):r.match&&!t.hasChildren()?tv(t,e,n):r.match?Wu(t,0,i):tv(t,e,n)}function Wu(t,e,n){if(n.length===0)return new me(t.segments,{});{let r=o$(n),i={};if(Object.keys(r).some(s=>s!==X)&&t.children[X]&&t.numberOfChildren===1&&t.children[X].segments.length===0){let s=Wu(t.children[X],e,n);return new me(t.segments,s.children)}return Object.entries(r).forEach(([s,o])=>{typeof o=="string"&&(o=[o]),o!==null&&(i[s]=nx(t.children[s],e,o))}),Object.entries(t.children).forEach(([s,o])=>{r[s]===void 0&&(i[s]=o)}),new me(t.segments,i)}}function a$(t,e,n){let r=0,i=e,s={match:!1,pathIndex:0,commandIndex:0};for(;i<t.segments.length;){if(r>=n.length)return s;let o=t.segments[i],a=n[r];if(Zu(a))break;let u=`${a}`,c=r<n.length-1?n[r+1]:null;if(i>0&&u===void 0)break;if(u&&c&&typeof c=="object"&&c.outlets===void 0){if(!LA(u,c,o))return s;r+=2}else{if(!LA(u,{},o))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}function tv(t,e,n){let r=t.segments.slice(0,e),i=0;for(;i<n.length;){let s=n[i];if(Zu(s)){let u=u$(s.outlets);return new me(r,u)}if(i===0&&Jh(n[0])){let u=t.segments[e];r.push(new ls(u.path,VA(n[0]))),i++;continue}let o=Zu(s)?s.outlets[X]:`${s}`,a=i<n.length-1?n[i+1]:null;o&&a&&Jh(a)?(r.push(new ls(o,VA(a))),i+=2):(r.push(new ls(o,{})),i++)}return new me(r,{})}function u$(t){let e={};return Object.entries(t).forEach(([n,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(e[n]=tv(new me([],{}),0,r))}),e}function VA(t){let e={};return Object.entries(t).forEach(([n,r])=>e[n]=`${r}`),e}function LA(t,e,n){return t==n.path&&nr(e,n.parameters)}var Ku="imperative",at=function(t){return t[t.NavigationStart=0]="NavigationStart",t[t.NavigationEnd=1]="NavigationEnd",t[t.NavigationCancel=2]="NavigationCancel",t[t.NavigationError=3]="NavigationError",t[t.RoutesRecognized=4]="RoutesRecognized",t[t.ResolveStart=5]="ResolveStart",t[t.ResolveEnd=6]="ResolveEnd",t[t.GuardsCheckStart=7]="GuardsCheckStart",t[t.GuardsCheckEnd=8]="GuardsCheckEnd",t[t.RouteConfigLoadStart=9]="RouteConfigLoadStart",t[t.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",t[t.ChildActivationStart=11]="ChildActivationStart",t[t.ChildActivationEnd=12]="ChildActivationEnd",t[t.ActivationStart=13]="ActivationStart",t[t.ActivationEnd=14]="ActivationEnd",t[t.Scroll=15]="Scroll",t[t.NavigationSkipped=16]="NavigationSkipped",t}(at||{}),gn=class{constructor(e,n){this.id=e,this.url=n}},Yo=class extends gn{constructor(e,n,r="imperative",i=null){super(e,n),this.type=at.NavigationStart,this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Mr=class extends gn{constructor(e,n,r){super(e,n),this.urlAfterRedirects=r,this.type=at.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},pn=function(t){return t[t.Redirect=0]="Redirect",t[t.SupersededByNewNavigation=1]="SupersededByNewNavigation",t[t.NoDataFromResolver=2]="NoDataFromResolver",t[t.GuardRejected=3]="GuardRejected",t}(pn||{}),tf=function(t){return t[t.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",t[t.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",t}(tf||{}),oi=class extends gn{constructor(e,n,r,i){super(e,n),this.reason=r,this.code=i,this.type=at.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},ai=class extends gn{constructor(e,n,r,i){super(e,n),this.reason=r,this.code=i,this.type=at.NavigationSkipped}},Xu=class extends gn{constructor(e,n,r,i){super(e,n),this.error=r,this.target=i,this.type=at.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},nf=class extends gn{constructor(e,n,r,i){super(e,n),this.urlAfterRedirects=r,this.state=i,this.type=at.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},nv=class extends gn{constructor(e,n,r,i){super(e,n),this.urlAfterRedirects=r,this.state=i,this.type=at.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},rv=class extends gn{constructor(e,n,r,i,s){super(e,n),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=s,this.type=at.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},iv=class extends gn{constructor(e,n,r,i){super(e,n),this.urlAfterRedirects=r,this.state=i,this.type=at.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},sv=class extends gn{constructor(e,n,r,i){super(e,n),this.urlAfterRedirects=r,this.state=i,this.type=at.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},ov=class{constructor(e){this.route=e,this.type=at.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},av=class{constructor(e){this.route=e,this.type=at.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},uv=class{constructor(e){this.snapshot=e,this.type=at.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},cv=class{constructor(e){this.snapshot=e,this.type=at.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},lv=class{constructor(e){this.snapshot=e,this.type=at.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},dv=class{constructor(e){this.snapshot=e,this.type=at.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},rf=class{constructor(e,n,r){this.routerEvent=e,this.position=n,this.anchor=r,this.type=at.Scroll}toString(){let e=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${e}')`}},Ju=class{},ec=class{constructor(e){this.url=e}};var hv=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new oc,this.attachRef=null}},oc=(()=>{let e=class e{constructor(){this.contexts=new Map}onChildOutletCreated(r,i){let s=this.getOrCreateContext(r);s.outlet=i,this.contexts.set(r,s)}onChildOutletDestroyed(r){let i=this.getContext(r);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){let r=this.contexts;return this.contexts=new Map,r}onOutletReAttached(r){this.contexts=r}getOrCreateContext(r){let i=this.getContext(r);return i||(i=new hv,this.contexts.set(r,i)),i}getContext(r){return this.contexts.get(r)||null}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})(),sf=class{constructor(e){this._root=e}get root(){return this._root.value}parent(e){let n=this.pathFromRoot(e);return n.length>1?n[n.length-2]:null}children(e){let n=fv(e,this._root);return n?n.children.map(r=>r.value):[]}firstChild(e){let n=fv(e,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(e){let n=pv(e,this._root);return n.length<2?[]:n[n.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return pv(e,this._root).map(n=>n.value)}};function fv(t,e){if(t===e.value)return e;for(let n of e.children){let r=fv(t,n);if(r)return r}return null}function pv(t,e){if(t===e.value)return[e];for(let n of e.children){let r=pv(t,n);if(r.length)return r.unshift(e),r}return[]}var Qt=class{constructor(e,n){this.value=e,this.children=n}toString(){return`TreeNode(${this.value})`}};function Go(t){let e={};return t&&t.children.forEach(n=>e[n.value.outlet]=n),e}var of=class extends sf{constructor(e,n){super(e),this.snapshot=n,Dv(this,e)}toString(){return this.snapshot.toString()}};function rx(t){let e=c$(t),n=new mt([new ls("",{})]),r=new mt({}),i=new mt({}),s=new mt({}),o=new mt(""),a=new Zo(n,r,s,o,i,X,t,e.root);return a.snapshot=e.root,new of(new Qt(a,[]),e)}function c$(t){let e={},n={},r={},i="",s=new tc([],e,r,i,n,X,t,null,{});return new af("",new Qt(s,[]))}var Zo=class{constructor(e,n,r,i,s,o,a,u){this.urlSubject=e,this.paramsSubject=n,this.queryParamsSubject=r,this.fragmentSubject=i,this.dataSubject=s,this.outlet=o,this.component=a,this._futureSnapshot=u,this.title=this.dataSubject?.pipe(F(c=>c[ic]))??V(void 0),this.url=e,this.params=n,this.queryParams=r,this.fragment=i,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(F(e=>Ko(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(F(e=>Ko(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Cv(t,e,n="emptyOnly"){let r,{routeConfig:i}=t;return e!==null&&(n==="always"||i?.path===""||!e.component&&!e.routeConfig?.loadComponent)?r={params:x(x({},e.params),t.params),data:x(x({},e.data),t.data),resolve:x(x(x(x({},t.data),e.data),i?.data),t._resolvedData)}:r={params:x({},t.params),data:x({},t.data),resolve:x(x({},t.data),t._resolvedData??{})},i&&sx(i)&&(r.resolve[ic]=i.title),r}var tc=class{get title(){return this.data?.[ic]}constructor(e,n,r,i,s,o,a,u,c){this.url=e,this.params=n,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=o,this.component=a,this.routeConfig=u,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Ko(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Ko(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(r=>r.toString()).join("/"),n=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${n}')`}},af=class extends sf{constructor(e,n){super(n),this.url=e,Dv(this,n)}toString(){return ix(this._root)}};function Dv(t,e){e.value._routerState=t,e.children.forEach(n=>Dv(t,n))}function ix(t){let e=t.children.length>0?` { ${t.children.map(ix).join(", ")} } `:"";return`${t.value}${e}`}function Q_(t){if(t.snapshot){let e=t.snapshot,n=t._futureSnapshot;t.snapshot=n,nr(e.queryParams,n.queryParams)||t.queryParamsSubject.next(n.queryParams),e.fragment!==n.fragment&&t.fragmentSubject.next(n.fragment),nr(e.params,n.params)||t.paramsSubject.next(n.params),LB(e.url,n.url)||t.urlSubject.next(n.url),nr(e.data,n.data)||t.dataSubject.next(n.data)}else t.snapshot=t._futureSnapshot,t.dataSubject.next(t._futureSnapshot.data)}function gv(t,e){let n=nr(t.params,e.params)&&$B(t.url,e.url),r=!t.parent!=!e.parent;return n&&!r&&(!t.parent||gv(t.parent,e.parent))}function sx(t){return typeof t.title=="string"||t.title===null}var l$=(()=>{let e=class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=X,this.activateEvents=new it,this.deactivateEvents=new it,this.attachEvents=new it,this.detachEvents=new it,this.parentContexts=R(oc),this.location=R(ju),this.changeDetector=R(jo),this.environmentInjector=R(Wt),this.inputBinder=R(hf,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(r){if(r.name){let{firstChange:i,previousValue:s}=r.name;if(i)return;this.isTrackedInParentContexts(s)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(s)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(r){return this.parentContexts.getContext(r)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let r=this.parentContexts.getContext(this.name);r?.route&&(r.attachRef?this.attach(r.attachRef,r.route):this.activateWith(r.route,r.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new U(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new U(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new U(4012,!1);this.location.detach();let r=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(r.instance),r}attach(r,i){this.activated=r,this._activatedRoute=i,this.location.insert(r.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(r.instance)}deactivate(){if(this.activated){let r=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(r)}}activateWith(r,i){if(this.isActivated)throw new U(4013,!1);this._activatedRoute=r;let s=this.location,a=r.snapshot.component,u=this.parentContexts.getOrCreateContext(this.name).children,c=new mv(r,u,s.injector);this.activated=s.createComponent(a,{index:s.length,injector:c,environmentInjector:i??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=Xn({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[ko]});let t=e;return t})(),mv=class{constructor(e,n,r){this.route=e,this.childContexts=n,this.parent=r}get(e,n){return e===Zo?this.route:e===oc?this.childContexts:this.parent.get(e,n)}},hf=new P(""),jA=(()=>{let e=class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(r){this.unsubscribeFromRouteData(r),this.subscribeToRouteData(r)}unsubscribeFromRouteData(r){this.outletDataSubscriptions.get(r)?.unsubscribe(),this.outletDataSubscriptions.delete(r)}subscribeToRouteData(r){let{activatedRoute:i}=r,s=mu([i.queryParams,i.params,i.data]).pipe(Me(([o,a,u],c)=>(u=x(x(x({},o),a),u),c===0?V(u):Promise.resolve(u)))).subscribe(o=>{if(!r.isActivated||!r.activatedComponentRef||r.activatedRoute!==i||i.component===null){this.unsubscribeFromRouteData(r);return}let a=dA(i.component);if(!a){this.unsubscribeFromRouteData(r);return}for(let{templateName:u}of a.inputs)r.activatedComponentRef.setInput(u,o[u])});this.outletDataSubscriptions.set(r,s)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=k({token:e,factory:e.\u0275fac});let t=e;return t})();function d$(t,e,n){let r=nc(t,e._root,n?n._root:void 0);return new of(r,e)}function nc(t,e,n){if(n&&t.shouldReuseRoute(e.value,n.value.snapshot)){let r=n.value;r._futureSnapshot=e.value;let i=h$(t,e,n);return new Qt(r,i)}else{if(t.shouldAttach(e.value)){let s=t.retrieve(e.value);if(s!==null){let o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(a=>nc(t,a)),o}}let r=f$(e.value),i=e.children.map(s=>nc(t,s));return new Qt(r,i)}}function h$(t,e,n){return e.children.map(r=>{for(let i of n.children)if(t.shouldReuseRoute(r.value,i.value.snapshot))return nc(t,r,i);return nc(t,r)})}function f$(t){return new Zo(new mt(t.url),new mt(t.params),new mt(t.queryParams),new mt(t.fragment),new mt(t.data),t.outlet,t.component,t)}var ox="ngNavigationCancelingError";function ax(t,e){let{redirectTo:n,navigationBehaviorOptions:r}=Qo(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,i=ux(!1,pn.Redirect);return i.url=n,i.navigationBehaviorOptions=r,i}function ux(t,e){let n=new Error(`NavigationCancelingError: ${t||""}`);return n[ox]=!0,n.cancellationCode=e,n}function p$(t){return cx(t)&&Qo(t.url)}function cx(t){return!!t&&t[ox]}var g$=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=No({type:e,selectors:[["ng-component"]],standalone:!0,features:[tA],decls:1,vars:0,template:function(i,s){i&1&&Pn(0,"router-outlet")},dependencies:[l$],encapsulation:2});let t=e;return t})();function m$(t,e){return t.providers&&!t._injector&&(t._injector=Fh(t.providers,e,`Route: ${t.path}`)),t._injector??e}function Tv(t){let e=t.children&&t.children.map(Tv),n=e?he(x({},t),{children:e}):x({},t);return!n.component&&!n.loadComponent&&(e||n.loadChildren)&&n.outlet&&n.outlet!==X&&(n.component=g$),n}function rr(t){return t.outlet||X}function y$(t,e){let n=t.filter(r=>rr(r)===e);return n.push(...t.filter(r=>rr(r)!==e)),n}function ac(t){if(!t)return null;if(t.routeConfig?._injector)return t.routeConfig._injector;for(let e=t.parent;e;e=e.parent){let n=e.routeConfig;if(n?._loadedInjector)return n._loadedInjector;if(n?._injector)return n._injector}return null}var _$=(t,e,n,r)=>F(i=>(new yv(e,i.targetRouterState,i.currentRouterState,n,r).activate(t),i)),yv=class{constructor(e,n,r,i,s){this.routeReuseStrategy=e,this.futureState=n,this.currState=r,this.forwardEvent=i,this.inputBindingEnabled=s}activate(e){let n=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,r,e),Q_(this.futureState.root),this.activateChildRoutes(n,r,e)}deactivateChildRoutes(e,n,r){let i=Go(n);e.children.forEach(s=>{let o=s.value.outlet;this.deactivateRoutes(s,i[o],r),delete i[o]}),Object.values(i).forEach(s=>{this.deactivateRouteAndItsChildren(s,r)})}deactivateRoutes(e,n,r){let i=e.value,s=n?n.value:null;if(i===s)if(i.component){let o=r.getContext(i.outlet);o&&this.deactivateChildRoutes(e,n,o.children)}else this.deactivateChildRoutes(e,n,r);else s&&this.deactivateRouteAndItsChildren(n,r)}deactivateRouteAndItsChildren(e,n){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,n):this.deactivateRouteAndOutlet(e,n)}detachAndStoreRouteSubtree(e,n){let r=n.getContext(e.value.outlet),i=r&&e.value.component?r.children:n,s=Go(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);if(r&&r.outlet){let o=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:a})}}deactivateRouteAndOutlet(e,n){let r=n.getContext(e.value.outlet),i=r&&e.value.component?r.children:n,s=Go(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(e,n,r){let i=Go(n);e.children.forEach(s=>{this.activateRoutes(s,i[s.value.outlet],r),this.forwardEvent(new dv(s.value.snapshot))}),e.children.length&&this.forwardEvent(new cv(e.value.snapshot))}activateRoutes(e,n,r){let i=e.value,s=n?n.value:null;if(Q_(i),i===s)if(i.component){let o=r.getOrCreateContext(i.outlet);this.activateChildRoutes(e,n,o.children)}else this.activateChildRoutes(e,n,r);else if(i.component){let o=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){let a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),Q_(a.route.value),this.activateChildRoutes(e,null,o.children)}else{let a=ac(i.snapshot);o.attachRef=null,o.route=i,o.injector=a,o.outlet&&o.outlet.activateWith(i,o.injector),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,r)}},uf=class{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},Wo=class{constructor(e,n){this.component=e,this.route=n}};function v$(t,e,n){let r=t._root,i=e?e._root:null;return Gu(r,i,n,[r.value])}function w$(t){let e=t.routeConfig?t.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:t,guards:e}}function Jo(t,e){let n=Symbol(),r=e.get(t,n);return r===n?typeof t=="function"&&!ib(t)?t:e.get(t):r}function Gu(t,e,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=Go(e);return t.children.forEach(o=>{E$(o,s[o.value.outlet],n,r.concat([o.value]),i),delete s[o.value.outlet]}),Object.entries(s).forEach(([o,a])=>Qu(a,n.getContext(o),i)),i}function E$(t,e,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=t.value,o=e?e.value:null,a=n?n.getContext(t.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){let u=I$(o,s,s.routeConfig.runGuardsAndResolvers);u?i.canActivateChecks.push(new uf(r)):(s.data=o.data,s._resolvedData=o._resolvedData),s.component?Gu(t,e,a?a.children:null,r,i):Gu(t,e,n,r,i),u&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new Wo(a.outlet.component,o))}else o&&Qu(e,a,i),i.canActivateChecks.push(new uf(r)),s.component?Gu(t,null,a?a.children:null,r,i):Gu(t,null,n,r,i);return i}function I$(t,e,n){if(typeof n=="function")return n(t,e);switch(n){case"pathParamsChange":return!ds(t.url,e.url);case"pathParamsOrQueryParamsChange":return!ds(t.url,e.url)||!nr(t.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!gv(t,e)||!nr(t.queryParams,e.queryParams);case"paramsChange":default:return!gv(t,e)}}function Qu(t,e,n){let r=Go(t),i=t.value;Object.entries(r).forEach(([s,o])=>{i.component?e?Qu(o,e.children.getContext(s),n):Qu(o,null,n):Qu(o,e,n)}),i.component?e&&e.outlet&&e.outlet.isActivated?n.canDeactivateChecks.push(new Wo(e.outlet.component,i)):n.canDeactivateChecks.push(new Wo(null,i)):n.canDeactivateChecks.push(new Wo(null,i))}function uc(t){return typeof t=="function"}function C$(t){return typeof t=="boolean"}function D$(t){return t&&uc(t.canLoad)}function T$(t){return t&&uc(t.canActivate)}function b$(t){return t&&uc(t.canActivateChild)}function S$(t){return t&&uc(t.canDeactivate)}function A$(t){return t&&uc(t.canMatch)}function lx(t){return t instanceof Cr||t?.name==="EmptyError"}var Qh=Symbol("INITIAL_VALUE");function Xo(){return Me(t=>mu(t.map(e=>e.pipe(Dr(1),Qi(Qh)))).pipe(F(e=>{for(let n of e)if(n!==!0){if(n===Qh)return Qh;if(n===!1||n instanceof si)return n}return!0}),yt(e=>e!==Qh),Dr(1)))}function x$(t,e){return We(n=>{let{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=n;return o.length===0&&s.length===0?V(he(x({},n),{guardsResult:!0})):M$(o,r,i,t).pipe(We(a=>a&&C$(a)?R$(r,s,t,e):V(a)),F(a=>he(x({},n),{guardsResult:a})))})}function M$(t,e,n,r){return fe(t).pipe(We(i=>F$(i.component,i.route,n,e,r)),un(i=>i!==!0,!0))}function R$(t,e,n,r){return fe(e).pipe(Ki(i=>go(P$(i.route.parent,r),N$(i.route,r),O$(t,i.path,n),k$(t,i.route,n))),un(i=>i!==!0,!0))}function N$(t,e){return t!==null&&e&&e(new lv(t)),V(!0)}function P$(t,e){return t!==null&&e&&e(new uv(t)),V(!0)}function k$(t,e,n){let r=e.routeConfig?e.routeConfig.canActivate:null;if(!r||r.length===0)return V(!0);let i=r.map(s=>Hd(()=>{let o=ac(e)??n,a=Jo(s,o),u=T$(a)?a.canActivate(e,t):ii(o,()=>a(e,t));return ui(u).pipe(un())}));return V(i).pipe(Xo())}function O$(t,e,n){let r=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>w$(o)).filter(o=>o!==null).map(o=>Hd(()=>{let a=o.guards.map(u=>{let c=ac(o.node)??n,l=Jo(u,c),d=b$(l)?l.canActivateChild(r,t):ii(c,()=>l(r,t));return ui(d).pipe(un())});return V(a).pipe(Xo())}));return V(s).pipe(Xo())}function F$(t,e,n,r,i){let s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!s||s.length===0)return V(!0);let o=s.map(a=>{let u=ac(e)??i,c=Jo(a,u),l=S$(c)?c.canDeactivate(t,e,n,r):ii(u,()=>c(t,e,n,r));return ui(l).pipe(un())});return V(o).pipe(Xo())}function V$(t,e,n,r){let i=e.canLoad;if(i===void 0||i.length===0)return V(!0);let s=i.map(o=>{let a=Jo(o,t),u=D$(a)?a.canLoad(e,n):ii(t,()=>a(e,n));return ui(u)});return V(s).pipe(Xo(),dx(r))}function dx(t){return bm(Ke(e=>{if(Qo(e))throw ax(t,e)}),F(e=>e===!0))}function L$(t,e,n,r){let i=e.canMatch;if(!i||i.length===0)return V(!0);let s=i.map(o=>{let a=Jo(o,t),u=A$(a)?a.canMatch(e,n):ii(t,()=>a(e,n));return ui(u)});return V(s).pipe(Xo(),dx(r))}var rc=class{constructor(e){this.segmentGroup=e||null}},cf=class extends Error{constructor(e){super(),this.urlTree=e}};function qo(t){return po(new rc(t))}function j$(t){return po(new U(4e3,!1))}function U$(t){return po(ux(!1,pn.GuardRejected))}var _v=class{constructor(e,n){this.urlSerializer=e,this.urlTree=n}lineralizeSegments(e,n){let r=[],i=n.root;for(;;){if(r=r.concat(i.segments),i.numberOfChildren===0)return V(r);if(i.numberOfChildren>1||!i.children[X])return j$(e.redirectTo);i=i.children[X]}}applyRedirectCommands(e,n,r){let i=this.applyRedirectCreateUrlTree(n,this.urlSerializer.parse(n),e,r);if(n.startsWith("/"))throw new cf(i);return i}applyRedirectCreateUrlTree(e,n,r,i){let s=this.createSegmentGroup(e,n.root,r,i);return new si(s,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(e,n){let r={};return Object.entries(e).forEach(([i,s])=>{if(typeof s=="string"&&s.startsWith(":")){let a=s.substring(1);r[i]=n[a]}else r[i]=s}),r}createSegmentGroup(e,n,r,i){let s=this.createSegments(e,n.segments,r,i),o={};return Object.entries(n.children).forEach(([a,u])=>{o[a]=this.createSegmentGroup(e,u,r,i)}),new me(s,o)}createSegments(e,n,r,i){return n.map(s=>s.path.startsWith(":")?this.findPosParam(e,s,i):this.findOrReturn(s,r))}findPosParam(e,n,r){let i=r[n.path.substring(1)];if(!i)throw new U(4001,!1);return i}findOrReturn(e,n){let r=0;for(let i of n){if(i.path===e.path)return n.splice(r),i;r++}return e}},vv={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function B$(t,e,n,r,i){let s=bv(t,e,n);return s.matched?(r=m$(e,r),L$(r,e,n,i).pipe(F(o=>o===!0?s:x({},vv)))):V(s)}function bv(t,e,n){if(e.path==="**")return $$(n);if(e.path==="")return e.pathMatch==="full"&&(t.hasChildren()||n.length>0)?x({},vv):{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};let i=(e.matcher||VB)(n,t,e);if(!i)return x({},vv);let s={};Object.entries(i.posParams??{}).forEach(([a,u])=>{s[a]=u.path});let o=i.consumed.length>0?x(x({},s),i.consumed[i.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:i.consumed,remainingSegments:n.slice(i.consumed.length),parameters:o,positionalParamSegments:i.posParams??{}}}function $$(t){return{matched:!0,parameters:t.length>0?qA(t).parameters:{},consumedSegments:t,remainingSegments:[],positionalParamSegments:{}}}function UA(t,e,n,r){return n.length>0&&G$(t,n,r)?{segmentGroup:new me(e,q$(r,new me(n,t.children))),slicedSegments:[]}:n.length===0&&z$(t,n,r)?{segmentGroup:new me(t.segments,H$(t,n,r,t.children)),slicedSegments:n}:{segmentGroup:new me(t.segments,t.children),slicedSegments:n}}function H$(t,e,n,r){let i={};for(let s of n)if(ff(t,e,s)&&!r[rr(s)]){let o=new me([],{});i[rr(s)]=o}return x(x({},r),i)}function q$(t,e){let n={};n[X]=e;for(let r of t)if(r.path===""&&rr(r)!==X){let i=new me([],{});n[rr(r)]=i}return n}function G$(t,e,n){return n.some(r=>ff(t,e,r)&&rr(r)!==X)}function z$(t,e,n){return n.some(r=>ff(t,e,r))}function ff(t,e,n){return(t.hasChildren()||e.length>0)&&n.pathMatch==="full"?!1:n.path===""}function W$(t,e,n,r){return rr(t)!==r&&(r===X||!ff(e,n,t))?!1:bv(e,t,n).matched}function K$(t,e,n){return e.length===0&&!t.children[n]}var wv=class{};function Q$(t,e,n,r,i,s,o="emptyOnly"){return new Ev(t,e,n,r,i,o,s).recognize()}var Y$=31,Ev=class{constructor(e,n,r,i,s,o,a){this.injector=e,this.configLoader=n,this.rootComponentType=r,this.config=i,this.urlTree=s,this.paramsInheritanceStrategy=o,this.urlSerializer=a,this.applyRedirects=new _v(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(e){return new U(4002,`'${e.segmentGroup}'`)}recognize(){let e=UA(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(F(n=>{let r=new tc([],Object.freeze({}),Object.freeze(x({},this.urlTree.queryParams)),this.urlTree.fragment,{},X,this.rootComponentType,null,{}),i=new Qt(r,n),s=new af("",i),o=n$(r,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(o),this.inheritParamsAndData(s._root,null),{state:s,tree:o}}))}match(e){return this.processSegmentGroup(this.injector,this.config,e,X).pipe(Kr(r=>{if(r instanceof cf)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof rc?this.noMatchError(r):r}))}inheritParamsAndData(e,n){let r=e.value,i=Cv(r,n,this.paramsInheritanceStrategy);r.params=Object.freeze(i.params),r.data=Object.freeze(i.data),e.children.forEach(s=>this.inheritParamsAndData(s,r))}processSegmentGroup(e,n,r,i){return r.segments.length===0&&r.hasChildren()?this.processChildren(e,n,r):this.processSegment(e,n,r,r.segments,i,!0).pipe(F(s=>s instanceof Qt?[s]:[]))}processChildren(e,n,r){let i=[];for(let s of Object.keys(r.children))s==="primary"?i.unshift(s):i.push(s);return fe(i).pipe(Ki(s=>{let o=r.children[s],a=y$(n,s);return this.processSegmentGroup(e,a,o,s)}),Gn((s,o)=>(s.push(...o),s)),Qr(null),Om(),We(s=>{if(s===null)return qo(r);let o=hx(s);return Z$(o),V(o)}))}processSegment(e,n,r,i,s,o){return fe(n).pipe(Ki(a=>this.processSegmentAgainstRoute(a._injector??e,n,a,r,i,s,o).pipe(Kr(u=>{if(u instanceof rc)return V(null);throw u}))),un(a=>!!a),Kr(a=>{if(lx(a))return K$(r,i,s)?V(new wv):qo(r);throw a}))}processSegmentAgainstRoute(e,n,r,i,s,o,a){return W$(r,i,s,o)?r.redirectTo===void 0?this.matchSegmentAgainstRoute(e,i,r,s,o):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(e,i,n,r,s,o):qo(i):qo(i)}expandSegmentAgainstRouteUsingRedirect(e,n,r,i,s,o){let{matched:a,consumedSegments:u,positionalParamSegments:c,remainingSegments:l}=bv(n,i,s);if(!a)return qo(n);i.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>Y$&&(this.allowRedirects=!1));let d=this.applyRedirects.applyRedirectCommands(u,i.redirectTo,c);return this.applyRedirects.lineralizeSegments(i,d).pipe(We(h=>this.processSegment(e,r,n,h.concat(l),o,!1)))}matchSegmentAgainstRoute(e,n,r,i,s){let o=B$(n,r,i,e,this.urlSerializer);return r.path==="**"&&(n.children={}),o.pipe(Me(a=>a.matched?(e=r._injector??e,this.getChildConfig(e,r,i).pipe(Me(({routes:u})=>{let c=r._loadedInjector??e,{consumedSegments:l,remainingSegments:d,parameters:h}=a,f=new tc(l,h,Object.freeze(x({},this.urlTree.queryParams)),this.urlTree.fragment,J$(r),rr(r),r.component??r._loadedComponent??null,r,eH(r)),{segmentGroup:p,slicedSegments:g}=UA(n,l,d,u);if(g.length===0&&p.hasChildren())return this.processChildren(c,u,p).pipe(F(C=>C===null?null:new Qt(f,C)));if(u.length===0&&g.length===0)return V(new Qt(f,[]));let _=rr(r)===s;return this.processSegment(c,u,p,g,_?X:s,!0).pipe(F(C=>new Qt(f,C instanceof Qt?[C]:[])))}))):qo(n)))}getChildConfig(e,n,r){return n.children?V({routes:n.children,injector:e}):n.loadChildren?n._loadedRoutes!==void 0?V({routes:n._loadedRoutes,injector:n._loadedInjector}):V$(e,n,r,this.urlSerializer).pipe(We(i=>i?this.configLoader.loadChildren(e,n).pipe(Ke(s=>{n._loadedRoutes=s.routes,n._loadedInjector=s.injector})):U$(n))):V({routes:[],injector:e})}};function Z$(t){t.sort((e,n)=>e.value.outlet===X?-1:n.value.outlet===X?1:e.value.outlet.localeCompare(n.value.outlet))}function X$(t){let e=t.value.routeConfig;return e&&e.path===""}function hx(t){let e=[],n=new Set;for(let r of t){if(!X$(r)){e.push(r);continue}let i=e.find(s=>r.value.routeConfig===s.value.routeConfig);i!==void 0?(i.children.push(...r.children),n.add(i)):e.push(r)}for(let r of n){let i=hx(r.children);e.push(new Qt(r.value,i))}return e.filter(r=>!n.has(r))}function J$(t){return t.data||{}}function eH(t){return t.resolve||{}}function tH(t,e,n,r,i,s){return We(o=>Q$(t,e,n,r,o.extractedUrl,i,s).pipe(F(({state:a,tree:u})=>he(x({},o),{targetSnapshot:a,urlAfterRedirects:u}))))}function nH(t,e){return We(n=>{let{targetSnapshot:r,guards:{canActivateChecks:i}}=n;if(!i.length)return V(n);let s=new Set(i.map(u=>u.route)),o=new Set;for(let u of s)if(!o.has(u))for(let c of fx(u))o.add(c);let a=0;return fe(o).pipe(Ki(u=>s.has(u)?rH(u,r,t,e):(u.data=Cv(u,u.parent,t).resolve,V(void 0))),Ke(()=>a++),yo(1),We(u=>a===o.size?V(n):Lt))})}function fx(t){let e=t.children.map(n=>fx(n)).flat();return[t,...e]}function rH(t,e,n,r){let i=t.routeConfig,s=t._resolve;return i?.title!==void 0&&!sx(i)&&(s[ic]=i.title),iH(s,t,e,r).pipe(F(o=>(t._resolvedData=o,t.data=Cv(t,t.parent,n).resolve,null)))}function iH(t,e,n,r){let i=X_(t);if(i.length===0)return V({});let s={};return fe(i).pipe(We(o=>sH(t[o],e,n,r).pipe(un(),Ke(a=>{s[o]=a}))),yo(1),km(s),Kr(o=>lx(o)?Lt:po(o)))}function sH(t,e,n,r){let i=ac(e)??r,s=Jo(t,i),o=s.resolve?s.resolve(e,n):ii(i,()=>s(e,n));return ui(o)}function Y_(t){return Me(e=>{let n=t(e);return n?fe(n).pipe(F(()=>e)):V(e)})}var px=(()=>{let e=class e{buildTitle(r){let i,s=r.root;for(;s!==void 0;)i=this.getResolvedTitleForRoute(s)??i,s=s.children.find(o=>o.outlet===X);return i}getResolvedTitleForRoute(r){return r.data[ic]}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=k({token:e,factory:()=>R(oH),providedIn:"root"});let t=e;return t})(),oH=(()=>{let e=class e extends px{constructor(r){super(),this.title=r}updateTitle(r){let i=this.buildTitle(r);i!==void 0&&this.title.setTitle(i)}};e.\u0275fac=function(i){return new(i||e)(I(PA))},e.\u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})(),cc=new P("",{providedIn:"root",factory:()=>({})}),lf=new P(""),Sv=(()=>{let e=class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=R(jh)}loadComponent(r){if(this.componentLoaders.get(r))return this.componentLoaders.get(r);if(r._loadedComponent)return V(r._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(r);let i=ui(r.loadComponent()).pipe(F(gx),Ke(o=>{this.onLoadEndListener&&this.onLoadEndListener(r),r._loadedComponent=o}),_u(()=>{this.componentLoaders.delete(r)})),s=new uo(i,()=>new rt).pipe(ao());return this.componentLoaders.set(r,s),s}loadChildren(r,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return V({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);let o=aH(i,this.compiler,r,this.onLoadEndListener).pipe(_u(()=>{this.childrenLoaders.delete(i)})),a=new uo(o,()=>new rt).pipe(ao());return this.childrenLoaders.set(i,a),a}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function aH(t,e,n,r){return ui(t.loadChildren()).pipe(F(gx),We(i=>i instanceof Nu||Array.isArray(i)?V(i):fe(e.compileModuleAsync(i))),F(i=>{r&&r(t);let s,o,a=!1;return Array.isArray(i)?(o=i,a=!0):(s=i.create(n).injector,o=s.get(lf,[],{optional:!0,self:!0}).flat()),{routes:o.map(Tv),injector:s}}))}function uH(t){return t&&typeof t=="object"&&"default"in t}function gx(t){return uH(t)?t.default:t}var Av=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=k({token:e,factory:()=>R(cH),providedIn:"root"});let t=e;return t})(),cH=(()=>{let e=class e{shouldProcessUrl(r){return!0}extract(r){return r}merge(r,i){return r}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})(),mx=new P(""),yx=new P("");function lH(t,e,n){let r=t.get(yx),i=t.get($t);return t.get(se).runOutsideAngular(()=>{if(!i.startViewTransition||r.skipNextTransition)return r.skipNextTransition=!1,Promise.resolve();let s,o=new Promise(c=>{s=c}),a=i.startViewTransition(()=>(s(),dH(t))),{onViewTransitionCreated:u}=r;return u&&ii(t,()=>u({transition:a,from:e,to:n})),o})}function dH(t){return new Promise(e=>{__(e,{injector:t})})}var xv=(()=>{let e=class e{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new rt,this.transitionAbortSubject=new rt,this.configLoader=R(Sv),this.environmentInjector=R(Wt),this.urlSerializer=R(sc),this.rootContexts=R(oc),this.location=R(Ho),this.inputBindingEnabled=R(hf,{optional:!0})!==null,this.titleStrategy=R(px),this.options=R(cc,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=R(Av),this.createViewTransition=R(mx,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>V(void 0),this.rootComponentType=null;let r=s=>this.events.next(new ov(s)),i=s=>this.events.next(new av(s));this.configLoader.onLoadEndListener=i,this.configLoader.onLoadStartListener=r}complete(){this.transitions?.complete()}handleNavigationRequest(r){let i=++this.navigationId;this.transitions?.next(he(x(x({},this.transitions.value),r),{id:i}))}setupNavigations(r,i,s){return this.transitions=new mt({id:0,currentUrlTree:i,currentRawUrl:i,extractedUrl:this.urlHandlingStrategy.extract(i),urlAfterRedirects:this.urlHandlingStrategy.extract(i),rawUrl:i,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Ku,restoredState:null,currentSnapshot:s.snapshot,targetSnapshot:null,currentRouterState:s,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(yt(o=>o.id!==0),F(o=>he(x({},o),{extractedUrl:this.urlHandlingStrategy.extract(o.rawUrl)})),Me(o=>{this.currentTransition=o;let a=!1,u=!1;return V(o).pipe(Ke(c=>{this.currentNavigation={id:c.id,initialUrl:c.rawUrl,extractedUrl:c.extractedUrl,trigger:c.source,extras:c.extras,previousNavigation:this.lastSuccessfulNavigation?he(x({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Me(c=>{let l=!r.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),d=c.extras.onSameUrlNavigation??r.onSameUrlNavigation;if(!l&&d!=="reload"){let h="";return this.events.next(new ai(c.id,this.urlSerializer.serialize(c.rawUrl),h,tf.IgnoredSameUrlNavigation)),c.resolve(null),Lt}if(this.urlHandlingStrategy.shouldProcessUrl(c.rawUrl))return V(c).pipe(Me(h=>{let f=this.transitions?.getValue();return this.events.next(new Yo(h.id,this.urlSerializer.serialize(h.extractedUrl),h.source,h.restoredState)),f!==this.transitions?.getValue()?Lt:Promise.resolve(h)}),tH(this.environmentInjector,this.configLoader,this.rootComponentType,r.config,this.urlSerializer,this.paramsInheritanceStrategy),Ke(h=>{o.targetSnapshot=h.targetSnapshot,o.urlAfterRedirects=h.urlAfterRedirects,this.currentNavigation=he(x({},this.currentNavigation),{finalUrl:h.urlAfterRedirects});let f=new nf(h.id,this.urlSerializer.serialize(h.extractedUrl),this.urlSerializer.serialize(h.urlAfterRedirects),h.targetSnapshot);this.events.next(f)}));if(l&&this.urlHandlingStrategy.shouldProcessUrl(c.currentRawUrl)){let{id:h,extractedUrl:f,source:p,restoredState:g,extras:_}=c,C=new Yo(h,this.urlSerializer.serialize(f),p,g);this.events.next(C);let M=rx(this.rootComponentType).snapshot;return this.currentTransition=o=he(x({},c),{targetSnapshot:M,urlAfterRedirects:f,extras:he(x({},_),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=f,V(o)}else{let h="";return this.events.next(new ai(c.id,this.urlSerializer.serialize(c.extractedUrl),h,tf.IgnoredByUrlHandlingStrategy)),c.resolve(null),Lt}}),Ke(c=>{let l=new nv(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(l)}),F(c=>(this.currentTransition=o=he(x({},c),{guards:v$(c.targetSnapshot,c.currentSnapshot,this.rootContexts)}),o)),x$(this.environmentInjector,c=>this.events.next(c)),Ke(c=>{if(o.guardsResult=c.guardsResult,Qo(c.guardsResult))throw ax(this.urlSerializer,c.guardsResult);let l=new rv(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot,!!c.guardsResult);this.events.next(l)}),yt(c=>c.guardsResult?!0:(this.cancelNavigationTransition(c,"",pn.GuardRejected),!1)),Y_(c=>{if(c.guards.canActivateChecks.length)return V(c).pipe(Ke(l=>{let d=new iv(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(d)}),Me(l=>{let d=!1;return V(l).pipe(nH(this.paramsInheritanceStrategy,this.environmentInjector),Ke({next:()=>d=!0,complete:()=>{d||this.cancelNavigationTransition(l,"",pn.NoDataFromResolver)}}))}),Ke(l=>{let d=new sv(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(d)}))}),Y_(c=>{let l=d=>{let h=[];d.routeConfig?.loadComponent&&!d.routeConfig._loadedComponent&&h.push(this.configLoader.loadComponent(d.routeConfig).pipe(Ke(f=>{d.component=f}),F(()=>{})));for(let f of d.children)h.push(...l(f));return h};return mu(l(c.targetSnapshot.root)).pipe(Qr(null),Dr(1))}),Y_(()=>this.afterPreactivation()),Me(()=>{let{currentSnapshot:c,targetSnapshot:l}=o,d=this.createViewTransition?.(this.environmentInjector,c.root,l.root);return d?fe(d).pipe(F(()=>o)):V(o)}),F(c=>{let l=d$(r.routeReuseStrategy,c.targetSnapshot,c.currentRouterState);return this.currentTransition=o=he(x({},c),{targetRouterState:l}),this.currentNavigation.targetRouterState=l,o}),Ke(()=>{this.events.next(new Ju)}),_$(this.rootContexts,r.routeReuseStrategy,c=>this.events.next(c),this.inputBindingEnabled),Dr(1),Ke({next:c=>{a=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Mr(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects))),this.titleStrategy?.updateTitle(c.targetRouterState.snapshot),c.resolve(!0)},complete:()=>{a=!0}}),Lm(this.transitionAbortSubject.pipe(Ke(c=>{throw c}))),_u(()=>{!a&&!u&&this.cancelNavigationTransition(o,"",pn.SupersededByNewNavigation),this.currentNavigation?.id===o.id&&(this.currentNavigation=null)}),Kr(c=>{if(u=!0,cx(c))this.events.next(new oi(o.id,this.urlSerializer.serialize(o.extractedUrl),c.message,c.cancellationCode)),p$(c)?this.events.next(new ec(c.url)):o.resolve(!1);else{this.events.next(new Xu(o.id,this.urlSerializer.serialize(o.extractedUrl),c,o.targetSnapshot??void 0));try{o.resolve(r.errorHandler(c))}catch(l){this.options.resolveNavigationPromiseOnError?o.resolve(!1):o.reject(l)}}return Lt}))}))}cancelNavigationTransition(r,i,s){let o=new oi(r.id,this.urlSerializer.serialize(r.extractedUrl),i,s);this.events.next(o),r.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function hH(t){return t!==Ku}var fH=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=k({token:e,factory:()=>R(pH),providedIn:"root"});let t=e;return t})(),Iv=class{shouldDetach(e){return!1}store(e,n){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,n){return e.routeConfig===n.routeConfig}},pH=(()=>{let e=class e extends Iv{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Vu(e)))(s||e)}})(),e.\u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})(),_x=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=k({token:e,factory:()=>R(gH),providedIn:"root"});let t=e;return t})(),gH=(()=>{let e=class e extends _x{constructor(){super(...arguments),this.location=R(Ho),this.urlSerializer=R(sc),this.options=R(cc,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=R(Av),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new si,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=rx(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(r){return this.location.subscribe(i=>{i.type==="popstate"&&r(i.url,i.state)})}handleRouterEvent(r,i){if(r instanceof Yo)this.stateMemento=this.createStateMemento();else if(r instanceof ai)this.rawUrlTree=i.initialUrl;else if(r instanceof nf){if(this.urlUpdateStrategy==="eager"&&!i.extras.skipLocationChange){let s=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl);this.setBrowserUrl(s,i)}}else r instanceof Ju?(this.currentUrlTree=i.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl),this.routerState=i.targetRouterState,this.urlUpdateStrategy==="deferred"&&(i.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,i))):r instanceof oi&&(r.code===pn.GuardRejected||r.code===pn.NoDataFromResolver)?this.restoreHistory(i):r instanceof Xu?this.restoreHistory(i,!0):r instanceof Mr&&(this.lastSuccessfulId=r.id,this.currentPageId=this.browserPageId)}setBrowserUrl(r,i){let s=this.urlSerializer.serialize(r);if(this.location.isCurrentPathEqualTo(s)||i.extras.replaceUrl){let o=this.browserPageId,a=x(x({},i.extras.state),this.generateNgRouterState(i.id,o));this.location.replaceState(s,"",a)}else{let o=x(x({},i.extras.state),this.generateNgRouterState(i.id,this.browserPageId+1));this.location.go(s,"",o)}}restoreHistory(r,i=!1){if(this.canceledNavigationResolution==="computed"){let s=this.browserPageId,o=this.currentPageId-s;o!==0?this.location.historyGo(o):this.currentUrlTree===r.finalUrl&&o===0&&(this.resetState(r),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(i&&this.resetState(r),this.resetUrlToCurrentUrlTree())}resetState(r){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,r.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(r,i){return this.canceledNavigationResolution==="computed"?{navigationId:r,\u0275routerPageId:i}:{navigationId:r}}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Vu(e)))(s||e)}})(),e.\u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})(),zu=function(t){return t[t.COMPLETE=0]="COMPLETE",t[t.FAILED=1]="FAILED",t[t.REDIRECTING=2]="REDIRECTING",t}(zu||{});function vx(t,e){t.events.pipe(yt(n=>n instanceof Mr||n instanceof oi||n instanceof Xu||n instanceof ai),F(n=>n instanceof Mr||n instanceof ai?zu.COMPLETE:(n instanceof oi?n.code===pn.Redirect||n.code===pn.SupersededByNewNavigation:!1)?zu.REDIRECTING:zu.FAILED),yt(n=>n!==zu.REDIRECTING),Dr(1)).subscribe(()=>{e()})}function mH(t){throw t}var yH={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},_H={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},hs=(()=>{let e=class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=R(Lh),this.stateManager=R(_x),this.options=R(cc,{optional:!0})||{},this.pendingTasks=R(Vh),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=R(xv),this.urlSerializer=R(sc),this.location=R(Ho),this.urlHandlingStrategy=R(Av),this._events=new rt,this.errorHandler=this.options.errorHandler||mH,this.navigated=!1,this.routeReuseStrategy=R(fH),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=R(lf,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!R(hf,{optional:!0}),this.eventsSubscription=new Ue,this.isNgZoneEnabled=R(se)instanceof se&&se.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:r=>{this.console.warn(r)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let r=this.navigationTransitions.events.subscribe(i=>{try{let s=this.navigationTransitions.currentTransition,o=this.navigationTransitions.currentNavigation;if(s!==null&&o!==null){if(this.stateManager.handleRouterEvent(i,o),i instanceof oi&&i.code!==pn.Redirect&&i.code!==pn.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof Mr)this.navigated=!0;else if(i instanceof ec){let a=this.urlHandlingStrategy.merge(i.url,s.currentRawUrl),u={info:s.extras.info,skipLocationChange:s.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||hH(s.source)};this.scheduleNavigation(a,Ku,null,u,{resolve:s.resolve,reject:s.reject,promise:s.promise})}}wH(i)&&this._events.next(i)}catch(s){this.navigationTransitions.transitionAbortSubject.next(s)}});this.eventsSubscription.add(r)}resetRootComponentType(r){this.routerState.root.component=r,this.navigationTransitions.rootComponentType=r}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Ku,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((r,i)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(r,"popstate",i)},0)})}navigateToSyncWithBrowser(r,i,s){let o={replaceUrl:!0},a=s?.navigationId?s:null;if(s){let c=x({},s);delete c.navigationId,delete c.\u0275routerPageId,Object.keys(c).length!==0&&(o.state=c)}let u=this.parseUrl(r);this.scheduleNavigation(u,i,a,o)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(r){this.config=r.map(Tv),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(r,i={}){let{relativeTo:s,queryParams:o,fragment:a,queryParamsHandling:u,preserveFragment:c}=i,l=c?this.currentUrlTree.fragment:a,d=null;switch(u){case"merge":d=x(x({},this.currentUrlTree.queryParams),o);break;case"preserve":d=this.currentUrlTree.queryParams;break;default:d=o||null}d!==null&&(d=this.removeEmptyProps(d));let h;try{let f=s?s.snapshot:this.routerState.snapshot.root;h=JA(f)}catch{(typeof r[0]!="string"||!r[0].startsWith("/"))&&(r=[]),h=this.currentUrlTree.root}return ex(h,r,d,l??null)}navigateByUrl(r,i={skipLocationChange:!1}){let s=Qo(r)?r:this.parseUrl(r),o=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(o,Ku,null,i)}navigate(r,i={skipLocationChange:!1}){return vH(r),this.navigateByUrl(this.createUrlTree(r,i),i)}serializeUrl(r){return this.urlSerializer.serialize(r)}parseUrl(r){try{return this.urlSerializer.parse(r)}catch{return this.urlSerializer.parse("/")}}isActive(r,i){let s;if(i===!0?s=x({},yH):i===!1?s=x({},_H):s=i,Qo(r))return OA(this.currentUrlTree,r,s);let o=this.parseUrl(r);return OA(this.currentUrlTree,o,s)}removeEmptyProps(r){return Object.entries(r).reduce((i,[s,o])=>(o!=null&&(i[s]=o),i),{})}scheduleNavigation(r,i,s,o,a){if(this.disposed)return Promise.resolve(!1);let u,c,l;a?(u=a.resolve,c=a.reject,l=a.promise):l=new Promise((h,f)=>{u=h,c=f});let d=this.pendingTasks.add();return vx(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(d))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:r,extras:o,resolve:u,reject:c,promise:l,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),l.catch(h=>Promise.reject(h))}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function vH(t){for(let e=0;e<t.length;e++)if(t[e]==null)throw new U(4008,!1)}function wH(t){return!(t instanceof Ju)&&!(t instanceof ec)}var df=class{};var EH=(()=>{let e=class e{constructor(r,i,s,o,a){this.router=r,this.injector=s,this.preloadingStrategy=o,this.loader=a}setUpPreloading(){this.subscription=this.router.events.pipe(yt(r=>r instanceof Mr),Ki(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(r,i){let s=[];for(let o of i){o.providers&&!o._injector&&(o._injector=Fh(o.providers,r,`Route: ${o.path}`));let a=o._injector??r,u=o._loadedInjector??a;(o.loadChildren&&!o._loadedRoutes&&o.canLoad===void 0||o.loadComponent&&!o._loadedComponent)&&s.push(this.preloadConfig(a,o)),(o.children||o._loadedRoutes)&&s.push(this.processRoutes(u,o.children??o._loadedRoutes))}return fe(s).pipe(Wr())}preloadConfig(r,i){return this.preloadingStrategy.preload(i,()=>{let s;i.loadChildren&&i.canLoad===void 0?s=this.loader.loadChildren(r,i):s=V(null);let o=s.pipe(We(a=>a===null?V(void 0):(i._loadedRoutes=a.routes,i._loadedInjector=a.injector,this.processRoutes(a.injector??r,a.routes))));if(i.loadComponent&&!i._loadedComponent){let a=this.loader.loadComponent(i);return fe([o,a]).pipe(Wr())}else return o})}};e.\u0275fac=function(i){return new(i||e)(I(hs),I(jh),I(Wt),I(df),I(Sv))},e.\u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})(),wx=new P(""),IH=(()=>{let e=class e{constructor(r,i,s,o,a={}){this.urlSerializer=r,this.transitions=i,this.viewportScroller=s,this.zone=o,this.options=a,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},a.scrollPositionRestoration||="disabled",a.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(r=>{r instanceof Yo?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=r.navigationTrigger,this.restoredId=r.restoredState?r.restoredState.navigationId:0):r instanceof Mr?(this.lastId=r.id,this.scheduleScrollEvent(r,this.urlSerializer.parse(r.urlAfterRedirects).fragment)):r instanceof ai&&r.code===tf.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(r,this.urlSerializer.parse(r.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(r=>{r instanceof rf&&(r.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(r.position):r.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(r.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(r,i){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new rf(r,this.lastSource==="popstate"?this.store[this.restoredId]:null,i))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}};e.\u0275fac=function(i){xS()},e.\u0275prov=k({token:e,factory:e.\u0275fac});let t=e;return t})();function CH(t){return t.routerState.root}function lc(t,e){return{\u0275kind:t,\u0275providers:e}}function DH(){let t=R(Nn);return e=>{let n=t.get($o);if(e!==n.components[0])return;let r=t.get(hs),i=t.get(Ex);t.get(Mv)===1&&r.initialNavigation(),t.get(Ix,null,ne.Optional)?.setUpPreloading(),t.get(wx,null,ne.Optional)?.init(),r.resetRootComponentType(n.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}var Ex=new P("",{factory:()=>new rt}),Mv=new P("",{providedIn:"root",factory:()=>1});function TH(){return lc(2,[{provide:Mv,useValue:0},{provide:$h,multi:!0,deps:[Nn],useFactory:e=>{let n=e.get(yA,Promise.resolve());return()=>n.then(()=>new Promise(r=>{let i=e.get(hs),s=e.get(Ex);vx(i,()=>{r(!0)}),e.get(xv).afterPreactivation=()=>(r(!0),s.closed?V(void 0):s),i.initialNavigation()}))}}])}function bH(){return lc(3,[{provide:$h,multi:!0,useFactory:()=>{let e=R(hs);return()=>{e.setUpLocationChangeListener()}}},{provide:Mv,useValue:2}])}var Ix=new P("");function SH(t){return lc(0,[{provide:Ix,useExisting:EH},{provide:df,useExisting:t}])}function AH(){return lc(8,[jA,{provide:hf,useExisting:jA}])}function xH(t){let e=[{provide:mx,useValue:lH},{provide:yx,useValue:x({skipNextTransition:!!t?.skipInitialTransition},t)}];return lc(9,e)}var BA=new P("ROUTER_FORROOT_GUARD"),MH=[Ho,{provide:sc,useClass:Yu},hs,oc,{provide:Zo,useFactory:CH,deps:[hs]},Sv,[]],Rv=(()=>{let e=class e{constructor(r){}static forRoot(r,i){return{ngModule:e,providers:[MH,[],{provide:lf,multi:!0,useValue:r},{provide:BA,useFactory:kH,deps:[[hs,new Fo,new t_]]},{provide:cc,useValue:i||{}},i?.useHash?NH():PH(),RH(),i?.preloadingStrategy?SH(i.preloadingStrategy).\u0275providers:[],i?.initialNavigation?OH(i):[],i?.bindToComponentInputs?AH().\u0275providers:[],i?.enableViewTransitions?xH().\u0275providers:[],FH()]}}static forChild(r){return{ngModule:e,providers:[{provide:lf,multi:!0,useValue:r}]}}};e.\u0275fac=function(i){return new(i||e)(I(BA,8))},e.\u0275mod=Ye({type:e}),e.\u0275inj=Qe({});let t=e;return t})();function RH(){return{provide:wx,useFactory:()=>{let t=R(CA),e=R(se),n=R(cc),r=R(xv),i=R(sc);return n.scrollOffset&&t.setOffset(n.scrollOffset),new IH(i,r,t,e,n)}}}function NH(){return{provide:us,useClass:vA}}function PH(){return{provide:us,useClass:V_}}function kH(t){return"guarded"}function OH(t){return[t.initialNavigation==="disabled"?bH().\u0275providers:[],t.initialNavigation==="enabledBlocking"?TH().\u0275providers:[]]}var $A=new P("");function FH(){return[{provide:$A,useFactory:DH},{provide:A_,multi:!0,useExisting:$A}]}var VH=[],Cx=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Ye({type:e}),e.\u0275inj=Qe({imports:[Rv.forRoot(VH),Rv]});let t=e;return t})();var fs=class{};var LH="firebase",jH="10.8.0";Dn(LH,jH,"app");var ps=new br("ANGULARFIRE2_VERSION");var UH=(t,e)=>{let n=e?[e]:$T(),r=[];return n.forEach(i=>{i.container.getProvider(t).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},Rr=class{constructor(){return UH(BH)}},BH="app-check";function Nv(){}var pf=class{zone;delegate;constructor(e,n=Mm){this.zone=e,this.delegate=n}now(){return this.delegate.now()}schedule(e,n,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,n,r)}},Pv=class{zone;task=null;constructor(e){this.zone=e}call(e,n){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Nv,{},Nv,Nv)),n.pipe(Ke({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},ea=(()=>{class t{ngZone;outsideAngular;insideAngular;constructor(n){this.ngZone=n,this.outsideAngular=n.runOutsideAngular(()=>new pf(Zone.current)),this.insideAngular=n.run(()=>new pf(Zone.current,Wi)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||t)(I(se))};static \u0275prov=k({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function $H(){let t=globalThis.\u0275AngularFireScheduler;if(!t)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return t}function $e(t){return HH($H())(t)}function HH(t){return function(n){return n=n.lift(new Pv(t.ngZone)),n.pipe(bn(t.outsideAngular),an(t.insideAngular))}}var qH=new Map,GH={activated:!1,tokenObservers:[]},zH={initialized:!1,enabled:!1};function kn(t){return qH.get(t)||Object.assign({},GH)}function Mx(){return zH}var WH="https://content-firebaseappcheck.googleapis.com/v1";var KH="exchangeDebugToken",Dx={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},sJ=24*60*60*1e3;var Fv=class{constructor(e,n,r,i,s){if(this.operation=e,this.retryPolicy=n,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return v(this,null,function*(){this.stop();try{this.pending=new ot,this.pending.promise.catch(n=>{}),yield QH(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new ot,this.pending.promise.catch(n=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(n){this.retryPolicy(n)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let n=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),n}}};function QH(t){return new Promise(e=>{setTimeout(e,t)})}var YH={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},ci=new FT("appCheck","AppCheck",YH);function Rx(t){if(!kn(t).activated)throw ci.create("use-before-activation",{appName:t.name})}function Nx(r,i){return v(this,arguments,function*({url:t,body:e},n){let s={"Content-Type":"application/json"},o=n.getImmediate({optional:!0});if(o){let f=yield o.getHeartbeatsHeader();f&&(s["X-Firebase-Client"]=f)}let a={method:"POST",body:JSON.stringify(e),headers:s},u;try{u=yield fetch(t,a)}catch(f){throw ci.create("fetch-network-error",{originalErrorMessage:f?.message})}if(u.status!==200)throw ci.create("fetch-status-error",{httpStatus:u.status});let c;try{c=yield u.json()}catch(f){throw ci.create("fetch-parse-error",{originalErrorMessage:f?.message})}let l=c.ttl.match(/^([\d.]+)(s)$/);if(!l||!l[2]||isNaN(Number(l[1])))throw ci.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let d=Number(l[1])*1e3,h=Date.now();return{token:c.token,expireTimeMillis:h+d,issuedAtTimeMillis:h}})}function Px(t,e){let{projectId:n,appId:r,apiKey:i}=t.options;return{url:`${WH}/projects/${n}/apps/${r}:${KH}?key=${i}`,body:{debug_token:e}}}var ZH="firebase-app-check-database",XH=1,Vv="firebase-app-check-store";var gf=null;function JH(){return gf||(gf=new Promise((t,e)=>{try{let n=indexedDB.open(ZH,XH);n.onsuccess=r=>{t(r.target.result)},n.onerror=r=>{var i;e(ci.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},n.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(Vv,{keyPath:"compositeKey"})}}}catch(n){e(ci.create("storage-open",{originalErrorMessage:n?.message}))}}),gf)}function eq(t,e){return tq(nq(t),e)}function tq(t,e){return v(this,null,function*(){let r=(yield JH()).transaction(Vv,"readwrite"),s=r.objectStore(Vv).put({compositeKey:t,value:e});return new Promise((o,a)=>{s.onsuccess=u=>{o()},r.onerror=u=>{var c;a(ci.create("storage-set",{originalErrorMessage:(c=u.target.error)===null||c===void 0?void 0:c.message}))}})})}function nq(t){return`${t.options.appId}-${t.name}`}var Lv=new zr("@firebase/app-check");function Ov(t,e){return gd()?eq(t,e).catch(n=>{Lv.warn(`Failed to write token to IndexedDB. Error: ${n}`)}):Promise.resolve()}function kx(){return Mx().enabled}function Ox(){return v(this,null,function*(){let t=Mx();if(t.enabled&&t.token)return t.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var rq={error:"UNKNOWN_ERROR"};function iq(t){return fd.encodeString(JSON.stringify(t),!1)}function jv(t,e=!1){return v(this,null,function*(){let n=t.app;Rx(n);let r=kn(n),i=r.token,s;if(i&&!dc(i)&&(r.token=void 0,i=void 0),!i){let u=yield r.cachedTokenPromise;u&&(dc(u)?i=u:yield Ov(n,void 0))}if(!e&&i&&dc(i))return{token:i.token};let o=!1;if(kx()){r.exchangeTokenPromise||(r.exchangeTokenPromise=Nx(Px(n,yield Ox()),t.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let u=yield r.exchangeTokenPromise;return yield Ov(n,u),r.token=u,{token:u.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield kn(n).exchangeTokenPromise}catch(u){u.code==="appCheck/throttled"?Lv.warn(u.message):Lv.error(u),s=u}let a;return i?s?dc(i)?a={token:i.token,internalError:s}:a=bx(s):(a={token:i.token},r.token=i,yield Ov(n,i)):a=bx(s),o&&uq(n,a),a})}function sq(t){return v(this,null,function*(){let e=t.app;Rx(e);let{provider:n}=kn(e);if(kx()){let r=yield Ox(),{token:i}=yield Nx(Px(e,r),t.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield n.getToken();return{token:r}}})}function oq(t,e,n,r){let{app:i}=t,s=kn(i),o={next:n,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&dc(s.token)){let a=s.token;Promise.resolve().then(()=>{n({token:a.token}),Tx(t)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Tx(t))}function Fx(t,e){let n=kn(t),r=n.tokenObservers.filter(i=>i.next!==e);r.length===0&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),n.tokenObservers=r}function Tx(t){let{app:e}=t,n=kn(e),r=n.tokenRefresher;r||(r=aq(t),n.tokenRefresher=r),!r.isRunning()&&n.isTokenAutoRefreshEnabled&&r.start()}function aq(t){let{app:e}=t;return new Fv(()=>v(this,null,function*(){let n=kn(e),r;if(n.token?r=yield jv(t,!0):r=yield jv(t),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let n=kn(e);if(n.token){let r=n.token.issuedAtTimeMillis+(n.token.expireTimeMillis-n.token.issuedAtTimeMillis)*.5+3e5,i=n.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},Dx.RETRIAL_MIN_WAIT,Dx.RETRIAL_MAX_WAIT)}function uq(t,e){let n=kn(t).tokenObservers;for(let r of n)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function dc(t){return t.expireTimeMillis-Date.now()>0}function bx(t){return{token:iq(rq),error:t}}var Uv=class{constructor(e,n){this.app=e,this.heartbeatServiceProvider=n}_delete(){let{tokenObservers:e}=kn(this.app);for(let n of e)Fx(this.app,n.next);return Promise.resolve()}};function cq(t,e){return new Uv(t,e)}function lq(t){return{getToken:e=>jv(t,e),getLimitedUseToken:()=>sq(t),addTokenListener:e=>oq(t,"INTERNAL",e),removeTokenListener:e=>Fx(t.app,e)}}var dq="@firebase/app-check",hq="0.8.2";var fq="app-check",Sx="app-check-internal";function pq(){$i(new qt(fq,t=>{let e=t.getProvider("app").getImmediate(),n=t.getProvider("heartbeat");return cq(e,n)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,e,n)=>{t.getProvider(Sx).initialize()})),$i(new qt(Sx,t=>{let e=t.getProvider("app-check").getImmediate();return lq(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Dn(dq,hq)}pq();var gq=["localhost","0.0.0.0","127.0.0.1"],yJ=typeof window<"u"&&gq.includes(window.location.hostname);var mq="firebase",yq="10.8.0";pt.registerVersion(mq,yq,"app-compat");var _q=["ngOnDestroy"],Lx=(t,e,n,r={})=>new Proxy(t,{get:(i,s)=>n.runOutsideAngular(()=>{if(t[s])return r?.spy?.get&&r.spy.get(s,t[s]),t[s];if(_q.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let u=a?.[s];return typeof u=="function"?u.bind(a):u?.then?u.then(c=>n.run(()=>c)):n.run(()=>u)});return new Proxy(()=>{},{get:(a,u)=>o[u],apply:(a,u,c)=>o.then(l=>{let d=l?.(...c);return r?.spy?.apply&&r.spy.apply(s,c,d),d})})})});var mf=class{constructor(e){return e}},li=new P("angularfire2.app.options"),di=new P("angularfire2.app.name");function gs(t,e,n){let r=typeof n=="string"&&n||"[DEFAULT]",i=typeof n=="object"&&n||{};i.name=i.name||r;let o=pt.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>pt.initializeApp(t,i));try{if(JSON.stringify(t)!==JSON.stringify(o.options)){let a=!!module.hot;vq("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new mf(o)}var vq=(t,...e)=>{R_()&&typeof console<"u"&&console[t](...e)},wq={provide:mf,useFactory:gs,deps:[li,se,[new Fo,di]]},jx=(()=>{class t{static initializeApp(n,r){return{ngModule:t,providers:[{provide:li,useValue:n},{provide:di,useValue:r}]}}constructor(n){pt.registerVersion("angularfire",ps.full,"core"),pt.registerVersion("angularfire",ps.full,"app-compat"),pt.registerVersion("angular",nA.full,n.toString())}static \u0275fac=function(r){return new(r||t)(I(Ct))};static \u0275mod=Ye({type:t});static \u0275inj=Qe({providers:[wq]})}return t})();function ta(t,e,n,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===t)||[];if(s)return Eq(i,o)||(Vx("error",`${e} was already initialized on the ${n} Firebase App with different settings.${Iq?" You may need to reload as Firebase is not HMR aware.":""}`),Vx("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([t,a,i]),a}}function Eq(t,e){try{return t.toString()===e.toString()}catch{return t===e}}var Iq=typeof module<"u"&&!!module.hot,Vx=(t,...e)=>{R_()&&typeof console<"u"&&console[t](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var hc=new P("angularfire2.auth.use-emulator"),fc=new P("angularfire2.auth.settings"),pc=new P("angularfire2.auth.tenant-id"),gc=new P("angularfire2.auth.langugage-code"),mc=new P("angularfire2.auth.use-device-language"),yc=new P("angularfire.auth.persistence"),_c=(t,e,n,r,i,s,o,a)=>ta(`${t.name}.auth`,"AngularFireAuth",t.name,()=>{let u=e.runOutsideAngular(()=>t.auth());if(n&&u.useEmulator(...n),r&&(u.tenantId=r),u.languageCode=i,s&&u.useDeviceLanguage(),o)for(let[c,l]of Object.entries(o))u.settings[c]=l;return a&&u.setPersistence(a),u},[n,r,i,s,o,a]),yf=(()=>{class t{authState;idToken;user;idTokenResult;credential;constructor(n,r,i,s,o,a,u,c,l,d,h,f){let p=new rt,g=V(void 0).pipe(an(o.outsideAngular),Me(()=>s.runOutsideAngular(()=>import("./chunk-2UTFESB6.js"))),F(()=>gs(n,s,r)),F(_=>_c(_,s,a,c,l,d,u,h)),Gd({bufferSize:1,refCount:!1}));if(cs(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=V(null);else{g.pipe(un()).subscribe();let _=g.pipe(Me(T=>T.getRedirectResult().then(j=>j,()=>null)),$e,Gd({bufferSize:1,refCount:!1})),C=g.pipe(Me(T=>new J(j=>({unsubscribe:s.runOutsideAngular(()=>T.onAuthStateChanged($=>j.next($),$=>j.error($),()=>j.complete()))})))),M=g.pipe(Me(T=>new J(j=>({unsubscribe:s.runOutsideAngular(()=>T.onIdTokenChanged($=>j.next($),$=>j.error($),()=>j.complete()))}))));this.authState=_.pipe(zd(C),bn(o.outsideAngular),an(o.insideAngular)),this.user=_.pipe(zd(M),bn(o.outsideAngular),an(o.insideAngular)),this.idToken=this.user.pipe(Me(T=>T?fe(T.getIdToken()):V(null))),this.idTokenResult=this.user.pipe(Me(T=>T?fe(T.getIdTokenResult()):V(null))),this.credential=mo(_,p,this.authState.pipe(yt(T=>!T))).pipe(F(T=>T?.user?T:null),bn(o.outsideAngular),an(o.insideAngular))}return Lx(this,g,s,{spy:{apply:(_,C,M)=>{(_.startsWith("signIn")||_.startsWith("createUser"))&&M.then(T=>p.next(T))}}})}static \u0275fac=function(r){return new(r||t)(I(li),I(di,8),I(Ct),I(se),I(ea),I(hc,8),I(fc,8),I(pc,8),I(gc,8),I(mc,8),I(yc,8),I(Rr,8))};static \u0275prov=k({token:t,factory:t.\u0275fac,providedIn:"any"})}return t})();var Cq=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Fn={},S,cw=cw||{},z=Cq||self;function Rf(t){var e=typeof t;return e=e!="object"?e:t?Array.isArray(t)?"array":e:"null",e=="array"||e=="object"&&typeof t.length=="number"}function Nc(t){var e=typeof t;return e=="object"&&t!=null||e=="function"}function Dq(t){return Object.prototype.hasOwnProperty.call(t,$v)&&t[$v]||(t[$v]=++Tq)}var $v="closure_uid_"+(1e9*Math.random()>>>0),Tq=0;function bq(t,e,n){return t.call.apply(t.bind,arguments)}function Sq(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function Dt(t,e,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Dt=bq:Dt=Sq,Dt.apply(null,arguments)}function _f(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var r=n.slice();return r.push.apply(r,arguments),t.apply(this,r)}}function ct(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function hi(){this.s=this.s,this.o=this.o}var Aq=0;hi.prototype.s=!1;hi.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),Aq!=0)&&Dq(this)};hi.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Jx=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(typeof t=="string")return typeof e!="string"||e.length!=1?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function lw(t){let e=t.length;if(0<e){let n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function Bx(t,e){for(let n=1;n<arguments.length;n++){let r=arguments[n];if(Rf(r)){let i=t.length||0,s=r.length||0;t.length=i+s;for(let o=0;o<s;o++)t[i+o]=r[o]}else t.push(r)}}function Tt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}Tt.prototype.h=function(){this.defaultPrevented=!0};var xq=function(){if(!z.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{let n=()=>{};z.addEventListener("test",n,e),z.removeEventListener("test",n,e)}catch{}return t}();function Dc(t){return/^[\s\xa0]*$/.test(t)}function Nf(){var t=z.navigator;return t&&(t=t.userAgent)?t:""}function ir(t){return Nf().indexOf(t)!=-1}function dw(t){return dw[" "](t),t}dw[" "]=function(){};function Mq(t,e){var n=_4;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}var Rq=ir("Opera"),sa=ir("Trident")||ir("MSIE"),eM=ir("Edge"),Wv=eM||sa,tM=ir("Gecko")&&!(Nf().toLowerCase().indexOf("webkit")!=-1&&!ir("Edge"))&&!(ir("Trident")||ir("MSIE"))&&!ir("Edge"),Nq=Nf().toLowerCase().indexOf("webkit")!=-1&&!ir("Edge");function nM(){var t=z.document;return t?t.documentMode:void 0}var Kv;e:{if(vf="",wf=function(){var t=Nf();if(tM)return/rv:([^\);]+)(\)|;)/.exec(t);if(eM)return/Edge\/([\d\.]+)/.exec(t);if(sa)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t);if(Nq)return/WebKit\/(\S+)/.exec(t);if(Rq)return/(?:Version)[ \/]?(\S+)/.exec(t)}(),wf&&(vf=wf?wf[1]:""),sa&&(Ef=nM(),Ef!=null&&Ef>parseFloat(vf))){Kv=String(Ef);break e}Kv=vf}var vf,wf,Ef,Qv;z.document&&sa?(Hv=nM(),Qv=Hv||parseInt(Kv,10)||void 0):Qv=void 0;var Hv,Pq=Qv;function Tc(t,e){if(Tt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(tM){e:{try{dw(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else n=="mouseover"?e=t.fromElement:n=="mouseout"&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=t.clientX!==void 0?t.clientX:t.pageX,this.clientY=t.clientY!==void 0?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=typeof t.pointerType=="string"?t.pointerType:kq[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Tc.$.h.call(this)}}ct(Tc,Tt);var kq={2:"touch",3:"pen",4:"mouse"};Tc.prototype.h=function(){Tc.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Pc="closure_listenable_"+(1e6*Math.random()|0),Oq=0;function Fq(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.la=i,this.key=++Oq,this.fa=this.ia=!1}function Pf(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function hw(t,e,n){for(let r in t)e.call(n,t[r],r,t)}function Vq(t,e){for(let n in t)e.call(void 0,t[n],n,t)}function rM(t){let e={};for(let n in t)e[n]=t[n];return e}var $x="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function iM(t,e){let n,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(n in r)t[n]=r[n];for(let s=0;s<$x.length;s++)n=$x[s],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function kf(t){this.src=t,this.g={},this.h=0}kf.prototype.add=function(t,e,n,r,i){var s=t.toString();t=this.g[s],t||(t=this.g[s]=[],this.h++);var o=Zv(t,e,r,i);return-1<o?(e=t[o],n||(e.ia=!1)):(e=new Fq(e,this.src,s,!!r,i),e.ia=n,t.push(e)),e};function Yv(t,e){var n=e.type;if(n in t.g){var r=t.g[n],i=Jx(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Pf(e),t.g[n].length==0&&(delete t.g[n],t.h--))}}function Zv(t,e,n,r){for(var i=0;i<t.length;++i){var s=t[i];if(!s.fa&&s.listener==e&&s.capture==!!n&&s.la==r)return i}return-1}var fw="closure_lm_"+(1e6*Math.random()|0),qv={};function sM(t,e,n,r,i){if(r&&r.once)return aM(t,e,n,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)sM(t,e[s],n,r,i);return null}return n=mw(n),t&&t[Pc]?t.O(e,n,Nc(r)?!!r.capture:!!r,i):oM(t,e,n,!1,r,i)}function oM(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");var o=Nc(i)?!!i.capture:!!i,a=gw(t);if(a||(t[fw]=a=new kf(t)),n=a.add(e,n,r,o,s),n.proxy)return n;if(r=Lq(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)xq||(i=o),i===void 0&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(cM(e.toString()),r);else if(t.addListener&&t.removeListener)t.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function Lq(){function t(n){return e.call(t.src,t.listener,n)}let e=jq;return t}function aM(t,e,n,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)aM(t,e[s],n,r,i);return null}return n=mw(n),t&&t[Pc]?t.P(e,n,Nc(r)?!!r.capture:!!r,i):oM(t,e,n,!0,r,i)}function uM(t,e,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)uM(t,e[s],n,r,i);else r=Nc(r)?!!r.capture:!!r,n=mw(n),t&&t[Pc]?(t=t.i,e=String(e).toString(),e in t.g&&(s=t.g[e],n=Zv(s,n,r,i),-1<n&&(Pf(s[n]),Array.prototype.splice.call(s,n,1),s.length==0&&(delete t.g[e],t.h--)))):t&&(t=gw(t))&&(e=t.g[e.toString()],t=-1,e&&(t=Zv(e,n,r,i)),(n=-1<t?e[t]:null)&&pw(n))}function pw(t){if(typeof t!="number"&&t&&!t.fa){var e=t.src;if(e&&e[Pc])Yv(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(cM(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=gw(e))?(Yv(n,t),n.h==0&&(n.src=null,e[fw]=null)):Pf(t)}}}function cM(t){return t in qv?qv[t]:qv[t]="on"+t}function jq(t,e){if(t.fa)t=!0;else{e=new Tc(e,this);var n=t.listener,r=t.la||t.src;t.ia&&pw(t),t=n.call(r,e)}return t}function gw(t){return t=t[fw],t instanceof kf?t:null}var Gv="__closure_events_fn_"+(1e9*Math.random()>>>0);function mw(t){return typeof t=="function"?t:(t[Gv]||(t[Gv]=function(e){return t.handleEvent(e)}),t[Gv])}function ut(){hi.call(this),this.i=new kf(this),this.S=this,this.J=null}ct(ut,hi);ut.prototype[Pc]=!0;ut.prototype.removeEventListener=function(t,e,n,r){uM(this,t,e,n,r)};function vt(t,e){var n,r=t.J;if(r)for(n=[];r;r=r.J)n.push(r);if(t=t.S,r=e.type||e,typeof e=="string")e=new Tt(e,t);else if(e instanceof Tt)e.target=e.target||t;else{var i=e;e=new Tt(r,t),iM(e,i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];i=If(o,r,!0,e)&&i}if(o=e.g=t,i=If(o,r,!0,e)&&i,i=If(o,r,!1,e)&&i,n)for(s=0;s<n.length;s++)o=e.g=n[s],i=If(o,r,!1,e)&&i}ut.prototype.N=function(){if(ut.$.N.call(this),this.i){var t=this.i,e;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)Pf(n[r]);delete t.g[e],t.h--}}this.J=null};ut.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)};ut.prototype.P=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};function If(t,e,n,r){if(e=t.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,u=o.la||o.src;o.ia&&Yv(t.i,o),i=a.call(u,r)!==!1&&i}}return i&&!r.defaultPrevented}var yw=z.JSON.stringify,Xv=class{constructor(e,n){this.i=e,this.j=n,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}};function Uq(){var t=_w;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Jv=class{constructor(){this.h=this.g=null}add(e,n){let r=lM.get();r.set(e,n),this.h?this.h.next=r:this.g=r,this.h=r}},lM=new Xv(()=>new ew,t=>t.reset()),ew=class{constructor(){this.next=this.g=this.h=null}set(e,n){this.h=e,this.g=n,this.next=null}reset(){this.next=this.g=this.h=null}};function Bq(t){var e=1;t=t.split(":");let n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function $q(t){z.setTimeout(()=>{throw t},0)}var bc,Sc=!1,_w=new Jv,dM=()=>{let t=z.Promise.resolve(void 0);bc=()=>{t.then(Hq)}},Hq=()=>{for(var t;t=Uq();){try{t.h.call(t.g)}catch(n){$q(n)}var e=lM;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Sc=!1};function Of(t,e){ut.call(this),this.h=t||1,this.g=e||z,this.j=Dt(this.qb,this),this.l=Date.now()}ct(Of,ut);S=Of.prototype;S.ga=!1;S.T=null;S.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),vt(this,"tick"),this.ga&&(vw(this),this.start()))}};S.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function vw(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}S.N=function(){Of.$.N.call(this),vw(this),delete this.g};function ww(t,e,n){if(typeof t=="function")n&&(t=Dt(t,n));else if(t&&typeof t.handleEvent=="function")t=Dt(t.handleEvent,t);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:z.setTimeout(t,e||0)}function hM(t){t.g=ww(()=>{t.g=null,t.i&&(t.i=!1,hM(t))},t.j);let e=t.h;t.h=null,t.m.apply(null,e)}var tw=class extends hi{constructor(e,n){super(),this.m=e,this.j=n,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:hM(this)}N(){super.N(),this.g&&(z.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function Ac(t){hi.call(this),this.h=t,this.g={}}ct(Ac,hi);var Hx=[];function fM(t,e,n,r){Array.isArray(n)||(n&&(Hx[0]=n.toString()),n=Hx);for(var i=0;i<n.length;i++){var s=sM(e,n[i],r||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}}function pM(t){hw(t.g,function(e,n){this.g.hasOwnProperty(n)&&pw(e)},t),t.g={}}Ac.prototype.N=function(){Ac.$.N.call(this),pM(this)};Ac.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Ff(){this.g=!0}Ff.prototype.Ea=function(){this.g=!1};function qq(t,e,n,r,i,s){t.info(function(){if(t.g)if(s)for(var o="",a=s.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var d=l.split("_");o=2<=d.length&&d[1]=="type"?o+(l+"="+c+"&"):o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+`
`+n+`
`+o})}function Gq(t,e,n,r,i,s,o){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+`
`+n+`
`+s+" "+o})}function ra(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+Wq(t,n)+(r?" "+r:"")})}function zq(t,e){t.info(function(){return"TIMEOUT: "+e})}Ff.prototype.info=function(){};function Wq(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n){for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return yw(n)}catch{return e}}var vs={},qx=null;function Vf(){return qx=qx||new ut}vs.Ta="serverreachability";function gM(t){Tt.call(this,vs.Ta,t)}ct(gM,Tt);function xc(t){let e=Vf();vt(e,new gM(e))}vs.STAT_EVENT="statevent";function mM(t,e){Tt.call(this,vs.STAT_EVENT,t),this.stat=e}ct(mM,Tt);function Mt(t){let e=Vf();vt(e,new mM(e,t))}vs.Ua="timingevent";function yM(t,e){Tt.call(this,vs.Ua,t),this.size=e}ct(yM,Tt);function kc(t,e){if(typeof t!="function")throw Error("Fn must not be null and must be a function");return z.setTimeout(function(){t()},e)}var Lf={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},_M={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Ew(){}Ew.prototype.h=null;function Gx(t){return t.h||(t.h=t.i())}function vM(){}var Oc={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Iw(){Tt.call(this,"d")}ct(Iw,Tt);function Cw(){Tt.call(this,"c")}ct(Cw,Tt);var nw;function jf(){}ct(jf,Ew);jf.prototype.g=function(){return new XMLHttpRequest};jf.prototype.i=function(){return{}};nw=new jf;function Fc(t,e,n,r){this.l=t,this.j=e,this.m=n,this.W=r||1,this.U=new Ac(this),this.P=Kq,t=Wv?125:void 0,this.V=new Of(t),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new wM}function wM(){this.i=null,this.g="",this.h=!1}var Kq=45e3,EM={},rw={};S=Fc.prototype;S.setTimeout=function(t){this.P=t};function iw(t,e,n){t.L=1,t.A=Bf(Pr(e)),t.u=n,t.S=!0,IM(t,null)}function IM(t,e){t.G=Date.now(),Vc(t),t.B=Pr(t.A);var n=t.B,r=t.W;Array.isArray(r)||(r=[String(r)]),MM(n.i,"t",r),t.o=0,n=t.l.J,t.h=new wM,t.g=ZM(t.l,n?e:null,!t.u),0<t.O&&(t.M=new tw(Dt(t.Pa,t,t.g),t.O)),fM(t.U,t.g,"readystatechange",t.nb),e=t.I?rM(t.I):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.B,t.v,t.u,e)):(t.v="GET",t.g.ha(t.B,t.v,null,e)),xc(),qq(t.j,t.v,t.B,t.m,t.W,t.u)}S.nb=function(t){t=t.target;let e=this.M;e&&sr(t)==3?e.l():this.Pa(t)};S.Pa=function(t){try{if(t==this.g)e:{let l=sr(this.g);var e=this.g.Ia();let d=this.g.da();if(!(3>l)&&(l!=3||Wv||this.g&&(this.h.h||this.g.ja()||Qx(this.g)))){this.J||l!=4||e==7||(e==8||0>=d?xc(3):xc(2)),Uf(this);var n=this.g.da();this.ca=n;t:if(CM(this)){var r=Qx(this.g);t="";var i=r.length,s=sr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ms(this),Cc(this);var o="";break t}this.h.i=new z.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=t,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=n==200,Gq(this.j,this.v,this.B,this.m,this.W,l,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Dc(a)){var c=a;break t}}c=null}if(n=c)ra(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,sw(this,n);else{this.i=!1,this.s=3,Mt(12),ms(this),Cc(this);break e}}this.S?(DM(this,l,o),Wv&&this.i&&l==3&&(fM(this.U,this.V,"tick",this.mb),this.V.start())):(ra(this.j,this.m,o,null),sw(this,o)),l==4&&ms(this),this.i&&!this.J&&(l==4?WM(this.l,this):(this.i=!1,Vc(this)))}else g4(this.g),n==400&&0<o.indexOf("Unknown SID")?(this.s=3,Mt(12)):(this.s=0,Mt(13)),ms(this),Cc(this)}}}catch{}finally{}};function CM(t){return t.g?t.v=="GET"&&t.L!=2&&t.l.Ha:!1}function DM(t,e,n){let r=!0,i;for(;!t.J&&t.o<n.length;)if(i=Qq(t,n),i==rw){e==4&&(t.s=4,Mt(14),r=!1),ra(t.j,t.m,null,"[Incomplete Response]");break}else if(i==EM){t.s=4,Mt(15),ra(t.j,t.m,n,"[Invalid Chunk]"),r=!1;break}else ra(t.j,t.m,i,null),sw(t,i);CM(t)&&t.o!=0&&(t.h.g=t.h.g.slice(t.o),t.o=0),e!=4||n.length!=0||t.h.h||(t.s=1,Mt(16),r=!1),t.i=t.i&&r,r?0<n.length&&!t.ba&&(t.ba=!0,e=t.l,e.g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),xw(e),e.M=!0,Mt(11))):(ra(t.j,t.m,n,"[Invalid Chunked Response]"),ms(t),Cc(t))}S.mb=function(){if(this.g){var t=sr(this.g),e=this.g.ja();this.o<e.length&&(Uf(this),DM(this,t,e),this.i&&t!=4&&Vc(this))}};function Qq(t,e){var n=t.o,r=e.indexOf(`
`,n);return r==-1?rw:(n=Number(e.substring(n,r)),isNaN(n)?EM:(r+=1,r+n>e.length?rw:(e=e.slice(r,r+n),t.o=r+n,e)))}S.cancel=function(){this.J=!0,ms(this)};function Vc(t){t.Y=Date.now()+t.P,TM(t,t.P)}function TM(t,e){if(t.C!=null)throw Error("WatchDog timer not null");t.C=kc(Dt(t.lb,t),e)}function Uf(t){t.C&&(z.clearTimeout(t.C),t.C=null)}S.lb=function(){this.C=null;let t=Date.now();0<=t-this.Y?(zq(this.j,this.B),this.L!=2&&(xc(),Mt(17)),ms(this),this.s=2,Cc(this)):TM(this,this.Y-t)};function Cc(t){t.l.H==0||t.J||WM(t.l,t)}function ms(t){Uf(t);var e=t.M;e&&typeof e.sa=="function"&&e.sa(),t.M=null,vw(t.V),pM(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function sw(t,e){try{var n=t.l;if(n.H!=0&&(n.g==t||ow(n.i,t))){if(!t.K&&ow(n.i,t)&&n.H==3){try{var r=n.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){e:if(!n.u){if(n.g)if(n.g.G+3e3<t.G)Sf(n),qf(n);else break e;Aw(n),Mt(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&n.A==0&&!n.v&&(n.v=kc(Dt(n.ib,n),6e3));if(1>=PM(n.i)&&n.oa){try{n.oa()}catch{}n.oa=void 0}}else ys(n,11)}else if((t.K||n.g==t)&&Sf(n),!Dc(e))for(i=n.Ja.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(n.V=c[0],c=c[1],n.H==2)if(c[0]=="c"){n.K=c[1],n.pa=c[2];let l=c[3];l!=null&&(n.ra=l,n.l.info("VER="+n.ra));let d=c[4];d!=null&&(n.Ga=d,n.l.info("SVER="+n.Ga));let h=c[5];h!=null&&typeof h=="number"&&0<h&&(r=1.5*h,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;let f=t.g;if(f){let p=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(p){var s=r.i;s.g||p.indexOf("spdy")==-1&&p.indexOf("quic")==-1&&p.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(Dw(s,s.h),s.h=null))}if(r.F){let g=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;g&&(r.Da=g,Se(r.I,r.F,g))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms")),r=n;var o=t;if(r.wa=YM(r,r.J?r.pa:null,r.Y),o.K){kM(r.i,o);var a=o,u=r.L;u&&a.setTimeout(u),a.C&&(Uf(a),Vc(a)),r.g=o}else GM(r);0<n.j.length&&Gf(n)}else c[0]!="stop"&&c[0]!="close"||ys(n,7);else n.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?ys(n,7):Sw(n):c[0]!="noop"&&n.h&&n.h.Aa(c),n.A=0)}}xc(4)}catch{}}function Yq(t){if(t.Z&&typeof t.Z=="function")return t.Z();if(typeof Map<"u"&&t instanceof Map||typeof Set<"u"&&t instanceof Set)return Array.from(t.values());if(typeof t=="string")return t.split("");if(Rf(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}e=[],n=0;for(r in t)e[n++]=t[r];return e}function Zq(t){if(t.ta&&typeof t.ta=="function")return t.ta();if(!t.Z||typeof t.Z!="function"){if(typeof Map<"u"&&t instanceof Map)return Array.from(t.keys());if(!(typeof Set<"u"&&t instanceof Set)){if(Rf(t)||typeof t=="string"){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(let r in t)e[n++]=r;return e}}}function bM(t,e){if(t.forEach&&typeof t.forEach=="function")t.forEach(e,void 0);else if(Rf(t)||typeof t=="string")Array.prototype.forEach.call(t,e,void 0);else for(var n=Zq(t),r=Yq(t),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],n&&n[s],t)}var SM=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Xq(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var s=t[n].substring(0,r);i=t[n].substring(r+1)}else s=t[n];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function _s(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof _s){this.h=t.h,Tf(this,t.j),this.s=t.s,this.g=t.g,bf(this,t.m),this.l=t.l;var e=t.i,n=new Mc;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),zx(this,n),this.o=t.o}else t&&(e=String(t).match(SM))?(this.h=!1,Tf(this,e[1]||"",!0),this.s=Ec(e[2]||""),this.g=Ec(e[3]||"",!0),bf(this,e[4]),this.l=Ec(e[5]||"",!0),zx(this,e[6]||"",!0),this.o=Ec(e[7]||"")):(this.h=!1,this.i=new Mc(null,this.h))}_s.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Ic(e,Wx,!0),":");var n=this.g;return(n||e=="file")&&(t.push("//"),(e=this.s)&&t.push(Ic(e,Wx,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,n!=null&&t.push(":",String(n))),(n=this.l)&&(this.g&&n.charAt(0)!="/"&&t.push("/"),t.push(Ic(n,n.charAt(0)=="/"?t4:e4,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Ic(n,r4)),t.join("")};function Pr(t){return new _s(t)}function Tf(t,e,n){t.j=n?Ec(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function bf(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function zx(t,e,n){e instanceof Mc?(t.i=e,i4(t.i,t.h)):(n||(e=Ic(e,n4)),t.i=new Mc(e,t.h))}function Se(t,e,n){t.i.set(e,n)}function Bf(t){return Se(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Ec(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ic(t,e,n){return typeof t=="string"?(t=encodeURI(t).replace(e,Jq),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Jq(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(t&15).toString(16)}var Wx=/[#\/\?@]/g,e4=/[#\?:]/g,t4=/[#\?]/g,n4=/[#\?@]/g,r4=/#/g;function Mc(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function fi(t){t.g||(t.g=new Map,t.h=0,t.i&&Xq(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}S=Mc.prototype;S.add=function(t,e){fi(this),this.i=null,t=oa(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this};function AM(t,e){fi(t),e=oa(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function xM(t,e){return fi(t),e=oa(t,e),t.g.has(e)}S.forEach=function(t,e){fi(this),this.g.forEach(function(n,r){n.forEach(function(i){t.call(e,i,r,this)},this)},this)};S.ta=function(){fi(this);let t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){let i=t[r];for(let s=0;s<i.length;s++)n.push(e[r])}return n};S.Z=function(t){fi(this);let e=[];if(typeof t=="string")xM(this,t)&&(e=e.concat(this.g.get(oa(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e};S.set=function(t,e){return fi(this),this.i=null,t=oa(this,t),xM(this,t)&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this};S.get=function(t,e){return t?(t=this.Z(t),0<t.length?String(t[0]):e):e};function MM(t,e,n){AM(t,e),0<n.length&&(t.i=null,t.g.set(oa(t,e),lw(n)),t.h+=n.length)}S.toString=function(){if(this.i)return this.i;if(!this.g)return"";let t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),t.push(i)}}return this.i=t.join("&")};function oa(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function i4(t,e){e&&!t.j&&(fi(t),t.i=null,t.g.forEach(function(n,r){var i=r.toLowerCase();r!=i&&(AM(this,r),MM(this,i,n))},t)),t.j=e}var s4=class{constructor(t,e){this.g=t,this.map=e}};function RM(t){this.l=t||o4,z.PerformanceNavigationTiming?(t=z.performance.getEntriesByType("navigation"),t=0<t.length&&(t[0].nextHopProtocol=="hq"||t[0].nextHopProtocol=="h2")):t=!!(z.g&&z.g.Ka&&z.g.Ka()&&z.g.Ka().dc),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var o4=10;function NM(t){return t.h?!0:t.g?t.g.size>=t.j:!1}function PM(t){return t.h?1:t.g?t.g.size:0}function ow(t,e){return t.h?t.h==e:t.g?t.g.has(e):!1}function Dw(t,e){t.g?t.g.add(e):t.h=e}function kM(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}RM.prototype.cancel=function(){if(this.i=OM(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let t of this.g.values())t.cancel();this.g.clear()}};function OM(t){if(t.h!=null)return t.i.concat(t.h.F);if(t.g!=null&&t.g.size!==0){let e=t.i;for(let n of t.g.values())e=e.concat(n.F);return e}return lw(t.i)}var a4=class{stringify(t){return z.JSON.stringify(t,void 0)}parse(t){return z.JSON.parse(t,void 0)}};function u4(){this.g=new a4}function c4(t,e,n){let r=n||"";try{bM(t,function(i,s){let o=i;Nc(i)&&(o=yw(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function l4(t,e){let n=new Ff;if(z.Image){let r=new Image;r.onload=_f(Cf,n,r,"TestLoadImage: loaded",!0,e),r.onerror=_f(Cf,n,r,"TestLoadImage: error",!1,e),r.onabort=_f(Cf,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=_f(Cf,n,r,"TestLoadImage: timeout",!1,e),z.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}function Cf(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function Lc(t){this.l=t.ec||null,this.j=t.ob||!1}ct(Lc,Ew);Lc.prototype.g=function(){return new $f(this.l,this.j)};Lc.prototype.i=function(t){return function(){return t}}({});function $f(t,e){ut.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=Tw,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}ct($f,ut);var Tw=0;S=$f.prototype;S.open=function(t,e){if(this.readyState!=Tw)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Rc(this)};S.send=function(t){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||z).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};S.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,jc(this)),this.readyState=Tw};S.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Rc(this)),this.g&&(this.readyState=3,Rc(this),this.g)))if(this.responseType==="arraybuffer")t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof z.ReadableStream<"u"&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;FM(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))};function FM(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}S.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?jc(this):Rc(this),this.readyState==3&&FM(this)}};S.Za=function(t){this.g&&(this.response=this.responseText=t,jc(this))};S.Ya=function(t){this.g&&(this.response=t,jc(this))};S.ka=function(){this.g&&jc(this)};function jc(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Rc(t)}S.setRequestHeader=function(t,e){this.v.append(t,e)};S.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""};S.getAllResponseHeaders=function(){if(!this.h)return"";let t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join(`\r
`)};function Rc(t){t.onreadystatechange&&t.onreadystatechange.call(t)}Object.defineProperty($f.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(t){this.m=t?"include":"same-origin"}});var d4=z.JSON.parse;function Ve(t){ut.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=VM,this.L=this.M=!1}ct(Ve,ut);var VM="",h4=/^https?$/i,f4=["POST","PUT"];S=Ve.prototype;S.Oa=function(t){this.M=t};S.ha=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():nw.g(),this.C=this.u?Gx(this.u):Gx(nw),this.g.onreadystatechange=Dt(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(s){Kx(this,s);return}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let s of r.keys())n.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(n.keys()).find(s=>s.toLowerCase()=="content-type"),i=z.FormData&&t instanceof z.FormData,!(0<=Jx(f4,e))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of n)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{UM(this),0<this.B&&((this.L=p4(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Dt(this.ua,this)):this.A=ww(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(s){Kx(this,s)}};function p4(t){return sa&&typeof t.timeout=="number"&&t.ontimeout!==void 0}S.ua=function(){typeof cw<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,vt(this,"timeout"),this.abort(8))};function Kx(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,LM(t),Hf(t)}function LM(t){t.F||(t.F=!0,vt(t,"complete"),vt(t,"error"))}S.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,vt(this,"complete"),vt(this,"abort"),Hf(this))};S.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Hf(this,!0)),Ve.$.N.call(this)};S.La=function(){this.s||(this.G||this.v||this.l?jM(this):this.kb())};S.kb=function(){jM(this)};function jM(t){if(t.h&&typeof cw<"u"&&(!t.C[1]||sr(t)!=4||t.da()!=2)){if(t.v&&sr(t)==4)ww(t.La,0,t);else if(vt(t,"readystatechange"),sr(t)==4){t.h=!1;try{let o=t.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var n;if(!(n=e)){var r;if(r=o===0){var i=String(t.I).match(SM)[1]||null;!i&&z.self&&z.self.location&&(i=z.self.location.protocol.slice(0,-1)),r=!h4.test(i?i.toLowerCase():"")}n=r}if(n)vt(t,"complete"),vt(t,"success");else{t.m=6;try{var s=2<sr(t)?t.g.statusText:""}catch{s=""}t.j=s+" ["+t.da()+"]",LM(t)}}finally{Hf(t)}}}}function Hf(t,e){if(t.g){UM(t);let n=t.g,r=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||vt(t,"ready");try{n.onreadystatechange=r}catch{}}}function UM(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(z.clearTimeout(t.A),t.A=null)}S.isActive=function(){return!!this.g};function sr(t){return t.g?t.g.readyState:0}S.da=function(){try{return 2<sr(this)?this.g.status:-1}catch{return-1}};S.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};S.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&e.indexOf(t)==0&&(e=e.substring(t.length)),d4(e)}};function Qx(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case VM:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch{return null}}function g4(t){let e={};t=(t.g&&2<=sr(t)&&t.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<t.length;r++){if(Dc(t[r]))continue;var n=Bq(t[r]);let i=n[0];if(n=n[1],typeof n!="string")continue;n=n.trim();let s=e[i]||[];e[i]=s,s.push(n)}Vq(e,function(r){return r.join(", ")})}S.Ia=function(){return this.m};S.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function BM(t){let e="";return hw(t,function(n,r){e+=r,e+=":",e+=n,e+=`\r
`}),e}function bw(t,e,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=BM(n),typeof t=="string"?n!=null&&encodeURIComponent(String(n)):Se(t,e,n))}function vc(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function $M(t){this.Ga=0,this.j=[],this.l=new Ff,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=vc("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=vc("baseRetryDelayMs",5e3,t),this.hb=vc("retryDelaySeedMs",1e4,t),this.eb=vc("forwardChannelMaxRetries",2,t),this.xa=vc("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new RM(t&&t.concurrentRequestLimit),this.Ja=new u4,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}S=$M.prototype;S.ra=8;S.H=1;function Sw(t){if(HM(t),t.H==3){var e=t.W++,n=Pr(t.I);if(Se(n,"SID",t.K),Se(n,"RID",e),Se(n,"TYPE","terminate"),Uc(t,n),e=new Fc(t,t.l,e),e.L=2,e.A=Bf(Pr(n)),n=!1,z.navigator&&z.navigator.sendBeacon)try{n=z.navigator.sendBeacon(e.A.toString(),"")}catch{}!n&&z.Image&&(new Image().src=e.A,n=!0),n||(e.g=ZM(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Vc(e)}QM(t)}function qf(t){t.g&&(xw(t),t.g.cancel(),t.g=null)}function HM(t){qf(t),t.u&&(z.clearTimeout(t.u),t.u=null),Sf(t),t.i.cancel(),t.m&&(typeof t.m=="number"&&z.clearTimeout(t.m),t.m=null)}function Gf(t){if(!NM(t.i)&&!t.m){t.m=!0;var e=t.Na;bc||dM(),Sc||(bc(),Sc=!0),_w.add(e,t),t.C=0}}function m4(t,e){return PM(t.i)>=t.i.j-(t.m?1:0)?!1:t.m?(t.j=e.F.concat(t.j),!0):t.H==1||t.H==2||t.C>=(t.cb?0:t.eb)?!1:(t.m=kc(Dt(t.Na,t,e),KM(t,t.C)),t.C++,!0)}S.Na=function(t){if(this.m)if(this.m=null,this.H==1){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;let i=new Fc(this,this.l,t),s=this.s;if(this.U&&(s?(s=rM(s),iM(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,n=0;n<this.j.length;n++){t:{var r=this.j[n];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=n;break e}if(e===4096||n===this.j.length-1){e=n+1;break e}}e=1e3}else e=1e3;e=qM(this,i,e),n=Pr(this.I),Se(n,"RID",t),Se(n,"CVER",22),this.F&&Se(n,"X-HTTP-Session-Id",this.F),Uc(this,n),s&&(this.O?e="headers="+encodeURIComponent(String(BM(s)))+"&"+e:this.o&&bw(n,this.o,s)),Dw(this.i,i),this.bb&&Se(n,"TYPE","init"),this.P?(Se(n,"$req",e),Se(n,"SID","null"),i.aa=!0,iw(i,n,null)):iw(i,n,e),this.H=2}}else this.H==3&&(t?Yx(this,t):this.j.length==0||NM(this.i)||Yx(this))};function Yx(t,e){var n;e?n=e.m:n=t.W++;let r=Pr(t.I);Se(r,"SID",t.K),Se(r,"RID",n),Se(r,"AID",t.V),Uc(t,r),t.o&&t.s&&bw(r,t.o,t.s),n=new Fc(t,t.l,n,t.C+1),t.o===null&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=qM(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),Dw(t.i,n),iw(n,r,e)}function Uc(t,e){t.na&&hw(t.na,function(n,r){Se(e,r,n)}),t.h&&bM({},function(n,r){Se(e,r,n)})}function qM(t,e,n){n=Math.min(t.j.length,n);var r=t.h?Dt(t.h.Va,t.h,t):null;e:{var i=t.j;let s=-1;for(;;){let o=["count="+n];s==-1?0<n?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let u=0;u<n;u++){let c=i[u].g,l=i[u].map;if(c-=s,0>c)s=Math.max(0,i[u].g-100),a=!1;else try{c4(l,o,"req"+c+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break e}}}return t=t.j.splice(0,n),e.F=t,r}function GM(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;bc||dM(),Sc||(bc(),Sc=!0),_w.add(e,t),t.A=0}}function Aw(t){return t.g||t.u||3<=t.A?!1:(t.ba++,t.u=kc(Dt(t.Ma,t),KM(t,t.A)),t.A++,!0)}S.Ma=function(){if(this.u=null,zM(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=kc(Dt(this.jb,this),t)}};S.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Mt(10),qf(this),zM(this))};function xw(t){t.B!=null&&(z.clearTimeout(t.B),t.B=null)}function zM(t){t.g=new Fc(t,t.l,"rpc",t.ba),t.o===null&&(t.g.I=t.s),t.g.O=0;var e=Pr(t.wa);Se(e,"RID","rpc"),Se(e,"SID",t.K),Se(e,"AID",t.V),Se(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&Se(e,"TO",t.qa),Se(e,"TYPE","xmlhttp"),Uc(t,e),t.o&&t.s&&bw(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.A=Bf(Pr(e)),n.u=null,n.S=!0,IM(n,t)}S.ib=function(){this.v!=null&&(this.v=null,qf(this),Aw(this),Mt(19))};function Sf(t){t.v!=null&&(z.clearTimeout(t.v),t.v=null)}function WM(t,e){var n=null;if(t.g==e){Sf(t),xw(t),t.g=null;var r=2}else if(ow(t.i,e))n=e.F,kM(t.i,e),r=1;else return;if(t.H!=0){if(e.i)if(r==1){n=e.u?e.u.length:0,e=Date.now()-e.G;var i=t.C;r=Vf(),vt(r,new yM(r,n)),Gf(t)}else GM(t);else if(i=e.s,i==3||i==0&&0<e.ca||!(r==1&&m4(t,e)||r==2&&Aw(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:ys(t,5);break;case 4:ys(t,10);break;case 3:ys(t,6);break;default:ys(t,2)}}}function KM(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function ys(t,e){if(t.l.info("Error code "+e),e==2){var n=null;t.h&&(n=null);var r=Dt(t.pb,t);n||(n=new _s("//www.google.com/images/cleardot.gif"),z.location&&z.location.protocol=="http"||Tf(n,"https"),Bf(n)),l4(n.toString(),r)}else Mt(2);t.H=0,t.h&&t.h.za(e),QM(t),HM(t)}S.pb=function(t){t?(this.l.info("Successfully pinged google.com"),Mt(2)):(this.l.info("Failed to ping google.com"),Mt(1))};function QM(t){if(t.H=0,t.ma=[],t.h){let e=OM(t.i);(e.length!=0||t.j.length!=0)&&(Bx(t.ma,e),Bx(t.ma,t.j),t.i.i.length=0,lw(t.j),t.j.length=0),t.h.ya()}}function YM(t,e,n){var r=n instanceof _s?Pr(n):new _s(n);if(r.g!="")e&&(r.g=e+"."+r.g),bf(r,r.m);else{var i=z.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new _s(null);r&&Tf(s,r),e&&(s.g=e),i&&bf(s,i),n&&(s.l=n),r=s}return n=t.F,e=t.Da,n&&e&&Se(r,n,e),Se(r,"VER",t.ra),Uc(t,r),r}function ZM(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=t.Ha&&!t.va?new Ve(new Lc({ob:n})):new Ve(t.va),e.Oa(t.J),e}S.isActive=function(){return!!this.h&&this.h.isActive(this)};function XM(){}S=XM.prototype;S.Ba=function(){};S.Aa=function(){};S.za=function(){};S.ya=function(){};S.isActive=function(){return!0};S.Va=function(){};function Af(){if(sa&&!(10<=Number(Pq)))throw Error("Environmental error: no available transport.")}Af.prototype.g=function(t,e){return new Yt(t,e)};function Yt(t,e){ut.call(this),this.g=new $M(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!Dc(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Dc(e)&&(this.g.F=e,t=this.h,t!==null&&e in t&&(t=this.h,e in t&&delete t[e])),this.j=new aa(this)}ct(Yt,ut);Yt.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;Mt(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=YM(t,null,t.Y),Gf(t)};Yt.prototype.close=function(){Sw(this.g)};Yt.prototype.u=function(t){var e=this.g;if(typeof t=="string"){var n={};n.__data__=t,t=n}else this.v&&(n={},n.__data__=yw(t),t=n);e.j.push(new s4(e.fb++,t)),e.H==3&&Gf(e)};Yt.prototype.N=function(){this.g.h=null,delete this.j,Sw(this.g),delete this.g,Yt.$.N.call(this)};function JM(t){Iw.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){e:{for(let n in e){t=n;break e}t=void 0}(this.i=t)&&(t=this.i,e=e!==null&&t in e?e[t]:void 0),this.data=e}else this.data=t}ct(JM,Iw);function eR(){Cw.call(this),this.status=1}ct(eR,Cw);function aa(t){this.g=t}ct(aa,XM);aa.prototype.Ba=function(){vt(this.g,"a")};aa.prototype.Aa=function(t){vt(this.g,new JM(t))};aa.prototype.za=function(t){vt(this.g,new eR)};aa.prototype.ya=function(){vt(this.g,"b")};function y4(){this.blockSize=-1}function On(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}ct(On,y4);On.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function zv(t,e,n){n||(n=0);var r=Array(16);if(typeof e=="string")for(var i=0;16>i;++i)r[i]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],i=t.g[2];var s=t.g[3],o=e+(s^n&(i^s))+r[0]+3614090360&4294967295;e=n+(o<<7&4294967295|o>>>25),o=s+(i^e&(n^i))+r[1]+3905402710&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(n^s&(e^n))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(e^i&(s^e))+r[3]+3250441966&4294967295,n=i+(o<<22&4294967295|o>>>10),o=e+(s^n&(i^s))+r[4]+4118548399&4294967295,e=n+(o<<7&4294967295|o>>>25),o=s+(i^e&(n^i))+r[5]+1200080426&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(n^s&(e^n))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(e^i&(s^e))+r[7]+4249261313&4294967295,n=i+(o<<22&4294967295|o>>>10),o=e+(s^n&(i^s))+r[8]+1770035416&4294967295,e=n+(o<<7&4294967295|o>>>25),o=s+(i^e&(n^i))+r[9]+2336552879&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(n^s&(e^n))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(e^i&(s^e))+r[11]+2304563134&4294967295,n=i+(o<<22&4294967295|o>>>10),o=e+(s^n&(i^s))+r[12]+1804603682&4294967295,e=n+(o<<7&4294967295|o>>>25),o=s+(i^e&(n^i))+r[13]+4254626195&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(n^s&(e^n))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=n+(e^i&(s^e))+r[15]+1236535329&4294967295,n=i+(o<<22&4294967295|o>>>10),o=e+(i^s&(n^i))+r[1]+4129170786&4294967295,e=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(e^n))+r[6]+3225465664&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^n&(s^e))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^e&(i^s))+r[0]+3921069994&4294967295,n=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(n^i))+r[5]+3593408605&4294967295,e=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(e^n))+r[10]+38016083&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^n&(s^e))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^e&(i^s))+r[4]+3889429448&4294967295,n=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(n^i))+r[9]+568446438&4294967295,e=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(e^n))+r[14]+3275163606&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^n&(s^e))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^e&(i^s))+r[8]+1163531501&4294967295,n=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(n^i))+r[13]+2850285829&4294967295,e=n+(o<<5&4294967295|o>>>27),o=s+(n^i&(e^n))+r[2]+4243563512&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^n&(s^e))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=n+(s^e&(i^s))+r[12]+2368359562&4294967295,n=i+(o<<20&4294967295|o>>>12),o=e+(n^i^s)+r[5]+4294588738&4294967295,e=n+(o<<4&4294967295|o>>>28),o=s+(e^n^i)+r[8]+2272392833&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^n)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^e)+r[14]+4259657740&4294967295,n=i+(o<<23&4294967295|o>>>9),o=e+(n^i^s)+r[1]+2763975236&4294967295,e=n+(o<<4&4294967295|o>>>28),o=s+(e^n^i)+r[4]+1272893353&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^n)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^e)+r[10]+3200236656&4294967295,n=i+(o<<23&4294967295|o>>>9),o=e+(n^i^s)+r[13]+681279174&4294967295,e=n+(o<<4&4294967295|o>>>28),o=s+(e^n^i)+r[0]+3936430074&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^n)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^e)+r[6]+76029189&4294967295,n=i+(o<<23&4294967295|o>>>9),o=e+(n^i^s)+r[9]+3654602809&4294967295,e=n+(o<<4&4294967295|o>>>28),o=s+(e^n^i)+r[12]+3873151461&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^n)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=n+(i^s^e)+r[2]+3299628645&4294967295,n=i+(o<<23&4294967295|o>>>9),o=e+(i^(n|~s))+r[0]+4096336452&4294967295,e=n+(o<<6&4294967295|o>>>26),o=s+(n^(e|~i))+r[7]+1126891415&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~n))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~e))+r[5]+4237533241&4294967295,n=i+(o<<21&4294967295|o>>>11),o=e+(i^(n|~s))+r[12]+1700485571&4294967295,e=n+(o<<6&4294967295|o>>>26),o=s+(n^(e|~i))+r[3]+2399980690&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~n))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~e))+r[1]+2240044497&4294967295,n=i+(o<<21&4294967295|o>>>11),o=e+(i^(n|~s))+r[8]+1873313359&4294967295,e=n+(o<<6&4294967295|o>>>26),o=s+(n^(e|~i))+r[15]+4264355552&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~n))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~e))+r[13]+1309151649&4294967295,n=i+(o<<21&4294967295|o>>>11),o=e+(i^(n|~s))+r[4]+4149444226&4294967295,e=n+(o<<6&4294967295|o>>>26),o=s+(n^(e|~i))+r[11]+3174756917&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~n))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=n+(s^(i|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+i&4294967295,t.g[3]=t.g[3]+s&4294967295}On.prototype.j=function(t,e){e===void 0&&(e=t.length);for(var n=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(i==0)for(;s<=n;)zv(this,t,s),s+=this.blockSize;if(typeof t=="string"){for(;s<e;)if(r[i++]=t.charCodeAt(s++),i==this.blockSize){zv(this,r),i=0;break}}else for(;s<e;)if(r[i++]=t[s++],i==this.blockSize){zv(this,r),i=0;break}}this.h=i,this.i+=e};On.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=n&255,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};function _e(t,e){this.h=e;for(var n=[],r=!0,i=t.length-1;0<=i;i--){var s=t[i]|0;r&&s==e||(n[i]=s,r=!1)}this.g=n}var _4={};function Mw(t){return-128<=t&&128>t?Mq(t,function(e){return new _e([e|0],0>e?-1:0)}):new _e([t|0],0>t?-1:0)}function or(t){if(isNaN(t)||!isFinite(t))return ia;if(0>t)return _t(or(-t));for(var e=[],n=1,r=0;t>=n;r++)e[r]=t/n|0,n*=aw;return new _e(e,0)}function tR(t,e){if(t.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(t.charAt(0)=="-")return _t(tR(t.substring(1),e));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=or(Math.pow(e,8)),r=ia,i=0;i<t.length;i+=8){var s=Math.min(8,t.length-i),o=parseInt(t.substring(i,i+s),e);8>s?(s=or(Math.pow(e,s)),r=r.R(s).add(or(o))):(r=r.R(n),r=r.add(or(o)))}return r}var aw=4294967296,ia=Mw(0),uw=Mw(1),Zx=Mw(16777216);S=_e.prototype;S.ea=function(){if(mn(this))return-_t(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.D(n);t+=(0<=r?r:aw+r)*e,e*=aw}return t};S.toString=function(t){if(t=t||10,2>t||36<t)throw Error("radix out of range: "+t);if(Nr(this))return"0";if(mn(this))return"-"+_t(this).toString(t);for(var e=or(Math.pow(t,6)),n=this,r="";;){var i=Mf(n,e).g;n=xf(n,i.R(e));var s=((0<n.g.length?n.g[0]:n.h)>>>0).toString(t);if(n=i,Nr(n))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};S.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h};function Nr(t){if(t.h!=0)return!1;for(var e=0;e<t.g.length;e++)if(t.g[e]!=0)return!1;return!0}function mn(t){return t.h==-1}S.X=function(t){return t=xf(this,t),mn(t)?-1:Nr(t)?0:1};function _t(t){for(var e=t.g.length,n=[],r=0;r<e;r++)n[r]=~t.g[r];return new _e(n,~t.h).add(uw)}S.abs=function(){return mn(this)?_t(this):this};S.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0,i=0;i<=e;i++){var s=r+(this.D(i)&65535)+(t.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(t.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new _e(n,n[n.length-1]&-2147483648?-1:0)};function xf(t,e){return t.add(_t(e))}S.R=function(t){if(Nr(this)||Nr(t))return ia;if(mn(this))return mn(t)?_t(this).R(_t(t)):_t(_t(this).R(t));if(mn(t))return _t(this.R(_t(t)));if(0>this.X(Zx)&&0>t.X(Zx))return or(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],r=0;r<2*e;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<t.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=t.D(i)>>>16,u=t.D(i)&65535;n[2*r+2*i]+=o*u,Df(n,2*r+2*i),n[2*r+2*i+1]+=s*u,Df(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,Df(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,Df(n,2*r+2*i+2)}for(r=0;r<e;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=e;r<2*e;r++)n[r]=0;return new _e(n,0)};function Df(t,e){for(;(t[e]&65535)!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function wc(t,e){this.g=t,this.h=e}function Mf(t,e){if(Nr(e))throw Error("division by zero");if(Nr(t))return new wc(ia,ia);if(mn(t))return e=Mf(_t(t),e),new wc(_t(e.g),_t(e.h));if(mn(e))return e=Mf(t,_t(e)),new wc(_t(e.g),e.h);if(30<t.g.length){if(mn(t)||mn(e))throw Error("slowDivide_ only works with positive integers.");for(var n=uw,r=e;0>=r.X(t);)n=Xx(n),r=Xx(r);var i=na(n,1),s=na(r,1);for(r=na(r,2),n=na(n,2);!Nr(r);){var o=s.add(r);0>=o.X(t)&&(i=i.add(n),s=o),r=na(r,1),n=na(n,1)}return e=xf(t,i.R(e)),new wc(i,e)}for(i=ia;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),r=Math.ceil(Math.log(n)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=or(n),o=s.R(e);mn(o)||0<o.X(t);)n-=r,s=or(n),o=s.R(e);Nr(s)&&(s=uw),i=i.add(s),t=xf(t,o)}return new wc(i,t)}S.gb=function(t){return Mf(this,t).h};S.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)&t.D(r);return new _e(n,this.h&t.h)};S.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)|t.D(r);return new _e(n,this.h|t.h)};S.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)^t.D(r);return new _e(n,this.h^t.h)};function Xx(t){for(var e=t.g.length+1,n=[],r=0;r<e;r++)n[r]=t.D(r)<<1|t.D(r-1)>>>31;return new _e(n,t.h)}function na(t,e){var n=e>>5;e%=32;for(var r=t.g.length-n,i=[],s=0;s<r;s++)i[s]=0<e?t.D(s+n)>>>e|t.D(s+n+1)<<32-e:t.D(s+n);return new _e(i,t.h)}Af.prototype.createWebChannel=Af.prototype.g;Yt.prototype.send=Yt.prototype.u;Yt.prototype.open=Yt.prototype.m;Yt.prototype.close=Yt.prototype.close;Lf.NO_ERROR=0;Lf.TIMEOUT=8;Lf.HTTP_ERROR=6;_M.COMPLETE="complete";vM.EventType=Oc;Oc.OPEN="a";Oc.CLOSE="b";Oc.ERROR="c";Oc.MESSAGE="d";ut.prototype.listen=ut.prototype.O;Ve.prototype.listenOnce=Ve.prototype.P;Ve.prototype.getLastError=Ve.prototype.Sa;Ve.prototype.getLastErrorCode=Ve.prototype.Ia;Ve.prototype.getStatus=Ve.prototype.da;Ve.prototype.getResponseJson=Ve.prototype.Wa;Ve.prototype.getResponseText=Ve.prototype.ja;Ve.prototype.send=Ve.prototype.ha;Ve.prototype.setWithCredentials=Ve.prototype.Oa;On.prototype.digest=On.prototype.l;On.prototype.reset=On.prototype.reset;On.prototype.update=On.prototype.j;_e.prototype.add=_e.prototype.add;_e.prototype.multiply=_e.prototype.R;_e.prototype.modulo=_e.prototype.gb;_e.prototype.compare=_e.prototype.X;_e.prototype.toNumber=_e.prototype.ea;_e.prototype.toString=_e.prototype.toString;_e.prototype.getBits=_e.prototype.D;_e.fromNumber=or;_e.fromString=tR;var nR=Fn.createWebChannelTransport=function(){return new Af},rR=Fn.getStatEventTarget=function(){return Vf()},zf=Fn.ErrorCode=Lf,iR=Fn.EventType=_M,sR=Fn.Event=vs,Rw=Fn.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},$J=Fn.FetchXmlHttpFactory=Lc,Bc=Fn.WebChannel=vM,oR=Fn.XhrIo=Ve,aR=Fn.Md5=On,ws=Fn.Integer=_e;var uR="@firebase/firestore";var Je=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Je.UNAUTHENTICATED=new Je(null),Je.GOOGLE_CREDENTIALS=new Je("google-credentials-uid"),Je.FIRST_PARTY=new Je("first-party-uid"),Je.MOCK_USER=new Je("mock-user");var Va="10.8.0";var wi=new zr("@firebase/firestore");function ha(){return wi.logLevel}function aN(t){wi.setLogLevel(t)}function E(t,...e){if(wi.logLevel<=on.DEBUG){let n=e.map(PI);wi.debug(`Firestore (${Va}): ${t}`,...n)}}function He(t,...e){if(wi.logLevel<=on.ERROR){let n=e.map(PI);wi.error(`Firestore (${Va}): ${t}`,...n)}}function _n(t,...e){if(wi.logLevel<=on.WARN){let n=e.map(PI);wi.warn(`Firestore (${Va}): ${t}`,...n)}}function PI(t){if(typeof t=="string")return t;try{return function(n){return JSON.stringify(n)}(t)}catch{return t}}function N(t="Unexpected state"){let e=`FIRESTORE (${Va}) INTERNAL ASSERTION FAILED: `+t;throw He(e),new Error(e)}function O(t,e){t||N()}function uN(t,e){t||N()}function A(t,e){return t}var y={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},w=class extends OT{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var et=class{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}};var rp=class{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Fw=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(Je.UNAUTHENTICATED))}shutdown(){}},Vw=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}},Lw=class{constructor(e){this.t=e,this.currentUser=Je.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){let r=this.i,i=u=>this.i!==r?(r=this.i,n(u)):Promise.resolve(),s=new et;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new et,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;e.enqueueRetryable(()=>v(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},a=u=>{E("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?a(u):(E("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new et)}},0),o()}getToken(){let e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(E("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(O(typeof r.accessToken=="string"),new rp(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return O(e===null||typeof e=="string"),new Je(e)}},jw=class{constructor(e,n,r){this.l=e,this.h=n,this.P=r,this.type="FirstParty",this.user=Je.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Uw=class{constructor(e,n,r){this.l=e,this.h=n,this.P=r}getToken(){return Promise.resolve(new jw(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n(Je.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Bw=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},$w=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,n){let r=s=>{s.error!=null&&E("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,E("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{E("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):E("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(O(typeof n.token=="string"),this.R=n.token,new Bw(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function w4(t){let e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var ip=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=w4(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<n&&(r+=e.charAt(i[s]%e.length))}return r}};function K(t,e){return t<e?-1:t>e?1:0}function Ea(t,e,n){return t.length===e.length&&t.every((r,i)=>n(r,e[i]))}function cN(t){return t+"\0"}var Oe=class t{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new w(y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new w(y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new w(y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new w(y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return t.fromMillis(Date.now())}static fromDate(e){return t.fromMillis(e.getTime())}static fromMillis(e){let n=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*n));return new t(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?K(this.nanoseconds,e.nanoseconds):K(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var L=class t{constructor(e){this.timestamp=e}static fromTimestamp(e){return new t(e)}static min(){return new t(new Oe(0,0))}static max(){return new t(new Oe(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var sp=class t{constructor(e,n,r){n===void 0?n=0:n>e.length&&N(),r===void 0?r=e.length-n:r>e.length-n&&N(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return t.comparator(this,e)===0}child(e){let n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){let r=Math.min(e.length,n.length);for(let i=0;i<r;i++){let s=e.get(i),o=n.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<n.length?-1:e.length>n.length?1:0}},le=class t extends sp{construct(e,n,r){return new t(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let n=[];for(let r of e){if(r.indexOf("//")>=0)throw new w(y.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(i=>i.length>0))}return new t(n)}static emptyPath(){return new t([])}},E4=/^[_a-zA-Z][_a-zA-Z0-9]*$/,qe=class t extends sp{construct(e,n,r){return new t(e,n,r)}static isValidIdentifier(e){return E4.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),t.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new t(["__name__"])}static fromServerFormat(e){let n=[],r="",i=0,s=()=>{if(r.length===0)throw new w(y.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new w(y.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new w(y.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new w(y.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new t(n)}static emptyPath(){return new t([])}};var b=class t{constructor(e){this.path=e}static fromPath(e){return new t(le.fromString(e))}static fromName(e){return new t(le.fromString(e).popFirst(5))}static empty(){return new t(le.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&le.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return le.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new t(new le(e.slice()))}};var Ia=class{constructor(e,n,r,i){this.indexId=e,this.collectionGroup=n,this.fields=r,this.indexState=i}};function Hw(t){return t.fields.find(e=>e.kind===2)}function Is(t){return t.fields.filter(e=>e.kind!==2)}Ia.UNKNOWN_ID=-1;var _a=class{constructor(e,n){this.fieldPath=e,this.kind=n}};var Jc=class t{constructor(e,n){this.sequenceNumber=e,this.offset=n}static empty(){return new t(0,vn.min())}};function lN(t,e){let n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=L.fromTimestamp(r===1e9?new Oe(n+1,0):new Oe(n,r));return new vn(i,b.empty(),e)}function dN(t){return new vn(t.readTime,t.key,-1)}var vn=class t{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new t(L.min(),b.empty(),-1)}static max(){return new t(L.max(),b.empty(),-1)}};function kI(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=b.comparator(t.documentKey,e.documentKey),n!==0?n:K(t.largestBatchId,e.largestBatchId))}var hN="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",op=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Mi(t){return v(this,null,function*(){if(t.code!==y.FAILED_PRECONDITION||t.message!==hN)throw t;E("LocalStore","Unexpectedly lost primary lease")})}var m=class t{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&N(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(n,s).next(r,i)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{let n=e();return n instanceof t?n:t.resolve(n)}catch(n){return t.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):t.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):t.reject(n)}static resolve(e){return new t((n,r)=>{n(e)})}static reject(e){return new t((n,r)=>{r(e)})}static waitFor(e){return new t((n,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&n()},u=>r(u))}),o=!0,s===i&&n()})}static or(e){let n=t.resolve(!1);for(let r of e)n=n.next(i=>i?t.resolve(i):r());return n}static forEach(e,n){let r=[];return e.forEach((i,s)=>{r.push(n.call(this,i,s))}),this.waitFor(r)}static mapArray(e,n){return new t((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let u=0;u<s;u++){let c=u;n(e[c]).next(l=>{o[c]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(e,n){return new t((r,i)=>{let s=()=>{e()===!0?n().next(()=>{s()},i):r()};s()})}};var ap=class t{constructor(e,n){this.action=e,this.transaction=n,this.aborted=!1,this.V=new et,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{n.error?this.V.reject(new As(e,n.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=OI(r.target.error);this.V.reject(new As(e,i))}}static open(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(s){throw new As(n,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(E("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let n=this.transaction.objectStore(e);return new Gw(n)}},Fr=class t{constructor(e,n,r){this.name=e,this.version=n,this.p=r,t.S(du())===12.2&&He("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return E("SimpleDb","Removing database:",e),Cs(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!gd())return!1;if(t.C())return!0;let e=du(),n=t.S(e),r=0<n&&n<10,i=t.v(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.F)==="YES"}static M(e,n){return e.store(n)}static S(e){let n=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static v(e){let n=e.match(/Android ([\d.]+)/i),r=n?n[1].split(".").slice(0,2).join("."):"-1";return Number(r)}O(e){return v(this,null,function*(){return this.db||(E("SimpleDb","Opening database:",this.name),this.db=yield new Promise((n,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;n(o)},i.onblocked=()=>{r(new As(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new w(y.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new w(y.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new As(e,o))},i.onupgradeneeded=s=>{E("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.N(o,i.transaction,s.oldVersion,this.version).next(()=>{E("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=n=>this.B(n)),this.db})}L(e){this.B=e,this.db&&(this.db.onversionchange=n=>e(n))}runTransaction(e,n,r,i){return v(this,null,function*(){let s=n==="readonly",o=0;for(;;){++o;try{this.db=yield this.O(e);let a=ap.open(this.db,e,s?"readonly":"readwrite",r),u=i(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),m.reject(c))).toPromise();return u.catch(()=>{}),yield a.m,u}catch(a){let u=a,c=u.name!=="FirebaseError"&&o<3;if(E("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),this.close(),!c)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}},qw=class{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return Cs(this.k.delete())}},As=class extends w{constructor(e,n){super(y.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${n}`),this.name="IndexedDbTransactionError"}};function Ri(t){return t.name==="IndexedDbTransactionError"}var Gw=class{constructor(e){this.store=e}put(e,n){let r;return n!==void 0?(E("SimpleDb","PUT",this.store.name,e,n),r=this.store.put(n,e)):(E("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Cs(r)}add(e){return E("SimpleDb","ADD",this.store.name,e,e),Cs(this.store.add(e))}get(e){return Cs(this.store.get(e)).next(n=>(n===void 0&&(n=null),E("SimpleDb","GET",this.store.name,e,n),n))}delete(e){return E("SimpleDb","DELETE",this.store.name,e),Cs(this.store.delete(e))}count(){return E("SimpleDb","COUNT",this.store.name),Cs(this.store.count())}W(e,n){let r=this.options(e,n),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new m((o,a)=>{s.onerror=u=>{a(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(r),o=[];return this.G(s,(a,u)=>{o.push(u)}).next(()=>o)}}j(e,n){let r=this.store.getAll(e,n===null?void 0:n);return new m((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}H(e,n){E("SimpleDb","DELETE ALL",this.store.name);let r=this.options(e,n);r.J=!1;let i=this.cursor(r);return this.G(i,(s,o,a)=>a.delete())}Y(e,n){let r;n?r=e:(r={},n=e);let i=this.cursor(r);return this.G(i,n)}Z(e){let n=this.cursor({});return new m((r,i)=>{n.onerror=s=>{let o=OI(s.target.error);i(o)},n.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}G(e,n){let r=[];return new m((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let u=new qw(a),c=n(a.primaryKey,a.value,u);if(c instanceof m){let l=c.catch(d=>(u.done(),m.reject(d)));r.push(l)}u.isDone?i():u.$===null?a.continue():a.continue(u.$)}}).next(()=>m.waitFor(r))}options(e,n){let r;return e!==void 0&&(typeof e=="string"?r=e:n=e),{index:r,range:n}}cursor(e){let n="next";if(e.reverse&&(n="prev"),e.index){let r=this.store.index(e.index);return e.J?r.openKeyCursor(e.range,n):r.openCursor(e.range,n)}return this.store.openCursor(e.range,n)}};function Cs(t){return new m((e,n)=>{t.onsuccess=r=>{let i=r.target.result;e(i)},t.onerror=r=>{let i=OI(r.target.error);n(i)}})}var cR=!1;function OI(t){let e=Fr.S(du());if(e>=12.2&&e<13){let n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){let r=new w("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${n}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return cR||(cR=!0,setTimeout(()=>{throw r},0)),r}}return t}var zw=class{constructor(e,n){this.asyncQueue=e,this.X=n,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ee(e){E("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>v(this,null,function*(){this.task=null;try{E("IndexBackfiller",`Documents written: ${yield this.X.te()}`)}catch(n){Ri(n)?E("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",n):yield Mi(n)}yield this.ee(6e4)}))}},Ww=class{constructor(e,n){this.localStore=e,this.persistence=n}te(e=50){return v(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>this.ne(n,e))})}ne(e,n){let r=new Set,i=n,s=!0;return m.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return E("IndexBackfiller",`Processing collection: ${o}`),this.re(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>n-i)}re(e,n,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,n).next(i=>this.localStore.localDocuments.getNextDocuments(e,n,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.ie(i,s)).next(a=>(E("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,n,a))).next(()=>o.size)}))}ie(e,n){let r=e;return n.changes.forEach((i,s)=>{let o=dN(s);kI(o,r)>0&&(r=o)}),new vn(r.readTime,r.documentKey,Math.max(n.batchId,e.largestBatchId))}};var Zt=(()=>{class t{constructor(n,r){this.previousValue=n,r&&(r.sequenceNumberHandler=i=>this.se(i),this.oe=i=>r.writeSequenceNumber(i))}se(n){return this.previousValue=Math.max(n,this.previousValue),this.previousValue}next(){let n=++this.previousValue;return this.oe&&this.oe(n),n}}return t._e=-1,t})();function Il(t){return t==null}function el(t){return t===0&&1/t==-1/0}function fN(t){return typeof t=="number"&&Number.isInteger(t)&&!el(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}function Rt(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=lR(e)),e=I4(t.get(n),e);return lR(e)}function I4(t,e){let n=e,r=t.length;for(let i=0;i<r;i++){let s=t.charAt(i);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function lR(t){return t+""}function ar(t){let e=t.length;if(O(e>=2),e===2)return O(t.charAt(0)===""&&t.charAt(1)===""),le.emptyPath();let n=e-2,r=[],i="";for(let s=0;s<e;){let o=t.indexOf("",s);switch((o<0||o>n)&&N(),t.charAt(o+1)){case"":let a=t.substring(s,o),u;i.length===0?u=a:(i+=a,u=i,i=""),r.push(u);break;case"":i+=t.substring(s,o),i+="\0";break;case"":i+=t.substring(s,o+1);break;default:N()}s=o+2}return new le(r)}var dR=["userId","batchId"];function Zf(t,e){return[t,Rt(e)]}function pN(t,e,n){return[t,Rt(e),n]}var C4={},D4=["prefixPath","collectionGroup","readTime","documentId"],T4=["prefixPath","collectionGroup","documentId"],b4=["collectionGroup","readTime","prefixPath","documentId"],S4=["canonicalId","targetId"],A4=["targetId","path"],x4=["path","targetId"],M4=["collectionId","parent"],R4=["indexId","uid"],N4=["uid","sequenceNumber"],P4=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],k4=["indexId","uid","orderedDocumentKey"],O4=["userId","collectionPath","documentId"],F4=["userId","collectionPath","largestBatchId"],V4=["userId","collectionGroup","largestBatchId"],gN=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],L4=[...gN,"documentOverlays"],mN=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],yN=mN,j4=[...yN,"indexConfiguration","indexState","indexEntries"];var tl=class extends op{constructor(e,n){super(),this.ae=e,this.currentSequenceNumber=n}};function dt(t,e){let n=A(t);return Fr.M(n.ae,e)}function hR(t){let e=0;for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Us(t,e){for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function _N(t){for(let e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Ae=class t{constructor(e,n){this.comparator=e,this.root=n||cr.EMPTY}insert(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,cr.BLACK,null,null))}remove(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,cr.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){let e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ya(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ya(this.root,e,this.comparator,!1)}getReverseIterator(){return new ya(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ya(this.root,e,this.comparator,!0)}},ya=class{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=n?r(e.key,n):1,n&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},cr=class t{constructor(e,n,r,i,s){this.key=e,this.value=n,this.color=r??t.RED,this.left=i??t.EMPTY,this.right=s??t.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,s){return new t(e??this.key,n??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,n,r),null):s===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return t.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw N();let e=this.left.check();if(e!==this.right.check())throw N();return e+(this.isRed()?0:1)}};cr.EMPTY=null,cr.RED=!0,cr.BLACK=!1;cr.EMPTY=new class{constructor(){this.size=0}get key(){throw N()}get value(){throw N()}get color(){throw N()}get left(){throw N()}get right(){throw N()}copy(e,n,r,i,s){return this}insert(e,n,r){return new cr(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var Ce=class t{constructor(e){this.comparator=e,this.data=new Ae(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new up(this.data.getIterator())}getIteratorFrom(e){return new up(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof t)||this.size!==e.size)return!1;let n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){let i=n.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(n=>{e.push(n)}),e}toString(){let e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){let n=new t(this.comparator);return n.data=e,n}},up=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function ua(t){return t.hasNext()?t.getNext():void 0}var Xt=class t{constructor(e){this.fields=e,e.sort(qe.comparator)}static empty(){return new t([])}unionWith(e){let n=new Ce(qe.comparator);for(let r of this.fields)n=n.add(r);for(let r of e)n=n.add(r);return new t(n.toArray())}covers(e){for(let n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Ea(this.fields,e.fields,(n,r)=>n.isEqual(r))}};var cp=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function vN(){return typeof atob<"u"}var lt=class t{constructor(e){this.binaryString=e}static fromBase64String(e){let n=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new cp("Invalid base64 string: "+s):s}}(e);return new t(n)}static fromUint8Array(e){let n=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new t(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){let r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return K(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};lt.EMPTY_BYTE_STRING=new lt("");var U4=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ei(t){if(O(!!t),typeof t=="string"){let e=0,n=U4.exec(t);if(O(!!n),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Le(t.seconds),nanos:Le(t.nanos)}}function Le(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Ii(t){return typeof t=="string"?lt.fromBase64String(t):lt.fromUint8Array(t)}function Jp(t){var e,n;return((n=(((e=t?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function FI(t){let e=t.mapValue.fields.__previous_value__;return Jp(e)?FI(e):e}function nl(t){let e=Ei(t.mapValue.fields.__local_write_time__.timestampValue);return new Oe(e.seconds,e.nanos)}var Kw=class{constructor(e,n,r,i,s,o,a,u,c){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}},Ci=class t{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new t("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database}};var _i={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Xf={nullValue:"NULL_VALUE"};function xs(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Jp(t)?4:wN(t)?9007199254740991:10:N()}function hr(t,e){if(t===e)return!0;let n=xs(t);if(n!==xs(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return nl(t).isEqual(nl(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=Ei(i.timestampValue),a=Ei(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(i,s){return Ii(i.bytesValue).isEqual(Ii(s.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(i,s){return Le(i.geoPointValue.latitude)===Le(s.geoPointValue.latitude)&&Le(i.geoPointValue.longitude)===Le(s.geoPointValue.longitude)}(t,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return Le(i.integerValue)===Le(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=Le(i.doubleValue),a=Le(s.doubleValue);return o===a?el(o)===el(a):isNaN(o)&&isNaN(a)}return!1}(t,e);case 9:return Ea(t.arrayValue.values||[],e.arrayValue.values||[],hr);case 10:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(hR(o)!==hR(a))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!hr(o[u],a[u])))return!1;return!0}(t,e);default:return N()}}function rl(t,e){return(t.values||[]).find(n=>hr(n,e))!==void 0}function Di(t,e){if(t===e)return 0;let n=xs(t),r=xs(e);if(n!==r)return K(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return K(t.booleanValue,e.booleanValue);case 2:return function(s,o){let a=Le(s.integerValue||s.doubleValue),u=Le(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(t,e);case 3:return fR(t.timestampValue,e.timestampValue);case 4:return fR(nl(t),nl(e));case 5:return K(t.stringValue,e.stringValue);case 6:return function(s,o){let a=Ii(s),u=Ii(o);return a.compareTo(u)}(t.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){let l=K(a[c],u[c]);if(l!==0)return l}return K(a.length,u.length)}(t.referenceValue,e.referenceValue);case 8:return function(s,o){let a=K(Le(s.latitude),Le(o.latitude));return a!==0?a:K(Le(s.longitude),Le(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(s,o){let a=s.values||[],u=o.values||[];for(let c=0;c<a.length&&c<u.length;++c){let l=Di(a[c],u[c]);if(l)return l}return K(a.length,u.length)}(t.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===_i.mapValue&&o===_i.mapValue)return 0;if(s===_i.mapValue)return 1;if(o===_i.mapValue)return-1;let a=s.fields||{},u=Object.keys(a),c=o.fields||{},l=Object.keys(c);u.sort(),l.sort();for(let d=0;d<u.length&&d<l.length;++d){let h=K(u[d],l[d]);if(h!==0)return h;let f=Di(a[u[d]],c[l[d]]);if(f!==0)return f}return K(u.length,l.length)}(t.mapValue,e.mapValue);default:throw N()}}function fR(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return K(t,e);let n=Ei(t),r=Ei(e),i=K(n.seconds,r.seconds);return i!==0?i:K(n.nanos,r.nanos)}function Ca(t){return Qw(t)}function Qw(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){let r=Ei(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return Ii(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return b.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",i=!0;for(let s of n.values||[])i?i=!1:r+=",",r+=Qw(s);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){let r=Object.keys(n.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${Qw(n.fields[o])}`;return i+"}"}(t.mapValue):N()}function Ms(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Yw(t){return!!t&&"integerValue"in t}function il(t){return!!t&&"arrayValue"in t}function pR(t){return!!t&&"nullValue"in t}function gR(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Jf(t){return!!t&&"mapValue"in t}function Kc(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){let e={mapValue:{fields:{}}};return Us(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=Kc(r)),e}if(t.arrayValue){let e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Kc(t.arrayValue.values[n]);return e}return Object.assign({},t)}function wN(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function B4(t){return"nullValue"in t?Xf:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?Ms(Ci.empty(),b.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?{mapValue:{}}:N()}function $4(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?Ms(Ci.empty(),b.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?{mapValue:{}}:"mapValue"in t?_i:N()}function mR(t,e){let n=Di(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function yR(t,e){let n=Di(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}var St=class t{constructor(e){this.value=e}static empty(){return new t({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Jf(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Kc(n)}setAll(e){let n=qe.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){let u=this.getFieldsMap(n);this.applyChanges(u,r,i),r={},i=[],n=a.popLast()}o?r[a.lastSegment()]=Kc(o):i.push(a.lastSegment())});let s=this.getFieldsMap(n);this.applyChanges(s,r,i)}delete(e){let n=this.field(e.popLast());Jf(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return hr(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];Jf(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){Us(n,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new t(Kc(this.value))}};function EN(t){let e=[];return Us(t.fields,(n,r)=>{let i=new qe([n]);if(Jf(r)){let s=EN(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new Xt(e)}var tt=class t{constructor(e,n,r,i,s,o,a){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new t(e,0,L.min(),L.min(),L.min(),St.empty(),0)}static newFoundDocument(e,n,r,i){return new t(e,1,n,L.min(),r,i,0)}static newNoDocument(e,n){return new t(e,2,n,L.min(),L.min(),St.empty(),0)}static newUnknownDocument(e,n){return new t(e,3,n,L.min(),L.min(),St.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(L.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=St.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=St.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=L.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new t(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var fr=class{constructor(e,n){this.position=e,this.inclusive=n}};function _R(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){let s=e[i],o=t.position[i];if(s.field.isKeyField()?r=b.comparator(b.fromName(o.referenceValue),n.key):r=Di(o,n.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function vR(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!hr(t.position[n],e.position[n]))return!1;return!0}var Rs=class{constructor(e,n="asc"){this.field=e,this.dir=n}};function H4(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}var lp=class{},ae=class t extends lp{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new Jw(e,n,r):n==="array-contains"?new nE(e,r):n==="in"?new dp(e,r):n==="not-in"?new rE(e,r):n==="array-contains-any"?new iE(e,r):new t(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new eE(e,r):new tE(e,r)}matches(e){let n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(Di(n,this.value)):n!==null&&xs(this.value)===xs(n)&&this.matchesComparison(Di(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return N()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ve=class t extends lp{constructor(e,n){super(),this.filters=e,this.op=n,this.ue=null}static create(e,n){return new t(e,n)}matches(e){return Da(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ue!==null||(this.ue=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}};function Da(t){return t.op==="and"}function Zw(t){return t.op==="or"}function VI(t){return IN(t)&&Da(t)}function IN(t){for(let e of t.filters)if(e instanceof ve)return!1;return!0}function Xw(t){if(t instanceof ae)return t.field.canonicalString()+t.op.toString()+Ca(t.value);if(VI(t))return t.filters.map(e=>Xw(e)).join(",");{let e=t.filters.map(n=>Xw(n)).join(",");return`${t.op}(${e})`}}function CN(t,e){return t instanceof ae?function(r,i){return i instanceof ae&&r.op===i.op&&r.field.isEqual(i.field)&&hr(r.value,i.value)}(t,e):t instanceof ve?function(r,i){return i instanceof ve&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&CN(o,i.filters[a]),!0):!1}(t,e):void N()}function DN(t,e){let n=t.filters.concat(e);return ve.create(n,t.op)}function TN(t){return t instanceof ae?function(n){return`${n.field.canonicalString()} ${n.op} ${Ca(n.value)}`}(t):t instanceof ve?function(n){return n.op.toString()+" {"+n.getFilters().map(TN).join(" ,")+"}"}(t):"Filter"}var Jw=class extends ae{constructor(e,n,r){super(e,n,r),this.key=b.fromName(r.referenceValue)}matches(e){let n=b.comparator(e.key,this.key);return this.matchesComparison(n)}},eE=class extends ae{constructor(e,n){super(e,"in",n),this.keys=bN("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}},tE=class extends ae{constructor(e,n){super(e,"not-in",n),this.keys=bN("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}};function bN(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>b.fromName(r.referenceValue))}var nE=class extends ae{constructor(e,n){super(e,"array-contains",n)}matches(e){let n=e.data.field(this.field);return il(n)&&rl(n.arrayValue,this.value)}},dp=class extends ae{constructor(e,n){super(e,"in",n)}matches(e){let n=e.data.field(this.field);return n!==null&&rl(this.value.arrayValue,n)}},rE=class extends ae{constructor(e,n){super(e,"not-in",n)}matches(e){if(rl(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let n=e.data.field(this.field);return n!==null&&!rl(this.value.arrayValue,n)}},iE=class extends ae{constructor(e,n){super(e,"array-contains-any",n)}matches(e){let n=e.data.field(this.field);return!(!il(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>rl(this.value.arrayValue,r))}};var sE=class{constructor(e,n=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ce=null}};function oE(t,e=null,n=[],r=[],i=null,s=null,o=null){return new sE(t,e,n,r,i,s,o)}function Ns(t){let e=A(t);if(e.ce===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>Xw(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),Il(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>Ca(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>Ca(r)).join(",")),e.ce=n}return e.ce}function Cl(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!H4(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!CN(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!vR(t.startAt,e.startAt)&&vR(t.endAt,e.endAt)}function hp(t){return b.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}function fp(t,e){return t.filters.filter(n=>n instanceof ae&&n.field.isEqual(e))}function wR(t,e,n){let r=Xf,i=!0;for(let s of fp(t,e)){let o=Xf,a=!0;switch(s.op){case"<":case"<=":o=B4(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Xf}mR({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(n!==null){for(let s=0;s<t.orderBy.length;++s)if(t.orderBy[s].field.isEqual(e)){let o=n.position[s];mR({value:r,inclusive:i},{value:o,inclusive:n.inclusive})<0&&(r=o,i=n.inclusive);break}}return{value:r,inclusive:i}}function ER(t,e,n){let r=_i,i=!0;for(let s of fp(t,e)){let o=_i,a=!0;switch(s.op){case">=":case">":o=$4(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=_i}yR({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(n!==null){for(let s=0;s<t.orderBy.length;++s)if(t.orderBy[s].field.isEqual(e)){let o=n.position[s];yR({value:r,inclusive:i},{value:o,inclusive:n.inclusive})>0&&(r=o,i=n.inclusive);break}}return{value:r,inclusive:i}}var Vn=class{constructor(e,n=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}};function SN(t,e,n,r,i,s,o,a){return new Vn(t,e,n,r,i,s,o,a)}function La(t){return new Vn(t)}function IR(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function LI(t){return t.collectionGroup!==null}function va(t){let e=A(t);if(e.le===null){e.le=[];let n=new Set;for(let s of e.explicitOrderBy)e.le.push(s),n.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Ce(qe.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(s=>{n.has(s.canonicalString())||s.isKeyField()||e.le.push(new Rs(s,r))}),n.has(qe.keyField().canonicalString())||e.le.push(new Rs(qe.keyField(),r))}return e.le}function Nt(t){let e=A(t);return e.he||(e.he=q4(e,va(t))),e.he}function q4(t,e){if(t.limitType==="F")return oE(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Rs(i.field,s)});let n=t.endAt?new fr(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new fr(t.startAt.position,t.startAt.inclusive):null;return oE(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function aE(t,e){let n=t.filters.concat([e]);return new Vn(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function pp(t,e,n){return new Vn(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Dl(t,e){return Cl(Nt(t),Nt(e))&&t.limitType===e.limitType}function AN(t){return`${Ns(Nt(t))}|lt:${t.limitType}`}function fa(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(i=>TN(i)).join(", ")}]`),Il(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(i=>Ca(i)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(i=>Ca(i)).join(",")),`Target(${r})`}(Nt(t))}; limitType=${t.limitType})`}function Tl(t,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):b.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(t,e)&&function(r,i){for(let s of va(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(t,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(t,e)&&function(r,i){return!(r.startAt&&!function(o,a,u){let c=_R(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,va(r),i)||r.endAt&&!function(o,a,u){let c=_R(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,va(r),i))}(t,e)}function xN(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function MN(t){return(e,n)=>{let r=!1;for(let i of va(t)){let s=G4(i,e,n);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function G4(t,e,n){let r=t.field.isKeyField()?b.comparator(e.key,n.key):function(s,o,a){let u=o.data.field(s),c=a.data.field(s);return u!==null&&c!==null?Di(u,c):N()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return N()}}var pr=class{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){let n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,n){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){let n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Us(this.inner,(n,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return _N(this.inner)}size(){return this.innerSize}};var z4=new Ae(b.comparator);function Ht(){return z4}var RN=new Ae(b.comparator);function zc(...t){let e=RN;for(let n of t)e=e.insert(n.key,n);return e}function NN(t){let e=RN;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function ur(){return Qc()}function PN(){return Qc()}function Qc(){return new pr(t=>t.toString(),(t,e)=>t.isEqual(e))}var W4=new Ae(b.comparator),K4=new Ce(b.comparator);function Z(...t){let e=K4;for(let n of t)e=e.add(n);return e}var Q4=new Ce(K);function jI(){return Q4}function kN(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:el(e)?"-0":e}}function ON(t){return{integerValue:""+t}}function FN(t,e){return fN(e)?ON(e):kN(t,e)}var Ta=class{constructor(){this._=void 0}};function Y4(t,e,n){return t instanceof Ti?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Jp(s)&&(s=FI(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(n,e):t instanceof Vr?LN(t,e):t instanceof Lr?jN(t,e):function(i,s){let o=VN(i,s),a=CR(o)+CR(i.Ie);return Yw(o)&&Yw(i.Ie)?ON(a):kN(i.serializer,a)}(t,e)}function Z4(t,e,n){return t instanceof Vr?LN(t,e):t instanceof Lr?jN(t,e):n}function VN(t,e){return t instanceof bi?function(r){return Yw(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var Ti=class extends Ta{},Vr=class extends Ta{constructor(e){super(),this.elements=e}};function LN(t,e){let n=UN(e);for(let r of t.elements)n.some(i=>hr(i,r))||n.push(r);return{arrayValue:{values:n}}}var Lr=class extends Ta{constructor(e){super(),this.elements=e}};function jN(t,e){let n=UN(e);for(let r of t.elements)n=n.filter(i=>!hr(i,r));return{arrayValue:{values:n}}}var bi=class extends Ta{constructor(e,n){super(),this.serializer=e,this.Ie=n}};function CR(t){return Le(t.integerValue||t.doubleValue)}function UN(t){return il(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Ps=class{constructor(e,n){this.field=e,this.transform=n}};function X4(t,e){return t.field.isEqual(e.field)&&function(r,i){return r instanceof Vr&&i instanceof Vr||r instanceof Lr&&i instanceof Lr?Ea(r.elements,i.elements,hr):r instanceof bi&&i instanceof bi?hr(r.Ie,i.Ie):r instanceof Ti&&i instanceof Ti}(t.transform,e.transform)}var uE=class{constructor(e,n){this.version=e,this.transformResults=n}},je=class t{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new t}static exists(e){return new t(void 0,e)}static updateTime(e){return new t(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function ep(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}var ba=class{};function BN(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new Ai(t.key,je.none()):new Si(t.key,t.data,je.none());{let n=t.data,r=St.empty(),i=new Ce(qe.comparator);for(let s of e.fields)if(!i.has(s)){let o=n.field(s);o===null&&s.length>1&&(s=s.popLast(),o=n.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Ln(t.key,r,new Xt(i.toArray()),je.none())}}function J4(t,e,n){t instanceof Si?function(i,s,o){let a=i.value.clone(),u=TR(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(t,e,n):t instanceof Ln?function(i,s,o){if(!ep(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=TR(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll($N(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(t,e,n):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,n)}function Yc(t,e,n,r){return t instanceof Si?function(s,o,a,u){if(!ep(s.precondition,o))return a;let c=s.value.clone(),l=bR(s.fieldTransforms,u,o);return c.setAll(l),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(t,e,n,r):t instanceof Ln?function(s,o,a,u){if(!ep(s.precondition,o))return a;let c=bR(s.fieldTransforms,u,o),l=o.data;return l.setAll($N(s)),l.setAll(c),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(d=>d.field))}(t,e,n,r):function(s,o,a){return ep(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(t,e,n)}function eG(t,e){let n=null;for(let r of t.fieldTransforms){let i=e.data.field(r.field),s=VN(r.transform,i||null);s!=null&&(n===null&&(n=St.empty()),n.set(r.field,s))}return n||null}function DR(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Ea(r,i,(s,o)=>X4(s,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}var Si=class extends ba{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Ln=class extends ba{constructor(e,n,r,i,s=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function $N(t){let e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=t.data.field(n);e.set(n,r)}}),e}function TR(t,e,n){let r=new Map;O(t.length===n.length);for(let i=0;i<n.length;i++){let s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,Z4(o,a,n[i]))}return r}function bR(t,e,n){let r=new Map;for(let i of t){let s=i.transform,o=n.data.field(i.field);r.set(i.field,Y4(s,o,e))}return r}var Ai=class extends ba{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},sl=class extends ba{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var ol=class{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){let r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&J4(s,e,r[i])}}applyToLocalView(e,n){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(n=Yc(r,e,n,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(n=Yc(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){let r=PN();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=n.has(i.key)?null:a;let u=BN(o,a);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(L.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Z())}isEqual(e){return this.batchId===e.batchId&&Ea(this.mutations,e.mutations,(n,r)=>DR(n,r))&&Ea(this.baseMutations,e.baseMutations,(n,r)=>DR(n,r))}},cE=class t{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){O(e.mutations.length===r.length);let i=function(){return W4}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new t(e,n,r,i)}};var al=class{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var lE=class{constructor(e,n){this.count=e,this.unchangedNames=n}};var Ze,ce;function HN(t){switch(t){default:return N();case y.CANCELLED:case y.UNKNOWN:case y.DEADLINE_EXCEEDED:case y.RESOURCE_EXHAUSTED:case y.INTERNAL:case y.UNAVAILABLE:case y.UNAUTHENTICATED:return!1;case y.INVALID_ARGUMENT:case y.NOT_FOUND:case y.ALREADY_EXISTS:case y.PERMISSION_DENIED:case y.FAILED_PRECONDITION:case y.ABORTED:case y.OUT_OF_RANGE:case y.UNIMPLEMENTED:case y.DATA_LOSS:return!0}}function qN(t){if(t===void 0)return He("GRPC error has no .code"),y.UNKNOWN;switch(t){case Ze.OK:return y.OK;case Ze.CANCELLED:return y.CANCELLED;case Ze.UNKNOWN:return y.UNKNOWN;case Ze.DEADLINE_EXCEEDED:return y.DEADLINE_EXCEEDED;case Ze.RESOURCE_EXHAUSTED:return y.RESOURCE_EXHAUSTED;case Ze.INTERNAL:return y.INTERNAL;case Ze.UNAVAILABLE:return y.UNAVAILABLE;case Ze.UNAUTHENTICATED:return y.UNAUTHENTICATED;case Ze.INVALID_ARGUMENT:return y.INVALID_ARGUMENT;case Ze.NOT_FOUND:return y.NOT_FOUND;case Ze.ALREADY_EXISTS:return y.ALREADY_EXISTS;case Ze.PERMISSION_DENIED:return y.PERMISSION_DENIED;case Ze.FAILED_PRECONDITION:return y.FAILED_PRECONDITION;case Ze.ABORTED:return y.ABORTED;case Ze.OUT_OF_RANGE:return y.OUT_OF_RANGE;case Ze.UNIMPLEMENTED:return y.UNIMPLEMENTED;case Ze.DATA_LOSS:return y.DATA_LOSS;default:return N()}}(ce=Ze||(Ze={}))[ce.OK=0]="OK",ce[ce.CANCELLED=1]="CANCELLED",ce[ce.UNKNOWN=2]="UNKNOWN",ce[ce.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ce[ce.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ce[ce.NOT_FOUND=5]="NOT_FOUND",ce[ce.ALREADY_EXISTS=6]="ALREADY_EXISTS",ce[ce.PERMISSION_DENIED=7]="PERMISSION_DENIED",ce[ce.UNAUTHENTICATED=16]="UNAUTHENTICATED",ce[ce.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ce[ce.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ce[ce.ABORTED=10]="ABORTED",ce[ce.OUT_OF_RANGE=11]="OUT_OF_RANGE",ce[ce.UNIMPLEMENTED=12]="UNIMPLEMENTED",ce[ce.INTERNAL=13]="INTERNAL",ce[ce.UNAVAILABLE=14]="UNAVAILABLE",ce[ce.DATA_LOSS=15]="DATA_LOSS";var SR=null;function GN(){return new TextEncoder}var tG=new ws([4294967295,4294967295],0);function AR(t){let e=GN().encode(t),n=new aR;return n.update(e),new Uint8Array(n.digest())}function xR(t){let e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new ws([n,r],0),new ws([i,s],0)]}var dE=class t{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Ss(`Invalid padding: ${n}`);if(r<0)throw new Ss(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Ss(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Ss(`Invalid padding when bitmap length is 0: ${n}`);this.Te=8*e.length-n,this.Ee=ws.fromNumber(this.Te)}de(e,n,r){let i=e.add(n.multiply(ws.fromNumber(r)));return i.compare(tG)===1&&(i=new ws([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ee).toNumber()}Ae(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Te===0)return!1;let n=AR(e),[r,i]=xR(n);for(let s=0;s<this.hashCount;s++){let o=this.de(r,i,s);if(!this.Ae(o))return!1}return!0}static create(e,n,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new t(s,i,n);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Te===0)return;let n=AR(e),[r,i]=xR(n);for(let s=0;s<this.hashCount;s++){let o=this.de(r,i,s);this.Re(o)}}Re(e){let n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}},Ss=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var ul=class t{constructor(e,n,r,i,s){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,n,r){let i=new Map;return i.set(e,cl.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new t(L.min(),i,new Ae(K),Ht(),Z())}},cl=class t{constructor(e,n,r,i,s){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new t(r,n,Z(),Z(),Z())}};var wa=class{constructor(e,n,r,i){this.Ve=e,this.removedTargetIds=n,this.key=r,this.me=i}},gp=class{constructor(e,n){this.targetId=e,this.fe=n}},mp=class{constructor(e,n,r=lt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}},yp=class{constructor(){this.ge=0,this.pe=RR(),this.ye=lt.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return this.ge!==0}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=Z(),n=Z(),r=Z();return this.pe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:N()}}),new cl(this.ye,this.we,e,n,r)}Fe(){this.Se=!1,this.pe=RR()}Me(e,n){this.Se=!0,this.pe=this.pe.insert(e,n)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,O(this.ge>=0)}Be(){this.Se=!0,this.we=!0}},hE=class{constructor(e){this.Le=e,this.ke=new Map,this.qe=Ht(),this.Qe=MR(),this.Ke=new Ae(K)}$e(e){for(let n of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(n,e.me):this.We(n,e.key,e.me);for(let n of e.removedTargetIds)this.We(n,e.key,e.me)}Ge(e){this.forEachTarget(e,n=>{let r=this.ze(n);switch(e.state){case 0:this.je(n)&&r.Ce(e.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(e.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(n);break;case 3:this.je(n)&&(r.Be(),r.Ce(e.resumeToken));break;case 4:this.je(n)&&(this.He(n),r.Ce(e.resumeToken));break;default:N()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ke.forEach((r,i)=>{this.je(i)&&n(i)})}Je(e){let n=e.targetId,r=e.fe.count,i=this.Ye(n);if(i){let s=i.target;if(hp(s))if(r===0){let o=new b(s.path);this.We(n,o,tt.newNoDocument(o,L.min()))}else O(r===1);else{let o=this.Ze(n);if(o!==r){let a=this.Xe(e),u=a?this.et(a,e,o):1;if(u!==0){this.He(n);let c=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(n,c)}SR?.tt(function(l,d,h,f,p){var g,_,C,M,T,j;let $={localCacheCount:l,existenceFilterCount:d.count,databaseId:h.database,projectId:h.projectId},Y=d.unchangedNames;return Y&&($.bloomFilter={applied:p===0,hashCount:(g=Y?.hashCount)!==null&&g!==void 0?g:0,bitmapLength:(M=(C=(_=Y?.bits)===null||_===void 0?void 0:_.bitmap)===null||C===void 0?void 0:C.length)!==null&&M!==void 0?M:0,padding:(j=(T=Y?.bits)===null||T===void 0?void 0:T.padding)!==null&&j!==void 0?j:0,mightContain:xe=>{var rn;return(rn=f?.mightContain(xe))!==null&&rn!==void 0&&rn}}),$}(o,e.fe,this.Le.nt(),a,u))}}}}Xe(e){let n=e.fe.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=n,o,a;try{o=Ii(r).toUint8Array()}catch(u){if(u instanceof cp)return _n("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new dE(o,i,s)}catch(u){return _n(u instanceof Ss?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.Te===0?null:a}et(e,n,r){return n.fe.count===r-this.rt(e,n.targetId)?0:2}rt(e,n){let r=this.Le.getRemoteKeysForTarget(n),i=0;return r.forEach(s=>{let o=this.Le.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.We(n,s,null),i++)}),i}it(e){let n=new Map;this.ke.forEach((s,o)=>{let a=this.Ye(o);if(a){if(s.current&&hp(a.target)){let u=new b(a.target.path);this.qe.get(u)!==null||this.st(o,u)||this.We(o,u,tt.newNoDocument(u,e))}s.De&&(n.set(o,s.ve()),s.Fe())}});let r=Z();this.Qe.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{let c=this.Ye(u);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.qe.forEach((s,o)=>o.setReadTime(e));let i=new ul(e,n,this.Ke,this.qe,r);return this.qe=Ht(),this.Qe=MR(),this.Ke=new Ae(K),i}Ue(e,n){if(!this.je(e))return;let r=this.st(e,n.key)?2:0;this.ze(e).Me(n.key,r),this.qe=this.qe.insert(n.key,n),this.Qe=this.Qe.insert(n.key,this.ot(n.key).add(e))}We(e,n,r){if(!this.je(e))return;let i=this.ze(e);this.st(e,n)?i.Me(n,1):i.xe(n),this.Qe=this.Qe.insert(n,this.ot(n).delete(e)),r&&(this.qe=this.qe.insert(n,r))}removeTarget(e){this.ke.delete(e)}Ze(e){let n=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let n=this.ke.get(e);return n||(n=new yp,this.ke.set(e,n)),n}ot(e){let n=this.Qe.get(e);return n||(n=new Ce(K),this.Qe=this.Qe.insert(e,n)),n}je(e){let n=this.Ye(e)!==null;return n||E("WatchChangeAggregator","Detected inactive target",e),n}Ye(e){let n=this.ke.get(e);return n&&n.be?null:this.Le._t(e)}He(e){this.ke.set(e,new yp),this.Le.getRemoteKeysForTarget(e).forEach(n=>{this.We(e,n,null)})}st(e,n){return this.Le.getRemoteKeysForTarget(e).has(n)}};function MR(){return new Ae(b.comparator)}function RR(){return new Ae(b.comparator)}var nG={asc:"ASCENDING",desc:"DESCENDING"},rG={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},iG={and:"AND",or:"OR"},fE=class{constructor(e,n){this.databaseId=e,this.useProto3Json=n}};function pE(t,e){return t.useProto3Json||Il(e)?e:{value:e}}function Sa(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function zN(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function sG(t,e){return Sa(t,e.toTimestamp())}function Ge(t){return O(!!t),L.fromTimestamp(function(n){let r=Ei(n);return new Oe(r.seconds,r.nanos)}(t))}function UI(t,e){return gE(t,e).canonicalString()}function gE(t,e){let n=function(i){return new le(["projects",i.projectId,"databases",i.database])}(t).child("documents");return e===void 0?n:n.child(e)}function WN(t){let e=le.fromString(t);return O(rP(e)),e}function ll(t,e){return UI(t.databaseId,e.path)}function lr(t,e){let n=WN(e);if(n.get(1)!==t.databaseId.projectId)throw new w(y.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new w(y.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new b(YN(n))}function KN(t,e){return UI(t.databaseId,e)}function QN(t){let e=WN(t);return e.length===4?le.emptyPath():YN(e)}function mE(t){return new le(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function YN(t){return O(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function NR(t,e,n){return{name:ll(t,e),fields:n.value.mapValue.fields}}function ZN(t,e,n){let r=lr(t,e.name),i=Ge(e.updateTime),s=e.createTime?Ge(e.createTime):L.min(),o=new St({mapValue:{fields:e.fields}}),a=tt.newFoundDocument(r,i,s,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function oG(t,e){return"found"in e?function(r,i){O(!!i.found),i.found.name,i.found.updateTime;let s=lr(r,i.found.name),o=Ge(i.found.updateTime),a=i.found.createTime?Ge(i.found.createTime):L.min(),u=new St({mapValue:{fields:i.found.fields}});return tt.newFoundDocument(s,o,a,u)}(t,e):"missing"in e?function(r,i){O(!!i.missing),O(!!i.readTime);let s=lr(r,i.missing),o=Ge(i.readTime);return tt.newNoDocument(s,o)}(t,e):N()}function aG(t,e){let n;if("targetChange"in e){e.targetChange;let r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:N()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(c,l){return c.useProto3Json?(O(l===void 0||typeof l=="string"),lt.fromBase64String(l||"")):(O(l===void 0||l instanceof Uint8Array),lt.fromUint8Array(l||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){let l=c.code===void 0?y.UNKNOWN:qN(c.code);return new w(l,c.message||"")}(o);n=new mp(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=lr(t,r.document.name),s=Ge(r.document.updateTime),o=r.document.createTime?Ge(r.document.createTime):L.min(),a=new St({mapValue:{fields:r.document.fields}}),u=tt.newFoundDocument(i,s,o,a),c=r.targetIds||[],l=r.removedTargetIds||[];n=new wa(c,l,u.key,u)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=lr(t,r.document),s=r.readTime?Ge(r.readTime):L.min(),o=tt.newNoDocument(i,s),a=r.removedTargetIds||[];n=new wa([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=lr(t,r.document),s=r.removedTargetIds||[];n=new wa([],s,i,null)}else{if(!("filter"in e))return N();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new lE(i,s),a=r.targetId;n=new gp(a,o)}}return n}function dl(t,e){let n;if(e instanceof Si)n={update:NR(t,e.key,e.value)};else if(e instanceof Ai)n={delete:ll(t,e.key)};else if(e instanceof Ln)n={update:NR(t,e.key,e.data),updateMask:fG(e.fieldMask)};else{if(!(e instanceof sl))return N();n={verify:ll(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(s,o){let a=o.transform;if(a instanceof Ti)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Vr)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Lr)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof bi)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw N()}(0,r))),e.precondition.isNone||(n.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:sG(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:N()}(t,e.precondition)),n}function yE(t,e){let n=e.currentDocument?function(s){return s.updateTime!==void 0?je.updateTime(Ge(s.updateTime)):s.exists!==void 0?je.exists(s.exists):je.none()}(e.currentDocument):je.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let u=null;if("setToServerValue"in a)O(a.setToServerValue==="REQUEST_TIME"),u=new Ti;else if("appendMissingElements"in a){let l=a.appendMissingElements.values||[];u=new Vr(l)}else if("removeAllFromArray"in a){let l=a.removeAllFromArray.values||[];u=new Lr(l)}else"increment"in a?u=new bi(o,a.increment):N();let c=qe.fromServerFormat(a.fieldPath);return new Ps(c,u)}(t,i)):[];if(e.update){e.update.name;let i=lr(t,e.update.name),s=new St({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(u){let c=u.fieldPaths||[];return new Xt(c.map(l=>qe.fromServerFormat(l)))}(e.updateMask);return new Ln(i,s,o,n,r)}return new Si(i,s,n,r)}if(e.delete){let i=lr(t,e.delete);return new Ai(i,n)}if(e.verify){let i=lr(t,e.verify);return new sl(i,n)}return N()}function uG(t,e){return t&&t.length>0?(O(e!==void 0),t.map(n=>function(i,s){let o=i.updateTime?Ge(i.updateTime):Ge(s);return o.isEqual(L.min())&&(o=Ge(s)),new uE(o,i.transformResults||[])}(n,e))):[]}function XN(t,e){return{documents:[KN(t,e.path)]}}function JN(t,e){let n={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=KN(t,i);let s=function(c){if(c.length!==0)return nP(ve.create(c,"and"))}(e.filters);s&&(n.structuredQuery.where=s);let o=function(c){if(c.length!==0)return c.map(l=>function(h){return{field:pa(h.field),direction:lG(h.dir)}}(l))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);let a=pE(t,e.limit);return a!==null&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{ut:n,parent:i}}function eP(t){let e=QN(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){O(r===1);let l=n.from[0];l.allDescendants?i=l.collectionId:e=e.child(l.collectionId)}let s=[];n.where&&(s=function(d){let h=tP(d);return h instanceof ve&&VI(h)?h.getFilters():[h]}(n.where));let o=[];n.orderBy&&(o=function(d){return d.map(h=>function(p){return new Rs(ga(p.field),function(_){switch(_){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(p.direction))}(h))}(n.orderBy));let a=null;n.limit&&(a=function(d){let h;return h=typeof d=="object"?d.value:d,Il(h)?null:h}(n.limit));let u=null;n.startAt&&(u=function(d){let h=!!d.before,f=d.values||[];return new fr(f,h)}(n.startAt));let c=null;return n.endAt&&(c=function(d){let h=!d.before,f=d.values||[];return new fr(f,h)}(n.endAt)),SN(e,i,o,s,a,"F",u,c)}function cG(t,e){let n=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return N()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function tP(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":let r=ga(n.unaryFilter.field);return ae.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=ga(n.unaryFilter.field);return ae.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=ga(n.unaryFilter.field);return ae.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=ga(n.unaryFilter.field);return ae.create(o,"!=",{nullValue:"NULL_VALUE"});default:return N()}}(t):t.fieldFilter!==void 0?function(n){return ae.create(ga(n.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return N()}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return ve.create(n.compositeFilter.filters.map(r=>tP(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return N()}}(n.compositeFilter.op))}(t):N()}function lG(t){return nG[t]}function dG(t){return rG[t]}function hG(t){return iG[t]}function pa(t){return{fieldPath:t.canonicalString()}}function ga(t){return qe.fromServerFormat(t.fieldPath)}function nP(t){return t instanceof ae?function(n){if(n.op==="=="){if(gR(n.value))return{unaryFilter:{field:pa(n.field),op:"IS_NAN"}};if(pR(n.value))return{unaryFilter:{field:pa(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(gR(n.value))return{unaryFilter:{field:pa(n.field),op:"IS_NOT_NAN"}};if(pR(n.value))return{unaryFilter:{field:pa(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:pa(n.field),op:dG(n.op),value:n.value}}}(t):t instanceof ve?function(n){let r=n.getFilters().map(i=>nP(i));return r.length===1?r[0]:{compositeFilter:{op:hG(n.op),filters:r}}}(t):N()}function fG(t){let e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function rP(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}var Aa=class t{constructor(e,n,r,i,s=L.min(),o=L.min(),a=lt.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var _p=class{constructor(e){this.ct=e}};function pG(t,e){let n;if(e.document)n=ZN(t.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=b.fromSegments(e.noDocument.path),i=Os(e.noDocument.readTime);n=tt.newNoDocument(r,i),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return N();{let r=b.fromSegments(e.unknownDocument.path),i=Os(e.unknownDocument.version);n=tt.newUnknownDocument(r,i)}}return e.readTime&&n.setReadTime(function(i){let s=new Oe(i[0],i[1]);return L.fromTimestamp(s)}(e.readTime)),n}function PR(t,e){let n=e.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:vp(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,o){return{name:ll(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Sa(s,o.version.toTimestamp()),createTime:Sa(s,o.createTime.toTimestamp())}}(t.ct,e);else if(e.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:ks(e.version)};else{if(!e.isUnknownDocument())return N();r.unknownDocument={path:n.path.toArray(),version:ks(e.version)}}return r}function vp(t){let e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function ks(t){let e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Os(t){let e=new Oe(t.seconds,t.nanoseconds);return L.fromTimestamp(e)}function Ds(t,e){let n=(e.baseMutations||[]).map(s=>yE(t.ct,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>yE(t.ct,s)),i=Oe.fromMillis(e.localWriteTimeMs);return new ol(e.batchId,i,n,r)}function Wc(t){let e=Os(t.readTime),n=t.lastLimboFreeSnapshotVersion!==void 0?Os(t.lastLimboFreeSnapshotVersion):L.min(),r;return r=function(s){return s.documents!==void 0}(t.query)?function(s){return O(s.documents.length===1),Nt(La(QN(s.documents[0])))}(t.query):function(s){return Nt(eP(s))}(t.query),new Aa(r,t.targetId,"TargetPurposeListen",t.lastListenSequenceNumber,e,n,lt.fromBase64String(t.resumeToken))}function iP(t,e){let n=ks(e.snapshotVersion),r=ks(e.lastLimboFreeSnapshotVersion),i;i=hp(e.target)?XN(t.ct,e.target):JN(t.ct,e.target).ut;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Ns(e.target),readTime:n,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function BI(t){let e=eP({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?pp(e,e.limit,"L"):e}function Nw(t,e){return new al(e.largestBatchId,yE(t.ct,e.overlayMutation))}function kR(t,e){let n=e.path.lastSegment();return[t,Rt(e.path.popLast()),n]}function OR(t,e,n,r){return{indexId:t,uid:e,sequenceNumber:n,readTime:ks(r.readTime),documentKey:Rt(r.documentKey.path),largestBatchId:r.largestBatchId}}var _E=class{getBundleMetadata(e,n){return FR(e).get(n).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:Os(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,n){return FR(e).put(function(i){return{bundleId:i.id,createTime:ks(Ge(i.createTime)),version:i.version}}(n))}getNamedQuery(e,n){return VR(e).get(n).next(r=>{if(r)return function(s){return{name:s.name,query:BI(s.bundledQuery),readTime:Os(s.readTime)}}(r)})}saveNamedQuery(e,n){return VR(e).put(function(i){return{name:i.name,readTime:ks(Ge(i.readTime)),bundledQuery:i.bundledQuery}}(n))}};function FR(t){return dt(t,"bundles")}function VR(t){return dt(t,"namedQueries")}var wp=class t{constructor(e,n){this.serializer=e,this.userId=n}static lt(e,n){let r=n.uid||"";return new t(e,r)}getOverlay(e,n){return $c(e).get(kR(this.userId,n)).next(r=>r?Nw(this.serializer,r):null)}getOverlays(e,n){let r=ur();return m.forEach(n,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,n,r){let i=[];return r.forEach((s,o)=>{let a=new al(n,o);i.push(this.ht(e,a))}),m.waitFor(i)}removeOverlaysForBatchId(e,n,r){let i=new Set;n.forEach(o=>i.add(Rt(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push($c(e).H("collectionPathOverlayIndex",a))}),m.waitFor(s)}getOverlaysForCollection(e,n,r){let i=ur(),s=Rt(n),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return $c(e).W("collectionPathOverlayIndex",o).next(a=>{for(let u of a){let c=Nw(this.serializer,u);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,n,r,i){let s=ur(),o,a=IDBKeyRange.bound([this.userId,n,r],[this.userId,n,Number.POSITIVE_INFINITY],!0);return $c(e).Y({index:"collectionGroupOverlayIndex",range:a},(u,c,l)=>{let d=Nw(this.serializer,c);s.size()<i||d.largestBatchId===o?(s.set(d.getKey(),d),o=d.largestBatchId):l.done()}).next(()=>s)}ht(e,n){return $c(e).put(function(i,s,o){let[a,u,c]=kR(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:dl(i.ct,o.mutation)}}(this.serializer,this.userId,n))}};function $c(t){return dt(t,"documentOverlays")}var kr=class{constructor(){}Pt(e,n){this.It(e,n),n.Tt()}It(e,n){if("nullValue"in e)this.Et(n,5);else if("booleanValue"in e)this.Et(n,10),n.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(n,15),n.dt(Le(e.integerValue));else if("doubleValue"in e){let r=Le(e.doubleValue);isNaN(r)?this.Et(n,13):(this.Et(n,15),el(r)?n.dt(0):n.dt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Et(n,20),typeof r=="string"?n.At(r):(n.At(`${r.seconds||""}`),n.dt(r.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,n),this.Vt(n);else if("bytesValue"in e)this.Et(n,30),n.ft(Ii(e.bytesValue)),this.Vt(n);else if("referenceValue"in e)this.gt(e.referenceValue,n);else if("geoPointValue"in e){let r=e.geoPointValue;this.Et(n,45),n.dt(r.latitude||0),n.dt(r.longitude||0)}else"mapValue"in e?wN(e)?this.Et(n,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,n),this.Vt(n)):"arrayValue"in e?(this.wt(e.arrayValue,n),this.Vt(n)):N()}Rt(e,n){this.Et(n,25),this.St(e,n)}St(e,n){n.At(e)}yt(e,n){let r=e.fields||{};this.Et(n,55);for(let i of Object.keys(r))this.Rt(i,n),this.It(r[i],n)}wt(e,n){let r=e.values||[];this.Et(n,50);for(let i of r)this.It(i,n)}gt(e,n){this.Et(n,37),b.fromName(e).path.forEach(r=>{this.Et(n,60),this.St(r,n)})}Et(e,n){e.dt(n)}Vt(e){e.dt(2)}};kr.bt=new kr;function gG(t){if(t===0)return 8;let e=0;return!(t>>4)&&(e+=4,t<<=4),!(t>>6)&&(e+=2,t<<=2),!(t>>7)&&(e+=1),e}function LR(t){let e=64-function(r){let i=0;for(let s=0;s<8;++s){let o=gG(255&r[s]);if(i+=o,o!==8)break}return i}(t);return Math.ceil(e/8)}var vE=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){let n=e[Symbol.iterator](),r=n.next();for(;!r.done;)this.Ct(r.value),r=n.next();this.vt()}Ft(e){let n=e[Symbol.iterator](),r=n.next();for(;!r.done;)this.Mt(r.value),r=n.next();this.xt()}Ot(e){for(let n of e){let r=n.charCodeAt(0);if(r<128)this.Ct(r);else if(r<2048)this.Ct(960|r>>>6),this.Ct(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Ct(480|r>>>12),this.Ct(128|63&r>>>6),this.Ct(128|63&r);else{let i=n.codePointAt(0);this.Ct(240|i>>>18),this.Ct(128|63&i>>>12),this.Ct(128|63&i>>>6),this.Ct(128|63&i)}}this.vt()}Nt(e){for(let n of e){let r=n.charCodeAt(0);if(r<128)this.Mt(r);else if(r<2048)this.Mt(960|r>>>6),this.Mt(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Mt(480|r>>>12),this.Mt(128|63&r>>>6),this.Mt(128|63&r);else{let i=n.codePointAt(0);this.Mt(240|i>>>18),this.Mt(128|63&i>>>12),this.Mt(128|63&i>>>6),this.Mt(128|63&i)}}this.xt()}Bt(e){let n=this.Lt(e),r=LR(n);this.kt(1+r),this.buffer[this.position++]=255&r;for(let i=n.length-r;i<n.length;++i)this.buffer[this.position++]=255&n[i]}qt(e){let n=this.Lt(e),r=LR(n);this.kt(1+r),this.buffer[this.position++]=~(255&r);for(let i=n.length-r;i<n.length;++i)this.buffer[this.position++]=~(255&n[i])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Lt(e){let n=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=(128&n[0])!=0;n[0]^=r?255:128;for(let i=1;i<n.length;++i)n[i]^=r?255:0;return n}Ct(e){let n=255&e;n===0?(this.Kt(0),this.Kt(255)):n===255?(this.Kt(255),this.Kt(0)):this.Kt(n)}Mt(e){let n=255&e;n===0?(this.Ut(0),this.Ut(255)):n===255?(this.Ut(255),this.Ut(0)):this.Ut(e)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){let n=e+this.position;if(n<=this.buffer.length)return;let r=2*this.buffer.length;r<n&&(r=n);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},wE=class{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Bt(e)}Tt(){this.Gt.Qt()}},EE=class{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}},Ts=class{constructor(){this.Gt=new vE,this.zt=new wE(this.Gt),this.jt=new EE(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return e===0?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}};var bs=class t{constructor(e,n,r,i){this.indexId=e,this.documentKey=n,this.arrayValue=r,this.directionalValue=i}Jt(){let e=this.directionalValue.length,n=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(n);return r.set(this.directionalValue,0),n!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new t(this.indexId,this.documentKey,this.arrayValue,r)}};function pi(t,e){let n=t.indexId-e.indexId;return n!==0?n:(n=jR(t.arrayValue,e.arrayValue),n!==0?n:(n=jR(t.directionalValue,e.directionalValue),n!==0?n:b.comparator(t.documentKey,e.documentKey)))}function jR(t,e){for(let n=0;n<t.length&&n<e.length;++n){let r=t[n]-e[n];if(r!==0)return r}return t.length-e.length}var Ep=class{constructor(e){this.Yt=new Ce((n,r)=>qe.comparator(n.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.Zt=e.orderBy,this.Xt=[];for(let n of e.filters){let r=n;r.isInequality()?this.Yt=this.Yt.add(r):this.Xt.push(r)}}get en(){return this.Yt.size>1}tn(e){if(O(e.collectionGroup===this.collectionId),this.en)return!1;let n=Hw(e);if(n!==void 0&&!this.nn(n))return!1;let r=Is(e),i=new Set,s=0,o=0;for(;s<r.length&&this.nn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Yt.size>0){let a=this.Yt.getIterator().getNext();if(!i.has(a.field.canonicalString())){let u=r[s];if(!this.rn(a,u)||!this.sn(this.Zt[o++],u))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.Zt.length||!this.sn(this.Zt[o++],a))return!1}return!0}on(){if(this.en)return null;let e=new Ce(qe.comparator),n=[];for(let r of this.Xt)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")n.push(new _a(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),n.push(new _a(r.field,0))}for(let r of this.Zt)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),n.push(new _a(r.field,r.dir==="asc"?0:1)));return new Ia(Ia.UNKNOWN_ID,this.collectionId,n,Jc.empty())}nn(e){for(let n of this.Xt)if(this.rn(n,e))return!0;return!1}rn(e,n){if(e===void 0||!e.field.isEqual(n.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return n.kind===2===r}sn(e,n){return!!e.field.isEqual(n.fieldPath)&&(n.kind===0&&e.dir==="asc"||n.kind===1&&e.dir==="desc")}};function sP(t){var e,n;if(O(t instanceof ae||t instanceof ve),t instanceof ae){if(t instanceof dp){let i=((n=(e=t.value.arrayValue)===null||e===void 0?void 0:e.values)===null||n===void 0?void 0:n.map(s=>ae.create(t.field,"==",s)))||[];return ve.create(i,"or")}return t}let r=t.filters.map(i=>sP(i));return ve.create(r,t.op)}function mG(t){if(t.getFilters().length===0)return[];let e=DE(sP(t));return O(oP(e)),IE(e)||CE(e)?[e]:e.getFilters()}function IE(t){return t instanceof ae}function CE(t){return t instanceof ve&&VI(t)}function oP(t){return IE(t)||CE(t)||function(n){if(n instanceof ve&&Zw(n)){for(let r of n.getFilters())if(!IE(r)&&!CE(r))return!1;return!0}return!1}(t)}function DE(t){if(O(t instanceof ae||t instanceof ve),t instanceof ae)return t;if(t.filters.length===1)return DE(t.filters[0]);let e=t.filters.map(r=>DE(r)),n=ve.create(e,t.op);return n=Ip(n),oP(n)?n:(O(n instanceof ve),O(Da(n)),O(n.filters.length>1),n.filters.reduce((r,i)=>$I(r,i)))}function $I(t,e){let n;return O(t instanceof ae||t instanceof ve),O(e instanceof ae||e instanceof ve),n=t instanceof ae?e instanceof ae?function(i,s){return ve.create([i,s],"and")}(t,e):UR(t,e):e instanceof ae?UR(e,t):function(i,s){if(O(i.filters.length>0&&s.filters.length>0),Da(i)&&Da(s))return DN(i,s.getFilters());let o=Zw(i)?i:s,a=Zw(i)?s:i,u=o.filters.map(c=>$I(c,a));return ve.create(u,"or")}(t,e),Ip(n)}function UR(t,e){if(Da(e))return DN(e,t.getFilters());{let n=e.filters.map(r=>$I(t,r));return ve.create(n,"or")}}function Ip(t){if(O(t instanceof ae||t instanceof ve),t instanceof ae)return t;let e=t.getFilters();if(e.length===1)return Ip(e[0]);if(IN(t))return t;let n=e.map(i=>Ip(i)),r=[];return n.forEach(i=>{i instanceof ae?r.push(i):i instanceof ve&&(i.op===t.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:ve.create(r,t.op)}var TE=class{constructor(){this._n=new hl}addToCollectionParentIndex(e,n){return this._n.add(n),m.resolve()}getCollectionParents(e,n){return m.resolve(this._n.getEntries(n))}addFieldIndex(e,n){return m.resolve()}deleteFieldIndex(e,n){return m.resolve()}deleteAllFieldIndexes(e){return m.resolve()}createTargetIndexes(e,n){return m.resolve()}getDocumentsMatchingTarget(e,n){return m.resolve(null)}getIndexType(e,n){return m.resolve(0)}getFieldIndexes(e,n){return m.resolve([])}getNextCollectionGroupToUpdate(e){return m.resolve(null)}getMinOffset(e,n){return m.resolve(vn.min())}getMinOffsetFromCollectionGroup(e,n){return m.resolve(vn.min())}updateCollectionGroup(e,n,r){return m.resolve()}updateIndexEntries(e,n){return m.resolve()}},hl=class{constructor(){this.index={}}add(e){let n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new Ce(le.comparator),s=!i.has(r);return this.index[n]=i.add(r),s}has(e){let n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Ce(le.comparator)).toArray()}};var Wf=new Uint8Array(0),bE=class{constructor(e,n){this.databaseId=n,this.an=new hl,this.un=new pr(r=>Ns(r),(r,i)=>Cl(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,n){if(!this.an.has(n)){let r=n.lastSegment(),i=n.popLast();e.addOnCommittedListener(()=>{this.an.add(n)});let s={collectionId:r,parent:Rt(i)};return BR(e).put(s)}return m.resolve()}getCollectionParents(e,n){let r=[],i=IDBKeyRange.bound([n,""],[cN(n),""],!1,!0);return BR(e).W(i).next(s=>{for(let o of s){if(o.collectionId!==n)break;r.push(ar(o.parent))}return r})}addFieldIndex(e,n){let r=Hc(e),i=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(n);delete i.indexId;let s=r.add(i);if(n.indexState){let o=la(e);return s.next(a=>{o.put(OR(a,this.uid,n.indexState.sequenceNumber,n.indexState.offset))})}return s.next()}deleteFieldIndex(e,n){let r=Hc(e),i=la(e),s=ca(e);return r.delete(n.indexId).next(()=>i.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let n=Hc(e),r=ca(e),i=la(e);return n.H().next(()=>r.H()).next(()=>i.H())}createTargetIndexes(e,n){return m.forEach(this.cn(n),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let s=new Ep(r).on();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,n){let r=ca(e),i=!0,s=new Map;return m.forEach(this.cn(n),o=>this.ln(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=Z(),a=[];return m.forEach(s,(u,c)=>{E("IndexedDbIndexManager",`Using index ${function(T){return`id=${T.indexId}|cg=${T.collectionGroup}|f=${T.fields.map(j=>`${j.fieldPath}:${j.kind}`).join(",")}`}(u)} to execute ${Ns(n)}`);let l=function(T,j){let $=Hw(j);if($===void 0)return null;for(let Y of fp(T,$.fieldPath))switch(Y.op){case"array-contains-any":return Y.value.arrayValue.values||[];case"array-contains":return[Y.value]}return null}(c,u),d=function(T,j){let $=new Map;for(let Y of Is(j))for(let xe of fp(T,Y.fieldPath))switch(xe.op){case"==":case"in":$.set(Y.fieldPath.canonicalString(),xe.value);break;case"not-in":case"!=":return $.set(Y.fieldPath.canonicalString(),xe.value),Array.from($.values())}return null}(c,u),h=function(T,j){let $=[],Y=!0;for(let xe of Is(j)){let rn=xe.kind===0?wR(T,xe.fieldPath,T.startAt):ER(T,xe.fieldPath,T.startAt);$.push(rn.value),Y&&(Y=rn.inclusive)}return new fr($,Y)}(c,u),f=function(T,j){let $=[],Y=!0;for(let xe of Is(j)){let rn=xe.kind===0?ER(T,xe.fieldPath,T.endAt):wR(T,xe.fieldPath,T.endAt);$.push(rn.value),Y&&(Y=rn.inclusive)}return new fr($,Y)}(c,u),p=this.hn(u,c,h),g=this.hn(u,c,f),_=this.Pn(u,c,d),C=this.In(u.indexId,l,p,h.inclusive,g,f.inclusive,_);return m.forEach(C,M=>r.j(M,n.limit).next(T=>{T.forEach(j=>{let $=b.fromSegments(j.documentKey);o.has($)||(o=o.add($),a.push($))})}))}).next(()=>a)}return m.resolve(null)})}cn(e){let n=this.un.get(e);return n||(e.filters.length===0?n=[e]:n=mG(ve.create(e.filters,"and")).map(r=>oE(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.un.set(e,n),n)}In(e,n,r,i,s,o,a){let u=(n!=null?n.length:1)*Math.max(r.length,s.length),c=u/(n!=null?n.length:1),l=[];for(let d=0;d<u;++d){let h=n?this.Tn(n[d/c]):Wf,f=this.En(e,h,r[d%c],i),p=this.dn(e,h,s[d%c],o),g=a.map(_=>this.En(e,h,_,!0));l.push(...this.createRange(f,p,g))}return l}En(e,n,r,i){let s=new bs(e,b.empty(),n,r);return i?s:s.Jt()}dn(e,n,r,i){let s=new bs(e,b.empty(),n,r);return i?s.Jt():s}ln(e,n){let r=new Ep(n),i=n.collectionGroup!=null?n.collectionGroup:n.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.tn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,n){let r=2,i=this.cn(n);return m.forEach(i,s=>this.ln(e,s).next(o=>{o?r!==0&&o.fields.length<function(u){let c=new Ce(qe.comparator),l=!1;for(let d of u.filters)for(let h of d.getFlattenedFilters())h.field.isKeyField()||(h.op==="array-contains"||h.op==="array-contains-any"?l=!0:c=c.add(h.field));for(let d of u.orderBy)d.field.isKeyField()||(c=c.add(d.field));return c.size+(l?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(n)&&i.length>1&&r===2?1:r)}An(e,n){let r=new Ts;for(let i of Is(e)){let s=n.data.field(i.fieldPath);if(s==null)return null;let o=r.Ht(i.kind);kr.bt.Pt(s,o)}return r.Wt()}Tn(e){let n=new Ts;return kr.bt.Pt(e,n.Ht(0)),n.Wt()}Rn(e,n){let r=new Ts;return kr.bt.Pt(Ms(this.databaseId,n),r.Ht(function(s){let o=Is(s);return o.length===0?0:o[o.length-1].kind}(e))),r.Wt()}Pn(e,n,r){if(r===null)return[];let i=[];i.push(new Ts);let s=0;for(let o of Is(e)){let a=r[s++];for(let u of i)if(this.Vn(n,o.fieldPath)&&il(a))i=this.mn(i,o,a);else{let c=u.Ht(o.kind);kr.bt.Pt(a,c)}}return this.fn(i)}hn(e,n,r){return this.Pn(e,n,r.position)}fn(e){let n=[];for(let r=0;r<e.length;++r)n[r]=e[r].Wt();return n}mn(e,n,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let u=new Ts;u.seed(a.Wt()),kr.bt.Pt(o,u.Ht(n.kind)),s.push(u)}return s}Vn(e,n){return!!e.filters.find(r=>r instanceof ae&&r.field.isEqual(n)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,n){let r=Hc(e),i=la(e);return(n?r.W("collectionGroupIndex",IDBKeyRange.bound(n,n)):r.W()).next(s=>{let o=[];return m.forEach(s,a=>i.get([a.indexId,this.uid]).next(u=>{o.push(function(l,d){let h=d?new Jc(d.sequenceNumber,new vn(Os(d.readTime),new b(ar(d.documentKey)),d.largestBatchId)):Jc.empty(),f=l.fields.map(([p,g])=>new _a(qe.fromServerFormat(p),g));return new Ia(l.indexId,l.collectionGroup,f,h)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(n=>n.length===0?null:(n.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:K(r.collectionGroup,i.collectionGroup)}),n[0].collectionGroup))}updateCollectionGroup(e,n,r){let i=Hc(e),s=la(e);return this.gn(e).next(o=>i.W("collectionGroupIndex",IDBKeyRange.bound(n,n)).next(a=>m.forEach(a,u=>s.put(OR(u.indexId,this.uid,o,r)))))}updateIndexEntries(e,n){let r=new Map;return m.forEach(n,(i,s)=>{let o=r.get(i.collectionGroup);return(o?m.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),m.forEach(a,u=>this.pn(e,i,u).next(c=>{let l=this.yn(s,u);return c.isEqual(l)?m.resolve():this.wn(e,s,u,c,l)}))))})}Sn(e,n,r,i){return ca(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Rn(r,n.key),documentKey:n.key.path.toArray()})}bn(e,n,r,i){return ca(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Rn(r,n.key),n.key.path.toArray()])}pn(e,n,r){let i=ca(e),s=new Ce(pi);return i.Y({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.Rn(r,n)])},(o,a)=>{s=s.add(new bs(r.indexId,n,a.arrayValue,a.directionalValue))}).next(()=>s)}yn(e,n){let r=new Ce(pi),i=this.An(n,e);if(i==null)return r;let s=Hw(n);if(s!=null){let o=e.data.field(s.fieldPath);if(il(o))for(let a of o.arrayValue.values||[])r=r.add(new bs(n.indexId,e.key,this.Tn(a),i))}else r=r.add(new bs(n.indexId,e.key,Wf,i));return r}wn(e,n,r,i,s){E("IndexedDbIndexManager","Updating index entries for document '%s'",n.key);let o=[];return function(u,c,l,d,h){let f=u.getIterator(),p=c.getIterator(),g=ua(f),_=ua(p);for(;g||_;){let C=!1,M=!1;if(g&&_){let T=l(g,_);T<0?M=!0:T>0&&(C=!0)}else g!=null?M=!0:C=!0;C?(d(_),_=ua(p)):M?(h(g),g=ua(f)):(g=ua(f),_=ua(p))}}(i,s,pi,a=>{o.push(this.Sn(e,n,r,a))},a=>{o.push(this.bn(e,n,r,a))}),m.waitFor(o)}gn(e){let n=1;return la(e).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),n=i.sequenceNumber+1}).next(()=>n)}createRange(e,n,r){r=r.sort((o,a)=>pi(o,a)).filter((o,a,u)=>!a||pi(o,u[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=pi(o,e),u=pi(o,n);if(a===0)i[0]=e.Jt();else if(a>0&&u<0)i.push(o),i.push(o.Jt());else if(u>0)break}i.push(n);let s=[];for(let o=0;o<i.length;o+=2){if(this.Dn(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Wf,[]],u=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Wf,[]];s.push(IDBKeyRange.bound(a,u))}return s}Dn(e,n){return pi(e,n)>0}getMinOffsetFromCollectionGroup(e,n){return this.getFieldIndexes(e,n).next($R)}getMinOffset(e,n){return m.mapArray(this.cn(n),r=>this.ln(e,r).next(i=>i||N())).next($R)}};function BR(t){return dt(t,"collectionParents")}function ca(t){return dt(t,"indexEntries")}function Hc(t){return dt(t,"indexConfiguration")}function la(t){return dt(t,"indexState")}function $R(t){O(t.length!==0);let e=t[0].indexState.offset,n=e.largestBatchId;for(let r=1;r<t.length;r++){let i=t[r].indexState.offset;kI(i,e)<0&&(e=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new vn(e.readTime,e.documentKey,n)}var HR={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},yn=class t{constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function aP(t,e,n){let r=t.store("mutations"),i=t.store("documentMutations"),s=[],o=IDBKeyRange.only(n.batchId),a=0,u=r.Y({range:o},(l,d,h)=>(a++,h.delete()));s.push(u.next(()=>{O(a===1)}));let c=[];for(let l of n.mutations){let d=pN(e,l.key.path,n.batchId);s.push(i.delete(d)),c.push(l.key)}return m.waitFor(s).next(()=>c)}function Cp(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw N();e=t.noDocument}return JSON.stringify(e).length}yn.DEFAULT_COLLECTION_PERCENTILE=10,yn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,yn.DEFAULT=new yn(41943040,yn.DEFAULT_COLLECTION_PERCENTILE,yn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),yn.DISABLED=new yn(-1,0,0);var Dp=class t{constructor(e,n,r,i){this.userId=e,this.serializer=n,this.indexManager=r,this.referenceDelegate=i,this.Cn={}}static lt(e,n,r,i){O(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new t(s,n,r,i)}checkEmpty(e){let n=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return gi(e).Y({index:"userMutationsIndex",range:r},(i,s,o)=>{n=!1,o.done()}).next(()=>n)}addMutationBatch(e,n,r,i){let s=ma(e),o=gi(e);return o.add({}).next(a=>{O(typeof a=="number");let u=new ol(a,n,r,i),c=function(f,p,g){let _=g.baseMutations.map(M=>dl(f.ct,M)),C=g.mutations.map(M=>dl(f.ct,M));return{userId:p,batchId:g.batchId,localWriteTimeMs:g.localWriteTime.toMillis(),baseMutations:_,mutations:C}}(this.serializer,this.userId,u),l=[],d=new Ce((h,f)=>K(h.canonicalString(),f.canonicalString()));for(let h of i){let f=pN(this.userId,h.key.path,a);d=d.add(h.key.path.popLast()),l.push(o.put(c)),l.push(s.put(f,C4))}return d.forEach(h=>{l.push(this.indexManager.addToCollectionParentIndex(e,h))}),e.addOnCommittedListener(()=>{this.Cn[a]=u.keys()}),m.waitFor(l).next(()=>u)})}lookupMutationBatch(e,n){return gi(e).get(n).next(r=>r?(O(r.userId===this.userId),Ds(this.serializer,r)):null)}vn(e,n){return this.Cn[n]?m.resolve(this.Cn[n]):this.lookupMutationBatch(e,n).next(r=>{if(r){let i=r.keys();return this.Cn[n]=i,i}return null})}getNextMutationBatchAfterBatchId(e,n){let r=n+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return gi(e).Y({index:"userMutationsIndex",range:i},(o,a,u)=>{a.userId===this.userId&&(O(a.batchId>=r),s=Ds(this.serializer,a)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let n=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return gi(e).Y({index:"userMutationsIndex",range:n,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return gi(e).W("userMutationsIndex",n).next(r=>r.map(i=>Ds(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,n){let r=Zf(this.userId,n.path),i=IDBKeyRange.lowerBound(r),s=[];return ma(e).Y({range:i},(o,a,u)=>{let[c,l,d]=o,h=ar(l);if(c===this.userId&&n.path.isEqual(h))return gi(e).get(d).next(f=>{if(!f)throw N();O(f.userId===this.userId),s.push(Ds(this.serializer,f))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new Ce(K),i=[];return n.forEach(s=>{let o=Zf(this.userId,s.path),a=IDBKeyRange.lowerBound(o),u=ma(e).Y({range:a},(c,l,d)=>{let[h,f,p]=c,g=ar(f);h===this.userId&&s.path.isEqual(g)?r=r.add(p):d.done()});i.push(u)}),m.waitFor(i).next(()=>this.Fn(e,r))}getAllMutationBatchesAffectingQuery(e,n){let r=n.path,i=r.length+1,s=Zf(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new Ce(K);return ma(e).Y({range:o},(u,c,l)=>{let[d,h,f]=u,p=ar(h);d===this.userId&&r.isPrefixOf(p)?p.length===i&&(a=a.add(f)):l.done()}).next(()=>this.Fn(e,a))}Fn(e,n){let r=[],i=[];return n.forEach(s=>{i.push(gi(e).get(s).next(o=>{if(o===null)throw N();O(o.userId===this.userId),r.push(Ds(this.serializer,o))}))}),m.waitFor(i).next(()=>r)}removeMutationBatch(e,n){return aP(e.ae,this.userId,n).next(r=>(e.addOnCommittedListener(()=>{this.Mn(n.batchId)}),m.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Mn(e){delete this.Cn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(n=>{if(!n)return m.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return ma(e).Y({range:r},(s,o,a)=>{if(s[0]===this.userId){let u=ar(s[1]);i.push(u)}else a.done()}).next(()=>{O(i.length===0)})})}containsKey(e,n){return uP(e,this.userId,n)}xn(e){return cP(e).get(this.userId).next(n=>n||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function uP(t,e,n){let r=Zf(e,n.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return ma(t).Y({range:s,J:!0},(a,u,c)=>{let[l,d,h]=a;l===e&&d===i&&(o=!0),c.done()}).next(()=>o)}function gi(t){return dt(t,"mutations")}function ma(t){return dt(t,"documentMutations")}function cP(t){return dt(t,"mutationQueues")}var xa=class t{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new t(0)}static Bn(){return new t(-1)}};var SE=class{constructor(e,n){this.referenceDelegate=e,this.serializer=n}allocateTargetId(e){return this.Ln(e).next(n=>{let r=new xa(n.highestTargetId);return n.highestTargetId=r.next(),this.kn(e,n).next(()=>n.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Ln(e).next(n=>L.fromTimestamp(new Oe(n.lastRemoteSnapshotVersion.seconds,n.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Ln(e).next(n=>n.highestListenSequenceNumber)}setTargetsMetadata(e,n,r){return this.Ln(e).next(i=>(i.highestListenSequenceNumber=n,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),n>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=n),this.kn(e,i)))}addTargetData(e,n){return this.qn(e,n).next(()=>this.Ln(e).next(r=>(r.targetCount+=1,this.Qn(n,r),this.kn(e,r))))}updateTargetData(e,n){return this.qn(e,n)}removeTargetData(e,n){return this.removeMatchingKeysForTargetId(e,n.targetId).next(()=>da(e).delete(n.targetId)).next(()=>this.Ln(e)).next(r=>(O(r.targetCount>0),r.targetCount-=1,this.kn(e,r)))}removeTargets(e,n,r){let i=0,s=[];return da(e).Y((o,a)=>{let u=Wc(a);u.sequenceNumber<=n&&r.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>m.waitFor(s)).next(()=>i)}forEachTarget(e,n){return da(e).Y((r,i)=>{let s=Wc(i);n(s)})}Ln(e){return qR(e).get("targetGlobalKey").next(n=>(O(n!==null),n))}kn(e,n){return qR(e).put("targetGlobalKey",n)}qn(e,n){return da(e).put(iP(this.serializer,n))}Qn(e,n){let r=!1;return e.targetId>n.highestTargetId&&(n.highestTargetId=e.targetId,r=!0),e.sequenceNumber>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Ln(e).next(n=>n.targetCount)}getTargetData(e,n){let r=Ns(n),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return da(e).Y({range:i,index:"queryTargetsIndex"},(o,a,u)=>{let c=Wc(a);Cl(n,c.target)&&(s=c,u.done())}).next(()=>s)}addMatchingKeys(e,n,r){let i=[],s=mi(e);return n.forEach(o=>{let a=Rt(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),m.waitFor(i)}removeMatchingKeys(e,n,r){let i=mi(e);return m.forEach(n,s=>{let o=Rt(s.path);return m.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,n){let r=mi(e),i=IDBKeyRange.bound([n],[n+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,n){let r=IDBKeyRange.bound([n],[n+1],!1,!0),i=mi(e),s=Z();return i.Y({range:r,J:!0},(o,a,u)=>{let c=ar(o[1]),l=new b(c);s=s.add(l)}).next(()=>s)}containsKey(e,n){let r=Rt(n.path),i=IDBKeyRange.bound([r],[cN(r)],!1,!0),s=0;return mi(e).Y({index:"documentTargetsIndex",J:!0,range:i},([o,a],u,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}_t(e,n){return da(e).get(n).next(r=>r?Wc(r):null)}};function da(t){return dt(t,"targets")}function qR(t){return dt(t,"targetGlobal")}function mi(t){return dt(t,"targetDocuments")}function GR([t,e],[n,r]){let i=K(t,n);return i===0?K(e,r):i}var AE=class{constructor(e){this.Kn=e,this.buffer=new Ce(GR),this.$n=0}Un(){return++this.$n}Wn(e){let n=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(n);else{let r=this.buffer.last();GR(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}},xE=class{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Gn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return this.Gn!==null}zn(e){E("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>v(this,null,function*(){this.Gn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(n){Ri(n)?E("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n):yield Mi(n)}yield this.zn(3e5)}))}},ME=class{constructor(e,n){this.jn=e,this.params=n}calculateTargetCount(e,n){return this.jn.Hn(e).next(r=>Math.floor(n/100*r))}nthSequenceNumber(e,n){if(n===0)return m.resolve(Zt._e);let r=new AE(n);return this.jn.forEachTarget(e,i=>r.Wn(i.sequenceNumber)).next(()=>this.jn.Jn(e,i=>r.Wn(i))).next(()=>r.maxValue)}removeTargets(e,n,r){return this.jn.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.jn.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(E("LruGarbageCollector","Garbage collection skipped; disabled"),m.resolve(HR)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(E("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),HR):this.Yn(e,n))}getCacheSize(e){return this.jn.getCacheSize(e)}Yn(e,n){let r,i,s,o,a,u,c,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(E("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),i=this.params.maximumSequenceNumbersToCollect):i=d,o=Date.now(),this.nthSequenceNumber(e,i))).next(d=>(r=d,a=Date.now(),this.removeTargets(e,r,n))).next(d=>(s=d,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(d=>(c=Date.now(),ha()<=on.DEBUG&&E("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-l}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(u-a)+`ms
	Removed ${d} documents in `+(c-u)+`ms
Total Duration: ${c-l}ms`),m.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:d})))}};function yG(t,e){return new ME(t,e)}var RE=class{constructor(e,n){this.db=e,this.garbageCollector=yG(this,n)}Hn(e){let n=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>n.next(i=>r+i))}Zn(e){let n=0;return this.Jn(e,r=>{n++}).next(()=>n)}forEachTarget(e,n){return this.db.getTargetCache().forEachTarget(e,n)}Jn(e,n){return this.Xn(e,(r,i)=>n(i))}addReference(e,n,r){return Kf(e,r)}removeReference(e,n,r){return Kf(e,r)}removeTargets(e,n,r){return this.db.getTargetCache().removeTargets(e,n,r)}markPotentiallyOrphaned(e,n){return Kf(e,n)}er(e,n){return function(i,s){let o=!1;return cP(i).Z(a=>uP(i,a,s).next(u=>(u&&(o=!0),m.resolve(!u)))).next(()=>o)}(e,n)}removeOrphanedDocuments(e,n){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.Xn(e,(o,a)=>{if(a<=n){let u=this.er(e,o).next(c=>{if(!c)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,L.min()),mi(e).delete(function(d){return[0,Rt(d.path)]}(o))))});i.push(u)}}).next(()=>m.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,n){let r=n.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,n){return Kf(e,n)}Xn(e,n){let r=mi(e),i,s=Zt._e;return r.Y({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{o===0?(s!==Zt._e&&n(new b(ar(i)),s),s=c,i=u):s=Zt._e}).next(()=>{s!==Zt._e&&n(new b(ar(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function Kf(t,e){return mi(t).put(function(r,i){return{targetId:0,path:Rt(r.path),sequenceNumber:i}}(e,t.currentSequenceNumber))}var Tp=class{constructor(){this.changes=new pr(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,tt.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();let r=this.changes.get(n);return r!==void 0?m.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var NE=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,n,r){return Es(e).put(r)}removeEntry(e,n,r){return Es(e).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],vp(o),a[a.length-1]]}(n,r))}updateMetadata(e,n){return this.getMetadata(e).next(r=>(r.byteSize+=n,this.tr(e,r)))}getEntry(e,n){let r=tt.newInvalidDocument(n);return Es(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(qc(n))},(i,s)=>{r=this.nr(n,s)}).next(()=>r)}rr(e,n){let r={size:0,document:tt.newInvalidDocument(n)};return Es(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(qc(n))},(i,s)=>{r={document:this.nr(n,s),size:Cp(s)}}).next(()=>r)}getEntries(e,n){let r=Ht();return this.ir(e,n,(i,s)=>{let o=this.nr(i,s);r=r.insert(i,o)}).next(()=>r)}sr(e,n){let r=Ht(),i=new Ae(b.comparator);return this.ir(e,n,(s,o)=>{let a=this.nr(s,o);r=r.insert(s,a),i=i.insert(s,Cp(o))}).next(()=>({documents:r,_r:i}))}ir(e,n,r){if(n.isEmpty())return m.resolve();let i=new Ce(KR);n.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound(qc(i.first()),qc(i.last())),o=i.getIterator(),a=o.getNext();return Es(e).Y({index:"documentKeyIndex",range:s},(u,c,l)=>{let d=b.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&KR(a,d)<0;)r(a,null),a=o.getNext();a&&a.isEqual(d)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?l.U(qc(a)):l.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,n,r,i,s){let o=n.path,a=[o.popLast().toArray(),o.lastSegment(),vp(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Es(e).W(IDBKeyRange.bound(a,u,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let l=Ht();for(let d of c){let h=this.nr(b.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);h.isFoundDocument()&&(Tl(n,h)||i.has(h.key))&&(l=l.insert(h.key,h))}return l})}getAllFromCollectionGroup(e,n,r,i){let s=Ht(),o=WR(n,r),a=WR(n,vn.max());return Es(e).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,l)=>{let d=this.nr(b.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(d.key,d),s.size===i&&l.done()}).next(()=>s)}newChangeBuffer(e){return new PE(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(n=>n.byteSize)}getMetadata(e){return zR(e).get("remoteDocumentGlobalKey").next(n=>(O(!!n),n))}tr(e,n){return zR(e).put("remoteDocumentGlobalKey",n)}nr(e,n){if(n){let r=pG(this.serializer,n);if(!(r.isNoDocument()&&r.version.isEqual(L.min())))return r}return tt.newInvalidDocument(e)}};function lP(t){return new NE(t)}var PE=class extends Tp{constructor(e,n){super(),this.ar=e,this.trackRemovals=n,this.ur=new pr(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let n=[],r=0,i=new Ce((s,o)=>K(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.ur.get(s);if(n.push(this.ar.removeEntry(e,s,a.readTime)),o.isValidDocument()){let u=PR(this.ar.serializer,o);i=i.add(s.path.popLast());let c=Cp(u);r+=c-a.size,n.push(this.ar.addEntry(e,s,u))}else if(r-=a.size,this.trackRemovals){let u=PR(this.ar.serializer,o.convertToNoDocument(L.min()));n.push(this.ar.addEntry(e,s,u))}}),i.forEach(s=>{n.push(this.ar.indexManager.addToCollectionParentIndex(e,s))}),n.push(this.ar.updateMetadata(e,r)),m.waitFor(n)}getFromCache(e,n){return this.ar.rr(e,n).next(r=>(this.ur.set(n,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,n){return this.ar.sr(e,n).next(({documents:r,_r:i})=>(i.forEach((s,o)=>{this.ur.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function zR(t){return dt(t,"remoteDocumentGlobal")}function Es(t){return dt(t,"remoteDocumentsV14")}function qc(t){let e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function WR(t,e){let n=e.documentKey.path.toArray();return[t,vp(e.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function KR(t,e){let n=t.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<n.length-2&&s<r.length-2;++s)if(i=K(n[s],r[s]),i)return i;return i=K(n.length,r.length),i||(i=K(n[n.length-2],r[r.length-2]),i||K(n[n.length-1],r[r.length-1]))}var kE=class{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}};var bp=class{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,n))).next(i=>(r!==null&&Yc(r.mutation,i,Xt.empty(),Oe.now()),i))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,Z()).next(()=>r))}getLocalViewOfDocuments(e,n,r=Z()){let i=ur();return this.populateOverlays(e,i,n).next(()=>this.computeViews(e,n,i,r).next(s=>{let o=zc();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){let r=ur();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,Z()))}populateOverlays(e,n,r){let i=[];return r.forEach(s=>{n.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{n.set(o,a)})})}computeViews(e,n,r,i){let s=Ht(),o=Qc(),a=function(){return Qc()}();return n.forEach((u,c)=>{let l=r.get(c.key);i.has(c.key)&&(l===void 0||l.mutation instanceof Ln)?s=s.insert(c.key,c):l!==void 0?(o.set(c.key,l.mutation.getFieldMask()),Yc(l.mutation,c,l.mutation.getFieldMask(),Oe.now())):o.set(c.key,Xt.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((c,l)=>o.set(c,l)),n.forEach((c,l)=>{var d;return a.set(c,new kE(l,(d=o.get(c))!==null&&d!==void 0?d:null))}),a))}recalculateAndSaveOverlays(e,n){let r=Qc(),i=new Ae((o,a)=>o-a),s=Z();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(let a of o)a.keys().forEach(u=>{let c=n.get(u);if(c===null)return;let l=r.get(u)||Xt.empty();l=a.applyToLocalView(c,l),r.set(u,l);let d=(i.get(a.batchId)||Z()).add(u);i=i.insert(a.batchId,d)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let u=a.getNext(),c=u.key,l=u.value,d=PN();l.forEach(h=>{if(!s.has(h)){let f=BN(n.get(h),r.get(h));f!==null&&d.set(h,f),s=s.add(h)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,d))}return m.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,i){return function(o){return b.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):LI(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-s.size):m.resolve(ur()),a=-1,u=s;return o.next(c=>m.forEach(c,(l,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),s.get(l)?m.resolve():this.remoteDocumentCache.getEntry(e,l).next(h=>{u=u.insert(l,h)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,u,c,Z())).next(l=>({batchId:a,changes:NN(l)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new b(n)).next(r=>{let i=zc();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){let s=n.collectionGroup,o=zc();return this.indexManager.getCollectionParents(e,s).next(a=>m.forEach(a,u=>{let c=function(d,h){return new Vn(h,null,d.explicitOrderBy.slice(),d.filters.slice(),d.limit,d.limitType,d.startAt,d.endAt)}(n,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(l=>{l.forEach((d,h)=>{o=o.insert(d,h)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,n,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,s,i))).next(o=>{s.forEach((u,c)=>{let l=c.getKey();o.get(l)===null&&(o=o.insert(l,tt.newInvalidDocument(l)))});let a=zc();return o.forEach((u,c)=>{let l=s.get(u);l!==void 0&&Yc(l.mutation,c,Xt.empty(),Oe.now()),Tl(n,c)&&(a=a.insert(u,c))}),a})}};var OE=class{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,n){return m.resolve(this.cr.get(n))}saveBundleMetadata(e,n){return this.cr.set(n.id,function(i){return{id:i.id,version:i.version,createTime:Ge(i.createTime)}}(n)),m.resolve()}getNamedQuery(e,n){return m.resolve(this.lr.get(n))}saveNamedQuery(e,n){return this.lr.set(n.name,function(i){return{name:i.name,query:BI(i.bundledQuery),readTime:Ge(i.readTime)}}(n)),m.resolve()}};var FE=class{constructor(){this.overlays=new Ae(b.comparator),this.hr=new Map}getOverlay(e,n){return m.resolve(this.overlays.get(n))}getOverlays(e,n){let r=ur();return m.forEach(n,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((i,s)=>{this.ht(e,n,s)}),m.resolve()}removeOverlaysForBatchId(e,n,r){let i=this.hr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(r)),m.resolve()}getOverlaysForCollection(e,n,r){let i=ur(),s=n.length+1,o=new b(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let u=a.getNext().value,c=u.getKey();if(!n.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return m.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let s=new Ae((c,l)=>c-l),o=this.overlays.getIterator();for(;o.hasNext();){let c=o.getNext().value;if(c.getKey().getCollectionGroup()===n&&c.largestBatchId>r){let l=s.get(c.largestBatchId);l===null&&(l=ur(),s=s.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}let a=ur(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=i)););return m.resolve(a)}ht(e,n,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.hr.get(i.largestBatchId).delete(r.key);this.hr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new al(n,r));let s=this.hr.get(n);s===void 0&&(s=Z(),this.hr.set(n,s)),this.hr.set(n,s.add(r.key))}};var fl=class{constructor(){this.Pr=new Ce(Xe.Ir),this.Tr=new Ce(Xe.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,n){let r=new Xe(e,n);this.Pr=this.Pr.add(r),this.Tr=this.Tr.add(r)}dr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Ar(new Xe(e,n))}Rr(e,n){e.forEach(r=>this.removeReference(r,n))}Vr(e){let n=new b(new le([])),r=new Xe(n,e),i=new Xe(n,e+1),s=[];return this.Tr.forEachInRange([r,i],o=>{this.Ar(o),s.push(o.key)}),s}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){let n=new b(new le([])),r=new Xe(n,e),i=new Xe(n,e+1),s=Z();return this.Tr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let n=new Xe(e,0),r=this.Pr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}},Xe=class{constructor(e,n){this.key=e,this.pr=n}static Ir(e,n){return b.comparator(e.key,n.key)||K(e.pr,n.pr)}static Er(e,n){return K(e.pr,n.pr)||b.comparator(e.key,n.key)}};var VE=class{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.yr=1,this.wr=new Ce(Xe.Ir)}checkEmpty(e){return m.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){let s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new ol(s,n,r,i);this.mutationQueue.push(o);for(let a of i)this.wr=this.wr.add(new Xe(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return m.resolve(o)}lookupMutationBatch(e,n){return m.resolve(this.Sr(n))}getNextMutationBatchAfterBatchId(e,n){let r=n+1,i=this.br(r),s=i<0?0:i;return m.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return m.resolve(this.mutationQueue.length===0?-1:this.yr-1)}getAllMutationBatches(e){return m.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){let r=new Xe(n,0),i=new Xe(n,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([r,i],o=>{let a=this.Sr(o.pr);s.push(a)}),m.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new Ce(K);return n.forEach(i=>{let s=new Xe(i,0),o=new Xe(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,o],a=>{r=r.add(a.pr)})}),m.resolve(this.Dr(r))}getAllMutationBatchesAffectingQuery(e,n){let r=n.path,i=r.length+1,s=r;b.isDocumentKey(s)||(s=s.child(""));let o=new Xe(new b(s),0),a=new Ce(K);return this.wr.forEachWhile(u=>{let c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.pr)),!0)},o),m.resolve(this.Dr(a))}Dr(e){let n=[];return e.forEach(r=>{let i=this.Sr(r);i!==null&&n.push(i)}),n}removeMutationBatch(e,n){O(this.Cr(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.wr;return m.forEach(n.mutations,i=>{let s=new Xe(i.key,n.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.wr=r})}Mn(e){}containsKey(e,n){let r=new Xe(n,0),i=this.wr.firstAfterOrEqual(r);return m.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,m.resolve()}Cr(e,n){return this.br(e)}br(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Sr(e){let n=this.br(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}};var LE=class{constructor(e){this.vr=e,this.docs=function(){return new Ae(b.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){let r=n.key,i=this.docs.get(r),s=i?i.size:0,o=this.vr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){let r=this.docs.get(n);return m.resolve(r?r.document.mutableCopy():tt.newInvalidDocument(n))}getEntries(e,n){let r=Ht();return n.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():tt.newInvalidDocument(i))}),m.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let s=Ht(),o=n.path,a=new b(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){let{key:c,value:{document:l}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||kI(dN(l),r)<=0||(i.has(l.key)||Tl(n,l))&&(s=s.insert(l.key,l.mutableCopy()))}return m.resolve(s)}getAllFromCollectionGroup(e,n,r,i){N()}Fr(e,n){return m.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new jE(this)}getSize(e){return m.resolve(this.size)}},jE=class extends Tp{constructor(e){super(),this.ar=e}applyChanges(e){let n=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?n.push(this.ar.addEntry(e,i)):this.ar.removeEntry(r)}),m.waitFor(n)}getFromCache(e,n){return this.ar.getEntry(e,n)}getAllFromCache(e,n){return this.ar.getEntries(e,n)}};var UE=class{constructor(e){this.persistence=e,this.Mr=new pr(n=>Ns(n),Cl),this.lastRemoteSnapshotVersion=L.min(),this.highestTargetId=0,this.Or=0,this.Nr=new fl,this.targetCount=0,this.Br=xa.Nn()}forEachTarget(e,n){return this.Mr.forEach((r,i)=>n(i)),m.resolve()}getLastRemoteSnapshotVersion(e){return m.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return m.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Br.next(),m.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.Or&&(this.Or=n),m.resolve()}qn(e){this.Mr.set(e.target,e);let n=e.targetId;n>this.highestTargetId&&(this.Br=new xa(n),this.highestTargetId=n),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,n){return this.qn(n),this.targetCount+=1,m.resolve()}updateTargetData(e,n){return this.qn(n),m.resolve()}removeTargetData(e,n){return this.Mr.delete(n.target),this.Nr.Vr(n.targetId),this.targetCount-=1,m.resolve()}removeTargets(e,n,r){let i=0,s=[];return this.Mr.forEach((o,a)=>{a.sequenceNumber<=n&&r.get(a.targetId)===null&&(this.Mr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),m.waitFor(s).next(()=>i)}getTargetCount(e){return m.resolve(this.targetCount)}getTargetData(e,n){let r=this.Mr.get(n)||null;return m.resolve(r)}addMatchingKeys(e,n,r){return this.Nr.dr(n,r),m.resolve()}removeMatchingKeys(e,n,r){this.Nr.Rr(n,r);let i=this.persistence.referenceDelegate,s=[];return i&&n.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),m.waitFor(s)}removeMatchingKeysForTargetId(e,n){return this.Nr.Vr(n),m.resolve()}getMatchingKeysForTargetId(e,n){let r=this.Nr.gr(n);return m.resolve(r)}containsKey(e,n){return m.resolve(this.Nr.containsKey(n))}};var Sp=class{constructor(e,n){this.Lr={},this.overlays={},this.kr=new Zt(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new UE(this),this.indexManager=new TE,this.remoteDocumentCache=function(i){return new LE(i)}(r=>this.referenceDelegate.Kr(r)),this.serializer=new _p(n),this.$r=new OE(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new FE,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.Lr[e.toKey()];return r||(r=new VE(n,this.referenceDelegate),this.Lr[e.toKey()]=r),r}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,n,r){E("MemoryPersistence","Starting transaction:",e);let i=new BE(this.kr.next());return this.referenceDelegate.Ur(),r(i).next(s=>this.referenceDelegate.Wr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gr(e,n){return m.or(Object.values(this.Lr).map(r=>()=>r.containsKey(e,n)))}},BE=class extends op{constructor(e){super(),this.currentSequenceNumber=e}},Ap=class t{constructor(e){this.persistence=e,this.zr=new fl,this.jr=null}static Hr(e){return new t(e)}get Jr(){if(this.jr)return this.jr;throw N()}addReference(e,n,r){return this.zr.addReference(r,n),this.Jr.delete(r.toString()),m.resolve()}removeReference(e,n,r){return this.zr.removeReference(r,n),this.Jr.add(r.toString()),m.resolve()}markPotentiallyOrphaned(e,n){return this.Jr.add(n.toString()),m.resolve()}removeTarget(e,n){this.zr.Vr(n.targetId).forEach(i=>this.Jr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(i=>{i.forEach(s=>this.Jr.add(s.toString()))}).next(()=>r.removeTargetData(e,n))}Ur(){this.jr=new Set}Wr(e){let n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return m.forEach(this.Jr,r=>{let i=b.fromPath(r);return this.Yr(e,i).next(s=>{s||n.removeEntry(i,L.min())})}).next(()=>(this.jr=null,n.apply(e)))}updateLimboDocument(e,n){return this.Yr(e,n).next(r=>{r?this.Jr.delete(n.toString()):this.Jr.add(n.toString())})}Kr(e){return 0}Yr(e,n){return m.or([()=>m.resolve(this.zr.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Gr(e,n)])}};var $E=class{constructor(e){this.serializer=e}N(e,n,r,i){let s=new ap("createOrUpgrade",n);r<1&&i>=1&&(function(u){u.createObjectStore("owner")}(e),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",dR,{unique:!0}),u.createObjectStore("documentMutations")}(e),QR(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=m.resolve();return r<3&&i>=3&&(r!==0&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),QR(e)),o=o.next(()=>function(u){let c=u.store("targetGlobal"),l={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:L.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",l)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(u,c){return c.store("mutations").W().next(l=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",dR,{unique:!0});let d=c.store("mutations"),h=l.map(f=>d.put(f));return m.waitFor(h)})}(e,s))),o=o.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.Xr(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.ei(s)))),r<7&&i>=7&&(o=o.next(()=>this.ti(s))),r<8&&i>=8&&(o=o.next(()=>this.ni(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.ri(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(u){let c=u.createObjectStore("documentOverlays",{keyPath:O4});c.createIndex("collectionPathOverlayIndex",F4,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",V4,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(u){let c=u.createObjectStore("remoteDocumentsV14",{keyPath:D4});c.createIndex("documentKeyIndex",T4),c.createIndex("collectionGroupIndex",b4)}(e)).next(()=>this.ii(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.si(e,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:R4}).createIndex("sequenceNumberIndex",N4,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:P4}).createIndex("documentKeyIndex",k4,{unique:!1})}(e))),o}ei(e){let n=0;return e.store("remoteDocuments").Y((r,i)=>{n+=Cp(i)}).next(()=>{let r={byteSize:n};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Xr(e){let n=e.store("mutationQueues"),r=e.store("mutations");return n.W().next(i=>m.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",o).next(a=>m.forEach(a,u=>{O(u.userId===s.userId);let c=Ds(this.serializer,u);return aP(e,s.userId,c).next(()=>{})}))}))}ti(e){let n=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return r.Y((o,a)=>{let u=new le(o),c=function(d){return[0,Rt(d)]}(u);s.push(n.get(c).next(l=>l?m.resolve():(d=>n.put({targetId:0,path:Rt(d),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>m.waitFor(s))})}ni(e,n){e.createObjectStore("collectionParents",{keyPath:M4});let r=n.store("collectionParents"),i=new hl,s=o=>{if(i.add(o)){let a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:Rt(u)})}};return n.store("remoteDocuments").Y({J:!0},(o,a)=>{let u=new le(o);return s(u.popLast())}).next(()=>n.store("documentMutations").Y({J:!0},([o,a,u],c)=>{let l=ar(a);return s(l.popLast())}))}ri(e){let n=e.store("targets");return n.Y((r,i)=>{let s=Wc(i),o=iP(this.serializer,s);return n.put(o)})}ii(e,n){let r=n.store("remoteDocuments"),i=[];return r.Y((s,o)=>{let a=n.store("remoteDocumentsV14"),u=function(d){return d.document?new b(le.fromString(d.document.name).popFirst(5)):d.noDocument?b.fromSegments(d.noDocument.path):d.unknownDocument?b.fromSegments(d.unknownDocument.path):N()}(o).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>m.waitFor(i))}si(e,n){let r=n.store("mutations"),i=lP(this.serializer),s=new Sp(Ap.Hr,this.serializer.ct);return r.W().next(o=>{let a=new Map;return o.forEach(u=>{var c;let l=(c=a.get(u.userId))!==null&&c!==void 0?c:Z();Ds(this.serializer,u).keys().forEach(d=>l=l.add(d)),a.set(u.userId,l)}),m.forEach(a,(u,c)=>{let l=new Je(c),d=wp.lt(this.serializer,l),h=s.getIndexManager(l),f=Dp.lt(l,this.serializer,h,s.referenceDelegate);return new bp(i,f,d,h).recalculateAndSaveOverlaysForDocumentKeys(new tl(n,Zt._e),u).next()})})}};function QR(t){t.createObjectStore("targetDocuments",{keyPath:A4}).createIndex("documentTargetsIndex",x4,{unique:!0}),t.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",S4,{unique:!0}),t.createObjectStore("targetGlobal")}var Pw="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",HE=class t{constructor(e,n,r,i,s,o,a,u,c,l,d=15){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.oi=s,this.window=o,this.document=a,this._i=c,this.ai=l,this.ui=d,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=h=>Promise.resolve(),!t.D())throw new w(y.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new RE(this,i),this.Ti=n+"main",this.serializer=new _p(u),this.Ei=new Fr(this.Ti,this.ui,new $E(this.serializer)),this.Qr=new SE(this.referenceDelegate,this.serializer),this.remoteDocumentCache=lP(this.serializer),this.$r=new _E,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,l===!1&&He("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new w(y.FAILED_PRECONDITION,Pw);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Qr.getHighestSequenceNumber(e))}).then(e=>{this.kr=new Zt(e,this._i)}).then(()=>{this.qr=!0}).catch(e=>(this.Ei&&this.Ei.close(),Promise.reject(e)))}fi(e){return this.Ii=n=>v(this,null,function*(){if(this.started)return e(n)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ei.L(n=>v(this,null,function*(){n.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget(()=>v(this,null,function*(){this.started&&(yield this.Ai())})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Qf(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.gi(e).next(n=>{n||(this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)))})}).next(()=>this.pi(e)).next(n=>this.isPrimary&&!n?this.yi(e).next(()=>!1):!!n&&this.wi(e).next(()=>!0))).catch(e=>{if(Ri(e))return E("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return E("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.oi.enqueueRetryable(()=>this.Ii(e)),this.isPrimary=e})}gi(e){return Gc(e).get("owner").next(n=>m.resolve(this.Si(n)))}bi(e){return Qf(e).delete(this.clientId)}Di(){return v(this,null,function*(){if(this.isPrimary&&!this.Ci(this.Pi,18e5)){this.Pi=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{let r=dt(n,"clientMetadata");return r.W().next(i=>{let s=this.vi(i,18e5),o=i.filter(a=>s.indexOf(a)===-1);return m.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.di)for(let n of e)this.di.removeItem(this.Fi(n.clientId))}})}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ai().then(()=>this.Di()).then(()=>this.mi()))}Si(e){return!!e&&e.ownerId===this.clientId}pi(e){return this.ai?m.resolve(!0):Gc(e).get("owner").next(n=>{if(n!==null&&this.Ci(n.leaseTimestampMs,5e3)&&!this.Mi(n.ownerId)){if(this.Si(n)&&this.networkEnabled)return!0;if(!this.Si(n)){if(!n.allowTabSynchronization)throw new w(y.FAILED_PRECONDITION,Pw);return!1}}return!(!this.networkEnabled||!this.inForeground)||Qf(e).W().next(r=>this.vi(r,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(n=>(this.isPrimary!==n&&E("IndexedDbPersistence",`Client ${n?"is":"is not"} eligible for a primary lease.`),n))}shutdown(){return v(this,null,function*(){this.qr=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Oi(),this.Ni(),yield this.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let n=new tl(e,Zt._e);return this.yi(n).next(()=>this.bi(n))}),this.Ei.close(),this.Bi()})}vi(e,n){return e.filter(r=>this.Ci(r.updateTimeMs,n)&&!this.Mi(r.clientId))}Li(){return this.runTransaction("getActiveClients","readonly",e=>Qf(e).W().next(n=>this.vi(n,18e5).map(r=>r.clientId)))}get started(){return this.qr}getMutationQueue(e,n){return Dp.lt(e,this.serializer,n,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new bE(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return wp.lt(this.serializer,e)}getBundleCache(){return this.$r}runTransaction(e,n,r){E("IndexedDbPersistence","Starting transaction:",e);let i=n==="readonly"?"readonly":"readwrite",s=function(u){return u===15?j4:u===14?yN:u===13?mN:u===12?L4:u===11?gN:void N()}(this.ui),o;return this.Ei.runTransaction(e,i,s,a=>(o=new tl(a,this.kr?this.kr.next():Zt._e),n==="readwrite-primary"?this.gi(o).next(u=>!!u||this.pi(o)).next(u=>{if(!u)throw He(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)),new w(y.FAILED_PRECONDITION,hN);return r(o)}).next(u=>this.wi(o).next(()=>u)):this.ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}ki(e){return Gc(e).get("owner").next(n=>{if(n!==null&&this.Ci(n.leaseTimestampMs,5e3)&&!this.Mi(n.ownerId)&&!this.Si(n)&&!(this.ai||this.allowTabSynchronization&&n.allowTabSynchronization))throw new w(y.FAILED_PRECONDITION,Pw)})}wi(e){let n={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Gc(e).put("owner",n)}static D(){return Fr.D()}yi(e){let n=Gc(e);return n.get("owner").next(r=>this.Si(r)?(E("IndexedDbPersistence","Releasing primary lease."),n.delete("owner")):m.resolve())}Ci(e,n){let r=Date.now();return!(e<r-n)&&(!(e>r)||(He(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Ri(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.li=()=>{this.oi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ai()))},this.document.addEventListener("visibilitychange",this.li),this.inForeground=this.document.visibilityState==="visible")}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.ci=()=>{this.xi();let n=/(?:Version|Mobile)\/1[456]/;fm()&&(navigator.appVersion.match(n)||navigator.userAgent.match(n))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(e){var n;try{let r=((n=this.di)===null||n===void 0?void 0:n.getItem(this.Fi(e)))!==null;return E("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return He("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){He("Failed to set zombie client id.",e)}}Bi(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch{}}Fi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function Gc(t){return dt(t,"owner")}function Qf(t){return dt(t,"clientMetadata")}function HI(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var qE=class t{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.qi=r,this.Qi=i}static Ki(e,n){let r=Z(),i=Z();for(let s of n.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new t(e,n.fromCache,r,i)}};var GE=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var xp=class{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){return fm()?8:Fr.v(du())>0?6:4}()}initialize(e,n){this.zi=e,this.indexManager=n,this.$i=!0}getDocumentsMatchingQuery(e,n,r,i){let s={result:null};return this.ji(e,n).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Hi(e,n,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new GE;return this.Ji(e,n,o).next(a=>{if(s.result=a,this.Ui)return this.Yi(e,n,o,a.size)})}).next(()=>s.result)}Yi(e,n,r,i){return r.documentReadCount<this.Wi?(ha()<=on.DEBUG&&E("QueryEngine","SDK will not create cache indexes for query:",fa(n),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),m.resolve()):(ha()<=on.DEBUG&&E("QueryEngine","Query:",fa(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Gi*i?(ha()<=on.DEBUG&&E("QueryEngine","The SDK decides to create cache indexes for query:",fa(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Nt(n))):m.resolve())}ji(e,n){if(IR(n))return m.resolve(null);let r=Nt(n);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(n.limit!==null&&i===1&&(n=pp(n,null,"F"),r=Nt(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=Z(...s);return this.zi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{let c=this.Zi(n,a);return this.Xi(n,c,o,u.readTime)?this.ji(e,pp(n,null,"F")):this.es(e,c,n,u)}))})))}Hi(e,n,r,i){return IR(n)||i.isEqual(L.min())?m.resolve(null):this.zi.getDocuments(e,r).next(s=>{let o=this.Zi(n,s);return this.Xi(n,o,r,i)?m.resolve(null):(ha()<=on.DEBUG&&E("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),fa(n)),this.es(e,o,n,lN(i,-1)).next(a=>a))})}Zi(e,n){let r=new Ce(MN(e));return n.forEach((i,s)=>{Tl(e,s)&&(r=r.add(s))}),r}Xi(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;let s=e.limitType==="F"?n.last():n.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(e,n,r){return ha()<=on.DEBUG&&E("QueryEngine","Using full collection scan to execute query:",fa(n)),this.zi.getDocumentsMatchingQuery(e,n,vn.min(),r)}es(e,n,r,i){return this.zi.getDocumentsMatchingQuery(e,r,i).next(s=>(n.forEach(o=>{s=s.insert(o.key,o)}),s))}};var zE=class{constructor(e,n,r,i){this.persistence=e,this.ts=n,this.serializer=i,this.ns=new Ae(K),this.rs=new pr(s=>Ns(s),Cl),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(r)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new bp(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.ns))}};function dP(t,e,n,r){return new zE(t,e,n,r)}function hP(t,e){return v(this,null,function*(){let n=A(t);return yield n.persistence.runTransaction("Handle user change","readonly",r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,n._s(e),n.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],u=Z();for(let c of i){o.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}for(let c of s){a.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}return n.localDocuments.getDocuments(r,u).next(c=>({us:c,removedBatchIds:o,addedBatchIds:a}))})})})}function _G(t,e){let n=A(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=n.os.newChangeBuffer({trackRemovals:!0});return function(a,u,c,l){let d=c.batch,h=d.keys(),f=m.resolve();return h.forEach(p=>{f=f.next(()=>l.getEntry(u,p)).next(g=>{let _=c.docVersions.get(p);O(_!==null),g.version.compareTo(_)<0&&(d.applyToRemoteDocument(g,c),g.isValidDocument()&&(g.setReadTime(c.commitVersion),l.addEntry(g)))})}),f.next(()=>a.mutationQueue.removeMutationBatch(u,d))}(n,r,e,s).next(()=>s.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=Z();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(e))).next(()=>n.localDocuments.getDocuments(r,i))})}function fP(t){let e=A(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Qr.getLastRemoteSnapshotVersion(n))}function vG(t,e){let n=A(t),r=e.snapshotVersion,i=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=n.os.newChangeBuffer({trackRemovals:!0});i=n.ns;let a=[];e.targetChanges.forEach((l,d)=>{let h=i.get(d);if(!h)return;a.push(n.Qr.removeMatchingKeys(s,l.removedDocuments,d).next(()=>n.Qr.addMatchingKeys(s,l.addedDocuments,d)));let f=h.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(d)!==null?f=f.withResumeToken(lt.EMPTY_BYTE_STRING,L.min()).withLastLimboFreeSnapshotVersion(L.min()):l.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(l.resumeToken,r)),i=i.insert(d,f),function(g,_,C){return g.resumeToken.approximateByteSize()===0||_.snapshotVersion.toMicroseconds()-g.snapshotVersion.toMicroseconds()>=3e8?!0:C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0}(h,f,l)&&a.push(n.Qr.updateTargetData(s,f))});let u=Ht(),c=Z();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(pP(s,o,e.documentUpdates).next(l=>{u=l.cs,c=l.ls})),!r.isEqual(L.min())){let l=n.Qr.getLastRemoteSnapshotVersion(s).next(d=>n.Qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(l)}return m.waitFor(a).next(()=>o.apply(s)).next(()=>n.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(n.ns=i,s))}function pP(t,e,n){let r=Z(),i=Z();return n.forEach(s=>r=r.add(s)),e.getEntries(t,r).next(s=>{let o=Ht();return n.forEach((a,u)=>{let c=s.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(L.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||u.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):E("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{cs:o,ls:i}})}function wG(t,e){let n=A(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Ma(t,e){let n=A(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return n.Qr.getTargetData(r,e).next(s=>s?(i=s,m.resolve(i)):n.Qr.allocateTargetId(r).next(o=>(i=new Aa(e,o,"TargetPurposeListen",r.currentSequenceNumber),n.Qr.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=n.ns.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.ns=n.ns.insert(r.targetId,r),n.rs.set(e,r.targetId)),r})}function Ra(t,e,n){return v(this,null,function*(){let r=A(t),i=r.ns.get(e),s=n?"readwrite":"readwrite-primary";try{n||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Ri(o))throw o;E("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ns=r.ns.remove(e),r.rs.delete(i.target)})}function Mp(t,e,n){let r=A(t),i=L.min(),s=Z();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,l){let d=A(u),h=d.rs.get(l);return h!==void 0?m.resolve(d.ns.get(h)):d.Qr.getTargetData(c,l)}(r,o,Nt(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.ts.getDocumentsMatchingQuery(o,e,n?i:L.min(),n?s:Z())).next(a=>(yP(r,xN(e),a),{documents:a,hs:s})))}function gP(t,e){let n=A(t),r=A(n.Qr),i=n.ns.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",s=>r._t(s,e).next(o=>o?o.target:null))}function mP(t,e){let n=A(t),r=n.ss.get(e)||L.min();return n.persistence.runTransaction("Get new document changes","readonly",i=>n.os.getAllFromCollectionGroup(i,e,lN(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(yP(n,e,i),i))}function yP(t,e,n){let r=t.ss.get(e)||L.min();n.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),t.ss.set(e,r)}function EG(t,e,n,r){return v(this,null,function*(){let i=A(t),s=Z(),o=Ht();for(let c of n){let l=e.Ps(c.metadata.name);c.document&&(s=s.add(l));let d=e.Is(c);d.setReadTime(e.Ts(c.metadata.readTime)),o=o.insert(l,d)}let a=i.os.newChangeBuffer({trackRemovals:!0}),u=yield Ma(i,function(l){return Nt(La(le.fromString(`__bundle__/docs/${l}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>pP(c,a,o).next(l=>(a.apply(c),l)).next(l=>i.Qr.removeMatchingKeysForTargetId(c,u.targetId).next(()=>i.Qr.addMatchingKeys(c,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,l.cs,l.ls)).next(()=>l.cs)))})}function IG(r,i){return v(this,arguments,function*(t,e,n=Z()){let s=yield Ma(t,Nt(BI(e.bundledQuery))),o=A(t);return o.persistence.runTransaction("Save named query","readwrite",a=>{let u=Ge(e.readTime);if(s.snapshotVersion.compareTo(u)>=0)return o.$r.saveNamedQuery(a,e);let c=s.withResumeToken(lt.EMPTY_BYTE_STRING,u);return o.ns=o.ns.insert(c.targetId,c),o.Qr.updateTargetData(a,c).next(()=>o.Qr.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.Qr.addMatchingKeys(a,n,s.targetId)).next(()=>o.$r.saveNamedQuery(a,e))})})}function YR(t,e){return`firestore_clients_${t}_${e}`}function ZR(t,e,n){let r=`firestore_mutations_${t}_${n}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function kw(t,e){return`firestore_targets_${t}_${e}`}var Rp=class t{constructor(e,n,r,i){this.user=e,this.batchId=n,this.state=r,this.error=i}static Es(e,n,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new w(i.error.code,i.error.message))),o?new t(e,n,i.state,s):(He("SharedClientState",`Failed to parse mutation state for ID '${n}': ${r}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Zc=class t{constructor(e,n,r){this.targetId=e,this.state=n,this.error=r}static Es(e,n){let r=JSON.parse(n),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new w(r.error.code,r.error.message))),s?new t(e,r.state,i):(He("SharedClientState",`Failed to parse target state for ID '${e}': ${n}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Np=class t{constructor(e,n){this.clientId=e,this.activeTargetIds=n}static Es(e,n){let r=JSON.parse(n),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=jI();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=fN(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new t(e,s):(He("SharedClientState",`Failed to parse client data for instance '${e}': ${n}`),null)}},WE=class t{constructor(e,n){this.clientId=e,this.onlineState=n}static Es(e){let n=JSON.parse(e);return typeof n=="object"&&["Unknown","Online","Offline"].indexOf(n.onlineState)!==-1&&typeof n.clientId=="string"?new t(n.clientId,n.onlineState):(He("SharedClientState",`Failed to parse online state: ${e}`),null)}},pl=class{constructor(){this.activeTargetIds=jI()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Xc=class{constructor(e,n,r,i,s){this.window=e,this.oi=n,this.persistenceKey=r,this.Vs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new Ae(K),this.started=!1,this.ys=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ws=YR(this.persistenceKey,this.Vs),this.Ss=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.ps=this.ps.insert(this.Vs,new pl),this.bs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.vs=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.Fs=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(e){return!(!e||!e.localStorage)}start(){return v(this,null,function*(){let e=yield this.syncEngine.Li();for(let r of e){if(r===this.Vs)continue;let i=this.getItem(YR(this.persistenceKey,r));if(i){let s=Np.Es(r,i);s&&(this.ps=this.ps.insert(s.clientId,s))}}this.Ms();let n=this.storage.getItem(this.vs);if(n){let r=this.xs(n);r&&this.Os(r)}for(let r of this.ys)this.gs(r);this.ys=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.Ss,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(e){let n=!1;return this.ps.forEach((r,i)=>{i.activeTargetIds.has(e)&&(n=!0)}),n}addPendingMutation(e){this.Bs(e,"pending")}updateMutationState(e,n,r){this.Bs(e,n,r),this.Ls(e)}addLocalQueryTarget(e){let n="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(kw(this.persistenceKey,e));if(r){let i=Zc.Es(e,r);i&&(n=i.state)}}return this.ks.As(e),this.Ms(),n}removeLocalQueryTarget(e){this.ks.Rs(e),this.Ms()}isLocalQueryTarget(e){return this.ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(kw(this.persistenceKey,e))}updateQueryState(e,n,r){this.qs(e,n,r)}handleUserChange(e,n,r){n.forEach(i=>{this.Ls(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Qs(e)}notifyBundleLoaded(e){this.Ks(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(e){let n=this.storage.getItem(e);return E("SharedClientState","READ",e,n),n}setItem(e,n){E("SharedClientState","SET",e,n),this.storage.setItem(e,n)}removeItem(e){E("SharedClientState","REMOVE",e),this.storage.removeItem(e)}gs(e){let n=e;if(n.storageArea===this.storage){if(E("SharedClientState","EVENT",n.key,n.newValue),n.key===this.ws)return void He("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable(()=>v(this,null,function*(){if(this.started){if(n.key!==null){if(this.bs.test(n.key)){if(n.newValue==null){let r=this.$s(n.key);return this.Us(r,null)}{let r=this.Ws(n.key,n.newValue);if(r)return this.Us(r.clientId,r)}}else if(this.Ds.test(n.key)){if(n.newValue!==null){let r=this.Gs(n.key,n.newValue);if(r)return this.zs(r)}}else if(this.Cs.test(n.key)){if(n.newValue!==null){let r=this.js(n.key,n.newValue);if(r)return this.Hs(r)}}else if(n.key===this.vs){if(n.newValue!==null){let r=this.xs(n.newValue);if(r)return this.Os(r)}}else if(n.key===this.Ss){let r=function(s){let o=Zt._e;if(s!=null)try{let a=JSON.parse(s);O(typeof a=="number"),o=a}catch(a){He("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(n.newValue);r!==Zt._e&&this.sequenceNumberHandler(r)}else if(n.key===this.Fs){let r=this.Js(n.newValue);yield Promise.all(r.map(i=>this.syncEngine.Ys(i)))}}}else this.ys.push(n)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Bs(e,n,r){let i=new Rp(this.currentUser,e,n,r),s=ZR(this.persistenceKey,this.currentUser,e);this.setItem(s,i.ds())}Ls(e){let n=ZR(this.persistenceKey,this.currentUser,e);this.removeItem(n)}Qs(e){let n={clientId:this.Vs,onlineState:e};this.storage.setItem(this.vs,JSON.stringify(n))}qs(e,n,r){let i=kw(this.persistenceKey,e),s=new Zc(e,n,r);this.setItem(i,s.ds())}Ks(e){let n=JSON.stringify(Array.from(e));this.setItem(this.Fs,n)}$s(e){let n=this.bs.exec(e);return n?n[1]:null}Ws(e,n){let r=this.$s(e);return Np.Es(r,n)}Gs(e,n){let r=this.Ds.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return Rp.Es(new Je(s),i,n)}js(e,n){let r=this.Cs.exec(e),i=Number(r[1]);return Zc.Es(i,n)}xs(e){return WE.Es(e)}Js(e){return JSON.parse(e)}zs(e){return v(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Zs(e.batchId,e.state,e.error);E("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Hs(e){return this.syncEngine.Xs(e.targetId,e.state,e.error)}Us(e,n){let r=n?this.ps.insert(e,n):this.ps.remove(e),i=this.Ns(this.ps),s=this.Ns(r),o=[],a=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||a.push(u)}),this.syncEngine.eo(o,a).then(()=>{this.ps=r})}Os(e){this.ps.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ns(e){let n=jI();return e.forEach((r,i)=>{n=n.unionWith(i.activeTargetIds)}),n}},Pp=class{constructor(){this.no=new pl,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,n,r){this.ro[e]=n}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new pl,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var KE=class{io(e){}shutdown(){}};var kp=class{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){E("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.uo)e(0)}ao(){E("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.uo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Yf=null;function Ow(){return Yf===null?Yf=function(){return 268435456+Math.round(2147483648*Math.random())}():Yf++,"0x"+Yf.toString(16)}var CG={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var QE=class{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}onMessage(e){this.Ao=e}close(){this.ho()}send(e){this.lo(e)}Ro(){this.Io()}Vo(e){this.Eo(e)}mo(e){this.Ao(e)}};var bt="WebChannelConnection",YE=class extends class{constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;let r=n.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.fo=r+"://"+n.host,this.po=`projects/${i}/databases/${s}`,this.yo=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get wo(){return!1}So(n,r,i,s,o){let a=Ow(),u=this.bo(n,r.toUriEncodedString());E("RestConnection",`Sending RPC '${n}' ${a}:`,u,i);let c={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(c,s,o),this.Co(n,u,c,i).then(l=>(E("RestConnection",`Received RPC '${n}' ${a}: `,l),l),l=>{throw _n("RestConnection",`RPC '${n}' ${a} failed with error: `,l,"url: ",u,"request:",i),l})}vo(n,r,i,s,o,a){return this.So(n,r,i,s,o)}Do(n,r,i){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Va}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>n[o]=s),i&&i.headers.forEach((s,o)=>n[o]=s)}bo(n,r){let i=CG[n];return`${this.fo}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Co(e,n,r,i){let s=Ow();return new Promise((o,a)=>{let u=new oR;u.setWithCredentials(!0),u.listenOnce(iR.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case zf.NO_ERROR:let l=u.getResponseJson();E(bt,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(l)),o(l);break;case zf.TIMEOUT:E(bt,`RPC '${e}' ${s} timed out`),a(new w(y.DEADLINE_EXCEEDED,"Request time out"));break;case zf.HTTP_ERROR:let d=u.getStatus();if(E(bt,`RPC '${e}' ${s} failed with status:`,d,"response text:",u.getResponseText()),d>0){let h=u.getResponseJson();Array.isArray(h)&&(h=h[0]);let f=h?.error;if(f&&f.status&&f.message){let p=function(_){let C=_.toLowerCase().replace(/_/g,"-");return Object.values(y).indexOf(C)>=0?C:y.UNKNOWN}(f.status);a(new w(p,f.message))}else a(new w(y.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new w(y.UNAVAILABLE,"Connection failed."));break;default:N()}}finally{E(bt,`RPC '${e}' ${s} completed.`)}});let c=JSON.stringify(i);E(bt,`RPC '${e}' ${s} sending request:`,i),u.send(n,"POST",c,r,15)})}Fo(e,n,r){let i=Ow(),s=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=nR(),a=rR(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Do(u.initMessageHeaders,n,r),u.encodeInitMessageHeaders=!0;let l=s.join("");E(bt,`Creating RPC '${e}' stream ${i}: ${l}`,u);let d=o.createWebChannel(l,u),h=!1,f=!1,p=new QE({lo:_=>{f?E(bt,`Not sending because RPC '${e}' stream ${i} is closed:`,_):(h||(E(bt,`Opening RPC '${e}' stream ${i} transport.`),d.open(),h=!0),E(bt,`RPC '${e}' stream ${i} sending:`,_),d.send(_))},ho:()=>d.close()}),g=(_,C,M)=>{_.listen(C,T=>{try{M(T)}catch(j){setTimeout(()=>{throw j},0)}})};return g(d,Bc.EventType.OPEN,()=>{f||E(bt,`RPC '${e}' stream ${i} transport opened.`)}),g(d,Bc.EventType.CLOSE,()=>{f||(f=!0,E(bt,`RPC '${e}' stream ${i} transport closed`),p.Vo())}),g(d,Bc.EventType.ERROR,_=>{f||(f=!0,_n(bt,`RPC '${e}' stream ${i} transport errored:`,_),p.Vo(new w(y.UNAVAILABLE,"The operation could not be completed")))}),g(d,Bc.EventType.MESSAGE,_=>{var C;if(!f){let M=_.data[0];O(!!M);let T=M,j=T.error||((C=T[0])===null||C===void 0?void 0:C.error);if(j){E(bt,`RPC '${e}' stream ${i} received error:`,j);let $=j.status,Y=function(lm){let AT=Ze[lm];if(AT!==void 0)return qN(AT)}($),xe=j.message;Y===void 0&&(Y=y.INTERNAL,xe="Unknown error status: "+$+" with message "+j.message),f=!0,p.Vo(new w(Y,xe)),d.close()}else E(bt,`RPC '${e}' stream ${i} received:`,M),p.mo(M)}}),g(a,sR.STAT_EVENT,_=>{_.stat===Rw.PROXY?E(bt,`RPC '${e}' stream ${i} detected buffering proxy`):_.stat===Rw.NOPROXY&&E(bt,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{p.Ro()},0),p}};function _P(){return typeof window<"u"?window:null}function tp(){return typeof document<"u"?document:null}function bl(t){return new fE(t,!0)}var gl=class{constructor(e,n,r=1e3,i=1.5,s=6e4){this.oi=e,this.timerId=n,this.Mo=r,this.xo=i,this.Oo=s,this.No=0,this.Bo=null,this.Lo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(e){this.cancel();let n=Math.floor(this.No+this.Qo()),r=Math.max(0,Date.now()-this.Lo),i=Math.max(0,n-r);i>0&&E("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.No} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.Bo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Lo=Date.now(),e())),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){this.Bo!==null&&(this.Bo.skipDelay(),this.Bo=null)}cancel(){this.Bo!==null&&(this.Bo.cancel(),this.Bo=null)}Qo(){return(Math.random()-.5)*this.No}};var Op=class{constructor(e,n,r,i,s,o,a,u){this.oi=e,this.$o=r,this.Uo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new gl(e,n)}Ho(){return this.state===1||this.state===5||this.Jo()}Jo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Yo()}stop(){return v(this,null,function*(){this.Ho()&&(yield this.close(0))})}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&this.Go===null&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,()=>this.e_()))}t_(e){this.n_(),this.stream.send(e)}e_(){return v(this,null,function*(){if(this.Jo())return this.close(0)})}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}close(e,n){return v(this,null,function*(){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,e!==4?this.jo.reset():n&&n.code===y.RESOURCE_EXHAUSTED?(He(n.toString()),He("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):n&&n.code===y.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.i_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.To(n)})}i_(){}auth(){this.state=1;let e=this.s_(this.Wo),n=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Wo===n&&this.o_(r,i)},r=>{e(()=>{let i=new w(y.UNKNOWN,"Fetching auth token failed: "+r.message);return this.__(i)})})}o_(e,n){let r=this.s_(this.Wo);this.stream=this.a_(e,n),this.stream.Po(()=>{r(()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,()=>(this.Jo()&&(this.state=3),Promise.resolve())),this.listener.Po()))}),this.stream.To(i=>{r(()=>this.__(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Yo(){this.state=5,this.jo.qo(()=>v(this,null,function*(){this.state=0,this.start()}))}__(e){return E("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}s_(e){return n=>{this.oi.enqueueAndForget(()=>this.Wo===e?n():(E("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},ZE=class extends Op{constructor(e,n,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,o),this.serializer=s}a_(e,n){return this.connection.Fo("Listen",e,n)}onMessage(e){this.jo.reset();let n=aG(this.serializer,e),r=function(s){if(!("targetChange"in s))return L.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?L.min():o.readTime?Ge(o.readTime):L.min()}(e);return this.listener.u_(n,r)}c_(e){let n={};n.database=mE(this.serializer),n.addTarget=function(s,o){let a,u=o.target;if(a=hp(u)?{documents:XN(s,u)}:{query:JN(s,u).ut},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=zN(s,o.resumeToken);let c=pE(s,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(L.min())>0){a.readTime=Sa(s,o.snapshotVersion.toTimestamp());let c=pE(s,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);let r=cG(this.serializer,e);r&&(n.labels=r),this.t_(n)}l_(e){let n={};n.database=mE(this.serializer),n.removeTarget=e,this.t_(n)}},XE=class extends Op{constructor(e,n,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,o),this.serializer=s,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(e,n){return this.connection.Fo("Write",e,n)}onMessage(e){if(O(!!e.streamToken),this.lastStreamToken=e.streamToken,this.h_){this.jo.reset();let n=uG(e.writeResults,e.commitTime),r=Ge(e.commitTime);return this.listener.T_(r,n)}return O(!e.writeResults||e.writeResults.length===0),this.h_=!0,this.listener.E_()}d_(){let e={};e.database=mE(this.serializer),this.t_(e)}I_(e){let n={streamToken:this.lastStreamToken,writes:e.map(r=>dl(this.serializer,r))};this.t_(n)}};var JE=class extends class{}{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.A_=!1}R_(){if(this.A_)throw new w(y.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,n,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.So(e,gE(n,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===y.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new w(y.UNKNOWN,s.toString())})}vo(e,n,r,i,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.vo(e,gE(n,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===y.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new w(y.UNKNOWN,o.toString())})}terminate(){this.A_=!0,this.connection.terminate()}};var eI=class{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){this.m_===0&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve())))}S_(e){this.state==="Online"?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.y_("Offline")))}set(e){this.b_(),this.m_=0,e==="Online"&&(this.g_=!1),this.y_(e)}y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}w_(e){let n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(He(n),this.g_=!1):E("OnlineStateTracker",n)}b_(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}};var tI=class{constructor(e,n,r,i,s){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=s,this.M_.io(o=>{r.enqueueAndForget(()=>v(this,null,function*(){Ni(this)&&(E("RemoteStore","Restarting streams for network reachability change."),yield function(u){return v(this,null,function*(){let c=A(u);c.v_.add(4),yield ja(c),c.x_.set("Unknown"),c.v_.delete(4),yield Sl(c)})}(this))}))}),this.x_=new eI(r,i)}};function Sl(t){return v(this,null,function*(){if(Ni(t))for(let e of t.F_)yield e(!0)})}function ja(t){return v(this,null,function*(){for(let e of t.F_)yield e(!1)})}function eg(t,e){let n=A(t);n.C_.has(e.targetId)||(n.C_.set(e.targetId,e),zI(n)?GI(n):Ba(n).Jo()&&qI(n,e))}function ml(t,e){let n=A(t),r=Ba(n);n.C_.delete(e),r.Jo()&&vP(n,e),n.C_.size===0&&(r.Jo()?r.Xo():Ni(n)&&n.x_.set("Unknown"))}function qI(t,e){if(t.O_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(L.min())>0){let n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Ba(t).c_(e)}function vP(t,e){t.O_.Oe(e),Ba(t).l_(e)}function GI(t){t.O_=new hE({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>t.C_.get(e)||null,nt:()=>t.datastore.serializer.databaseId}),Ba(t).start(),t.x_.p_()}function zI(t){return Ni(t)&&!Ba(t).Ho()&&t.C_.size>0}function Ni(t){return A(t).v_.size===0}function wP(t){t.O_=void 0}function DG(t){return v(this,null,function*(){t.C_.forEach((e,n)=>{qI(t,e)})})}function TG(t,e){return v(this,null,function*(){wP(t),zI(t)?(t.x_.S_(e),GI(t)):t.x_.set("Unknown")})}function bG(t,e,n){return v(this,null,function*(){if(t.x_.set("Online"),e instanceof mp&&e.state===2&&e.cause)try{yield function(i,s){return v(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.C_.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.C_.delete(a),i.O_.removeTarget(a))})}(t,e)}catch(r){E("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Fp(t,r)}else if(e instanceof wa?t.O_.$e(e):e instanceof gp?t.O_.Je(e):t.O_.Ge(e),!n.isEqual(L.min()))try{let r=yield fP(t.localStore);n.compareTo(r)>=0&&(yield function(s,o){let a=s.O_.it(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){let l=s.C_.get(c);l&&s.C_.set(c,l.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{let l=s.C_.get(u);if(!l)return;s.C_.set(u,l.withResumeToken(lt.EMPTY_BYTE_STRING,l.snapshotVersion)),vP(s,u);let d=new Aa(l.target,u,c,l.sequenceNumber);qI(s,d)}),s.remoteSyncer.applyRemoteEvent(a)}(t,n))}catch(r){E("RemoteStore","Failed to raise snapshot:",r),yield Fp(t,r)}})}function Fp(t,e,n){return v(this,null,function*(){if(!Ri(e))throw e;t.v_.add(1),yield ja(t),t.x_.set("Offline"),n||(n=()=>fP(t.localStore)),t.asyncQueue.enqueueRetryable(()=>v(this,null,function*(){E("RemoteStore","Retrying IndexedDB access"),yield n(),t.v_.delete(1),yield Sl(t)}))})}function EP(t,e){return e().catch(n=>Fp(t,n,e))}function Ua(t){return v(this,null,function*(){let e=A(t),n=xi(e),r=e.D_.length>0?e.D_[e.D_.length-1].batchId:-1;for(;SG(e);)try{let i=yield wG(e.localStore,r);if(i===null){e.D_.length===0&&n.Xo();break}r=i.batchId,AG(e,i)}catch(i){yield Fp(e,i)}IP(e)&&CP(e)})}function SG(t){return Ni(t)&&t.D_.length<10}function AG(t,e){t.D_.push(e);let n=xi(t);n.Jo()&&n.P_&&n.I_(e.mutations)}function IP(t){return Ni(t)&&!xi(t).Ho()&&t.D_.length>0}function CP(t){xi(t).start()}function xG(t){return v(this,null,function*(){xi(t).d_()})}function MG(t){return v(this,null,function*(){let e=xi(t);for(let n of t.D_)e.I_(n.mutations)})}function RG(t,e,n){return v(this,null,function*(){let r=t.D_.shift(),i=cE.from(r,e,n);yield EP(t,()=>t.remoteSyncer.applySuccessfulWrite(i)),yield Ua(t)})}function NG(t,e){return v(this,null,function*(){e&&xi(t).P_&&(yield function(r,i){return v(this,null,function*(){if(function(o){return HN(o)&&o!==y.ABORTED}(i.code)){let s=r.D_.shift();xi(r).Zo(),yield EP(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Ua(r)}})}(t,e)),IP(t)&&CP(t)})}function XR(t,e){return v(this,null,function*(){let n=A(t);n.asyncQueue.verifyOperationInProgress(),E("RemoteStore","RemoteStore received new credentials");let r=Ni(n);n.v_.add(3),yield ja(n),r&&n.x_.set("Unknown"),yield n.remoteSyncer.handleCredentialChange(e),n.v_.delete(3),yield Sl(n)})}function nI(t,e){return v(this,null,function*(){let n=A(t);e?(n.v_.delete(2),yield Sl(n)):e||(n.v_.add(2),yield ja(n),n.x_.set("Unknown"))})}function Ba(t){return t.N_||(t.N_=function(n,r,i){let s=A(n);return s.R_(),new ZE(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(t.datastore,t.asyncQueue,{Po:DG.bind(null,t),To:TG.bind(null,t),u_:bG.bind(null,t)}),t.F_.push(e=>v(this,null,function*(){e?(t.N_.Zo(),zI(t)?GI(t):t.x_.set("Unknown")):(yield t.N_.stop(),wP(t))}))),t.N_}function xi(t){return t.B_||(t.B_=function(n,r,i){let s=A(n);return s.R_(),new XE(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(t.datastore,t.asyncQueue,{Po:xG.bind(null,t),To:NG.bind(null,t),E_:MG.bind(null,t),T_:RG.bind(null,t)}),t.F_.push(e=>v(this,null,function*(){e?(t.B_.Zo(),yield Ua(t)):(yield t.B_.stop(),t.D_.length>0&&(E("RemoteStore",`Stopping write stream with ${t.D_.length} pending writes`),t.D_=[]))}))),t.B_}var rI=class t{constructor(e,n,r,i,s){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new et,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,s){let o=Date.now()+r,a=new t(e,n,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new w(y.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function $a(t,e){if(He("AsyncQueue",`${e}: ${t}`),Ri(t))return new w(y.UNAVAILABLE,`${e}: ${t}`);throw t}var Vp=class t{constructor(e){this.comparator=e?(n,r)=>e(n,r)||b.comparator(n.key,r.key):(n,r)=>b.comparator(n.key,r.key),this.keyedMap=zc(),this.sortedSet=new Ae(this.comparator)}static emptySet(e){return new t(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){let n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){let n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof t)||this.size!==e.size)return!1;let n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){let i=n.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){let r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}};var Lp=class{constructor(){this.L_=new Ae(b.comparator)}track(e){let n=e.doc.key,r=this.L_.get(n);r?e.type!==0&&r.type===3?this.L_=this.L_.insert(n,e):e.type===3&&r.type!==1?this.L_=this.L_.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.L_=this.L_.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.L_=this.L_.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.L_=this.L_.remove(n):e.type===1&&r.type===2?this.L_=this.L_.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.L_=this.L_.insert(n,{type:2,doc:e.doc}):N():this.L_=this.L_.insert(n,e)}k_(){let e=[];return this.L_.inorderTraversal((n,r)=>{e.push(r)}),e}},Na=class t{constructor(e,n,r,i,s,o,a,u,c){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,n,r,i,s){let o=[];return n.forEach(a=>{o.push({type:0,doc:a})}),new t(e,n,Vp.emptySet(n),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Dl(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}};var iI=class{constructor(){this.q_=void 0,this.Q_=[]}},sI=class{constructor(){this.queries=new pr(e=>AN(e),Dl),this.onlineState="Unknown",this.K_=new Set}};function WI(t,e){return v(this,null,function*(){let n=A(t),r=e.query,i=!1,s=n.queries.get(r);if(s||(i=!0,s=new iI),i)try{s.q_=yield n.onListen(r)}catch(o){let a=$a(o,`Initialization of query '${fa(e.query)}' failed`);return void e.onError(a)}n.queries.set(r,s),s.Q_.push(e),e.U_(n.onlineState),s.q_&&e.W_(s.q_)&&QI(n)})}function KI(t,e){return v(this,null,function*(){let n=A(t),r=e.query,i=!1,s=n.queries.get(r);if(s){let o=s.Q_.indexOf(e);o>=0&&(s.Q_.splice(o,1),i=s.Q_.length===0)}if(i)return n.queries.delete(r),n.onUnlisten(r)})}function PG(t,e){let n=A(t),r=!1;for(let i of e){let s=i.query,o=n.queries.get(s);if(o){for(let a of o.Q_)a.W_(i)&&(r=!0);o.q_=i}}r&&QI(n)}function kG(t,e,n){let r=A(t),i=r.queries.get(e);if(i)for(let s of i.Q_)s.onError(n);r.queries.delete(e)}function QI(t){t.K_.forEach(e=>{e.next()})}var yl=class{constructor(e,n,r){this.query=e,this.G_=n,this.z_=!1,this.j_=null,this.onlineState="Unknown",this.options=r||{}}W_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Na(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.z_?this.H_(e)&&(this.G_.next(e),n=!0):this.J_(e,this.onlineState)&&(this.Y_(e),n=!0),this.j_=e,n}onError(e){this.G_.error(e)}U_(e){this.onlineState=e;let n=!1;return this.j_&&!this.z_&&this.J_(this.j_,e)&&(this.Y_(this.j_),n=!0),n}J_(e,n){if(!e.fromCache)return!0;let r=n!=="Offline";return(!this.options.Z_||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}H_(e){if(e.docChanges.length>0)return!0;let n=this.j_&&this.j_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}Y_(e){e=Na.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.z_=!0,this.G_.next(e)}};var oI=class{constructor(e,n){this.X_=e,this.byteLength=n}ea(){return"metadata"in this.X_}};var jp=class{constructor(e){this.serializer=e}Ps(e){return lr(this.serializer,e)}Is(e){return e.metadata.exists?ZN(this.serializer,e.document,!1):tt.newNoDocument(this.Ps(e.metadata.name),this.Ts(e.metadata.readTime))}Ts(e){return Ge(e)}},aI=class{constructor(e,n,r){this.ta=e,this.localStore=n,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=DP(e)}na(e){this.progress.bytesLoaded+=e.byteLength;let n=this.progress.documentsLoaded;if(e.X_.namedQuery)this.queries.push(e.X_.namedQuery);else if(e.X_.documentMetadata){this.documents.push({metadata:e.X_.documentMetadata}),e.X_.documentMetadata.exists||++n;let r=le.fromString(e.X_.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.X_.document&&(this.documents[this.documents.length-1].document=e.X_.document,++n);return n!==this.progress.documentsLoaded?(this.progress.documentsLoaded=n,Object.assign({},this.progress)):null}ra(e){let n=new Map,r=new jp(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.Ps(i.metadata.name);for(let o of i.metadata.queries){let a=(n.get(o)||Z()).add(s);n.set(o,a)}}return n}complete(){return v(this,null,function*(){let e=yield EG(this.localStore,new jp(this.serializer),this.documents,this.ta.id),n=this.ra(this.documents);for(let r of this.queries)yield IG(this.localStore,r,n.get(r.name));return this.progress.taskState="Success",{progress:this.progress,ia:this.collectionGroups,sa:e}})}};function DP(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var Up=class{constructor(e){this.key=e}},Bp=class{constructor(e){this.key=e}},$p=class{constructor(e,n){this.query=e,this.oa=n,this._a=null,this.hasCachedResults=!1,this.current=!1,this.aa=Z(),this.mutatedKeys=Z(),this.ua=MN(e),this.ca=new Vp(this.ua)}get la(){return this.oa}ha(e,n){let r=n?n.Pa:new Lp,i=n?n.ca:this.ca,s=n?n.mutatedKeys:this.mutatedKeys,o=i,a=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((l,d)=>{let h=i.get(l),f=Tl(this.query,d)?d:null,p=!!h&&this.mutatedKeys.has(h.key),g=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations),_=!1;h&&f?h.data.isEqual(f.data)?p!==g&&(r.track({type:3,doc:f}),_=!0):this.Ia(h,f)||(r.track({type:2,doc:f}),_=!0,(u&&this.ua(f,u)>0||c&&this.ua(f,c)<0)&&(a=!0)):!h&&f?(r.track({type:0,doc:f}),_=!0):h&&!f&&(r.track({type:1,doc:h}),_=!0,(u||c)&&(a=!0)),_&&(f?(o=o.add(f),s=g?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let l=this.query.limitType==="F"?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),r.track({type:1,doc:l})}return{ca:o,Pa:r,Xi:a,mutatedKeys:s}}Ia(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,i){let s=this.ca;this.ca=e.ca,this.mutatedKeys=e.mutatedKeys;let o=e.Pa.k_();o.sort((l,d)=>function(f,p){let g=_=>{switch(_){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return N()}};return g(f)-g(p)}(l.type,d.type)||this.ua(l.doc,d.doc)),this.Ta(r),i=i!=null&&i;let a=n&&!i?this.Ea():[],u=this.aa.size===0&&this.current&&!i?1:0,c=u!==this._a;return this._a=u,o.length!==0||c?{snapshot:new Na(this.query,e.ca,s,o,e.mutatedKeys,u===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),da:a}:{da:a}}U_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({ca:this.ca,Pa:new Lp,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{da:[]}}Aa(e){return!this.oa.has(e)&&!!this.ca.has(e)&&!this.ca.get(e).hasLocalMutations}Ta(e){e&&(e.addedDocuments.forEach(n=>this.oa=this.oa.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.oa=this.oa.delete(n)),this.current=e.current)}Ea(){if(!this.current)return[];let e=this.aa;this.aa=Z(),this.ca.forEach(r=>{this.Aa(r.key)&&(this.aa=this.aa.add(r.key))});let n=[];return e.forEach(r=>{this.aa.has(r)||n.push(new Bp(r))}),this.aa.forEach(r=>{e.has(r)||n.push(new Up(r))}),n}Ra(e){this.oa=e.hs,this.aa=Z();let n=this.ha(e.documents);return this.applyChanges(n,!0)}Va(){return Na.fromInitialDocuments(this.query,this.ca,this.mutatedKeys,this._a===0,this.hasCachedResults)}},uI=class{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}},cI=class{constructor(e){this.key=e,this.ma=!1}},lI=class{constructor(e,n,r,i,s,o){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.fa={},this.ga=new pr(a=>AN(a),Dl),this.pa=new Map,this.ya=new Set,this.wa=new Ae(b.comparator),this.Sa=new Map,this.ba=new fl,this.Da={},this.Ca=new Map,this.va=xa.Bn(),this.onlineState="Unknown",this.Fa=void 0}get isPrimaryClient(){return this.Fa===!0}};function OG(t,e){return v(this,null,function*(){let n=eC(t),r,i,s=n.ga.get(e);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Va();else{let o=yield Ma(n.localStore,Nt(e)),a=n.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,i=yield YI(n,e,r,a==="current",o.resumeToken),n.isPrimaryClient&&eg(n.remoteStore,o)}return i})}function YI(t,e,n,r,i){return v(this,null,function*(){t.Ma=(d,h,f)=>function(g,_,C,M){return v(this,null,function*(){let T=_.view.ha(C);T.Xi&&(T=yield Mp(g.localStore,_.query,!1).then(({documents:xe})=>_.view.ha(xe,T)));let j=M&&M.targetChanges.get(_.targetId),$=M&&M.targetMismatches.get(_.targetId)!=null,Y=_.view.applyChanges(T,g.isPrimaryClient,j,$);return dI(g,_.targetId,Y.da),Y.snapshot})}(t,d,h,f);let s=yield Mp(t.localStore,e,!0),o=new $p(e,s.hs),a=o.ha(s.documents),u=cl.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),c=o.applyChanges(a,t.isPrimaryClient,u);dI(t,n,c.da);let l=new uI(e,n,o);return t.ga.set(e,l),t.pa.has(n)?t.pa.get(n).push(e):t.pa.set(n,[e]),c.snapshot})}function FG(t,e){return v(this,null,function*(){let n=A(t),r=n.ga.get(e),i=n.pa.get(r.targetId);if(i.length>1)return n.pa.set(r.targetId,i.filter(s=>!Dl(s,e))),void n.ga.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||(yield Ra(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),ml(n.remoteStore,r.targetId),Pa(n,r.targetId)}).catch(Mi))):(Pa(n,r.targetId),yield Ra(n.localStore,r.targetId,!0))})}function VG(t,e,n){return v(this,null,function*(){let r=tC(t);try{let i=yield function(o,a){let u=A(o),c=Oe.now(),l=a.reduce((f,p)=>f.add(p.key),Z()),d,h;return u.persistence.runTransaction("Locally write mutations","readwrite",f=>{let p=Ht(),g=Z();return u.os.getEntries(f,l).next(_=>{p=_,p.forEach((C,M)=>{M.isValidDocument()||(g=g.add(C))})}).next(()=>u.localDocuments.getOverlayedDocuments(f,p)).next(_=>{d=_;let C=[];for(let M of a){let T=eG(M,d.get(M.key).overlayedDocument);T!=null&&C.push(new Ln(M.key,T,EN(T.value.mapValue),je.exists(!0)))}return u.mutationQueue.addMutationBatch(f,c,C,a)}).next(_=>{h=_;let C=_.applyToLocalDocumentSet(d,g);return u.documentOverlayCache.saveOverlays(f,_.batchId,C)})}).then(()=>({batchId:h.batchId,changes:NN(d)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let c=o.Da[o.currentUser.toKey()];c||(c=new Ae(K)),c=c.insert(a,u),o.Da[o.currentUser.toKey()]=c}(r,i.batchId,n),yield Br(r,i.changes),yield Ua(r.remoteStore)}catch(i){let s=$a(i,"Failed to persist write");n.reject(s)}})}function TP(t,e){return v(this,null,function*(){let n=A(t);try{let r=yield vG(n.localStore,e);e.targetChanges.forEach((i,s)=>{let o=n.Sa.get(s);o&&(O(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.ma=!0:i.modifiedDocuments.size>0?O(o.ma):i.removedDocuments.size>0&&(O(o.ma),o.ma=!1))}),yield Br(n,r,e)}catch(r){yield Mi(r)}})}function JR(t,e,n){let r=A(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){let i=[];r.ga.forEach((s,o)=>{let a=o.view.U_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){let u=A(o);u.onlineState=a;let c=!1;u.queries.forEach((l,d)=>{for(let h of d.Q_)h.U_(a)&&(c=!0)}),c&&QI(u)}(r.eventManager,e),i.length&&r.fa.u_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function LG(t,e,n){return v(this,null,function*(){let r=A(t);r.sharedClientState.updateQueryState(e,"rejected",n);let i=r.Sa.get(e),s=i&&i.key;if(s){let o=new Ae(b.comparator);o=o.insert(s,tt.newNoDocument(s,L.min()));let a=Z().add(s),u=new ul(L.min(),new Map,new Ae(K),o,a);yield TP(r,u),r.wa=r.wa.remove(s),r.Sa.delete(e),JI(r)}else yield Ra(r.localStore,e,!1).then(()=>Pa(r,e,n)).catch(Mi)})}function jG(t,e){return v(this,null,function*(){let n=A(t),r=e.batch.batchId;try{let i=yield _G(n.localStore,e);XI(n,r,null),ZI(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),yield Br(n,i)}catch(i){yield Mi(i)}})}function UG(t,e,n){return v(this,null,function*(){let r=A(t);try{let i=yield function(o,a){let u=A(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return u.mutationQueue.lookupMutationBatch(c,a).next(d=>(O(d!==null),l=d.keys(),u.mutationQueue.removeMutationBatch(c,d))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,l,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>u.localDocuments.getDocuments(c,l))})}(r.localStore,e);XI(r,e,n),ZI(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),yield Br(r,i)}catch(i){yield Mi(i)}})}function BG(t,e){return v(this,null,function*(){let n=A(t);Ni(n.remoteStore)||E("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(o){let a=A(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(n.localStore);if(r===-1)return void e.resolve();let i=n.Ca.get(r)||[];i.push(e),n.Ca.set(r,i)}catch(r){let i=$a(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function ZI(t,e){(t.Ca.get(e)||[]).forEach(n=>{n.resolve()}),t.Ca.delete(e)}function XI(t,e,n){let r=A(t),i=r.Da[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(n?s.reject(n):s.resolve(),i=i.remove(e)),r.Da[r.currentUser.toKey()]=i}}function Pa(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(let r of t.pa.get(e))t.ga.delete(r),n&&t.fa.xa(r,n);t.pa.delete(e),t.isPrimaryClient&&t.ba.Vr(e).forEach(r=>{t.ba.containsKey(r)||bP(t,r)})}function bP(t,e){t.ya.delete(e.path.canonicalString());let n=t.wa.get(e);n!==null&&(ml(t.remoteStore,n),t.wa=t.wa.remove(e),t.Sa.delete(n),JI(t))}function dI(t,e,n){for(let r of n)r instanceof Up?(t.ba.addReference(r.key,e),$G(t,r)):r instanceof Bp?(E("SyncEngine","Document no longer in limbo: "+r.key),t.ba.removeReference(r.key,e),t.ba.containsKey(r.key)||bP(t,r.key)):N()}function $G(t,e){let n=e.key,r=n.path.canonicalString();t.wa.get(n)||t.ya.has(r)||(E("SyncEngine","New document in limbo: "+n),t.ya.add(r),JI(t))}function JI(t){for(;t.ya.size>0&&t.wa.size<t.maxConcurrentLimboResolutions;){let e=t.ya.values().next().value;t.ya.delete(e);let n=new b(le.fromString(e)),r=t.va.next();t.Sa.set(r,new cI(n)),t.wa=t.wa.insert(n,r),eg(t.remoteStore,new Aa(Nt(La(n.path)),r,"TargetPurposeLimboResolution",Zt._e))}}function Br(t,e,n){return v(this,null,function*(){let r=A(t),i=[],s=[],o=[];r.ga.isEmpty()||(r.ga.forEach((a,u)=>{o.push(r.Ma(u,e,n).then(c=>{if((c||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);let l=qE.Ki(u.targetId,c);s.push(l)}}))}),yield Promise.all(o),r.fa.u_(i),yield function(u,c){return v(this,null,function*(){let l=A(u);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",d=>m.forEach(c,h=>m.forEach(h.qi,f=>l.persistence.referenceDelegate.addReference(d,h.targetId,f)).next(()=>m.forEach(h.Qi,f=>l.persistence.referenceDelegate.removeReference(d,h.targetId,f)))))}catch(d){if(!Ri(d))throw d;E("LocalStore","Failed to update sequence numbers: "+d)}for(let d of c){let h=d.targetId;if(!d.fromCache){let f=l.ns.get(h),p=f.snapshotVersion,g=f.withLastLimboFreeSnapshotVersion(p);l.ns=l.ns.insert(h,g)}}})}(r.localStore,s))})}function HG(t,e){return v(this,null,function*(){let n=A(t);if(!n.currentUser.isEqual(e)){E("SyncEngine","User change. New user:",e.toKey());let r=yield hP(n.localStore,e);n.currentUser=e,function(s,o){s.Ca.forEach(a=>{a.forEach(u=>{u.reject(new w(y.CANCELLED,o))})}),s.Ca.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Br(n,r.us)}})}function qG(t,e){let n=A(t),r=n.Sa.get(e);if(r&&r.ma)return Z().add(r.key);{let i=Z(),s=n.pa.get(e);if(!s)return i;for(let o of s){let a=n.ga.get(o);i=i.unionWith(a.view.la)}return i}}function GG(t,e){return v(this,null,function*(){let n=A(t),r=yield Mp(n.localStore,e.query,!0),i=e.view.Ra(r);return n.isPrimaryClient&&dI(n,e.targetId,i.da),i})}function zG(t,e){return v(this,null,function*(){let n=A(t);return mP(n.localStore,e).then(r=>Br(n,r))})}function WG(t,e,n,r){return v(this,null,function*(){let i=A(t),s=yield function(a,u){let c=A(a),l=A(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",d=>l.vn(d,u).next(h=>h?c.localDocuments.getDocuments(d,h):m.resolve(null)))}(i.localStore,e);s!==null?(n==="pending"?yield Ua(i.remoteStore):n==="acknowledged"||n==="rejected"?(XI(i,e,r||null),ZI(i,e),function(a,u){A(A(a).mutationQueue).Mn(u)}(i.localStore,e)):N(),yield Br(i,s)):E("SyncEngine","Cannot apply mutation batch with id: "+e)})}function KG(t,e){return v(this,null,function*(){let n=A(t);if(eC(n),tC(n),e===!0&&n.Fa!==!0){let r=n.sharedClientState.getAllActiveQueryTargets(),i=yield eN(n,r.toArray());n.Fa=!0,yield nI(n.remoteStore,!0);for(let s of i)eg(n.remoteStore,s)}else if(e===!1&&n.Fa!==!1){let r=[],i=Promise.resolve();n.pa.forEach((s,o)=>{n.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Pa(n,o),Ra(n.localStore,o,!0))),ml(n.remoteStore,o)}),yield i,yield eN(n,r),function(o){let a=A(o);a.Sa.forEach((u,c)=>{ml(a.remoteStore,c)}),a.ba.mr(),a.Sa=new Map,a.wa=new Ae(b.comparator)}(n),n.Fa=!1,yield nI(n.remoteStore,!1)}})}function eN(t,e,n){return v(this,null,function*(){let r=A(t),i=[],s=[];for(let o of e){let a,u=r.pa.get(o);if(u&&u.length!==0){a=yield Ma(r.localStore,Nt(u[0]));for(let c of u){let l=r.ga.get(c),d=yield GG(r,l);d.snapshot&&s.push(d.snapshot)}}else{let c=yield gP(r.localStore,o);a=yield Ma(r.localStore,c),yield YI(r,SP(c),o,!1,a.resumeToken)}i.push(a)}return r.fa.u_(s),i})}function SP(t){return SN(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function QG(t){return function(n){return A(A(n).persistence).Li()}(A(t).localStore)}function YG(t,e,n,r){return v(this,null,function*(){let i=A(t);if(i.Fa)return void E("SyncEngine","Ignoring unexpected query state notification.");let s=i.pa.get(e);if(s&&s.length>0)switch(n){case"current":case"not-current":{let o=yield mP(i.localStore,xN(s[0])),a=ul.createSynthesizedRemoteEventForCurrentChange(e,n==="current",lt.EMPTY_BYTE_STRING);yield Br(i,o,a);break}case"rejected":yield Ra(i.localStore,e,!0),Pa(i,e,r);break;default:N()}})}function ZG(t,e,n){return v(this,null,function*(){let r=eC(t);if(r.Fa){for(let i of e){if(r.pa.has(i)){E("SyncEngine","Adding an already active target "+i);continue}let s=yield gP(r.localStore,i),o=yield Ma(r.localStore,s);yield YI(r,SP(s),o.targetId,!1,o.resumeToken),eg(r.remoteStore,o)}for(let i of n)r.pa.has(i)&&(yield Ra(r.localStore,i,!1).then(()=>{ml(r.remoteStore,i),Pa(r,i)}).catch(Mi))}})}function eC(t){let e=A(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=TP.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=qG.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=LG.bind(null,e),e.fa.u_=PG.bind(null,e.eventManager),e.fa.xa=kG.bind(null,e.eventManager),e}function tC(t){let e=A(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=jG.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=UG.bind(null,e),e}function XG(t,e,n){let r=A(t);(function(s,o,a){return v(this,null,function*(){try{let u=yield o.getMetadata();if(yield function(f,p){let g=A(f),_=Ge(p.createTime);return g.persistence.runTransaction("hasNewerBundle","readonly",C=>g.$r.getBundleMetadata(C,p.id)).then(C=>!!C&&C.createTime.compareTo(_)>=0)}(s.localStore,u))return yield o.close(),a._completeWith(function(f){return{taskState:"Success",documentsLoaded:f.totalDocuments,bytesLoaded:f.totalBytes,totalDocuments:f.totalDocuments,totalBytes:f.totalBytes}}(u)),Promise.resolve(new Set);a._updateProgress(DP(u));let c=new aI(u,s.localStore,o.serializer),l=yield o.Oa();for(;l;){let h=yield c.na(l);h&&a._updateProgress(h),l=yield o.Oa()}let d=yield c.complete();return yield Br(s,d.sa,void 0),yield function(f,p){let g=A(f);return g.persistence.runTransaction("Save bundle","readwrite",_=>g.$r.saveBundleMetadata(_,p))}(s.localStore,u),a._completeWith(d.progress),Promise.resolve(d.ia)}catch(u){return _n("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u),Promise.resolve(new Set)}})})(r,e,n).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var _l=class{constructor(){this.synchronizeTabs=!1}initialize(e){return v(this,null,function*(){this.serializer=bl(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,n){return null}createIndexBackfillerScheduler(e,n){return null}createLocalStore(e){return dP(this.persistence,new xp,e.initialUser,this.serializer)}createPersistence(e){return new Sp(Ap.Hr,this.serializer)}createSharedClientState(e){return new Pp}terminate(){return v(this,null,function*(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var Hp=class t extends _l{constructor(e,n,r){super(),this.Na=e,this.cacheSizeBytes=n,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){return v(this,null,function*(){yield dm(t.prototype,this,"initialize").call(this,e),yield this.Na.initialize(this,e),yield tC(this.Na.syncEngine),yield Ua(this.Na.remoteStore),yield this.persistence.fi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return dP(this.persistence,new xp,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,n){let r=this.persistence.referenceDelegate.garbageCollector;return new xE(r,e.asyncQueue,n)}createIndexBackfillerScheduler(e,n){let r=new Ww(n,this.persistence);return new zw(e.asyncQueue,r)}createPersistence(e){let n=HI(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?yn.withCacheSize(this.cacheSizeBytes):yn.DEFAULT;return new HE(this.synchronizeTabs,n,e.clientId,r,e.asyncQueue,_P(),tp(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Pp}},hI=class t extends Hp{constructor(e,n){super(e,n,!1),this.Na=e,this.cacheSizeBytes=n,this.synchronizeTabs=!0}initialize(e){return v(this,null,function*(){yield dm(t.prototype,this,"initialize").call(this,e);let n=this.Na.syncEngine;this.sharedClientState instanceof Xc&&(this.sharedClientState.syncEngine={Zs:WG.bind(null,n),Xs:YG.bind(null,n),eo:ZG.bind(null,n),Li:QG.bind(null,n),Ys:zG.bind(null,n)},yield this.sharedClientState.start()),yield this.persistence.fi(r=>v(this,null,function*(){yield KG(this.Na.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let n=_P();if(!Xc.D(n))throw new w(y.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=HI(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Xc(n,e.asyncQueue,r,e.clientId,e.initialUser)}},vl=class{initialize(e,n){return v(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>JR(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=HG.bind(null,this.syncEngine),yield nI(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new sI}()}createDatastore(e){let n=bl(e.databaseInfo.databaseId),r=function(s){return new YE(s)}(e.databaseInfo);return function(s,o,a,u){return new JE(s,o,a,u)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,i,s,o,a){return new tI(r,i,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,n=>JR(this.syncEngine,n,0),function(){return kp.D()?new kp:new KE}())}createSyncEngine(e,n){return function(i,s,o,a,u,c,l){let d=new lI(i,s,o,a,u,c);return l&&(d.Fa=!0),d}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return v(this,null,function*(){var e;yield function(r){return v(this,null,function*(){let i=A(r);E("RemoteStore","RemoteStore shutting down."),i.v_.add(5),yield ja(i),i.M_.shutdown(),i.x_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()})}};function tN(t,e=10240){let n=0;return{read(){return v(this,null,function*(){if(n<t.byteLength){let i={value:t.slice(n,n+e),done:!1};return n+=e,i}return{done:!0}})},cancel(){return v(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var ka=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ba(this.observer.next,e)}error(e){this.observer.error?this.Ba(this.observer.error,e):He("Uncaught Error in snapshot listener:",e.toString())}La(){this.muted=!0}Ba(e,n){this.muted||setTimeout(()=>{this.muted||e(n)},0)}};var fI=class{constructor(e,n){this.ka=e,this.serializer=n,this.metadata=new et,this.buffer=new Uint8Array,this.qa=function(){return new TextDecoder("utf-8")}(),this.Qa().then(r=>{r&&r.ea()?this.metadata.resolve(r.X_.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.X_)}`))},r=>this.metadata.reject(r))}close(){return this.ka.cancel()}getMetadata(){return v(this,null,function*(){return this.metadata.promise})}Oa(){return v(this,null,function*(){return yield this.getMetadata(),this.Qa()})}Qa(){return v(this,null,function*(){let e=yield this.Ka();if(e===null)return null;let n=this.qa.decode(e),r=Number(n);isNaN(r)&&this.$a(`length string (${n}) is not valid number`);let i=yield this.Ua(r);return new oI(JSON.parse(i),e.length+r)})}Wa(){return this.buffer.findIndex(e=>e===123)}Ka(){return v(this,null,function*(){for(;this.Wa()<0&&!(yield this.Ga()););if(this.buffer.length===0)return null;let e=this.Wa();e<0&&this.$a("Reached the end of bundle when a length string is expected.");let n=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),n})}Ua(e){return v(this,null,function*(){for(;this.buffer.length<e;)(yield this.Ga())&&this.$a("Reached the end of bundle when more is expected.");let n=this.qa.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),n})}$a(e){throw this.ka.cancel(),new Error(`Invalid bundle format: ${e}`)}Ga(){return v(this,null,function*(){let e=yield this.ka.read();if(!e.done){let n=new Uint8Array(this.buffer.length+e.value.length);n.set(this.buffer),n.set(e.value,this.buffer.length),this.buffer=n}return e.done})}};var pI=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return v(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new w(y.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let n=yield function(i,s){return v(this,null,function*(){let o=A(i),a={documents:s.map(d=>ll(o.serializer,d))},u=yield o.vo("BatchGetDocuments",o.serializer.databaseId,le.emptyPath(),a,s.length),c=new Map;u.forEach(d=>{let h=oG(o.serializer,d);c.set(h.key.toString(),h)});let l=[];return s.forEach(d=>{let h=c.get(d.toString());O(!!h),l.push(h)}),l})}(this.datastore,e);return n.forEach(r=>this.recordVersion(r)),n})}set(e,n){this.write(n.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,n){try{this.write(n.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Ai(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return v(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(n=>{e.delete(n.key.toString())}),e.forEach((n,r)=>{let i=b.fromPath(r);this.mutations.push(new sl(i,this.precondition(i)))}),yield function(r,i){return v(this,null,function*(){let s=A(r),o={writes:i.map(a=>dl(s.serializer,a))};yield s.So("Commit",s.serializer.databaseId,le.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let n;if(e.isFoundDocument())n=e.version;else{if(!e.isNoDocument())throw N();n=L.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!n.isEqual(r))throw new w(y.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),n)}precondition(e){let n=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&n?n.isEqual(L.min())?je.exists(!1):je.updateTime(n):je.none()}preconditionForUpdate(e){let n=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&n){if(n.isEqual(L.min()))throw new w(y.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return je.updateTime(n)}return je.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var gI=class{constructor(e,n,r,i,s){this.asyncQueue=e,this.datastore=n,this.options=r,this.updateFunction=i,this.deferred=s,this.za=r.maxAttempts,this.jo=new gl(this.asyncQueue,"transaction_retry")}ja(){this.za-=1,this.Ha()}Ha(){this.jo.qo(()=>v(this,null,function*(){let e=new pI(this.datastore),n=this.Ja(e);n&&n.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.Ya(i)}))}).catch(r=>{this.Ya(r)})}))}Ja(e){try{let n=this.updateFunction(e);return!Il(n)&&n.catch&&n.then?n:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(n){return this.deferred.reject(n),null}}Ya(e){this.za>0&&this.Za(e)?(this.za-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ha(),Promise.resolve()))):this.deferred.reject(e)}Za(e){if(e.name==="FirebaseError"){let n=e.code;return n==="aborted"||n==="failed-precondition"||n==="already-exists"||!HN(n)}return!1}};var mI=class{constructor(e,n,r,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=Je.UNAUTHENTICATED,this.clientId=ip.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>v(this,null,function*(){E("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(E("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new w(y.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new et;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>v(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let r=$a(n,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function np(t,e){return v(this,null,function*(){t.asyncQueue.verifyOperationInProgress(),E("FirestoreClient","Initializing OfflineComponentProvider");let n=t.configuration;yield e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(i=>v(this,null,function*(){r.isEqual(i)||(yield hP(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e})}function yI(t,e){return v(this,null,function*(){t.asyncQueue.verifyOperationInProgress();let n=yield nC(t);E("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>XR(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,i)=>XR(e.remoteStore,i)),t._onlineComponents=e})}function AP(t){return t.name==="FirebaseError"?t.code===y.FAILED_PRECONDITION||t.code===y.UNIMPLEMENTED:!(typeof DOMException<"u"&&t instanceof DOMException)||t.code===22||t.code===20||t.code===11}function nC(t){return v(this,null,function*(){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){E("FirestoreClient","Using user provided OfflineComponentProvider");try{yield np(t,t._uninitializedComponentsProvider._offline)}catch(e){let n=e;if(!AP(n))throw n;_n("Error using user provided cache. Falling back to memory cache: "+n),yield np(t,new _l)}}else E("FirestoreClient","Using default OfflineComponentProvider"),yield np(t,new _l);return t._offlineComponents})}function tg(t){return v(this,null,function*(){return t._onlineComponents||(t._uninitializedComponentsProvider?(E("FirestoreClient","Using user provided OnlineComponentProvider"),yield yI(t,t._uninitializedComponentsProvider._online)):(E("FirestoreClient","Using default OnlineComponentProvider"),yield yI(t,new vl))),t._onlineComponents})}function xP(t){return nC(t).then(e=>e.persistence)}function rC(t){return nC(t).then(e=>e.localStore)}function MP(t){return tg(t).then(e=>e.remoteStore)}function iC(t){return tg(t).then(e=>e.syncEngine)}function JG(t){return tg(t).then(e=>e.datastore)}function Oa(t){return v(this,null,function*(){let e=yield tg(t),n=e.eventManager;return n.onListen=OG.bind(null,e.syncEngine),n.onUnlisten=FG.bind(null,e.syncEngine),n})}function ez(t){return t.asyncQueue.enqueue(()=>v(this,null,function*(){let e=yield xP(t),n=yield MP(t);return e.setNetworkEnabled(!0),function(i){let s=A(i);return s.v_.delete(0),Sl(s)}(n)}))}function tz(t){return t.asyncQueue.enqueue(()=>v(this,null,function*(){let e=yield xP(t),n=yield MP(t);return e.setNetworkEnabled(!1),function(i){return v(this,null,function*(){let s=A(i);s.v_.add(0),yield ja(s),s.x_.set("Offline")})}(n)}))}function nz(t,e){let n=new et;return t.asyncQueue.enqueueAndForget(()=>v(this,null,function*(){return function(i,s,o){return v(this,null,function*(){try{let a=yield function(c,l){let d=A(c);return d.persistence.runTransaction("read document","readonly",h=>d.localDocuments.getDocument(h,l))}(i,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new w(y.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let u=$a(a,`Failed to get document '${s} from cache`);o.reject(u)}})}(yield rC(t),e,n)})),n.promise}function RP(t,e,n={}){let r=new et;return t.asyncQueue.enqueueAndForget(()=>v(this,null,function*(){return function(s,o,a,u,c){let l=new ka({next:h=>{o.enqueueAndForget(()=>KI(s,d));let f=h.docs.has(a);!f&&h.fromCache?c.reject(new w(y.UNAVAILABLE,"Failed to get document because the client is offline.")):f&&h.fromCache&&u&&u.source==="server"?c.reject(new w(y.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(h)},error:h=>c.reject(h)}),d=new yl(La(a.path),l,{includeMetadataChanges:!0,Z_:!0});return WI(s,d)}(yield Oa(t),t.asyncQueue,e,n,r)})),r.promise}function rz(t,e){let n=new et;return t.asyncQueue.enqueueAndForget(()=>v(this,null,function*(){return function(i,s,o){return v(this,null,function*(){try{let a=yield Mp(i,s,!0),u=new $p(s,a.hs),c=u.ha(a.documents),l=u.applyChanges(c,!1);o.resolve(l.snapshot)}catch(a){let u=$a(a,`Failed to execute query '${s} against cache`);o.reject(u)}})}(yield rC(t),e,n)})),n.promise}function NP(t,e,n={}){let r=new et;return t.asyncQueue.enqueueAndForget(()=>v(this,null,function*(){return function(s,o,a,u,c){let l=new ka({next:h=>{o.enqueueAndForget(()=>KI(s,d)),h.fromCache&&u.source==="server"?c.reject(new w(y.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(h)},error:h=>c.reject(h)}),d=new yl(a,l,{includeMetadataChanges:!0,Z_:!0});return WI(s,d)}(yield Oa(t),t.asyncQueue,e,n,r)})),r.promise}function iz(t,e){let n=new ka(e);return t.asyncQueue.enqueueAndForget(()=>v(this,null,function*(){return function(i,s){A(i).K_.add(s),s.next()}(yield Oa(t),n)})),()=>{n.La(),t.asyncQueue.enqueueAndForget(()=>v(this,null,function*(){return function(i,s){A(i).K_.delete(s)}(yield Oa(t),n)}))}}function sz(t,e,n,r){let i=function(o,a){let u;return u=typeof o=="string"?GN().encode(o):o,function(l,d){return new fI(l,d)}(function(l,d){if(l instanceof Uint8Array)return tN(l,d);if(l instanceof ArrayBuffer)return tN(new Uint8Array(l),d);if(l instanceof ReadableStream)return l.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),a)}(n,bl(e));t.asyncQueue.enqueueAndForget(()=>v(this,null,function*(){XG(yield iC(t),i,r)}))}function oz(t,e){return t.asyncQueue.enqueue(()=>v(this,null,function*(){return function(r,i){let s=A(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.$r.getNamedQuery(o,i))}(yield rC(t),e)}))}function PP(t){let e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}var nN=new Map;function sC(t,e,n){if(!n)throw new w(y.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function oC(t,e,n,r){if(e===!0&&r===!0)throw new w(y.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function rN(t){if(!b.isDocumentKey(t))throw new w(y.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function iN(t){if(b.isDocumentKey(t))throw new w(y.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function ng(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":N()}function de(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new w(y.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=ng(t);throw new w(y.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function kP(t,e){if(e<=0)throw new w(y.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}var qp=class{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new w(y.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new w(y.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}oC("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=PP((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new w(y.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new w(y.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new w(y.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Fs=class{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new qp({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new w(y.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new w(y.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new qp(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Fw;switch(r.type){case"firstParty":return new Uw(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new w(y.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){let r=nN.get(n);r&&(E("ComponentProvider","Removing Datastore"),nN.delete(n),r.terminate())}(this),Promise.resolve()}};function OP(t,e,n,r={}){var i;let s=(t=de(t,Fs))._getSettings(),o=`${e}:${n}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&_n("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,u;if(typeof r.mockUserToken=="string")a=r.mockUserToken,u=Je.MOCK_USER;else{a=pd(r.mockUserToken,(i=t._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new w(y.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new Je(c)}t._authCredentials=new Vw(new rp(a,u))}}var wt=class t{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new t(this.firestore,e,this._query)}},Te=class t{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new dr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new t(this.firestore,e,this._key)}},dr=class t extends wt{constructor(e,n,r){super(e,n,La(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Te(this.firestore,null,new b(e))}withConverter(e){return new t(this.firestore,e,this._path)}};function aC(t,e,...n){if(t=ie(t),sC("collection","path",e),t instanceof Fs){let r=le.fromString(e,...n);return iN(r),new dr(t,null,r)}{if(!(t instanceof Te||t instanceof dr))throw new w(y.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=t._path.child(le.fromString(e,...n));return iN(r),new dr(t.firestore,null,r)}}function FP(t,e){if(t=de(t,Fs),sC("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new w(y.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new wt(t,null,function(r){return new Vn(le.emptyPath(),r)}(e))}function Al(t,e,...n){if(t=ie(t),arguments.length===1&&(e=ip.newId()),sC("doc","path",e),t instanceof Fs){let r=le.fromString(e,...n);return rN(r),new Te(t,null,new b(r))}{if(!(t instanceof Te||t instanceof dr))throw new w(y.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=t._path.child(le.fromString(e,...n));return rN(r),new Te(t.firestore,t instanceof dr?t.converter:null,new b(r))}}function uC(t,e){return t=ie(t),e=ie(e),(t instanceof Te||t instanceof dr)&&(e instanceof Te||e instanceof dr)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function cC(t,e){return t=ie(t),e=ie(e),t instanceof wt&&e instanceof wt&&t.firestore===e.firestore&&Dl(t._query,e._query)&&t.converter===e.converter}var _I=class{constructor(){this.Xa=Promise.resolve(),this.eu=[],this.tu=!1,this.nu=[],this.ru=null,this.iu=!1,this.su=!1,this.ou=[],this.jo=new gl(this,"async_queue_retry"),this._u=()=>{let n=tp();n&&E("AsyncQueue","Visibility state changed to "+n.visibilityState),this.jo.Ko()};let e=tp();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._u)}get isShuttingDown(){return this.tu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.au(),this.uu(e)}enterRestrictedMode(e){if(!this.tu){this.tu=!0,this.su=e||!1;let n=tp();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._u)}}enqueue(e){if(this.au(),this.tu)return new Promise(()=>{});let n=new et;return this.uu(()=>this.tu&&this.su?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.eu.push(e),this.cu()))}cu(){return v(this,null,function*(){if(this.eu.length!==0){try{yield this.eu[0](),this.eu.shift(),this.jo.reset()}catch(e){if(!Ri(e))throw e;E("AsyncQueue","Operation failed with retryable error: "+e)}this.eu.length>0&&this.jo.qo(()=>this.cu())}})}uu(e){let n=this.Xa.then(()=>(this.iu=!0,e().catch(r=>{this.ru=r,this.iu=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw He("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.iu=!1,r))));return this.Xa=n,n}enqueueAfterDelay(e,n,r){this.au(),this.ou.indexOf(e)>-1&&(n=0);let i=rI.createAndSchedule(this,e,n,r,s=>this.lu(s));return this.nu.push(i),i}au(){this.ru&&N()}verifyOperationInProgress(){}hu(){return v(this,null,function*(){let e;do e=this.Xa,yield e;while(e!==this.Xa)})}Pu(e){for(let n of this.nu)if(n.timerId===e)return!0;return!1}Iu(e){return this.hu().then(()=>{this.nu.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(let n of this.nu)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.hu()})}Tu(e){this.ou.push(e)}lu(e){let n=this.nu.indexOf(e);this.nu.splice(n,1)}};function vI(t){return function(n,r){if(typeof n!="object"||n===null)return!1;let i=n;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(t,["next","error","complete"])}var wI=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new et,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,n,r){this._progressObserver={next:e,error:n,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,n){return this._taskCompletionResolver.promise.then(e,n)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var VP=-1,Ne=class extends Fs{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=function(){return new _I}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||LP(this),this._firestoreClient.terminate()}};function st(t){return t._firestoreClient||LP(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function LP(t){var e,n,r;let i=t._freezeSettings(),s=function(a,u,c,l){return new Kw(a,u,c,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,PP(l.experimentalLongPollingOptions),l.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,i);t._firestoreClient=new mI(t._authCredentials,t._appCheckCredentials,t._queue,s),!((n=i.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function jP(t,e){KP(t=de(t,Ne));let n=st(t);if(n._uninitializedComponentsProvider)throw new w(y.FAILED_PRECONDITION,"SDK cache is already specified.");_n("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=t._freezeSettings(),i=new vl;return BP(n,i,new Hp(i,r.cacheSizeBytes,e?.forceOwnership))}function UP(t){KP(t=de(t,Ne));let e=st(t);if(e._uninitializedComponentsProvider)throw new w(y.FAILED_PRECONDITION,"SDK cache is already specified.");_n("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let n=t._freezeSettings(),r=new vl;return BP(e,r,new hI(r,n.cacheSizeBytes))}function BP(t,e,n){let r=new et;return t.asyncQueue.enqueue(()=>v(this,null,function*(){try{yield np(t,n),yield yI(t,e),r.resolve()}catch(i){let s=i;if(!AP(s))throw s;_n("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function $P(t){if(t._initialized&&!t._terminated)throw new w(y.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new et;return t._queue.enqueueAndForgetEvenWhileRestricted(()=>v(this,null,function*(){try{yield function(r){return v(this,null,function*(){if(!Fr.D())return Promise.resolve();let i=r+"main";yield Fr.delete(i)})}(HI(t._databaseId,t._persistenceKey)),e.resolve()}catch(n){e.reject(n)}})),e.promise}function HP(t){return function(n){let r=new et;return n.asyncQueue.enqueueAndForget(()=>v(this,null,function*(){return BG(yield iC(n),r)})),r.promise}(st(t=de(t,Ne)))}function qP(t){return ez(st(t=de(t,Ne)))}function GP(t){return tz(st(t=de(t,Ne)))}function zP(t,e){let n=st(t=de(t,Ne)),r=new wI;return sz(n,t._databaseId,e,r),r}function WP(t,e){return oz(st(t=de(t,Ne)),e).then(n=>n?new wt(t,null,n.query):null)}function KP(t){if(t._initialized||t._terminated)throw new w(y.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var gr=class t{constructor(e){this._byteString=e}static fromBase64String(e){try{return new t(lt.fromBase64String(e))}catch(n){throw new w(y.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new t(lt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var jn=class{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new w(y.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new qe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var jr=class{constructor(e){this._methodName=e}};var Vs=class{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new w(y.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new w(y.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return K(this._lat,e._lat)||K(this._long,e._long)}};var az=/^__.*__$/,EI=class{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Ln(e,this.data,this.fieldMask,n,this.fieldTransforms):new Si(e,this.data,n,this.fieldTransforms)}},Gp=class{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Ln(e,this.data,this.fieldMask,n,this.fieldTransforms)}};function QP(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw N()}}var zp=class t{constructor(e,n,r,i,s,o){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Eu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get du(){return this.settings.du}Au(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ru(e){var n;let r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.Au({path:r,Vu:!1});return i.mu(e),i}fu(e){var n;let r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.Au({path:r,Vu:!1});return i.Eu(),i}gu(e){return this.Au({path:void 0,Vu:!0})}pu(e){return Wp(e,this.settings.methodName,this.settings.yu||!1,this.path,this.settings.wu)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}Eu(){if(this.path)for(let e=0;e<this.path.length;e++)this.mu(this.path.get(e))}mu(e){if(e.length===0)throw this.pu("Document fields must not be empty");if(QP(this.du)&&az.test(e))throw this.pu('Document fields cannot begin and end with "__"')}},II=class{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||bl(e)}Su(e,n,r,i=!1){return new zp({du:e,methodName:n,wu:r,path:qe.emptyPath(),Vu:!1,yu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Bs(t){let e=t._freezeSettings(),n=bl(t._databaseId);return new II(t._databaseId,!!e.ignoreUndefinedProperties,n)}function rg(t,e,n,r,i,s={}){let o=t.Su(s.merge||s.mergeFields?2:0,e,n,i);hC("Data must be an object, but it was:",o,r);let a=XP(r,o),u,c;if(s.merge)u=new Xt(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let l=[];for(let d of s.mergeFields){let h=SI(e,d,n);if(!o.contains(h))throw new w(y.INVALID_ARGUMENT,`Field '${h}' is specified in your field mask but missing from your input data.`);ek(l,h)||l.push(h)}u=new Xt(l),c=o.fieldTransforms.filter(d=>u.covers(d.field))}else u=null,c=o.fieldTransforms;return new EI(new St(a),u,c)}var wl=class t extends jr{_toFieldTransform(e){if(e.du!==2)throw e.du===1?e.pu(`${this._methodName}() can only appear at the top level of your update data`):e.pu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof t}};function YP(t,e,n){return new zp({du:3,wu:e.settings.wu,methodName:t._methodName,Vu:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var CI=class t extends jr{_toFieldTransform(e){return new Ps(e.path,new Ti)}isEqual(e){return e instanceof t}},DI=class t extends jr{constructor(e,n){super(e),this.bu=n}_toFieldTransform(e){let n=YP(this,e,!0),r=this.bu.map(s=>$s(s,n)),i=new Vr(r);return new Ps(e.path,i)}isEqual(e){return e instanceof t&&pm(this.bu,e.bu)}},TI=class t extends jr{constructor(e,n){super(e),this.bu=n}_toFieldTransform(e){let n=YP(this,e,!0),r=this.bu.map(s=>$s(s,n)),i=new Lr(r);return new Ps(e.path,i)}isEqual(e){return e instanceof t&&pm(this.bu,e.bu)}},bI=class t extends jr{constructor(e,n){super(e),this.Du=n}_toFieldTransform(e){let n=new bi(e.serializer,FN(e.serializer,this.Du));return new Ps(e.path,n)}isEqual(e){return e instanceof t&&this.Du===e.Du}};function lC(t,e,n,r){let i=t.Su(1,e,n);hC("Data must be an object, but it was:",i,r);let s=[],o=St.empty();Us(r,(u,c)=>{let l=fC(e,u,n);c=ie(c);let d=i.fu(l);if(c instanceof wl)s.push(l);else{let h=$s(c,d);h!=null&&(s.push(l),o.set(l,h))}});let a=new Xt(s);return new Gp(o,a,i.fieldTransforms)}function dC(t,e,n,r,i,s){let o=t.Su(1,e,n),a=[SI(e,r,n)],u=[i];if(s.length%2!=0)throw new w(y.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let h=0;h<s.length;h+=2)a.push(SI(e,s[h])),u.push(s[h+1]);let c=[],l=St.empty();for(let h=a.length-1;h>=0;--h)if(!ek(c,a[h])){let f=a[h],p=u[h];p=ie(p);let g=o.fu(f);if(p instanceof wl)c.push(f);else{let _=$s(p,g);_!=null&&(c.push(f),l.set(f,_))}}let d=new Xt(c);return new Gp(l,d,o.fieldTransforms)}function ZP(t,e,n,r=!1){return $s(n,t.Su(r?4:3,e))}function $s(t,e){if(JP(t=ie(t)))return hC("Unsupported field value:",e,t),XP(t,e);if(t instanceof jr)return function(r,i){if(!QP(i.du))throw i.pu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.pu(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Vu&&e.du!==4)throw e.pu("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let a of r){let u=$s(a,i.gu(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(t,e)}return function(r,i){if((r=ie(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return FN(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=Oe.fromDate(r);return{timestampValue:Sa(i.serializer,s)}}if(r instanceof Oe){let s=new Oe(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Sa(i.serializer,s)}}if(r instanceof Vs)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof gr)return{bytesValue:zN(i.serializer,r._byteString)};if(r instanceof Te){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.pu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:UI(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.pu(`Unsupported field value: ${ng(r)}`)}(t,e)}function XP(t,e){let n={};return _N(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Us(t,(r,i)=>{let s=$s(i,e.Ru(r));s!=null&&(n[r]=s)}),{mapValue:{fields:n}}}function JP(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Oe||t instanceof Vs||t instanceof gr||t instanceof Te||t instanceof jr)}function hC(t,e,n){if(!JP(n)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(n)){let r=ng(n);throw r==="an object"?e.pu(t+" a custom object"):e.pu(t+" "+r)}}function SI(t,e,n){if((e=ie(e))instanceof jn)return e._internalPath;if(typeof e=="string")return fC(t,e);throw Wp("Field path arguments must be of type string or ",t,!1,void 0,n)}var uz=new RegExp("[~\\*/\\[\\]]");function fC(t,e,n){if(e.search(uz)>=0)throw Wp(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new jn(...e.split("."))._internalPath}catch{throw Wp(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Wp(t,e,n,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new w(y.INVALID_ARGUMENT,a+t+u)}function ek(t,e){return t.some(n=>n.isEqual(e))}var Ls=class{constructor(e,n,r,i,s){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Te(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new AI(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let n=this._document.data.field(ig("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}},AI=class extends Ls{data(){return super.data()}};function ig(t,e){return typeof e=="string"?fC(t,e):e instanceof jn?e._internalPath:e._delegate._internalPath}function tk(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new w(y.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var El=class{},js=class extends El{};function $r(t,e,...n){let r=[];e instanceof El&&r.push(e),r=r.concat(n),function(s){let o=s.filter(u=>u instanceof xI).length,a=s.filter(u=>u instanceof Kp).length;if(o>1||o>0&&a>0)throw new w(y.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)t=i._apply(t);return t}var Kp=class t extends js{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new t(e,n,r)}_apply(e){let n=this._parse(e);return dk(e._query,n),new wt(e.firestore,e.converter,aE(e._query,n))}_parse(e){let n=Bs(e.firestore);return function(s,o,a,u,c,l,d){let h;if(c.isKeyField()){if(l==="array-contains"||l==="array-contains-any")throw new w(y.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if(l==="in"||l==="not-in"){oN(d,l);let f=[];for(let p of d)f.push(sN(u,s,p));h={arrayValue:{values:f}}}else h=sN(u,s,d)}else l!=="in"&&l!=="not-in"&&l!=="array-contains-any"||oN(d,l),h=ZP(a,o,d,l==="in"||l==="not-in");return ae.create(c,l,h)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}};function nk(t,e,n){let r=e,i=ig("where",t);return Kp._create(i,r,n)}var xI=class t extends El{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new t(e,n)}_parse(e){let n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:ve.create(n,this._getOperator())}_apply(e){let n=this._parse(e);return n.getFilters().length===0?e:(function(i,s){let o=i,a=s.getFlattenedFilters();for(let u of a)dk(o,u),o=aE(o,u)}(e._query,n),new wt(e.firestore,e.converter,aE(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var MI=class t extends js{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new t(e,n)}_apply(e){let n=function(i,s,o){if(i.startAt!==null)throw new w(y.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new w(y.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Rs(s,o)}(e._query,this._field,this._direction);return new wt(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new Vn(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,n))}};function rk(t,e="asc"){let n=e,r=ig("orderBy",t);return MI._create(r,n)}var Qp=class t extends js{constructor(e,n,r){super(),this.type=e,this._limit=n,this._limitType=r}static _create(e,n,r){return new t(e,n,r)}_apply(e){return new wt(e.firestore,e.converter,pp(e._query,this._limit,this._limitType))}};function ik(t){return kP("limit",t),Qp._create("limit",t,"F")}function sk(t){return kP("limitToLast",t),Qp._create("limitToLast",t,"L")}var Yp=class t extends js{constructor(e,n,r){super(),this.type=e,this._docOrFields=n,this._inclusive=r}static _create(e,n,r){return new t(e,n,r)}_apply(e){let n=lk(e,this.type,this._docOrFields,this._inclusive);return new wt(e.firestore,e.converter,function(i,s){return new Vn(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,n))}};function ok(...t){return Yp._create("startAt",t,!0)}function ak(...t){return Yp._create("startAfter",t,!1)}var Zp=class t extends js{constructor(e,n,r){super(),this.type=e,this._docOrFields=n,this._inclusive=r}static _create(e,n,r){return new t(e,n,r)}_apply(e){let n=lk(e,this.type,this._docOrFields,this._inclusive);return new wt(e.firestore,e.converter,function(i,s){return new Vn(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,n))}};function uk(...t){return Zp._create("endBefore",t,!1)}function ck(...t){return Zp._create("endAt",t,!0)}function lk(t,e,n,r){if(n[0]=ie(n[0]),n[0]instanceof Ls)return function(s,o,a,u,c){if(!u)throw new w(y.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let l=[];for(let d of va(s))if(d.field.isKeyField())l.push(Ms(o,u.key));else{let h=u.data.field(d.field);if(Jp(h))throw new w(y.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+d.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(h===null){let f=d.field.canonicalString();throw new w(y.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${f}' (used as the orderBy) does not exist.`)}l.push(h)}return new fr(l,c)}(t._query,t.firestore._databaseId,e,n[0]._document,r);{let i=Bs(t.firestore);return function(o,a,u,c,l,d){let h=o.explicitOrderBy;if(l.length>h.length)throw new w(y.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let f=[];for(let p=0;p<l.length;p++){let g=l[p];if(h[p].field.isKeyField()){if(typeof g!="string")throw new w(y.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof g}`);if(!LI(o)&&g.indexOf("/")!==-1)throw new w(y.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${g}' contains a slash.`);let _=o.path.child(le.fromString(g));if(!b.isDocumentKey(_))throw new w(y.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${_}' is not because it contains an odd number of segments.`);let C=new b(_);f.push(Ms(a,C))}else{let _=ZP(u,c,g);f.push(_)}}return new fr(f,d)}(t._query,t.firestore._databaseId,i,e,n,r)}}function sN(t,e,n){if(typeof(n=ie(n))=="string"){if(n==="")throw new w(y.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!LI(e)&&n.indexOf("/")!==-1)throw new w(y.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=e.path.child(le.fromString(n));if(!b.isDocumentKey(r))throw new w(y.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ms(t,new b(r))}if(n instanceof Te)return Ms(t,n._key);throw new w(y.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ng(n)}.`)}function oN(t,e){if(!Array.isArray(t)||t.length===0)throw new w(y.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function dk(t,e){let n=function(i,s){for(let o of i)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(t.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new w(y.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new w(y.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}var Fa=class{convertValue(e,n="none"){switch(xs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Le(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Ii(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 10:return this.convertObject(e.mapValue,n);default:throw N()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){let r={};return Us(e,(i,s)=>{r[i]=this.convertValue(s,n)}),r}convertGeoPoint(e){return new Vs(Le(e.latitude),Le(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":let r=FI(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(nl(e));default:return null}}convertTimestamp(e){let n=Ei(e);return new Oe(n.seconds,n.nanos)}convertDocumentKey(e,n){let r=le.fromString(e);O(rP(r));let i=new Ci(r.get(1),r.get(3)),s=new b(r.popFirst(5));return i.isEqual(n)||He(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),s}};function sg(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}var RI=class extends Fa{constructor(e){super(),this.firestore=e}convertBytes(e){return new gr(e)}convertReference(e){let n=this.convertDocumentKey(e,this.firestore._databaseId);return new Te(this.firestore,null,n)}};var Or=class{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},wn=class extends Ls{constructor(e,n,r,i,s,o){super(e,n,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let n=new vi(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){let r=this._document.data.field(ig("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}},vi=class extends wn{data(e={}){return super.data(e)}},Un=class{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new Or(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new vi(this._firestore,this._userDataWriter,r.key,r,new Or(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new w(y.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let u=new vi(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Or(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let u=new vi(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Or(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),c=-1,l=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:cz(a.type),doc:u,oldIndex:c,newIndex:l}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}};function cz(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return N()}}function pC(t,e){return t instanceof wn&&e instanceof wn?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(t._document===null?e._document===null:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Un&&e instanceof Un&&t._firestore===e._firestore&&cC(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function hk(t){t=de(t,Te);let e=de(t.firestore,Ne);return RP(st(e),t._key).then(n=>_C(e,t,n))}var Ur=class extends Fa{constructor(e){super(),this.firestore=e}convertBytes(e){return new gr(e)}convertReference(e){let n=this.convertDocumentKey(e,this.firestore._databaseId);return new Te(this.firestore,null,n)}};function fk(t){t=de(t,Te);let e=de(t.firestore,Ne),n=st(e),r=new Ur(e);return nz(n,t._key).then(i=>new wn(e,r,t._key,i,new Or(i!==null&&i.hasLocalMutations,!0),t.converter))}function pk(t){t=de(t,Te);let e=de(t.firestore,Ne);return RP(st(e),t._key,{source:"server"}).then(n=>_C(e,t,n))}function gk(t){t=de(t,wt);let e=de(t.firestore,Ne),n=st(e),r=new Ur(e);return tk(t._query),NP(n,t._query).then(i=>new Un(e,r,t,i))}function mk(t){t=de(t,wt);let e=de(t.firestore,Ne),n=st(e),r=new Ur(e);return rz(n,t._query).then(i=>new Un(e,r,t,i))}function yk(t){t=de(t,wt);let e=de(t.firestore,Ne),n=st(e),r=new Ur(e);return NP(n,t._query,{source:"server"}).then(i=>new Un(e,r,t,i))}function gC(t,e,n){t=de(t,Te);let r=de(t.firestore,Ne),i=sg(t.converter,e,n);return Ha(r,[rg(Bs(r),"setDoc",t._key,i,t.converter!==null,n).toMutation(t._key,je.none())])}function mC(t,e,n,...r){t=de(t,Te);let i=de(t.firestore,Ne),s=Bs(i),o;return o=typeof(e=ie(e))=="string"||e instanceof jn?dC(s,"updateDoc",t._key,e,n,r):lC(s,"updateDoc",t._key,e),Ha(i,[o.toMutation(t._key,je.exists(!0))])}function _k(t){return Ha(de(t.firestore,Ne),[new Ai(t._key,je.none())])}function vk(t,e){let n=de(t.firestore,Ne),r=Al(t),i=sg(t.converter,e);return Ha(n,[rg(Bs(t.firestore),"addDoc",r._key,i,t.converter!==null,{}).toMutation(r._key,je.exists(!1))]).then(()=>r)}function yC(t,...e){var n,r,i;t=ie(t);let s={includeMetadataChanges:!1},o=0;typeof e[o]!="object"||vI(e[o])||(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges};if(vI(e[o])){let d=e[o];e[o]=(n=d.next)===null||n===void 0?void 0:n.bind(d),e[o+1]=(r=d.error)===null||r===void 0?void 0:r.bind(d),e[o+2]=(i=d.complete)===null||i===void 0?void 0:i.bind(d)}let u,c,l;if(t instanceof Te)c=de(t.firestore,Ne),l=La(t._key.path),u={next:d=>{e[o]&&e[o](_C(c,t,d))},error:e[o+1],complete:e[o+2]};else{let d=de(t,wt);c=de(d.firestore,Ne),l=d._query;let h=new Ur(c);u={next:f=>{e[o]&&e[o](new Un(c,h,d,f))},error:e[o+1],complete:e[o+2]},tk(t._query)}return function(h,f,p,g){let _=new ka(g),C=new yl(f,_,p);return h.asyncQueue.enqueueAndForget(()=>v(this,null,function*(){return WI(yield Oa(h),C)})),()=>{_.La(),h.asyncQueue.enqueueAndForget(()=>v(this,null,function*(){return KI(yield Oa(h),C)}))}}(st(c),l,a,u)}function wk(t,e){return iz(st(t=de(t,Ne)),vI(e)?e:{next:e})}function Ha(t,e){return function(r,i){let s=new et;return r.asyncQueue.enqueueAndForget(()=>v(this,null,function*(){return VG(yield iC(r),i,s)})),s.promise}(st(t),e)}function _C(t,e,n){let r=n.docs.get(e._key),i=new Ur(t);return new wn(t,i,e._key,r,new Or(n.hasPendingWrites,n.fromCache),e.converter)}var lz={maxAttempts:5};var Xp=class{constructor(e,n){this._firestore=e,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=Bs(e)}set(e,n,r){this._verifyNotCommitted();let i=yi(e,this._firestore),s=sg(i.converter,n,r),o=rg(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,je.none())),this}update(e,n,r,...i){this._verifyNotCommitted();let s=yi(e,this._firestore),o;return o=typeof(n=ie(n))=="string"||n instanceof jn?dC(this._dataReader,"WriteBatch.update",s._key,n,r,i):lC(this._dataReader,"WriteBatch.update",s._key,n),this._mutations.push(o.toMutation(s._key,je.exists(!0))),this}delete(e){this._verifyNotCommitted();let n=yi(e,this._firestore);return this._mutations=this._mutations.concat(new Ai(n._key,je.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new w(y.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function yi(t,e){if((t=ie(t)).firestore!==e)throw new w(y.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var NI=class extends class{constructor(n,r){this._firestore=n,this._transaction=r,this._dataReader=Bs(n)}get(n){let r=yi(n,this._firestore),i=new RI(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return N();let o=s[0];if(o.isFoundDocument())return new Ls(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new Ls(this._firestore,i,r._key,null,r.converter);throw N()})}set(n,r,i){let s=yi(n,this._firestore),o=sg(s.converter,r,i),a=rg(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,a),this}update(n,r,i,...s){let o=yi(n,this._firestore),a;return a=typeof(r=ie(r))=="string"||r instanceof jn?dC(this._dataReader,"Transaction.update",o._key,r,i,s):lC(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(n){let r=yi(n,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,n){super(e,n),this._firestore=e}get(e){let n=yi(e,this._firestore),r=new Ur(this._firestore);return super.get(e).then(i=>new wn(this._firestore,r,n._key,i._document,new Or(!1,!1),n.converter))}};function Ek(t,e,n){t=de(t,Ne);let r=Object.assign(Object.assign({},lz),n);return function(s){if(s.maxAttempts<1)throw new w(y.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){let u=new et;return s.asyncQueue.enqueueAndForget(()=>v(this,null,function*(){let c=yield JG(s);new gI(s.asyncQueue,c,a,o,u).ja()})),u.promise}(st(t),i=>e(new NI(t,i)),r)}function Ik(){return new wl("deleteField")}function Ck(){return new CI("serverTimestamp")}function Dk(...t){return new DI("arrayUnion",t)}function Tk(...t){return new TI("arrayRemove",t)}function bk(t){return new bI("increment",t)}(function(e,n=!0){(function(i){Va=i})(vd),$i(new qt("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new Ne(new Lw(r.getProvider("auth-internal")),new $w(r.getProvider("app-check-internal")),function(c,l){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new w(y.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ci(c.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:n},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Dn(uR,"4.4.2",e),Dn(uR,"4.4.2","esm2017")})();var dz="@firebase/firestore-compat",hz="0.3.25";function DC(t,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new w("invalid-argument",`Invalid options passed to function ${t}(): You cannot specify both "merge" and "mergeFields".`);return e}function Sk(){if(typeof Uint8Array>"u")throw new w("unimplemented","Uint8Arrays are not available in this environment.")}function Ak(){if(!vN())throw new w("unimplemented","Blobs are unavailable in Firestore in this environment.")}var og=class t{constructor(e){this._delegate=e}static fromBase64String(e){return Ak(),new t(gr.fromBase64String(e))}static fromUint8Array(e){return Sk(),new t(gr.fromUint8Array(e))}toBase64(){return Ak(),this._delegate.toBase64()}toUint8Array(){return Sk(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function vC(t){return fz(t,["next","error","complete"])}function fz(t,e){if(typeof t!="object"||t===null)return!1;let n=t;for(let r of e)if(r in n&&typeof n[r]=="function")return!0;return!1}var wC=class{enableIndexedDbPersistence(e,n){return jP(e._delegate,{forceOwnership:n})}enableMultiTabIndexedDbPersistence(e){return UP(e._delegate)}clearIndexedDbPersistence(e){return $P(e._delegate)}},ag=class{constructor(e,n,r){this._delegate=n,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Ci||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let n=this._delegate._getSettings();!e.merge&&n.host!==e.host&&_n("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},n),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,n,r={}){OP(this._delegate,e,n,r)}enableNetwork(){return qP(this._delegate)}disableNetwork(){return GP(this._delegate)}enablePersistence(e){let n=!1,r=!1;return e&&(n=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,oC("synchronizeTabs",n,"experimentalForceOwningTab",r)),n?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return HP(this._delegate)}onSnapshotsInSync(e){return wk(this._delegate,e)}get app(){if(!this._appCompat)throw new w("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new za(this,aC(this._delegate,e))}catch(n){throw Pt(n,"collection()","Firestore.collection()")}}doc(e){try{return new mr(this,Al(this._delegate,e))}catch(n){throw Pt(n,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new zs(this,FP(this._delegate,e))}catch(n){throw Pt(n,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return Ek(this._delegate,n=>e(new ug(this,n)))}batch(){return st(this._delegate),new cg(new Xp(this._delegate,e=>Ha(this._delegate,e)))}loadBundle(e){return zP(this._delegate,e)}namedQuery(e){return WP(this._delegate,e).then(n=>n?new zs(this,n):null)}},qa=class extends Fa{constructor(e){super(),this.firestore=e}convertBytes(e){return new og(new gr(e))}convertReference(e){let n=this.convertDocumentKey(e,this.firestore._databaseId);return mr.forKey(n,this.firestore,null)}};function pz(t){aN(t)}var ug=class{constructor(e,n){this._firestore=e,this._delegate=n,this._userDataWriter=new qa(e)}get(e){let n=Hs(e);return this._delegate.get(n).then(r=>new qs(this._firestore,new wn(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,n.converter)))}set(e,n,r){let i=Hs(e);return r?(DC("Transaction.set",r),this._delegate.set(i,n,r)):this._delegate.set(i,n),this}update(e,n,r,...i){let s=Hs(e);return arguments.length===2?this._delegate.update(s,n):this._delegate.update(s,n,r,...i),this}delete(e){let n=Hs(e);return this._delegate.delete(n),this}},cg=class{constructor(e){this._delegate=e}set(e,n,r){let i=Hs(e);return r?(DC("WriteBatch.set",r),this._delegate.set(i,n,r)):this._delegate.set(i,n),this}update(e,n,r,...i){let s=Hs(e);return arguments.length===2?this._delegate.update(s,n):this._delegate.update(s,n,r,...i),this}delete(e){let n=Hs(e);return this._delegate.delete(n),this}commit(){return this._delegate.commit()}},Ga=class t{constructor(e,n,r){this._firestore=e,this._userDataWriter=n,this._delegate=r}fromFirestore(e,n){let r=new vi(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Gs(this._firestore,r),n??{})}toFirestore(e,n){return n?this._delegate.toFirestore(e,n):this._delegate.toFirestore(e)}static getInstance(e,n){let r=t.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(n);return s||(s=new t(e,new qa(e),n),i.set(n,s)),s}};Ga.INSTANCES=new WeakMap;var mr=class t{constructor(e,n){this.firestore=e,this._delegate=n,this._userDataWriter=new qa(e)}static forPath(e,n,r){if(e.length%2!==0)throw new w("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new t(n,new Te(n._delegate,r,new b(e)))}static forKey(e,n,r){return new t(n,new Te(n._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new za(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new za(this.firestore,aC(this._delegate,e))}catch(n){throw Pt(n,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ie(e),e instanceof Te?uC(this._delegate,e):!1}set(e,n){n=DC("DocumentReference.set",n);try{return n?gC(this._delegate,e,n):gC(this._delegate,e)}catch(r){throw Pt(r,"setDoc()","DocumentReference.set()")}}update(e,n,...r){try{return arguments.length===1?mC(this._delegate,e):mC(this._delegate,e,n,...r)}catch(i){throw Pt(i,"updateDoc()","DocumentReference.update()")}}delete(){return _k(this._delegate)}onSnapshot(...e){let n=xk(e),r=Mk(e,i=>new qs(this.firestore,new wn(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return yC(this._delegate,n,r)}get(e){let n;return e?.source==="cache"?n=fk(this._delegate):e?.source==="server"?n=pk(this._delegate):n=hk(this._delegate),n.then(r=>new qs(this.firestore,new wn(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new t(this.firestore,e?this._delegate.withConverter(Ga.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Pt(t,e,n){return t.message=t.message.replace(e,n),t}function xk(t){for(let e of t)if(typeof e=="object"&&!vC(e))return e;return{}}function Mk(t,e){var n,r;let i;return vC(t[0])?i=t[0]:vC(t[1])?i=t[1]:typeof t[0]=="function"?i={next:t[0],error:t[1],complete:t[2]}:i={next:t[1],error:t[2],complete:t[3]},{next:s=>{i.next&&i.next(e(s))},error:(n=i.error)===null||n===void 0?void 0:n.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var qs=class{constructor(e,n){this._firestore=e,this._delegate=n}get ref(){return new mr(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,n){return this._delegate.get(e,n)}isEqual(e){return pC(this._delegate,e._delegate)}},Gs=class extends qs{data(e){let n=this._delegate.data(e);return this._delegate._converter||uN(n!==void 0,"Document in a QueryDocumentSnapshot should exist"),n}},zs=class t{constructor(e,n){this.firestore=e,this._delegate=n,this._userDataWriter=new qa(e)}where(e,n,r){try{return new t(this.firestore,$r(this._delegate,nk(e,n,r)))}catch(i){throw Pt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,n){try{return new t(this.firestore,$r(this._delegate,rk(e,n)))}catch(r){throw Pt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new t(this.firestore,$r(this._delegate,ik(e)))}catch(n){throw Pt(n,"limit()","Query.limit()")}}limitToLast(e){try{return new t(this.firestore,$r(this._delegate,sk(e)))}catch(n){throw Pt(n,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new t(this.firestore,$r(this._delegate,ok(...e)))}catch(n){throw Pt(n,"startAt()","Query.startAt()")}}startAfter(...e){try{return new t(this.firestore,$r(this._delegate,ak(...e)))}catch(n){throw Pt(n,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new t(this.firestore,$r(this._delegate,uk(...e)))}catch(n){throw Pt(n,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new t(this.firestore,$r(this._delegate,ck(...e)))}catch(n){throw Pt(n,"endAt()","Query.endAt()")}}isEqual(e){return cC(this._delegate,e._delegate)}get(e){let n;return e?.source==="cache"?n=mk(this._delegate):e?.source==="server"?n=yk(this._delegate):n=gk(this._delegate),n.then(r=>new xl(this.firestore,new Un(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let n=xk(e),r=Mk(e,i=>new xl(this.firestore,new Un(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return yC(this._delegate,n,r)}withConverter(e){return new t(this.firestore,e?this._delegate.withConverter(Ga.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},EC=class{constructor(e,n){this._firestore=e,this._delegate=n}get type(){return this._delegate.type}get doc(){return new Gs(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},xl=class{constructor(e,n){this._firestore=e,this._delegate=n}get query(){return new zs(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Gs(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(n=>new EC(this._firestore,n))}forEach(e,n){this._delegate.forEach(r=>{e.call(n,new Gs(this._firestore,r))})}isEqual(e){return pC(this._delegate,e._delegate)}},za=class t extends zs{constructor(e,n){super(e,n),this.firestore=e,this._delegate=n}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new mr(this.firestore,e):null}doc(e){try{return e===void 0?new mr(this.firestore,Al(this._delegate)):new mr(this.firestore,Al(this._delegate,e))}catch(n){throw Pt(n,"doc()","CollectionReference.doc()")}}add(e){return vk(this._delegate,e).then(n=>new mr(this.firestore,n))}isEqual(e){return uC(this._delegate,e._delegate)}withConverter(e){return new t(this.firestore,e?this._delegate.withConverter(Ga.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Hs(t){return de(t,Te)}var IC=class t{constructor(...e){this._delegate=new jn(...e)}static documentId(){return new t(qe.keyField().canonicalString())}isEqual(e){return e=ie(e),e instanceof jn?this._delegate._internalPath.isEqual(e._internalPath):!1}};var CC=class t{constructor(e){this._delegate=e}static serverTimestamp(){let e=Ck();return e._methodName="FieldValue.serverTimestamp",new t(e)}static delete(){let e=Ik();return e._methodName="FieldValue.delete",new t(e)}static arrayUnion(...e){let n=Dk(...e);return n._methodName="FieldValue.arrayUnion",new t(n)}static arrayRemove(...e){let n=Tk(...e);return n._methodName="FieldValue.arrayRemove",new t(n)}static increment(e){let n=bk(e);return n._methodName="FieldValue.increment",new t(n)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var gz={Firestore:ag,GeoPoint:Vs,Timestamp:Oe,Blob:og,Transaction:ug,WriteBatch:cg,DocumentReference:mr,DocumentSnapshot:qs,Query:zs,QueryDocumentSnapshot:Gs,QuerySnapshot:xl,CollectionReference:za,FieldPath:IC,FieldValue:CC,setLogLevel:pz,CACHE_SIZE_UNLIMITED:VP};function mz(t,e){t.INTERNAL.registerComponent(new qt("firestore-compat",n=>{let r=n.getProvider("app-compat").getImmediate(),i=n.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},gz)))}function yz(t){mz(t,(e,n)=>new ag(e,n,new wC)),t.registerVersion(dz,hz)}yz(pt);function _z(t,e=Wi){return new J(n=>{let r;return e!=null?e.schedule(()=>{r=t.onSnapshot({includeMetadataChanges:!0},n)}):r=t.onSnapshot({includeMetadataChanges:!0},n),()=>{r?.()}})}function Rk(t,e){return _z(t,e)}function vz(t,e){return Rk(t,e).pipe(Qi(void 0),vu(),F(n=>{let[r,i]=n;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function SC(t,e){return Rk(t,e).pipe(F(n=>({payload:n,type:"query"})))}var lg=class{ref;afs;constructor(e,n){this.ref=e,this.afs=n}set(e,n){return this.ref.set(e,n)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,n){let r=this.ref.collection(e),{ref:i,query:s}=kk(r,n);return new hg(i,s,this.afs)}snapshotChanges(){return vz(this.ref,this.afs.schedulers.outsideAngular).pipe($e)}valueChanges(e={}){return this.snapshotChanges().pipe(F(({payload:n})=>e.idField?he(x({},n.data()),{[e.idField]:n.id}):n.data()))}get(e){return fe(this.ref.get(e)).pipe($e)}};function dg(t,e){return SC(t,e).pipe(Qi(void 0),vu(),F(n=>{let[r,i]=n,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,u)=>{let c=s.find(d=>d.doc.ref.isEqual(a.ref)),l=r?.payload.docs.find(d=>d.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&l&&JSON.stringify(l.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:u,newIndex:u,type:"modified",doc:a}})}),o}))}function Nk(t,e,n){return dg(t,n).pipe(Gn((r,i)=>wz(r,i.map(s=>s.payload),e),[]),yu(),F(r=>r.map(i=>({type:i.type,payload:i}))))}function wz(t,e,n){return e.forEach(r=>{n.indexOf(r.type)>-1&&(t=Ez(t,r))}),t}function TC(t,e,n,...r){let i=t.slice();return i.splice(e,n,...r),i}function Ez(t,e){switch(e.type){case"added":if(!(t[e.newIndex]&&t[e.newIndex].doc.ref.isEqual(e.doc.ref)))return TC(t,e.newIndex,0,e);break;case"modified":if(t[e.oldIndex]==null||t[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let n=t.slice();return n.splice(e.oldIndex,1),n.splice(e.newIndex,0,e),n}else return TC(t,e.newIndex,1,e);break;case"removed":if(t[e.oldIndex]&&t[e.oldIndex].doc.ref.isEqual(e.doc.ref))return TC(t,e.oldIndex,1);break}return t}function Pk(t){return(!t||t.length===0)&&(t=["added","removed","modified"]),t}var hg=class{ref;query;afs;constructor(e,n,r){this.ref=e,this.query=n,this.afs=r}stateChanges(e){let n=dg(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(n=n.pipe(F(r=>r.filter(i=>e.indexOf(i.type)>-1)))),n.pipe(Qi(void 0),vu(),yt(([r,i])=>i.length>0||!r),F(([,r])=>r),$e)}auditTrail(e){return this.stateChanges(e).pipe(Gn((n,r)=>[...n,...r],[]))}snapshotChanges(e){let n=Pk(e);return Nk(this.query,n,this.afs.schedulers.outsideAngular).pipe($e)}valueChanges(e={}){return SC(this.query,this.afs.schedulers.outsideAngular).pipe(F(n=>n.payload.docs.map(r=>e.idField?he(x({},r.data()),{[e.idField]:r.id}):r.data())),$e)}get(e){return fe(this.query.get(e)).pipe($e)}add(e){return this.ref.add(e)}doc(e){return new lg(this.ref.doc(e),this.afs)}},bC=class{query;afs;constructor(e,n){this.query=e,this.afs=n}stateChanges(e){return!e||e.length===0?dg(this.query,this.afs.schedulers.outsideAngular).pipe($e):dg(this.query,this.afs.schedulers.outsideAngular).pipe(F(n=>n.filter(r=>e.indexOf(r.type)>-1)),yt(n=>n.length>0),$e)}auditTrail(e){return this.stateChanges(e).pipe(Gn((n,r)=>[...n,...r],[]))}snapshotChanges(e){let n=Pk(e);return Nk(this.query,n,this.afs.schedulers.outsideAngular).pipe($e)}valueChanges(e={}){return SC(this.query,this.afs.schedulers.outsideAngular).pipe(F(r=>r.payload.docs.map(i=>e.idField?x({[e.idField]:i.id},i.data()):i.data())),$e)}get(e){return fe(this.query.get(e)).pipe($e)}},Iz=new P("angularfire2.enableFirestorePersistence"),Cz=new P("angularfire2.firestore.persistenceSettings"),Dz=new P("angularfire2.firestore.settings"),Tz=new P("angularfire2.firestore.use-emulator");function kk(t,e=n=>n){return{query:e(t),ref:t}}var Ok=(()=>{class t{schedulers;firestore;persistenceEnabled$;constructor(n,r,i,s,o,a,u,c,l,d,h,f,p,g,_,C,M){this.schedulers=u;let T=gs(n,a,r),j=l;d&&_c(T,a,h,p,g,_,f,C),[this.firestore,this.persistenceEnabled$]=ta(`${T.name}.firestore`,"AngularFirestore",T.name,()=>{let $=a.runOutsideAngular(()=>T.firestore());if(s&&$.settings(s),j&&$.useEmulator(...j),i&&!cs(o)){let Y=()=>{try{return fe($.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(xe){return typeof console<"u"&&console.warn(xe),V(!1)}};return[$,a.runOutsideAngular(Y)]}else return[$,V(!1)]},[s,j,i])}collection(n,r){let i;typeof n=="string"?i=this.firestore.collection(n):i=n;let{ref:s,query:o}=kk(i,r),a=this.schedulers.ngZone.run(()=>s);return new hg(a,o,this)}collectionGroup(n,r){let i=r||(o=>o),s=this.firestore.collectionGroup(n);return new bC(i(s),this)}doc(n){let r;typeof n=="string"?r=this.firestore.doc(n):r=n;let i=this.schedulers.ngZone.run(()=>r);return new lg(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||t)(I(li),I(di,8),I(Iz,8),I(Dz,8),I(Ct),I(se),I(ea),I(Cz,8),I(Tz,8),I(yf,8),I(hc,8),I(fc,8),I(pc,8),I(gc,8),I(mc,8),I(yc,8),I(Rr,8))};static \u0275prov=k({token:t,factory:t.\u0275fac,providedIn:"any"})}return t})();var Fk=(()=>{let e=class e{constructor(r){this.firestore=r}getLibros(){return this.firestore.collection("libros").snapshotChanges()}createLibro(r){return this.firestore.collection("libros").add(Object.assign({},r))}updateLibro(r){this.firestore.doc("libros/"+r.id).update(r)}deleteLibro(r){this.firestore.doc("libros/"+r).delete()}};e.\u0275fac=function(i){return new(i||e)(I(Ok))},e.\u0275prov=k({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var qk=(()=>{let e=class e{constructor(r,i){this._renderer=r,this._elementRef=i,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(r,i){this._renderer.setProperty(this._elementRef.nativeElement,r,i)}registerOnTouched(r){this.onTouched=r}registerOnChange(r){this.onChange=r}setDisabledState(r){this.setProperty("disabled",r)}};e.\u0275fac=function(i){return new(i||e)(ke(Vo),ke(ss))},e.\u0275dir=Xn({type:e});let t=e;return t})(),Az=(()=>{let e=class e extends qk{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Vu(e)))(s||e)}})(),e.\u0275dir=Xn({type:e,features:[Uo]});let t=e;return t})(),Gk=new P("");var xz={provide:Gk,useExisting:ku(()=>mg),multi:!0};function Mz(){let t=tr()?tr().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}var Rz=new P(""),mg=(()=>{let e=class e extends qk{constructor(r,i,s){super(r,i),this._compositionMode=s,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!Mz())}writeValue(r){let i=r??"";this.setProperty("value",i)}_handleInput(r){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(r)}_compositionStart(){this._composing=!0}_compositionEnd(r){this._composing=!1,this._compositionMode&&this.onChange(r)}};e.\u0275fac=function(i){return new(i||e)(ke(Vo),ke(ss),ke(Rz,8))},e.\u0275dir=Xn({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,s){i&1&&Kt("input",function(a){return s._handleInput(a.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(a){return s._compositionEnd(a.target.value)})},features:[T_([xz]),Uo]});let t=e;return t})();var Nz=new P(""),Pz=new P("");function zk(t){return t!=null}function Wk(t){return as(t)?fe(t):t}function Kk(t){let e={};return t.forEach(n=>{e=n!=null?x(x({},e),n):e}),Object.keys(e).length===0?null:e}function Qk(t,e){return e.map(n=>n(t))}function kz(t){return!t.validate}function Yk(t){return t.map(e=>kz(e)?e:n=>e.validate(n))}function Oz(t){if(!t)return null;let e=t.filter(zk);return e.length==0?null:function(n){return Kk(Qk(n,e))}}function Zk(t){return t!=null?Oz(Yk(t)):null}function Fz(t){if(!t)return null;let e=t.filter(zk);return e.length==0?null:function(n){let r=Qk(n,e).map(Wk);return Pm(r).pipe(F(Kk))}}function Xk(t){return t!=null?Fz(Yk(t)):null}function Vk(t,e){return t===null?[e]:Array.isArray(t)?[...t,e]:[t,e]}function Vz(t){return t._rawValidators}function Lz(t){return t._rawAsyncValidators}function AC(t){return t?Array.isArray(t)?t:[t]:[]}function pg(t,e){return Array.isArray(t)?t.includes(e):t===e}function Lk(t,e){let n=AC(e);return AC(t).forEach(i=>{pg(n,i)||n.push(i)}),n}function jk(t,e){return AC(e).filter(n=>!pg(t,n))}var gg=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=Zk(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=Xk(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,n){return this.control?this.control.hasError(e,n):!1}getError(e,n){return this.control?this.control.getError(e,n):null}},xC=class extends gg{get formDirective(){return null}get path(){return null}},Nl=class extends gg{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},MC=class{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},jz={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},Uee=he(x({},jz),{"[class.ng-submitted]":"isSubmitted"}),Jk=(()=>{let e=class e extends MC{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(ke(Nl,2))},e.\u0275dir=Xn({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,s){i&2&&C_("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},features:[Uo]});let t=e;return t})();var Ml="VALID",fg="INVALID",Wa="PENDING",Rl="DISABLED";function Uz(t){return(yg(t)?t.validators:t)||null}function Bz(t){return Array.isArray(t)?Zk(t):t||null}function $z(t,e){return(yg(e)?e.asyncValidators:t)||null}function Hz(t){return Array.isArray(t)?Xk(t):t||null}function yg(t){return t!=null&&!Array.isArray(t)&&typeof t=="object"}var RC=class{constructor(e,n){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(n)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===Ml}get invalid(){return this.status===fg}get pending(){return this.status==Wa}get disabled(){return this.status===Rl}get enabled(){return this.status!==Rl}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(Lk(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(Lk(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(jk(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(jk(e,this._rawAsyncValidators))}hasValidator(e){return pg(this._rawValidators,e)}hasAsyncValidator(e){return pg(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(n=>{n.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(n=>{n.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=Wa,e.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){let n=this._parentMarkedDirty(e.onlySelf);this.status=Rl,this.errors=null,this._forEachChild(r=>{r.disable(he(x({},e),{onlySelf:!0}))}),this._updateValue(),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(he(x({},e),{skipPristineCheck:n})),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){let n=this._parentMarkedDirty(e.onlySelf);this.status=Ml,this._forEachChild(r=>{r.enable(he(x({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(he(x({},e),{skipPristineCheck:n})),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Ml||this.status===Wa)&&this._runAsyncValidator(e.emitEvent)),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(n=>n._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Rl:Ml}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=Wa,this._hasOwnPendingAsyncValidator=!0;let n=Wk(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,n={}){this.errors=e,this._updateControlsErrors(n.emitEvent!==!1)}get(e){let n=e;return n==null||(Array.isArray(n)||(n=n.split(".")),n.length===0)?null:n.reduce((r,i)=>r&&r._find(i),this)}getError(e,n){let r=n?this.get(n):this;return r&&r.errors?r.errors[e]:null}hasError(e,n){return!!this.getError(e,n)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new it,this.statusChanges=new it}_calculateStatus(){return this._allControlsDisabled()?Rl:this.errors?fg:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Wa)?Wa:this._anyControlsHaveStatus(fg)?fg:Ml}_anyControlsHaveStatus(e){return this._anyControls(n=>n.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){yg(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let n=this._parent&&this._parent.dirty;return!e&&!!n&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=Bz(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=Hz(this._rawAsyncValidators)}};var eO=new P("CallSetDisabledState",{providedIn:"root",factory:()=>NC}),NC="always";function qz(t,e){return[...e.path,t]}function Gz(t,e,n=NC){Wz(t,e),e.valueAccessor.writeValue(t.value),(t.disabled||n==="always")&&e.valueAccessor.setDisabledState?.(t.disabled),Kz(t,e),Yz(t,e),Qz(t,e),zz(t,e)}function Uk(t,e){t.forEach(n=>{n.registerOnValidatorChange&&n.registerOnValidatorChange(e)})}function zz(t,e){if(e.valueAccessor.setDisabledState){let n=r=>{e.valueAccessor.setDisabledState(r)};t.registerOnDisabledChange(n),e._registerOnDestroy(()=>{t._unregisterOnDisabledChange(n)})}}function Wz(t,e){let n=Vz(t);e.validator!==null?t.setValidators(Vk(n,e.validator)):typeof n=="function"&&t.setValidators([n]);let r=Lz(t);e.asyncValidator!==null?t.setAsyncValidators(Vk(r,e.asyncValidator)):typeof r=="function"&&t.setAsyncValidators([r]);let i=()=>t.updateValueAndValidity();Uk(e._rawValidators,i),Uk(e._rawAsyncValidators,i)}function Kz(t,e){e.valueAccessor.registerOnChange(n=>{t._pendingValue=n,t._pendingChange=!0,t._pendingDirty=!0,t.updateOn==="change"&&tO(t,e)})}function Qz(t,e){e.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,t.updateOn==="blur"&&t._pendingChange&&tO(t,e),t.updateOn!=="submit"&&t.markAsTouched()})}function tO(t,e){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}function Yz(t,e){let n=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};t.registerOnChange(n),e._registerOnDestroy(()=>{t._unregisterOnChange(n)})}function Zz(t,e){if(!t.hasOwnProperty("model"))return!1;let n=t.model;return n.isFirstChange()?!0:!Object.is(e,n.currentValue)}function Xz(t){return Object.getPrototypeOf(t.constructor)===Az}function Jz(t,e){if(!e)return null;Array.isArray(e);let n,r,i;return e.forEach(s=>{s.constructor===mg?n=s:Xz(s)?r=s:i=s}),i||r||n||null}function Bk(t,e){let n=t.indexOf(e);n>-1&&t.splice(n,1)}function $k(t){return typeof t=="object"&&t!==null&&Object.keys(t).length===2&&"value"in t&&"disabled"in t}var eW=class extends RC{constructor(e=null,n,r){super(Uz(n),$z(r,n)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(n),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),yg(n)&&(n.nonNullable||n.initialValueIsDefault)&&($k(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,n={}){this.value=this._pendingValue=e,this._onChange.length&&n.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,n.emitViewToModelChange!==!1)),this.updateValueAndValidity(n)}patchValue(e,n={}){this.setValue(e,n)}reset(e=this.defaultValue,n={}){this._applyFormState(e),this.markAsPristine(n),this.markAsUntouched(n),this.setValue(this.value,n),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){Bk(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){Bk(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){$k(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var tW={provide:Nl,useExisting:ku(()=>PC)},Hk=Promise.resolve(),PC=(()=>{let e=class e extends Nl{constructor(r,i,s,o,a,u){super(),this._changeDetectorRef=a,this.callSetDisabledState=u,this.control=new eW,this._registered=!1,this.name="",this.update=new it,this._parent=r,this._setValidators(i),this._setAsyncValidators(s),this.valueAccessor=Jz(this,o)}ngOnChanges(r){if(this._checkForErrors(),!this._registered||"name"in r){if(this._registered&&(this._checkName(),this.formDirective)){let i=r.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in r&&this._updateDisabled(r),Zz(r,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(r){this.viewModel=r,this.update.emit(r)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){Gz(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(r){Hk.then(()=>{this.control.setValue(r,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(r){let i=r.isDisabled.currentValue,s=i!==0&&Hh(i);Hk.then(()=>{s&&!this.control.disabled?this.control.disable():!s&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(r){return this._parent?qz(r,this._parent):[r]}};e.\u0275fac=function(i){return new(i||e)(ke(xC,9),ke(Nz,10),ke(Pz,10),ke(Gk,10),ke(jo,8),ke(eO,8))},e.\u0275dir=Xn({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[hn.None,"disabled","isDisabled"],model:[hn.None,"ngModel","model"],options:[hn.None,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[T_([tW]),Uo,ko]});let t=e;return t})();var nW=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Ye({type:e}),e.\u0275inj=Qe({});let t=e;return t})();var nO=(()=>{let e=class e{static withConfig(r){return{ngModule:e,providers:[{provide:eO,useValue:r.callSetDisabledState??NC}]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Ye({type:e}),e.\u0275inj=Qe({imports:[nW]});let t=e;return t})();function iW(t,e){if(t&1){let n=YS();Ie(0,"tr")(1,"td"),Re(2),ye(),Ie(3,"td"),Re(4),ye(),Ie(5,"td"),Re(6),ye(),Ie(7,"td"),Re(8),ye(),Ie(9,"td")(10,"button",6),Kt("click",function(){let s=Nb(n).$implicit,o=XS();return Pb(o.selectLibro(s))}),Re(11," Seleccionar "),ye()()()}if(t&2){let n=e.$implicit;er(2),Bo(n.nombret),er(2),Bo(n.des),er(2),Bo(n.fecha),er(2),Bo(n.tipo)}}var rO=(()=>{let e=class e{constructor(r){this.libroService=r,this.libros=[],this.libro=new fs}ngOnInit(){this.libroService.getLibros().subscribe(r=>{this.libros=r.map(i=>he(x({},i.payload.doc.data()),{id:i.payload.doc.id}))})}insertarLibro(){this.libroService.createLibro(this.libro),this.libro=new fs}selectLibro(r){this.libro=r}updateLibro(){this.libroService.updateLibro(this.libro),this.libro=new fs}deleteLibro(r){this.libroService.deleteLibro(r),this.libro=new fs}};e.\u0275fac=function(i){return new(i||e)(ke(Fk))},e.\u0275cmp=No({type:e,selectors:[["app-libros"]],decls:62,vars:5,consts:[[1,"container"],[1,"form"],[1,"col-sm-4"],["for",""],["type","text",1,"form-control",3,"ngModel","ngModelChange"],[1,"datos"],["type","button",1,"btn","btn-primary",3,"click"],["type","button",1,"btn","btn-warning",3,"click"],["type","button",1,"btn","btn-danger",3,"click"],[1,"lista"],[1,"table","table","table-striped"],[4,"ngFor","ngForOf"]],template:function(i,s){i&1&&(Ie(0,"div",0)(1,"h1"),Re(2,"ALTA DE TAREAS"),ye(),Ie(3,"div",1)(4,"div",2)(5,"p")(6,"label",3),Re(7,"Nombre de la tarea"),ye(),Ie(8,"input",4),Kt("ngModelChange",function(a){return s.libro.nombret=a}),ye()(),Ie(9,"p")(10,"label",3),Re(11,"Descripcion"),ye(),Ie(12,"input",4),Kt("ngModelChange",function(a){return s.libro.des=a}),ye()(),Ie(13,"p")(14,"label",3),Re(15,"Fecha"),ye(),Ie(16,"input",4),Kt("ngModelChange",function(a){return s.libro.fecha=a}),ye()(),Ie(17,"p")(18,"label",3),Re(19,"Estado de la tarea"),ye(),Ie(20,"input",4),Kt("ngModelChange",function(a){return s.libro.tipo=a}),ye()(),Ie(21,"div",5)(22,"table")(23,"tr")(24,"td")(25,"button",6),Kt("click",function(){return s.insertarLibro()}),Re(26," Insertar "),ye()(),Ie(27,"td")(28,"button",7),Kt("click",function(){return s.updateLibro()}),Re(29," Actualizar "),ye()(),Ie(30,"td")(31,"button",8),Kt("click",function(){return s.deleteLibro(s.libro.id)}),Re(32," Eliminar "),ye()()()()(),Pn(33,"br"),ye(),Ie(34,"div",9)(35,"p")(36,"strong"),Re(37,"Tipos de cliente"),ye()(),Re(38," -Pendiente "),Pn(39,"br"),Re(40," -En Progreso "),Pn(41,"br"),Re(42," -Completado "),Pn(43,"br"),Re(44," -Sin definir "),Pn(45,"br")(46,"br")(47,"br"),ye()(),Ie(48,"table",10)(49,"thead")(50,"th"),Re(51,"Nombre de la tarea"),ye(),Ie(52,"th"),Re(53,"Descripcion"),ye(),Ie(54,"th"),Re(55,"Fecha de vencimiento"),ye(),Ie(56,"th"),Re(57,"Estado de la tarea"),ye(),Ie(58,"th"),Re(59,"Seleccionar"),ye()(),Ie(60,"tbody"),I_(61,iW,12,4,"tr",11),ye()()()),i&2&&(er(8),os("ngModel",s.libro.nombret),er(4),os("ngModel",s.libro.des),er(4),os("ngModel",s.libro.fecha),er(4),os("ngModel",s.libro.tipo),er(41),os("ngForOf",s.libros))},dependencies:[EA,mg,Jk,PC],styles:[".form[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}label[_ngcontent-%COMP%]{display:block;margin-bottom:8px}input[_ngcontent-%COMP%]{width:100%;padding:8px;margin-bottom:12px;box-sizing:border-box}.lista[_ngcontent-%COMP%]{container:right;margin-left:100px}.datos[_ngcontent-%COMP%]{container:center}h1[_ngcontent-%COMP%]{color:#4caf50;font-size:50px;font-weight:700;margin-bottom:10px;text-align:center}body[_ngcontent-%COMP%]{font-family:Arial,sans-serif;background-color:#f4f4f4;margin:0;padding:0;display:flex;justify-content:center;align-items:center;height:100vh}table[_ngcontent-%COMP%]{width:80%;border-collapse:collapse;margin-bottom:20px;box-shadow:0 0 20px #0000001a;border-radius:8px;overflow:hidden}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:15px;text-align:left;border-bottom:1px solid #ddd}tr[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}thead[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff}tbody[_ngcontent-%COMP%]{background-color:#fff;background-color:#70bd72}"]});let t=e;return t})();var iO=(()=>{let e=class e{constructor(){this.title="libros"}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=No({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(i,s){i&1&&Pn(0,"app-libros")},dependencies:[rO]});let t=e;return t})();var sO="@firebase/database",oO="1.0.3";var GD="";function zD(t){GD=t}var BC=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ze(n))}get(e){let n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:md(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var $C=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return sn(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var VO=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){let e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new BC(e)}}catch{}return new $C},Ks=VO("localStorage"),HC=VO("sessionStorage");var Za=new zr("@firebase/database"),LO=function(){let t=1;return function(){return t++}}(),jO=function(t){let e=BT(t),n=new UT;n.update(e);let r=n.digest();return fd.encodeByteArray(r)},nd=function(...t){let e="";for(let n=0;n<t.length;n++){let r=t[n];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=nd.apply(null,r):typeof r=="object"?e+=ze(r):e+=r,e+=" "}return e},Qs=null,aO=!0,UO=function(t,e){D(!e||t===!0||t===!1,"Can't turn on custom loggers persistently."),t===!0?(Za.logLevel=on.VERBOSE,Qs=Za.log.bind(Za),e&&HC.set("logging_enabled",!0)):typeof t=="function"?Qs=t:(Qs=null,HC.remove("logging_enabled"))},ht=function(...t){if(aO===!0&&(aO=!1,Qs===null&&HC.get("logging_enabled")===!0&&UO(!0)),Qs){let e=nd.apply(null,t);Qs(e)}},rd=function(t){return function(...e){ht(t,...e)}},qC=function(...t){let e="FIREBASE INTERNAL ERROR: "+nd(...t);Za.error(e)},vr=function(...t){let e=`FIREBASE FATAL ERROR: ${nd(...t)}`;throw Za.error(e),new Error(e)},At=function(...t){let e="FIREBASE WARNING: "+nd(...t);Za.warn(e)},oW=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&At("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Gg=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},aW=function(t){if(Hn()||document.readyState==="complete")t();else{let e=!1,n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},Fi="[MIN_NAME]",Hr="[MAX_NAME]",Zs=function(t,e){if(t===e)return 0;if(t===Fi||e===Hr)return-1;if(e===Fi||t===Hr)return 1;{let n=uO(t),r=uO(e);return n!==null?r!==null?n-r===0?t.length-e.length:n-r:-1:r!==null?1:t<e?-1:1}},uW=function(t,e){return t===e?0:t<e?-1:1},Pl=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+ze(e))},WD=function(t){if(typeof t!="object"||t===null)return ze(t);let e=[];for(let r in t)e.push(r);e.sort();let n="{";for(let r=0;r<e.length;r++)r!==0&&(n+=","),n+=ze(e[r]),n+=":",n+=WD(t[e[r]]);return n+="}",n},BO=function(t,e){let n=t.length;if(n<=e)return[t];let r=[];for(let i=0;i<n;i+=e)i+e>n?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r};function ft(t,e){for(let n in t)t.hasOwnProperty(n)&&e(n,t[n])}var $O=function(t){D(!Gg(t),"Invalid JSON number");let e=11,n=52,r=(1<<e-1)-1,i,s,o,a,u;t===0?(s=0,o=0,i=1/t===-1/0?1:0):(i=t<0,t=Math.abs(t),t>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),r),s=a+r,o=Math.round(t*Math.pow(2,n-a)-Math.pow(2,n))):(s=0,o=Math.round(t/Math.pow(2,1-r-n))));let c=[];for(u=n;u;u-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(u=e;u;u-=1)c.push(s%2?1:0),s=Math.floor(s/2);c.push(i?1:0),c.reverse();let l=c.join(""),d="";for(u=0;u<64;u+=8){let h=parseInt(l.substr(u,8),2).toString(16);h.length===1&&(h="0"+h),d=d+h}return d.toLowerCase()},cW=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},lW=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function dW(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");let r=new Error(t+" at "+e._path.toString()+": "+n);return r.code=t.toUpperCase(),r}var hW=new RegExp("^-?(0*)\\d{1,10}$"),fW=-2147483648,pW=2147483647,uO=function(t){if(hW.test(t)){let e=Number(t);if(e>=fW&&e<=pW)return e}return null},ou=function(t){try{t()}catch(e){setTimeout(()=>{let n=e.stack||"";throw At("Exception was thrown by user callback.",n),e},Math.floor(0))}},gW=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Vl=function(t,e){let n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};var GC=class{constructor(e,n){this.appName_=e,this.appCheckProvider=n,this.appCheck=n?.getImmediate({optional:!0}),this.appCheck||n?.get().then(r=>this.appCheck=r)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((n,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)===null||n===void 0||n.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){At(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var zC=class{constructor(e,n,r){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(ht("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',At(e)}},Ll=(()=>{class t{constructor(n){this.accessToken=n}getToken(n){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(n){n(this.accessToken)}removeTokenChangeListener(n){}notifyForInvalidToken(){}}t.OWNER="owner";return t})(),vg="5",HO="v",qO="s",GO="r",zO="f",WO=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,KO="ls",QO="p",WC="ac",YO="websocket",ZO="long_polling";var wg=class{constructor(e,n,r,i,s=!1,o="",a=!1,u=!1){this.secure=n,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ks.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ks.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}};function mW(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function XO(t,e,n){D(typeof e=="string","typeof type must == string"),D(typeof n=="object","typeof params must == object");let r;if(e===YO)r=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===ZO)r=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);mW(t)&&(n.ns=t.namespace);let i=[];return ft(n,(s,o)=>{i.push(s+"="+o)}),r+i.join("&")}var KC=class{constructor(){this.counters_={}}incrementCounter(e,n=1){sn(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return PT(this.counters_)}};var kC={},OC={};function KD(t){let e=t.toString();return kC[e]||(kC[e]=new KC),kC[e]}function yW(t,e){let n=t.toString();return OC[n]||(OC[n]=e()),OC[n]}var QC=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){let r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&ou(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var cO="start",_W="close",vW="pLPCommand",wW="pRTLPCB",JO="id",eF="pw",tF="ser",EW="cb",IW="seg",CW="ts",DW="d",TW="dframe",nF=1870,rF=30,bW=nF-rF,SW=25e3,AW=3e4,$l=class t{constructor(e,n,r,i,s,o,a){this.connId=e,this.repoInfo=n,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=rd(e),this.stats_=KD(n),this.urlFn=u=>(this.appCheckToken&&(u[WC]=this.appCheckToken),XO(n,ZO,u))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new QC(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(AW)),aW(()=>{if(this.isClosed_)return;this.scriptTagHolder=new YC((...s)=>{let[o,a,u,c,l]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===cO)this.id=a,this.password=u;else if(o===_W)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{let[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let r={};r[cO]="t",r[tF]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[EW]=this.scriptTagHolder.uniqueCallbackIdentifier),r[HO]=vg,this.transportSessionId&&(r[qO]=this.transportSessionId),this.lastSessionId&&(r[KO]=this.lastSessionId),this.applicationId&&(r[QO]=this.applicationId),this.appCheckToken&&(r[WC]=this.appCheckToken),typeof location<"u"&&location.hostname&&WO.test(location.hostname)&&(r[GO]=zO);let i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){t.forceAllow_=!0}static forceDisallow(){t.forceDisallow_=!0}static isAvailable(){return Hn()?!1:t.forceAllow_?!0:!t.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!cW()&&!lW()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let n=ze(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);let r=NT(n),i=BO(r,bW);for(let s=0;s<i.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[s]),this.curSegmentNum++}addDisconnectPingFrame(e,n){if(Hn())return;this.myDisconnFrame=document.createElement("iframe");let r={};r[TW]="t",r[JO]=e,r[eF]=n,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let n=ze(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}},YC=class t{constructor(e,n,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,Hn())this.commandCB=e,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=LO(),window[vW+this.uniqueCallbackIdentifier]=e,window[wW+this.uniqueCallbackIdentifier]=n,this.myIFrame=t.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){ht("frame writing exception"),a.stack&&ht(a.stack),ht(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||ht("No IE domain setting required")}catch{let r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[JO]=this.myID,e[eF]=this.myPW,e[tF]=this.currentSerial;let n=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+rF+r.length<=nF;){let o=this.pendingSegs.shift();r=r+"&"+IW+i+"="+o.seg+"&"+CW+i+"="+o.ts+"&"+DW+i+"="+o.d,i++}return n=n+r,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,r){this.pendingSegs.push({seg:e,ts:n,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);let r=()=>{this.outstandingRequests.delete(n),this.newRequest_()},i=setTimeout(r,Math.floor(SW)),s=()=>{clearTimeout(i),r()};this.addTag(e,s)}addTag(e,n){Hn()?this.doNodeLongPoll(e,n):setTimeout(()=>{try{if(!this.sendNewPolls)return;let r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){let i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),n())},r.onerror=()=>{ht("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}};var xW=16384,MW=45e3,Eg=null;typeof MozWebSocket<"u"?Eg=MozWebSocket:typeof WebSocket<"u"&&(Eg=WebSocket);var Qa=(()=>{class t{constructor(n,r,i,s,o,a,u){this.connId=n,this.applicationId=i,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=rd(this.connId),this.stats_=KD(r),this.connURL=t.connectionURL_(r,a,u,s,i),this.nodeAdmin=r.nodeAdmin}static connectionURL_(n,r,i,s,o){let a={};return a[HO]=vg,!Hn()&&typeof location<"u"&&location.hostname&&WO.test(location.hostname)&&(a[GO]=zO),r&&(a[qO]=r),i&&(a[KO]=i),s&&(a[WC]=s),o&&(a[QO]=o),XO(n,YO,a)}open(n,r){this.onDisconnect=r,this.onMessage=n,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ks.set("previous_websocket_failure",!0);try{let i;if(Hn()){let s=this.nodeAdmin?"AdminNode":"Node";i={headers:{"User-Agent":`Firebase/${vg}/${GD}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(i.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(i.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a})}this.mySock=new Eg(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){t.forceDisallow_=!0}static isAvailable(){let n=!1;if(typeof navigator<"u"&&navigator.userAgent){let r=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(r);i&&i.length>1&&parseFloat(i[1])<4.4&&(n=!0)}return!n&&Eg!==null&&!t.forceDisallow_}static previouslyFailed(){return Ks.isInMemoryStorage||Ks.get("previous_websocket_failure")===!0}markConnectionHealthy(){Ks.remove("previous_websocket_failure")}appendFrame_(n){if(this.frames.push(n),this.frames.length===this.totalFrames){let r=this.frames.join("");this.frames=null;let i=md(r);this.onMessage(i)}}handleNewFrameCount_(n){this.totalFrames=n,this.frames=[]}extractFrameCount_(n){if(D(this.frames===null,"We already have a frame buffer"),n.length<=6){let r=Number(n);if(!isNaN(r))return this.handleNewFrameCount_(r),null}return this.handleNewFrameCount_(1),n}handleIncomingFrame(n){if(this.mySock===null)return;let r=n.data;if(this.bytesReceived+=r.length,this.stats_.incrementCounter("bytes_received",r.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(r);else{let i=this.extractFrameCount_(r);i!==null&&this.appendFrame_(i)}}send(n){this.resetKeepAlive();let r=ze(n);this.bytesSent+=r.length,this.stats_.incrementCounter("bytes_sent",r.length);let i=BO(r,xW);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(MW))}sendString_(n){try{this.mySock.send(n)}catch(r){this.log_("Exception thrown from WebSocket.send():",r.message||r.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4;return t})(),iF=(()=>{class t{constructor(n){this.initTransports_(n)}static get ALL_TRANSPORTS(){return[$l,Qa]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(n){let r=Qa&&Qa.isAvailable(),i=r&&!Qa.previouslyFailed();if(n.webSocketOnly&&(r||At("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Qa];else{let s=this.transports_=[];for(let o of t.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);t.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}t.globalTransportInitialized_=!1;return t})(),RW=6e4,NW=5e3,PW=10*1024,kW=100*1024,FC="t",lO="d",OW="s",dO="r",FW="e",hO="o",fO="a",pO="n",gO="p",VW="h",ZC=class{constructor(e,n,r,i,s,o,a,u,c,l){this.id=e,this.repoInfo_=n,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=u,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=rd("c:"+this.id+":"),this.transportManager_=new iF(n),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,r)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Vl(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>kW?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>PW?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){let n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(FC in e){let n=e[FC];n===fO?this.upgradeIfSecondaryHealthy_():n===dO?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===hO&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let n=Pl("t",e),r=Pl("d",e);if(n==="c")this.onSecondaryControl_(r);else if(n==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:gO,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:fO,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:pO,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let n=Pl("t",e),r=Pl("d",e);n==="c"?this.onControl_(r):n==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let n=Pl(FC,e);if(lO in e){let r=e[lO];if(n===VW){let i=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(n===pO){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===OW?this.onConnectionShutdown_(r):n===dO?this.onReset_(r):n===FW?qC("Server Error: "+r):n===hO?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):qC("Unknown control packet command: "+n)}}onHandshake_(e){let n=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),vg!==r&&At("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Vl(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(RW))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Vl(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(NW))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:gO,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ks.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var Ig=class{put(e,n,r,i){}merge(e,n,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,r){}onDisconnectMerge(e,n,r){}onDisconnectCancel(e,n){}reportStats(e){}};var Cg=class{constructor(e){this.allowedEvents_=e,this.listeners_={},D(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){let r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,n)}}on(e,n,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:r});let i=this.getInitialEvent(e);i&&n.apply(r,i)}off(e,n,r){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let s=0;s<i.length;s++)if(i[s].callback===n&&(!r||r===i[s].context)){i.splice(s,1);return}}validateEventType_(e){D(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}};var Dg=class t extends Cg{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!hm()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new t}getInitialEvent(e){return D(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var mO=32,yO=768,ge=class{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}};function pe(){return new ge("")}function ee(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function Vi(t){return t.pieces_.length-t.pieceNum_}function De(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new ge(t.pieces_,e)}function QD(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function LW(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function Hl(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function sF(t){if(t.pieceNum_>=t.pieces_.length)return null;let e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new ge(e,0)}function Pe(t,e){let n=[];for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);if(e instanceof ge)for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{let r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&n.push(r[i])}return new ge(n,0)}function te(t){return t.pieceNum_>=t.pieces_.length}function kt(t,e){let n=ee(t),r=ee(e);if(n===null)return e;if(n===r)return kt(De(t),De(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function jW(t,e){let n=Hl(t,0),r=Hl(e,0);for(let i=0;i<n.length&&i<r.length;i++){let s=Zs(n[i],r[i]);if(s!==0)return s}return n.length===r.length?0:n.length<r.length?-1:1}function YD(t,e){if(Vi(t)!==Vi(e))return!1;for(let n=t.pieceNum_,r=e.pieceNum_;n<=t.pieces_.length;n++,r++)if(t.pieces_[n]!==e.pieces_[r])return!1;return!0}function En(t,e){let n=t.pieceNum_,r=e.pieceNum_;if(Vi(t)>Vi(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[r])return!1;++n,++r}return!0}var XC=class{constructor(e,n){this.errorPrefix_=n,this.parts_=Hl(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=fu(this.parts_[r]);oF(this)}};function UW(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=fu(e),oF(t)}function BW(t){let e=t.parts_.pop();t.byteLength_-=fu(e),t.parts_.length>0&&(t.byteLength_-=1)}function oF(t){if(t.byteLength_>yO)throw new Error(t.errorPrefix_+"has a key path longer than "+yO+" bytes ("+t.byteLength_+").");if(t.parts_.length>mO)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+mO+") or object contains a cycle "+Ws(t))}function Ws(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}var JC=class t extends Cg{constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{let r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}static getInstance(){return new t}getInitialEvent(e){return D(e==="visible","Unknown event type: "+e),[this.visible_]}};var kl=1e3,$W=60*5*1e3,_O=30*1e3,HW=1.3,qW=3e4,GW="server_kill",vO=3,ZD=(()=>{class t extends Ig{constructor(n,r,i,s,o,a,u,c){if(super(),this.repoInfo_=n,this.applicationId_=r,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=u,this.authOverride_=c,this.id=t.nextPersistentConnectionId_++,this.log_=rd("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=kl,this.maxReconnectDelay_=$W,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!Hn())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");JC.getInstance().on("visible",this.onVisible_,this),n.host.indexOf("fblocal")===-1&&Dg.getInstance().on("online",this.onOnline_,this)}sendRequest(n,r,i){let s=++this.requestNumber_,o={r:s,a:n,b:r};this.log_(ze(o)),D(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),i&&(this.requestCBHash_[s]=i)}get(n){this.initConnection_();let r=new ot,s={action:"g",request:{p:n._path.toString(),q:n._queryObject},onComplete:a=>{let u=a.d;a.s==="ok"?r.resolve(u):r.reject(u)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),r.promise}listen(n,r,i,s){this.initConnection_();let o=n._queryIdentifier,a=n._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),D(n._queryParams.isDefault()||!n._queryParams.loadsAllData(),"listen() called for non-default but complete query"),D(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let u={onComplete:s,hashFn:r,query:n,tag:i};this.listens.get(a).set(o,u),this.connected_&&this.sendListen_(u)}sendGet_(n){let r=this.outstandingGets_[n];this.sendRequest("g",r.request,i=>{delete this.outstandingGets_[n],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),r.onComplete&&r.onComplete(i)})}sendListen_(n){let r=n.query,i=r._path.toString(),s=r._queryIdentifier;this.log_("Listen on "+i+" for "+s);let o={p:i},a="q";n.tag&&(o.q=r._queryObject,o.t=n.tag),o.h=n.hashFn(),this.sendRequest(a,o,u=>{let c=u.d,l=u.s;t.warnOnListenWarnings_(c,r),(this.listens.get(i)&&this.listens.get(i).get(s))===n&&(this.log_("listen response",u),l!=="ok"&&this.removeListen_(i,s),n.onComplete&&n.onComplete(l,c))})}static warnOnListenWarnings_(n,r){if(n&&typeof n=="object"&&sn(n,"w")){let i=Gr(n,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){let s='".indexOn": "'+r._queryParams.getIndex().toString()+'"',o=r._path.toString();At(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(n){this.authToken_=n,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(n)}reduceReconnectDelayIfAdminCredential_(n){(n&&n.length===40||LT(n))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=_O)}refreshAppCheckToken(n){this.appCheckToken_=n,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let n=this.authToken_,r=VT(n)?"auth":"gauth",i={cred:n};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(r,i,s=>{let o=s.s,a=s.d||"error";this.authToken_===n&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},n=>{let r=n.s,i=n.d||"error";r==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(r,i)})}unlisten(n,r){let i=n._path.toString(),s=n._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),D(n._queryParams.isDefault()||!n._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,n._queryObject,r)}sendUnlisten_(n,r,i,s){this.log_("Unlisten on "+n+" for "+r);let o={p:n},a="n";s&&(o.q=i,o.t=s),this.sendRequest(a,o)}onDisconnectPut(n,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",n,r,i):this.onDisconnectRequestQueue_.push({pathString:n,action:"o",data:r,onComplete:i})}onDisconnectMerge(n,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",n,r,i):this.onDisconnectRequestQueue_.push({pathString:n,action:"om",data:r,onComplete:i})}onDisconnectCancel(n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",n,null,r):this.onDisconnectRequestQueue_.push({pathString:n,action:"oc",data:null,onComplete:r})}sendOnDisconnect_(n,r,i,s){let o={p:r,d:i};this.log_("onDisconnect "+n,o),this.sendRequest(n,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(n,r,i,s){this.putInternal("p",n,r,i,s)}merge(n,r,i,s){this.putInternal("m",n,r,i,s)}putInternal(n,r,i,s,o){this.initConnection_();let a={p:r,d:i};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:n,request:a,onComplete:s}),this.outstandingPutCount_++;let u=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(u):this.log_("Buffering put: "+r)}sendPut_(n){let r=this.outstandingPuts_[n].action,i=this.outstandingPuts_[n].request,s=this.outstandingPuts_[n].onComplete;this.outstandingPuts_[n].queued=this.connected_,this.sendRequest(r,i,o=>{this.log_(r+" response",o),delete this.outstandingPuts_[n],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(n){if(this.connected_){let r={c:n};this.log_("reportStats",r),this.sendRequest("s",r,i=>{if(i.s!=="ok"){let o=i.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(n){if("r"in n){this.log_("from server: "+ze(n));let r=n.r,i=this.requestCBHash_[r];i&&(delete this.requestCBHash_[r],i(n.b))}else{if("error"in n)throw"A server-side error has occurred: "+n.error;"a"in n&&this.onDataPush_(n.a,n.b)}}onDataPush_(n,r){this.log_("handleServerMessage",n,r),n==="d"?this.onDataUpdate_(r.p,r.d,!1,r.t):n==="m"?this.onDataUpdate_(r.p,r.d,!0,r.t):n==="c"?this.onListenRevoked_(r.p,r.q):n==="ac"?this.onAuthRevoked_(r.s,r.d):n==="apc"?this.onAppCheckRevoked_(r.s,r.d):n==="sd"?this.onSecurityDebugPacket_(r):qC("Unrecognized action received from server: "+ze(n)+`
Are you using the latest client?`)}onReady_(n,r){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(n),this.lastSessionId=r,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(n){D(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(n))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(n){n&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=kl,this.realtime_||this.scheduleConnect_(0)),this.visible_=n}onOnline_(n){n?(this.log_("Browser went online."),this.reconnectDelay_=kl,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>qW&&(this.reconnectDelay_=kl),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let n=new Date().getTime()-this.lastConnectionAttemptTime_,r=Math.max(0,this.reconnectDelay_-n);r=Math.random()*r,this.log_("Trying to reconnect in "+r+"ms"),this.scheduleConnect_(r),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*HW)}this.onConnectStatus_(!1)}establishConnection_(){return v(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let n=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+t.nextConnectionId_++,o=this.lastSessionId,a=!1,u=null,c=function(){u?u.close():(a=!0,i())},l=function(h){D(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(h)};this.realtime_={close:c,sendRequest:l};let d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[h,f]=yield Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);a?ht("getToken() completed but was canceled"):(ht("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=f&&f.token,u=new ZC(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,n,r,i,p=>{At(p+" ("+this.repoInfo_.toString()+")"),this.interrupt(GW)},o))}catch(h){this.log_("Failed to get token: "+h),a||(this.repoInfo_.nodeAdmin&&At(h),c())}}})}interrupt(n){ht("Interrupting connection for reason: "+n),this.interruptReasons_[n]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(n){ht("Resuming connection for reason: "+n),delete this.interruptReasons_[n],yd(this.interruptReasons_)&&(this.reconnectDelay_=kl,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(n){let r=n-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:r})}cancelSentTransactions_(){for(let n=0;n<this.outstandingPuts_.length;n++){let r=this.outstandingPuts_[n];r&&"h"in r.request&&r.queued&&(r.onComplete&&r.onComplete("disconnect"),delete this.outstandingPuts_[n],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(n,r){let i;r?i=r.map(o=>WD(o)).join("$"):i="default";let s=this.removeListen_(n,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(n,r){let i=new ge(n).toString(),s;if(this.listens.has(i)){let o=this.listens.get(i);s=o.get(r),o.delete(r),o.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(n,r){ht("Auth token revoked: "+n+"/"+r),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(n==="invalid_token"||n==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=vO&&(this.reconnectDelay_=_O,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(n,r){ht("App check token revoked: "+n+"/"+r),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(n==="invalid_token"||n==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=vO&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(n){this.securityDebugCallback_?this.securityDebugCallback_(n):"msg"in n&&console.log("FIREBASE: "+n.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let n of this.listens.values())for(let r of n.values())this.sendListen_(r);for(let n=0;n<this.outstandingPuts_.length;n++)this.outstandingPuts_[n]&&this.sendPut_(n);for(;this.onDisconnectRequestQueue_.length;){let n=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(n.action,n.pathString,n.data,n.onComplete)}for(let n=0;n<this.outstandingGets_.length;n++)this.outstandingGets_[n]&&this.sendGet_(n)}sendConnectStats_(){let n={},r="js";Hn()&&(this.repoInfo_.nodeAdmin?r="admin_node":r="node"),n["sdk."+r+"."+GD.replace(/\./g,"-")]=1,hm()?n["framework.cordova"]=1:kT()&&(n["framework.reactnative"]=1),this.reportStats(n)}shouldReconnect_(){let n=Dg.getInstance().currentlyOnline();return yd(this.interruptReasons_)&&n}}t.nextPersistentConnectionId_=0,t.nextConnectionId_=0;return t})(),re=class t{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new t(e,n)}};var Xa=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){let r=new re(Fi,e),i=new re(Fi,n);return this.compare(r,i)!==0}minPost(){return re.MIN}};var _g,Tg=class extends Xa{static get __EMPTY_NODE(){return _g}static set __EMPTY_NODE(e){_g=e}compare(e,n){return Zs(e.name,n.name)}isDefinedOn(e){throw no("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return re.MIN}maxPost(){return new re(Hr,_g)}makePost(e,n){return D(typeof e=="string","KeyIndex indexValue must always be a string."),new re(e,_g)}toString(){return".key"}},_r=new Tg;var Ya=class{constructor(e,n,r,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?r(e.key,n):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Bn=(()=>{class t{constructor(n,r,i,s,o){this.key=n,this.value=r,this.color=i??t.RED,this.left=s??In.EMPTY_NODE,this.right=o??In.EMPTY_NODE}copy(n,r,i,s,o){return new t(n??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(n){return this.left.inorderTraversal(n)||!!n(this.key,this.value)||this.right.inorderTraversal(n)}reverseTraversal(n){return this.right.reverseTraversal(n)||n(this.key,this.value)||this.left.reverseTraversal(n)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(n,r,i){let s=this,o=i(n,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(n,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(n,r,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return In.EMPTY_NODE;let n=this;return!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.removeMin_(),null),n.fixUp_()}remove(n,r){let i,s;if(i=this,r(n,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(n,r),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),r(n,i.key)===0){if(i.right.isEmpty())return In.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(n,r))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let n=this;return n.right.isRed_()&&!n.left.isRed_()&&(n=n.rotateLeft_()),n.left.isRed_()&&n.left.left.isRed_()&&(n=n.rotateRight_()),n.left.isRed_()&&n.right.isRed_()&&(n=n.colorFlip_()),n}moveRedLeft_(){let n=this.colorFlip_();return n.right.left.isRed_()&&(n=n.copy(null,null,null,null,n.right.rotateRight_()),n=n.rotateLeft_(),n=n.colorFlip_()),n}moveRedRight_(){let n=this.colorFlip_();return n.left.left.isRed_()&&(n=n.rotateRight_(),n=n.colorFlip_()),n}rotateLeft_(){let n=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,n,null)}rotateRight_(){let n=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,n)}colorFlip_(){let n=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,n,r)}checkMaxDepth_(){let n=this.check_();return Math.pow(2,n)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let n=this.left.check_();if(n!==this.right.check_())throw new Error("Black depths differ");return n+(this.isRed_()?0:1)}}return t.RED=!0,t.BLACK=!1,t})(),eD=class{copy(e,n,r,i,s){return this}insert(e,n,r){return new Bn(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},In=class t{constructor(e,n=t.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new t(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,Bn.BLACK,null,null))}remove(e){return new t(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Bn.BLACK,null,null))}get(e){let n,r=this.root_;for(;!r.isEmpty();){if(n=this.comparator_(e,r.key),n===0)return r.value;n<0?r=r.left:n>0&&(r=r.right)}return null}getPredecessorKey(e){let n,r=this.root_,i=null;for(;!r.isEmpty();)if(n=this.comparator_(e,r.key),n===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else n<0?r=r.left:n>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Ya(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new Ya(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new Ya(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new Ya(this.root_,null,this.comparator_,!0,e)}};In.EMPTY_NODE=new eD;function zW(t,e){return Zs(t.name,e.name)}function XD(t,e){return Zs(t,e)}var tD;function WW(t){tD=t}var aF=function(t){return typeof t=="number"?"number:"+$O(t):"string:"+t},uF=function(t){if(t.isLeafNode()){let e=t.val();D(typeof e=="string"||typeof e=="number"||typeof e=="object"&&sn(e,".sv"),"Priority must be a string or number.")}else D(t===tD||t.isEmpty(),"priority of unexpected type.");D(t===tD||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var wO,Ja=(()=>{class t{constructor(n,r=t.__childrenNodeConstructor.EMPTY_NODE){this.value_=n,this.priorityNode_=r,this.lazyHash_=null,D(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),uF(this.priorityNode_)}static set __childrenNodeConstructor(n){wO=n}static get __childrenNodeConstructor(){return wO}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(n){return new t(this.value_,n)}getImmediateChild(n){return n===".priority"?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE}getChild(n){return te(n)?this:ee(n)===".priority"?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(n,r){return null}updateImmediateChild(n,r){return n===".priority"?this.updatePriority(r):r.isEmpty()&&n!==".priority"?this:t.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(n,r).updatePriority(this.priorityNode_)}updateChild(n,r){let i=ee(n);return i===null?r:r.isEmpty()&&i!==".priority"?this:(D(i!==".priority"||Vi(n)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,t.__childrenNodeConstructor.EMPTY_NODE.updateChild(De(n),r)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(n,r){return!1}val(n){return n&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let n="";this.priorityNode_.isEmpty()||(n+="priority:"+aF(this.priorityNode_.val())+":");let r=typeof this.value_;n+=r+":",r==="number"?n+=$O(this.value_):n+=this.value_,this.lazyHash_=jO(n)}return this.lazyHash_}getValue(){return this.value_}compareTo(n){return n===t.__childrenNodeConstructor.EMPTY_NODE?1:n instanceof t.__childrenNodeConstructor?-1:(D(n.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(n))}compareToLeafNode_(n){let r=typeof n.value_,i=typeof this.value_,s=t.VALUE_TYPE_ORDER.indexOf(r),o=t.VALUE_TYPE_ORDER.indexOf(i);return D(s>=0,"Unknown leaf type: "+r),D(o>=0,"Unknown leaf type: "+i),s===o?i==="object"?0:this.value_<n.value_?-1:this.value_===n.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(n){if(n===this)return!0;if(n.isLeafNode()){let r=n;return this.value_===r.value_&&this.priorityNode_.equals(r.priorityNode_)}else return!1}}t.VALUE_TYPE_ORDER=["object","boolean","number","string"];return t})(),cF,lF;function KW(t){cF=t}function QW(t){lF=t}var nD=class extends Xa{compare(e,n){let r=e.node.getPriority(),i=n.node.getPriority(),s=r.compareTo(i);return s===0?Zs(e.name,n.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return re.MIN}maxPost(){return new re(Hr,new Ja("[PRIORITY-POST]",lF))}makePost(e,n){let r=cF(e);return new re(n,new Ja("[PRIORITY-POST]",r))}toString(){return".priority"}},be=new nD;var YW=Math.log(2),rD=class{constructor(e){let n=s=>parseInt(Math.log(s)/YW,10),r=s=>parseInt(Array(s+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;let i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},bg=function(t,e,n,r){t.sort(e);let i=function(u,c){let l=c-u,d,h;if(l===0)return null;if(l===1)return d=t[u],h=n?n(d):d,new Bn(h,d.node,Bn.BLACK,null,null);{let f=parseInt(l/2,10)+u,p=i(u,f),g=i(f+1,c);return d=t[f],h=n?n(d):d,new Bn(h,d.node,Bn.BLACK,p,g)}},s=function(u){let c=null,l=null,d=t.length,h=function(p,g){let _=d-p,C=d;d-=p;let M=i(_+1,C),T=t[_],j=n?n(T):T;f(new Bn(j,T.node,g,null,M))},f=function(p){c?(c.left=p,c=p):(l=p,c=p)};for(let p=0;p<u.count;++p){let g=u.nextBitIsOne(),_=Math.pow(2,u.count-(p+1));g?h(_,Bn.BLACK):(h(_,Bn.BLACK),h(_,Bn.RED))}return l},o=new rD(t.length),a=s(o);return new In(r||e,a)};var VC,Ka={},eu=class t{constructor(e,n){this.indexes_=e,this.indexSet_=n}static get Default(){return D(Ka&&be,"ChildrenNode.ts has not been loaded"),VC=VC||new t({".priority":Ka},{".priority":be}),VC}get(e){let n=Gr(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof In?n:null}hasIndex(e){return sn(this.indexSet_,e.toString())}addIndex(e,n){D(e!==_r,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let r=[],i=!1,s=n.getIterator(re.Wrap),o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();let a;i?a=bg(r,e.getCompare()):a=Ka;let u=e.toString(),c=Object.assign({},this.indexSet_);c[u]=e;let l=Object.assign({},this.indexes_);return l[u]=a,new t(l,c)}addToIndexes(e,n){let r=hu(this.indexes_,(i,s)=>{let o=Gr(this.indexSet_,s);if(D(o,"Missing index implementation for "+s),i===Ka)if(o.isDefinedOn(e.node)){let a=[],u=n.getIterator(re.Wrap),c=u.getNext();for(;c;)c.name!==e.name&&a.push(c),c=u.getNext();return a.push(e),bg(a,o.getCompare())}else return Ka;else{let a=n.get(e.name),u=i;return a&&(u=u.remove(new re(e.name,a))),u.insert(e,e.node)}});return new t(r,this.indexSet_)}removeFromIndexes(e,n){let r=hu(this.indexes_,i=>{if(i===Ka)return i;{let s=n.get(e.name);return s?i.remove(new re(e.name,s)):i}});return new t(r,this.indexSet_)}};var Ol,Q=(()=>{class t{constructor(n,r,i){this.children_=n,this.priorityNode_=r,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&uF(this.priorityNode_),this.children_.isEmpty()&&D(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Ol||(Ol=new t(new In(XD),null,eu.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Ol}updatePriority(n){return this.children_.isEmpty()?this:new t(this.children_,n,this.indexMap_)}getImmediateChild(n){if(n===".priority")return this.getPriority();{let r=this.children_.get(n);return r===null?Ol:r}}getChild(n){let r=ee(n);return r===null?this:this.getImmediateChild(r).getChild(De(n))}hasChild(n){return this.children_.get(n)!==null}updateImmediateChild(n,r){if(D(r,"We should always be passing snapshot nodes"),n===".priority")return this.updatePriority(r);{let i=new re(n,r),s,o;r.isEmpty()?(s=this.children_.remove(n),o=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(n,r),o=this.indexMap_.addToIndexes(i,this.children_));let a=s.isEmpty()?Ol:this.priorityNode_;return new t(s,a,o)}}updateChild(n,r){let i=ee(n);if(i===null)return r;{D(ee(n)!==".priority"||Vi(n)===1,".priority must be the last token in a path");let s=this.getImmediateChild(i).updateChild(De(n),r);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(n){if(this.isEmpty())return null;let r={},i=0,s=0,o=!0;if(this.forEachChild(be,(a,u)=>{r[a]=u.val(n),i++,o&&t.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!n&&o&&s<2*i){let a=[];for(let u in r)a[u]=r[u];return a}else return n&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(this.lazyHash_===null){let n="";this.getPriority().isEmpty()||(n+="priority:"+aF(this.getPriority().val())+":"),this.forEachChild(be,(r,i)=>{let s=i.hash();s!==""&&(n+=":"+r+":"+s)}),this.lazyHash_=n===""?"":jO(n)}return this.lazyHash_}getPredecessorChildName(n,r,i){let s=this.resolveIndex_(i);if(s){let o=s.getPredecessorKey(new re(n,r));return o?o.name:null}else return this.children_.getPredecessorKey(n)}getFirstChildName(n){let r=this.resolveIndex_(n);if(r){let i=r.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(n){let r=this.getFirstChildName(n);return r?new re(r,this.children_.get(r)):null}getLastChildName(n){let r=this.resolveIndex_(n);if(r){let i=r.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(n){let r=this.getLastChildName(n);return r?new re(r,this.children_.get(r)):null}forEachChild(n,r){let i=this.resolveIndex_(n);return i?i.inorderTraversal(s=>r(s.name,s.node)):this.children_.inorderTraversal(r)}getIterator(n){return this.getIteratorFrom(n.minPost(),n)}getIteratorFrom(n,r){let i=this.resolveIndex_(r);if(i)return i.getIteratorFrom(n,s=>s);{let s=this.children_.getIteratorFrom(n.name,re.Wrap),o=s.peek();for(;o!=null&&r.compare(o,n)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(n){return this.getReverseIteratorFrom(n.maxPost(),n)}getReverseIteratorFrom(n,r){let i=this.resolveIndex_(r);if(i)return i.getReverseIteratorFrom(n,s=>s);{let s=this.children_.getReverseIteratorFrom(n.name,re.Wrap),o=s.peek();for(;o!=null&&r.compare(o,n)>0;)s.getNext(),o=s.peek();return s}}compareTo(n){return this.isEmpty()?n.isEmpty()?0:-1:n.isLeafNode()||n.isEmpty()?1:n===id?-1:0}withIndex(n){if(n===_r||this.indexMap_.hasIndex(n))return this;{let r=this.indexMap_.addIndex(n,this.children_);return new t(this.children_,this.priorityNode_,r)}}isIndexed(n){return n===_r||this.indexMap_.hasIndex(n)}equals(n){if(n===this)return!0;if(n.isLeafNode())return!1;{let r=n;if(this.getPriority().equals(r.getPriority()))if(this.children_.count()===r.children_.count()){let i=this.getIterator(be),s=r.getIterator(be),o=i.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=i.getNext(),a=s.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(n){return n===_r?null:this.indexMap_.get(n.toString())}}return t.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,t})(),iD=class extends Q{constructor(){super(new In(XD),Q.EMPTY_NODE,eu.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Q.EMPTY_NODE}isEmpty(){return!1}},id=new iD;Object.defineProperties(re,{MIN:{value:new re(Fi,Q.EMPTY_NODE)},MAX:{value:new re(Hr,id)}});Tg.__EMPTY_NODE=Q.EMPTY_NODE;Ja.__childrenNodeConstructor=Q;WW(id);QW(id);var ZW=!0;function Fe(t,e=null){if(t===null)return Q.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),D(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){let n=t;return new Ja(n,Fe(e))}if(!(t instanceof Array)&&ZW){let n=[],r=!1;if(ft(t,(o,a)=>{if(o.substring(0,1)!=="."){let u=Fe(a);u.isEmpty()||(r=r||!u.getPriority().isEmpty(),n.push(new re(o,u)))}}),n.length===0)return Q.EMPTY_NODE;let s=bg(n,zW,o=>o.name,XD);if(r){let o=bg(n,be.getCompare());return new Q(s,Fe(e),new eu({".priority":o},{".priority":be}))}else return new Q(s,Fe(e),eu.Default)}else{let n=Q.EMPTY_NODE;return ft(t,(r,i)=>{if(sn(t,r)&&r.substring(0,1)!=="."){let s=Fe(i);(s.isLeafNode()||!s.isEmpty())&&(n=n.updateImmediateChild(r,s))}}),n.updatePriority(Fe(e))}}KW(Fe);var ql=class extends Xa{constructor(e){super(),this.indexPath_=e,D(!te(e)&&ee(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){let r=this.extractChild(e.node),i=this.extractChild(n.node),s=r.compareTo(i);return s===0?Zs(e.name,n.name):s}makePost(e,n){let r=Fe(e),i=Q.EMPTY_NODE.updateChild(this.indexPath_,r);return new re(n,i)}maxPost(){let e=Q.EMPTY_NODE.updateChild(this.indexPath_,id);return new re(Hr,e)}toString(){return Hl(this.indexPath_,0).join("/")}};var sD=class extends Xa{compare(e,n){let r=e.node.compareTo(n.node);return r===0?Zs(e.name,n.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return re.MIN}maxPost(){return re.MAX}makePost(e,n){let r=Fe(e);return new re(n,r)}toString(){return".value"}},JD=new sD;function dF(t){return{type:"value",snapshotNode:t}}function tu(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Gl(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function zl(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function XW(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}var Wl=class{constructor(e){this.index_=e}updateChild(e,n,r,i,s,o){D(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(n);return a.getChild(i).equals(r.getChild(i))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(n)?o.trackChildChange(Gl(n,a)):D(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(tu(n,r)):o.trackChildChange(zl(n,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(n,r).withIndex(this.index_)}updateFullNode(e,n,r){return r!=null&&(e.isLeafNode()||e.forEachChild(be,(i,s)=>{n.hasChild(i)||r.trackChildChange(Gl(i,s))}),n.isLeafNode()||n.forEachChild(be,(i,s)=>{if(e.hasChild(i)){let o=e.getImmediateChild(i);o.equals(s)||r.trackChildChange(zl(i,s,o))}else r.trackChildChange(tu(i,s))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?Q.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var Sg=class t{constructor(e){this.indexedFilter_=new Wl(e.getIndex()),this.index_=e.getIndex(),this.startPost_=t.getStartPost_(e),this.endPost_=t.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&r}updateChild(e,n,r,i,s,o){return this.matches(new re(n,r))||(r=Q.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,r,i,s,o)}updateFullNode(e,n,r){n.isLeafNode()&&(n=Q.EMPTY_NODE);let i=n.withIndex(this.index_);i=i.updatePriority(Q.EMPTY_NODE);let s=this;return n.forEachChild(be,(o,a)=>{s.matches(new re(o,a))||(i=i.updateImmediateChild(o,Q.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}};var oD=class{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{let r=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=n=>{let r=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Sg(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,r,i,s,o){return this.rangedFilter_.matches(new re(n,r))||(r=Q.EMPTY_NODE),e.getImmediateChild(n).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,r,i,s,o):this.fullLimitUpdateChild_(e,n,r,s,o)}updateFullNode(e,n,r){let i;if(n.isLeafNode()||n.isEmpty())i=Q.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){i=Q.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){let a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{i=n.withIndex(this.index_),i=i.updatePriority(Q.EMPTY_NODE);let s;this.reverse_?s=i.getReverseIterator(this.index_):s=i.getIterator(this.index_);let o=0;for(;s.hasNext();){let a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,Q.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,r,i,s){let o;if(this.reverse_){let d=this.index_.getCompare();o=(h,f)=>d(f,h)}else o=this.index_.getCompare();let a=e;D(a.numChildren()===this.limit_,"");let u=new re(n,r),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),l=this.rangedFilter_.matches(u);if(a.hasChild(n)){let d=a.getImmediateChild(n),h=i.getChildAfterChild(this.index_,c,this.reverse_);for(;h!=null&&(h.name===n||a.hasChild(h.name));)h=i.getChildAfterChild(this.index_,h,this.reverse_);let f=h==null?1:o(h,u);if(l&&!r.isEmpty()&&f>=0)return s?.trackChildChange(zl(n,r,d)),a.updateImmediateChild(n,r);{s?.trackChildChange(Gl(n,d));let g=a.updateImmediateChild(n,Q.EMPTY_NODE);return h!=null&&this.rangedFilter_.matches(h)?(s?.trackChildChange(tu(h.name,h.node)),g.updateImmediateChild(h.name,h.node)):g}}else return r.isEmpty()?e:l&&o(c,u)>=0?(s!=null&&(s.trackChildChange(Gl(c.name,c.node)),s.trackChildChange(tu(n,r))),a.updateImmediateChild(n,r).updateImmediateChild(c.name,Q.EMPTY_NODE)):e}};var Kl=class t{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=be}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return D(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return D(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Fi}hasEnd(){return this.endSet_}getIndexEndValue(){return D(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return D(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Hr}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return D(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===be}copy(){let e=new t;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function JW(t){return t.loadsAllData()?new Wl(t.getIndex()):t.hasLimit()?new oD(t):new Sg(t)}function e9(t,e){let n=t.copy();return n.limitSet_=!0,n.limit_=e,n.viewFrom_="l",n}function t9(t,e){let n=t.copy();return n.limitSet_=!0,n.limit_=e,n.viewFrom_="r",n}function aD(t,e,n){let r=t.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,n!=null?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function n9(t,e,n){let r;return t.index_===_r||n?r=aD(t,e,n):r=aD(t,e,Hr),r.startAfterSet_=!0,r}function uD(t,e,n){let r=t.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,n!==void 0?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function r9(t,e,n){let r;return t.index_===_r||n?r=uD(t,e,n):r=uD(t,e,Fi),r.endBeforeSet_=!0,r}function zg(t,e){let n=t.copy();return n.index_=e,n}function EO(t){let e={};if(t.isDefault())return e;let n;if(t.index_===be?n="$priority":t.index_===JD?n="$value":t.index_===_r?n="$key":(D(t.index_ instanceof ql,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=ze(n),t.startSet_){let r=t.startAfterSet_?"startAfter":"startAt";e[r]=ze(t.indexStartValue_),t.startNameSet_&&(e[r]+=","+ze(t.indexStartName_))}if(t.endSet_){let r=t.endBeforeSet_?"endBefore":"endAt";e[r]=ze(t.indexEndValue_),t.endNameSet_&&(e[r]+=","+ze(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function IO(t){let e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==be&&(e.i=t.index_.toString()),e}var cD=class t extends Ig{constructor(e,n,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=rd("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(D(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,n,r,i){let s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);let o=t.getListenId_(e,r),a={};this.listens_[o]=a;let u=EO(e._queryParams);this.restRequest_(s+".json",u,(c,l)=>{let d=l;if(c===404&&(d=null,c=null),c===null&&this.onDataUpdate_(s,d,!1,r),Gr(this.listens_,o)===a){let h;c?c===401?h="permission_denied":h="rest_error:"+c:h="ok",i(h,null)}})}unlisten(e,n){let r=t.getListenId_(e,n);delete this.listens_[r]}get(e){let n=EO(e._queryParams),r=e._path.toString(),i=new ot;return this.restRequest_(r+".json",n,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(r,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,n={},r){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,s])=>{i&&i.accessToken&&(n.auth=i.accessToken),s&&s.token&&(n.ac=s.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+jT(n);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let u=null;if(a.status>=200&&a.status<300){try{u=md(a.responseText)}catch{At("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,u)}else a.status!==401&&a.status!==404&&At("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}};var lD=class{constructor(){this.rootNode_=Q.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}};function Ag(){return{value:null,children:new Map}}function au(t,e,n){if(te(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{let r=ee(e);t.children.has(r)||t.children.set(r,Ag());let i=t.children.get(r);e=De(e),au(i,e,n)}}function dD(t,e){if(te(e))return t.value=null,t.children.clear(),!0;if(t.value!==null){if(t.value.isLeafNode())return!1;{let n=t.value;return t.value=null,n.forEachChild(be,(r,i)=>{au(t,new ge(r),i)}),dD(t,e)}}else if(t.children.size>0){let n=ee(e);return e=De(e),t.children.has(n)&&dD(t.children.get(n),e)&&t.children.delete(n),t.children.size===0}else return!0}function hD(t,e,n){t.value!==null?n(e,t.value):i9(t,(r,i)=>{let s=new ge(e.toString()+"/"+r);hD(i,s,n)})}function i9(t,e){t.children.forEach((n,r)=>{e(r,n)})}var fD=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),n=Object.assign({},e);return this.last_&&ft(this.last_,(r,i)=>{n[r]=n[r]-i}),this.last_=e,n}};var CO=10*1e3,s9=30*1e3,o9=5*60*1e3,pD=class{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new fD(e);let r=CO+(s9-CO)*Math.random();Vl(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){let e=this.statsListener_.get(),n={},r=!1;ft(e,(i,s)=>{s>0&&sn(this.statsToReport_,i)&&(n[i]=s,r=!0)}),r&&this.server_.reportStats(n),Vl(this.reportStats_.bind(this),Math.floor(Math.random()*2*o9))}};var yr=function(t){return t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",t}(yr||{});function eT(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function tT(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function nT(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}var gD=class t{constructor(e,n,r){this.path=e,this.affectedTree=n,this.revert=r,this.type=yr.ACK_USER_WRITE,this.source=eT()}operationForChild(e){if(te(this.path)){if(this.affectedTree.value!=null)return D(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let n=this.affectedTree.subtree(new ge(e));return new t(pe(),n,this.revert)}}else return D(ee(this.path)===e,"operationForChild called for unrelated child."),new t(De(this.path),this.affectedTree,this.revert)}};var xg=class t{constructor(e,n){this.source=e,this.path=n,this.type=yr.LISTEN_COMPLETE}operationForChild(e){return te(this.path)?new t(this.source,pe()):new t(this.source,De(this.path))}};var nu=class t{constructor(e,n,r){this.source=e,this.path=n,this.snap=r,this.type=yr.OVERWRITE}operationForChild(e){return te(this.path)?new t(this.source,pe(),this.snap.getImmediateChild(e)):new t(this.source,De(this.path),this.snap)}};var Ql=class t{constructor(e,n,r){this.source=e,this.path=n,this.children=r,this.type=yr.MERGE}operationForChild(e){if(te(this.path)){let n=this.children.subtree(new ge(e));return n.isEmpty()?null:n.value?new nu(this.source,pe(),n.value):new t(this.source,pe(),n)}else return D(ee(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new t(this.source,De(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var wr=class{constructor(e,n,r){this.node_=e,this.fullyInitialized_=n,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(te(e))return this.isFullyInitialized()&&!this.filtered_;let n=ee(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var mD=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function a9(t,e,n,r){let i=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(XW(o.childName,o.snapshotNode))}),Fl(t,i,"child_removed",e,r,n),Fl(t,i,"child_added",e,r,n),Fl(t,i,"child_moved",s,r,n),Fl(t,i,"child_changed",e,r,n),Fl(t,i,"value",e,r,n),i}function Fl(t,e,n,r,i,s){let o=r.filter(a=>a.type===n);o.sort((a,u)=>c9(t,a,u)),o.forEach(a=>{let u=u9(t,a,s);i.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(u,t.query_))})})}function u9(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function c9(t,e,n){if(e.childName==null||n.childName==null)throw no("Should only compare child_ events.");let r=new re(e.childName,e.snapshotNode),i=new re(n.childName,n.snapshotNode);return t.index_.compare(r,i)}function Wg(t,e){return{eventCache:t,serverCache:e}}function jl(t,e,n,r){return Wg(new wr(e,n,r),t.serverCache)}function hF(t,e,n,r){return Wg(t.eventCache,new wr(e,n,r))}function Mg(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Ys(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}var LC,l9=()=>(LC||(LC=new In(uW)),LC),Ot=class t{constructor(e,n=l9()){this.value=e,this.children=n}static fromObject(e){let n=new t(null);return ft(e,(r,i)=>{n=n.set(new ge(r),i)}),n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:pe(),value:this.value};if(te(e))return null;{let r=ee(e),i=this.children.get(r);if(i!==null){let s=i.findRootMostMatchingPathAndValue(De(e),n);return s!=null?{path:Pe(new ge(r),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(te(e))return this;{let n=ee(e),r=this.children.get(n);return r!==null?r.subtree(De(e)):new t(null)}}set(e,n){if(te(e))return new t(n,this.children);{let r=ee(e),s=(this.children.get(r)||new t(null)).set(De(e),n),o=this.children.insert(r,s);return new t(this.value,o)}}remove(e){if(te(e))return this.children.isEmpty()?new t(null):new t(null,this.children);{let n=ee(e),r=this.children.get(n);if(r){let i=r.remove(De(e)),s;return i.isEmpty()?s=this.children.remove(n):s=this.children.insert(n,i),this.value===null&&s.isEmpty()?new t(null):new t(this.value,s)}else return this}}get(e){if(te(e))return this.value;{let n=ee(e),r=this.children.get(n);return r?r.get(De(e)):null}}setTree(e,n){if(te(e))return n;{let r=ee(e),s=(this.children.get(r)||new t(null)).setTree(De(e),n),o;return s.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,s),new t(this.value,o)}}fold(e){return this.fold_(pe(),e)}fold_(e,n){let r={};return this.children.inorderTraversal((i,s)=>{r[i]=s.fold_(Pe(e,i),n)}),n(e,this.value,r)}findOnPath(e,n){return this.findOnPath_(e,pe(),n)}findOnPath_(e,n,r){let i=this.value?r(n,this.value):!1;if(i)return i;if(te(e))return null;{let s=ee(e),o=this.children.get(s);return o?o.findOnPath_(De(e),Pe(n,s),r):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,pe(),n)}foreachOnPath_(e,n,r){if(te(e))return this;{this.value&&r(n,this.value);let i=ee(e),s=this.children.get(i);return s?s.foreachOnPath_(De(e),Pe(n,i),r):new t(null)}}foreach(e){this.foreach_(pe(),e)}foreach_(e,n){this.children.inorderTraversal((r,i)=>{i.foreach_(Pe(e,r),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,r)=>{r.value&&e(n,r.value)})}};var $n=class t{constructor(e){this.writeTree_=e}static empty(){return new t(new Ot(null))}};function Ul(t,e,n){if(te(e))return new $n(new Ot(n));{let r=t.writeTree_.findRootMostValueAndPath(e);if(r!=null){let i=r.path,s=r.value,o=kt(i,e);return s=s.updateChild(o,n),new $n(t.writeTree_.set(i,s))}else{let i=new Ot(n),s=t.writeTree_.setTree(e,i);return new $n(s)}}}function yD(t,e,n){let r=t;return ft(n,(i,s)=>{r=Ul(r,Pe(e,i),s)}),r}function DO(t,e){if(te(e))return $n.empty();{let n=t.writeTree_.setTree(e,new Ot(null));return new $n(n)}}function _D(t,e){return Xs(t,e)!=null}function Xs(t,e){let n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(kt(n.path,e)):null}function TO(t){let e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(be,(r,i)=>{e.push(new re(r,i))}):t.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new re(r,i.value))}),e}function ki(t,e){if(te(e))return t;{let n=Xs(t,e);return n!=null?new $n(new Ot(n)):new $n(t.writeTree_.subtree(e))}}function vD(t){return t.writeTree_.isEmpty()}function ru(t,e){return fF(pe(),t.writeTree_,e)}function fF(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let r=null;return e.children.inorderTraversal((i,s)=>{i===".priority"?(D(s.value!==null,"Priority writes must always be leaf nodes"),r=s.value):n=fF(Pe(t,i),s,n)}),!n.getChild(t).isEmpty()&&r!==null&&(n=n.updateChild(Pe(t,".priority"),r)),n}}function Kg(t,e){return yF(e,t)}function d9(t,e,n,r,i){D(r>t.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),t.allWrites.push({path:e,snap:n,writeId:r,visible:i}),i&&(t.visibleWrites=Ul(t.visibleWrites,e,n)),t.lastWriteId=r}function h9(t,e,n,r){D(r>t.lastWriteId,"Stacking an older merge on top of newer ones"),t.allWrites.push({path:e,children:n,writeId:r,visible:!0}),t.visibleWrites=yD(t.visibleWrites,e,n),t.lastWriteId=r}function f9(t,e){for(let n=0;n<t.allWrites.length;n++){let r=t.allWrites[n];if(r.writeId===e)return r}return null}function p9(t,e){let n=t.allWrites.findIndex(a=>a.writeId===e);D(n>=0,"removeWrite called with nonexistent writeId.");let r=t.allWrites[n];t.allWrites.splice(n,1);let i=r.visible,s=!1,o=t.allWrites.length-1;for(;i&&o>=0;){let a=t.allWrites[o];a.visible&&(o>=n&&g9(a,r.path)?i=!1:En(r.path,a.path)&&(s=!0)),o--}if(i){if(s)return m9(t),!0;if(r.snap)t.visibleWrites=DO(t.visibleWrites,r.path);else{let a=r.children;ft(a,u=>{t.visibleWrites=DO(t.visibleWrites,Pe(r.path,u))})}return!0}else return!1}function g9(t,e){if(t.snap)return En(t.path,e);for(let n in t.children)if(t.children.hasOwnProperty(n)&&En(Pe(t.path,n),e))return!0;return!1}function m9(t){t.visibleWrites=pF(t.allWrites,y9,pe()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function y9(t){return t.visible}function pF(t,e,n){let r=$n.empty();for(let i=0;i<t.length;++i){let s=t[i];if(e(s)){let o=s.path,a;if(s.snap)En(n,o)?(a=kt(n,o),r=Ul(r,a,s.snap)):En(o,n)&&(a=kt(o,n),r=Ul(r,pe(),s.snap.getChild(a)));else if(s.children){if(En(n,o))a=kt(n,o),r=yD(r,a,s.children);else if(En(o,n))if(a=kt(o,n),te(a))r=yD(r,pe(),s.children);else{let u=Gr(s.children,ee(a));if(u){let c=u.getChild(De(a));r=Ul(r,pe(),c)}}}else throw no("WriteRecord should have .snap or .children")}}return r}function gF(t,e,n,r,i){if(!r&&!i){let s=Xs(t.visibleWrites,e);if(s!=null)return s;{let o=ki(t.visibleWrites,e);if(vD(o))return n;if(n==null&&!_D(o,pe()))return null;{let a=n||Q.EMPTY_NODE;return ru(o,a)}}}else{let s=ki(t.visibleWrites,e);if(!i&&vD(s))return n;if(!i&&n==null&&!_D(s,pe()))return null;{let o=function(c){return(c.visible||i)&&(!r||!~r.indexOf(c.writeId))&&(En(c.path,e)||En(e,c.path))},a=pF(t.allWrites,o,e),u=n||Q.EMPTY_NODE;return ru(a,u)}}}function _9(t,e,n){let r=Q.EMPTY_NODE,i=Xs(t.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(be,(s,o)=>{r=r.updateImmediateChild(s,o)}),r;if(n){let s=ki(t.visibleWrites,e);return n.forEachChild(be,(o,a)=>{let u=ru(ki(s,new ge(o)),a);r=r.updateImmediateChild(o,u)}),TO(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{let s=ki(t.visibleWrites,e);return TO(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function v9(t,e,n,r,i){D(r||i,"Either existingEventSnap or existingServerSnap must exist");let s=Pe(e,n);if(_D(t.visibleWrites,s))return null;{let o=ki(t.visibleWrites,s);return vD(o)?i.getChild(n):ru(o,i.getChild(n))}}function w9(t,e,n,r){let i=Pe(e,n),s=Xs(t.visibleWrites,i);if(s!=null)return s;if(r.isCompleteForChild(n)){let o=ki(t.visibleWrites,i);return ru(o,r.getNode().getImmediateChild(n))}else return null}function E9(t,e){return Xs(t.visibleWrites,e)}function I9(t,e,n,r,i,s,o){let a,u=ki(t.visibleWrites,e),c=Xs(u,pe());if(c!=null)a=c;else if(n!=null)a=ru(u,n);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let l=[],d=o.getCompare(),h=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o),f=h.getNext();for(;f&&l.length<i;)d(f,r)!==0&&l.push(f),f=h.getNext();return l}else return[]}function C9(){return{visibleWrites:$n.empty(),allWrites:[],lastWriteId:-1}}function Rg(t,e,n,r){return gF(t.writeTree,t.treePath,e,n,r)}function rT(t,e){return _9(t.writeTree,t.treePath,e)}function bO(t,e,n,r){return v9(t.writeTree,t.treePath,e,n,r)}function Ng(t,e){return E9(t.writeTree,Pe(t.treePath,e))}function D9(t,e,n,r,i,s){return I9(t.writeTree,t.treePath,e,n,r,i,s)}function iT(t,e,n){return w9(t.writeTree,t.treePath,e,n)}function mF(t,e){return yF(Pe(t.treePath,e),t.writeTree)}function yF(t,e){return{treePath:t,writeTree:e}}var wD=class{constructor(){this.changeMap=new Map}trackChildChange(e){let n=e.type,r=e.childName;D(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),D(r!==".priority","Only non-priority child changes can be tracked.");let i=this.changeMap.get(r);if(i){let s=i.type;if(n==="child_added"&&s==="child_removed")this.changeMap.set(r,zl(r,e.snapshotNode,i.snapshotNode));else if(n==="child_removed"&&s==="child_added")this.changeMap.delete(r);else if(n==="child_removed"&&s==="child_changed")this.changeMap.set(r,Gl(r,i.oldSnap));else if(n==="child_changed"&&s==="child_added")this.changeMap.set(r,tu(r,e.snapshotNode));else if(n==="child_changed"&&s==="child_changed")this.changeMap.set(r,zl(r,e.snapshotNode,i.oldSnap));else throw no("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}};var ED=class{getCompleteChild(e){return null}getChildAfterChild(e,n,r){return null}},_F=new ED,Yl=class{constructor(e,n,r=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=r}getCompleteChild(e){let n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{let r=this.optCompleteServerCache_!=null?new wr(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return iT(this.writes_,e,r)}}getChildAfterChild(e,n,r){let i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Ys(this.viewCache_),s=D9(this.writes_,i,n,1,r,e);return s.length===0?null:s[0]}};function T9(t){return{filter:t}}function b9(t,e){D(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),D(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function S9(t,e,n,r,i){let s=new wD,o,a;if(n.type===yr.OVERWRITE){let c=n;c.source.fromUser?o=ID(t,e,c.path,c.snap,r,i,s):(D(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!te(c.path),o=Pg(t,e,c.path,c.snap,r,i,a,s))}else if(n.type===yr.MERGE){let c=n;c.source.fromUser?o=x9(t,e,c.path,c.children,r,i,s):(D(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=CD(t,e,c.path,c.children,r,i,a,s))}else if(n.type===yr.ACK_USER_WRITE){let c=n;c.revert?o=N9(t,e,c.path,r,i,s):o=M9(t,e,c.path,c.affectedTree,r,i,s)}else if(n.type===yr.LISTEN_COMPLETE)o=R9(t,e,n.path,r,s);else throw no("Unknown operation type: "+n.type);let u=s.getChanges();return A9(e,o,u),{viewCache:o,changes:u}}function A9(t,e,n){let r=e.eventCache;if(r.isFullyInitialized()){let i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=Mg(t);(n.length>0||!t.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(dF(Mg(e)))}}function vF(t,e,n,r,i,s){let o=e.eventCache;if(Ng(r,n)!=null)return e;{let a,u;if(te(n))if(D(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=Ys(e),l=c instanceof Q?c:Q.EMPTY_NODE,d=rT(r,l);a=t.filter.updateFullNode(e.eventCache.getNode(),d,s)}else{let c=Rg(r,Ys(e));a=t.filter.updateFullNode(e.eventCache.getNode(),c,s)}else{let c=ee(n);if(c===".priority"){D(Vi(n)===1,"Can't have a priority with additional path components");let l=o.getNode();u=e.serverCache.getNode();let d=bO(r,n,l,u);d!=null?a=t.filter.updatePriority(l,d):a=o.getNode()}else{let l=De(n),d;if(o.isCompleteForChild(c)){u=e.serverCache.getNode();let h=bO(r,n,o.getNode(),u);h!=null?d=o.getNode().getImmediateChild(c).updateChild(l,h):d=o.getNode().getImmediateChild(c)}else d=iT(r,c,e.serverCache);d!=null?a=t.filter.updateChild(o.getNode(),c,d,l,i,s):a=o.getNode()}}return jl(e,a,o.isFullyInitialized()||te(n),t.filter.filtersNodes())}}function Pg(t,e,n,r,i,s,o,a){let u=e.serverCache,c,l=o?t.filter:t.filter.getIndexedFilter();if(te(n))c=l.updateFullNode(u.getNode(),r,null);else if(l.filtersNodes()&&!u.isFiltered()){let f=u.getNode().updateChild(n,r);c=l.updateFullNode(u.getNode(),f,null)}else{let f=ee(n);if(!u.isCompleteForPath(n)&&Vi(n)>1)return e;let p=De(n),_=u.getNode().getImmediateChild(f).updateChild(p,r);f===".priority"?c=l.updatePriority(u.getNode(),_):c=l.updateChild(u.getNode(),f,_,p,_F,null)}let d=hF(e,c,u.isFullyInitialized()||te(n),l.filtersNodes()),h=new Yl(i,d,s);return vF(t,d,n,i,h,a)}function ID(t,e,n,r,i,s,o){let a=e.eventCache,u,c,l=new Yl(i,e,s);if(te(n))c=t.filter.updateFullNode(e.eventCache.getNode(),r,o),u=jl(e,c,!0,t.filter.filtersNodes());else{let d=ee(n);if(d===".priority")c=t.filter.updatePriority(e.eventCache.getNode(),r),u=jl(e,c,a.isFullyInitialized(),a.isFiltered());else{let h=De(n),f=a.getNode().getImmediateChild(d),p;if(te(h))p=r;else{let g=l.getCompleteChild(d);g!=null?QD(h)===".priority"&&g.getChild(sF(h)).isEmpty()?p=g:p=g.updateChild(h,r):p=Q.EMPTY_NODE}if(f.equals(p))u=e;else{let g=t.filter.updateChild(a.getNode(),d,p,h,l,o);u=jl(e,g,a.isFullyInitialized(),t.filter.filtersNodes())}}}return u}function SO(t,e){return t.eventCache.isCompleteForChild(e)}function x9(t,e,n,r,i,s,o){let a=e;return r.foreach((u,c)=>{let l=Pe(n,u);SO(e,ee(l))&&(a=ID(t,a,l,c,i,s,o))}),r.foreach((u,c)=>{let l=Pe(n,u);SO(e,ee(l))||(a=ID(t,a,l,c,i,s,o))}),a}function AO(t,e,n){return n.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function CD(t,e,n,r,i,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let u=e,c;te(n)?c=r:c=new Ot(null).setTree(n,r);let l=e.serverCache.getNode();return c.children.inorderTraversal((d,h)=>{if(l.hasChild(d)){let f=e.serverCache.getNode().getImmediateChild(d),p=AO(t,f,h);u=Pg(t,u,new ge(d),p,i,s,o,a)}}),c.children.inorderTraversal((d,h)=>{let f=!e.serverCache.isCompleteForChild(d)&&h.value===null;if(!l.hasChild(d)&&!f){let p=e.serverCache.getNode().getImmediateChild(d),g=AO(t,p,h);u=Pg(t,u,new ge(d),g,i,s,o,a)}}),u}function M9(t,e,n,r,i,s,o){if(Ng(i,n)!=null)return e;let a=e.serverCache.isFiltered(),u=e.serverCache;if(r.value!=null){if(te(n)&&u.isFullyInitialized()||u.isCompleteForPath(n))return Pg(t,e,n,u.getNode().getChild(n),i,s,a,o);if(te(n)){let c=new Ot(null);return u.getNode().forEachChild(_r,(l,d)=>{c=c.set(new ge(l),d)}),CD(t,e,n,c,i,s,a,o)}else return e}else{let c=new Ot(null);return r.foreach((l,d)=>{let h=Pe(n,l);u.isCompleteForPath(h)&&(c=c.set(l,u.getNode().getChild(h)))}),CD(t,e,n,c,i,s,a,o)}}function R9(t,e,n,r,i){let s=e.serverCache,o=hF(e,s.getNode(),s.isFullyInitialized()||te(n),s.isFiltered());return vF(t,o,n,r,_F,i)}function N9(t,e,n,r,i,s){let o;if(Ng(r,n)!=null)return e;{let a=new Yl(r,e,i),u=e.eventCache.getNode(),c;if(te(n)||ee(n)===".priority"){let l;if(e.serverCache.isFullyInitialized())l=Rg(r,Ys(e));else{let d=e.serverCache.getNode();D(d instanceof Q,"serverChildren would be complete if leaf node"),l=rT(r,d)}l=l,c=t.filter.updateFullNode(u,l,s)}else{let l=ee(n),d=iT(r,l,e.serverCache);d==null&&e.serverCache.isCompleteForChild(l)&&(d=u.getImmediateChild(l)),d!=null?c=t.filter.updateChild(u,l,d,De(n),a,s):e.eventCache.getNode().hasChild(l)?c=t.filter.updateChild(u,l,Q.EMPTY_NODE,De(n),a,s):c=u,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Rg(r,Ys(e)),o.isLeafNode()&&(c=t.filter.updateFullNode(c,o,s)))}return o=e.serverCache.isFullyInitialized()||Ng(r,pe())!=null,jl(e,c,o,t.filter.filtersNodes())}}var DD=class{constructor(e,n){this.query_=e,this.eventRegistrations_=[];let r=this.query_._queryParams,i=new Wl(r.getIndex()),s=JW(r);this.processor_=T9(s);let o=n.serverCache,a=n.eventCache,u=i.updateFullNode(Q.EMPTY_NODE,o.getNode(),null),c=s.updateFullNode(Q.EMPTY_NODE,a.getNode(),null),l=new wr(u,o.isFullyInitialized(),i.filtersNodes()),d=new wr(c,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=Wg(d,l),this.eventGenerator_=new mD(this.query_)}get query(){return this.query_}};function P9(t){return t.viewCache_.serverCache.getNode()}function k9(t){return Mg(t.viewCache_)}function O9(t,e){let n=Ys(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!te(e)&&!n.getImmediateChild(ee(e)).isEmpty())?n.getChild(e):null}function xO(t){return t.eventRegistrations_.length===0}function F9(t,e){t.eventRegistrations_.push(e)}function MO(t,e,n){let r=[];if(n){D(e==null,"A cancel should cancel all event registrations.");let i=t.query._path;t.eventRegistrations_.forEach(s=>{let o=s.createCancelEvent(n,i);o&&r.push(o)})}if(e){let i=[];for(let s=0;s<t.eventRegistrations_.length;++s){let o=t.eventRegistrations_[s];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(t.eventRegistrations_.slice(s+1));break}}t.eventRegistrations_=i}else t.eventRegistrations_=[];return r}function RO(t,e,n,r){e.type===yr.MERGE&&e.source.queryId!==null&&(D(Ys(t.viewCache_),"We should always have a full cache before handling merges"),D(Mg(t.viewCache_),"Missing event cache, even though we have a server cache"));let i=t.viewCache_,s=S9(t.processor_,i,e,n,r);return b9(t.processor_,s.viewCache),D(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=s.viewCache,wF(t,s.changes,s.viewCache.eventCache.getNode(),null)}function V9(t,e){let n=t.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(be,(s,o)=>{r.push(tu(s,o))}),n.isFullyInitialized()&&r.push(dF(n.getNode())),wF(t,r,n.getNode(),e)}function wF(t,e,n,r){let i=r?[r]:t.eventRegistrations_;return a9(t.eventGenerator_,e,n,i)}var kg,Og=class{constructor(){this.views=new Map}};function L9(t){D(!kg,"__referenceConstructor has already been defined"),kg=t}function j9(){return D(kg,"Reference.ts has not been loaded"),kg}function U9(t){return t.views.size===0}function sT(t,e,n,r){let i=e.source.queryId;if(i!==null){let s=t.views.get(i);return D(s!=null,"SyncTree gave us an op for an invalid query."),RO(s,e,n,r)}else{let s=[];for(let o of t.views.values())s=s.concat(RO(o,e,n,r));return s}}function EF(t,e,n,r,i){let s=e._queryIdentifier,o=t.views.get(s);if(!o){let a=Rg(n,i?r:null),u=!1;a?u=!0:r instanceof Q?(a=rT(n,r),u=!1):(a=Q.EMPTY_NODE,u=!1);let c=Wg(new wr(a,u,!1),new wr(r,i,!1));return new DD(e,c)}return o}function B9(t,e,n,r,i,s){let o=EF(t,e,r,i,s);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),F9(o,n),V9(o,n)}function $9(t,e,n,r){let i=e._queryIdentifier,s=[],o=[],a=Li(t);if(i==="default")for(let[u,c]of t.views.entries())o=o.concat(MO(c,n,r)),xO(c)&&(t.views.delete(u),c.query._queryParams.loadsAllData()||s.push(c.query));else{let u=t.views.get(i);u&&(o=o.concat(MO(u,n,r)),xO(u)&&(t.views.delete(i),u.query._queryParams.loadsAllData()||s.push(u.query)))}return a&&!Li(t)&&s.push(new(j9())(e._repo,e._path)),{removed:s,events:o}}function IF(t){let e=[];for(let n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function Oi(t,e){let n=null;for(let r of t.views.values())n=n||O9(r,e);return n}function CF(t,e){if(e._queryParams.loadsAllData())return Qg(t);{let r=e._queryIdentifier;return t.views.get(r)}}function DF(t,e){return CF(t,e)!=null}function Li(t){return Qg(t)!=null}function Qg(t){for(let e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var Fg;function H9(t){D(!Fg,"__referenceConstructor has already been defined"),Fg=t}function q9(){return D(Fg,"Reference.ts has not been loaded"),Fg}var G9=1,Vg=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Ot(null),this.pendingWriteTree_=C9(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function oT(t,e,n,r,i){return d9(t.pendingWriteTree_,e,n,r,i),i?uu(t,new nu(eT(),e,n)):[]}function z9(t,e,n,r){h9(t.pendingWriteTree_,e,n,r);let i=Ot.fromObject(n);return uu(t,new Ql(eT(),e,i))}function Pi(t,e,n=!1){let r=f9(t.pendingWriteTree_,e);if(p9(t.pendingWriteTree_,e)){let s=new Ot(null);return r.snap!=null?s=s.set(pe(),!0):ft(r.children,o=>{s=s.set(new ge(o),!0)}),uu(t,new gD(r.path,s,n))}else return[]}function sd(t,e,n){return uu(t,new nu(tT(),e,n))}function W9(t,e,n){let r=Ot.fromObject(n);return uu(t,new Ql(tT(),e,r))}function K9(t,e){return uu(t,new xg(tT(),e))}function Q9(t,e,n){let r=aT(t,n);if(r){let i=uT(r),s=i.path,o=i.queryId,a=kt(s,e),u=new xg(nT(o),a);return cT(t,s,u)}else return[]}function Lg(t,e,n,r,i=!1){let s=e._path,o=t.syncPointTree_.get(s),a=[];if(o&&(e._queryIdentifier==="default"||DF(o,e))){let u=$9(o,e,n,r);U9(o)&&(t.syncPointTree_=t.syncPointTree_.remove(s));let c=u.removed;if(a=u.events,!i){let l=c.findIndex(h=>h._queryParams.loadsAllData())!==-1,d=t.syncPointTree_.findOnPath(s,(h,f)=>Li(f));if(l&&!d){let h=t.syncPointTree_.subtree(s);if(!h.isEmpty()){let f=X9(h);for(let p=0;p<f.length;++p){let g=f[p],_=g.query,C=AF(t,g);t.listenProvider_.startListening(Bl(_),Zl(t,_),C.hashFn,C.onComplete)}}}!d&&c.length>0&&!r&&(l?t.listenProvider_.stopListening(Bl(e),null):c.forEach(h=>{let f=t.queryToTagMap.get(Zg(h));t.listenProvider_.stopListening(Bl(h),f)}))}J9(t,c)}return a}function TF(t,e,n,r){let i=aT(t,r);if(i!=null){let s=uT(i),o=s.path,a=s.queryId,u=kt(o,e),c=new nu(nT(a),u,n);return cT(t,o,c)}else return[]}function Y9(t,e,n,r){let i=aT(t,r);if(i){let s=uT(i),o=s.path,a=s.queryId,u=kt(o,e),c=Ot.fromObject(n),l=new Ql(nT(a),u,c);return cT(t,o,l)}else return[]}function TD(t,e,n,r=!1){let i=e._path,s=null,o=!1;t.syncPointTree_.foreachOnPath(i,(h,f)=>{let p=kt(h,i);s=s||Oi(f,p),o=o||Li(f)});let a=t.syncPointTree_.get(i);a?(o=o||Li(a),s=s||Oi(a,pe())):(a=new Og,t.syncPointTree_=t.syncPointTree_.set(i,a));let u;s!=null?u=!0:(u=!1,s=Q.EMPTY_NODE,t.syncPointTree_.subtree(i).foreachChild((f,p)=>{let g=Oi(p,pe());g&&(s=s.updateImmediateChild(f,g))}));let c=DF(a,e);if(!c&&!e._queryParams.loadsAllData()){let h=Zg(e);D(!t.queryToTagMap.has(h),"View does not exist, but we have a tag");let f=e3();t.queryToTagMap.set(h,f),t.tagToQueryMap.set(f,h)}let l=Kg(t.pendingWriteTree_,i),d=B9(a,e,n,l,s,u);if(!c&&!o&&!r){let h=CF(a,e);d=d.concat(t3(t,e,h))}return d}function Yg(t,e,n){let i=t.pendingWriteTree_,s=t.syncPointTree_.findOnPath(e,(o,a)=>{let u=kt(o,e),c=Oi(a,u);if(c)return c});return gF(i,e,s,n,!0)}function Z9(t,e){let n=e._path,r=null;t.syncPointTree_.foreachOnPath(n,(c,l)=>{let d=kt(c,n);r=r||Oi(l,d)});let i=t.syncPointTree_.get(n);i?r=r||Oi(i,pe()):(i=new Og,t.syncPointTree_=t.syncPointTree_.set(n,i));let s=r!=null,o=s?new wr(r,!0,!1):null,a=Kg(t.pendingWriteTree_,e._path),u=EF(i,e,a,s?o.getNode():Q.EMPTY_NODE,s);return k9(u)}function uu(t,e){return bF(e,t.syncPointTree_,null,Kg(t.pendingWriteTree_,pe()))}function bF(t,e,n,r){if(te(t.path))return SF(t,e,n,r);{let i=e.get(pe());n==null&&i!=null&&(n=Oi(i,pe()));let s=[],o=ee(t.path),a=t.operationForChild(o),u=e.children.get(o);if(u&&a){let c=n?n.getImmediateChild(o):null,l=mF(r,o);s=s.concat(bF(a,u,c,l))}return i&&(s=s.concat(sT(i,t,r,n))),s}}function SF(t,e,n,r){let i=e.get(pe());n==null&&i!=null&&(n=Oi(i,pe()));let s=[];return e.children.inorderTraversal((o,a)=>{let u=n?n.getImmediateChild(o):null,c=mF(r,o),l=t.operationForChild(o);l&&(s=s.concat(SF(l,a,u,c)))}),i&&(s=s.concat(sT(i,t,r,n))),s}function AF(t,e){let n=e.query,r=Zl(t,n);return{hashFn:()=>(P9(e)||Q.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return r?Q9(t,n._path,r):K9(t,n._path);{let s=dW(i,n);return Lg(t,n,null,s)}}}}function Zl(t,e){let n=Zg(e);return t.queryToTagMap.get(n)}function Zg(t){return t._path.toString()+"$"+t._queryIdentifier}function aT(t,e){return t.tagToQueryMap.get(e)}function uT(t){let e=t.indexOf("$");return D(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new ge(t.substr(0,e))}}function cT(t,e,n){let r=t.syncPointTree_.get(e);D(r,"Missing sync point for query tag that we're tracking");let i=Kg(t.pendingWriteTree_,e);return sT(r,n,i,null)}function X9(t){return t.fold((e,n,r)=>{if(n&&Li(n))return[Qg(n)];{let i=[];return n&&(i=IF(n)),ft(r,(s,o)=>{i=i.concat(o)}),i}})}function Bl(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(q9())(t._repo,t._path):t}function J9(t,e){for(let n=0;n<e.length;++n){let r=e[n];if(!r._queryParams.loadsAllData()){let i=Zg(r),s=t.queryToTagMap.get(i);t.queryToTagMap.delete(i),t.tagToQueryMap.delete(s)}}}function e3(){return G9++}function t3(t,e,n){let r=e._path,i=Zl(t,e),s=AF(t,n),o=t.listenProvider_.startListening(Bl(e),i,s.hashFn,s.onComplete),a=t.syncPointTree_.subtree(r);if(i)D(!Li(a.value),"If we're adding a query, it shouldn't be shadowed");else{let u=a.fold((c,l,d)=>{if(!te(c)&&l&&Li(l))return[Qg(l).query];{let h=[];return l&&(h=h.concat(IF(l).map(f=>f.query))),ft(d,(f,p)=>{h=h.concat(p)}),h}});for(let c=0;c<u.length;++c){let l=u[c];t.listenProvider_.stopListening(Bl(l),Zl(t,l))}}return o}var bD=class t{constructor(e){this.node_=e}getImmediateChild(e){let n=this.node_.getImmediateChild(e);return new t(n)}node(){return this.node_}},SD=class t{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){let n=Pe(this.path_,e);return new t(this.syncTree_,n)}node(){return Yg(this.syncTree_,this.path_)}},n3=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},NO=function(t,e,n){if(!t||typeof t!="object")return t;if(D(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return r3(t[".sv"],e,n);if(typeof t[".sv"]=="object")return i3(t[".sv"],e);D(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},r3=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:D(!1,"Unexpected server value: "+t)}},i3=function(t,e,n){t.hasOwnProperty("increment")||D(!1,"Unexpected server value: "+JSON.stringify(t,null,2));let r=t.increment;typeof r!="number"&&D(!1,"Unexpected increment value: "+r);let i=e.node();if(D(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;let o=i.getValue();return typeof o!="number"?r:o+r},xF=function(t,e,n,r){return dT(e,new SD(n,t),r)},lT=function(t,e,n){return dT(t,new bD(e),n)};function dT(t,e,n){let r=t.getPriority().val(),i=NO(r,e.getImmediateChild(".priority"),n),s;if(t.isLeafNode()){let o=t,a=NO(o.getValue(),e,n);return a!==o.getValue()||i!==o.getPriority().val()?new Ja(a,Fe(i)):t}else{let o=t;return s=o,i!==o.getPriority().val()&&(s=s.updatePriority(new Ja(i))),o.forEachChild(be,(a,u)=>{let c=dT(u,e.getImmediateChild(a),n);c!==u&&(s=s.updateImmediateChild(a,c))}),s}}var Xl=class{constructor(e="",n=null,r={children:{},childCount:0}){this.name=e,this.parent=n,this.node=r}};function Xg(t,e){let n=e instanceof ge?e:new ge(e),r=t,i=ee(n);for(;i!==null;){let s=Gr(r.node.children,i)||{children:{},childCount:0};r=new Xl(i,r,s),n=De(n),i=ee(n)}return r}function Js(t){return t.node.value}function hT(t,e){t.node.value=e,AD(t)}function MF(t){return t.node.childCount>0}function s3(t){return Js(t)===void 0&&!MF(t)}function Jg(t,e){ft(t.node.children,(n,r)=>{e(new Xl(n,t,r))})}function RF(t,e,n,r){n&&!r&&e(t),Jg(t,i=>{RF(i,e,!0,r)}),n&&r&&e(t)}function o3(t,e,n){let r=n?t:t.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function od(t){return new ge(t.parent===null?t.name:od(t.parent)+"/"+t.name)}function AD(t){t.parent!==null&&a3(t.parent,t.name,t)}function a3(t,e,n){let r=s3(n),i=sn(t.node.children,e);r&&i?(delete t.node.children[e],t.node.childCount--,AD(t)):!r&&!i&&(t.node.children[e]=n.node,t.node.childCount++,AD(t))}var u3=/[\[\].#$\/\u0000-\u001F\u007F]/,c3=/[\[\].#$\u0000-\u001F\u007F]/,jC=10*1024*1024,em=function(t){return typeof t=="string"&&t.length!==0&&!u3.test(t)},NF=function(t){return typeof t=="string"&&t.length!==0&&!c3.test(t)},l3=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),NF(t)},Jl=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!Gg(t)||t&&typeof t=="object"&&sn(t,".sv")},Er=function(t,e,n,r){r&&e===void 0||ad(Vt(t,"value"),e,n)},ad=function(t,e,n){let r=n instanceof ge?new XC(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+Ws(r));if(typeof e=="function")throw new Error(t+"contains a function "+Ws(r)+" with contents = "+e.toString());if(Gg(e))throw new Error(t+"contains "+e.toString()+" "+Ws(r));if(typeof e=="string"&&e.length>jC/3&&fu(e)>jC)throw new Error(t+"contains a string greater than "+jC+" utf8 bytes "+Ws(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,s=!1;if(ft(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!em(o)))throw new Error(t+" contains an invalid key ("+o+") "+Ws(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);UW(r,o),ad(t,a,r),BW(r)}),i&&s)throw new Error(t+' contains ".value" child '+Ws(r)+" in addition to actual children.")}},d3=function(t,e){let n,r;for(n=0;n<e.length;n++){r=e[n];let s=Hl(r);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!em(s[o]))throw new Error(t+"contains an invalid key ("+s[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(jW);let i=null;for(n=0;n<e.length;n++){if(r=e[n],i!==null&&En(i,r))throw new Error(t+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},PF=function(t,e,n,r){if(r&&e===void 0)return;let i=Vt(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");let s=[];ft(e,(o,a)=>{let u=new ge(o);if(ad(i,a,Pe(n,u)),QD(u)===".priority"&&!Jl(a))throw new Error(i+"contains an invalid value for '"+u.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(u)}),d3(i,s)},fT=function(t,e,n){if(!(n&&e===void 0)){if(Gg(e))throw new Error(Vt(t,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Jl(e))throw new Error(Vt(t,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},ud=function(t,e,n,r){if(!(r&&n===void 0)&&!em(n))throw new Error(Vt(t,e)+'was an invalid key = "'+n+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},cu=function(t,e,n,r){if(!(r&&n===void 0)&&!NF(n))throw new Error(Vt(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},h3=function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),cu(t,e,n,r)},Jt=function(t,e){if(ee(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},kF=function(t,e){let n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!em(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!l3(n))throw new Error(Vt(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var xD=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function tm(t,e){let n=null;for(let r=0;r<e.length;r++){let i=e[r],s=i.getPath();n!==null&&!YD(s,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:s}),n.events.push(i)}n&&t.eventLists_.push(n)}function OF(t,e,n){tm(t,n),FF(t,r=>YD(r,e))}function en(t,e,n){tm(t,n),FF(t,r=>En(r,e)||En(e,r))}function FF(t,e){t.recursionDepth_++;let n=!0;for(let r=0;r<t.eventLists_.length;r++){let i=t.eventLists_[r];if(i){let s=i.path;e(s)?(f3(t.eventLists_[r]),t.eventLists_[r]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function f3(t){for(let e=0;e<t.events.length;e++){let n=t.events[e];if(n!==null){t.events[e]=null;let r=n.getEventRunner();Qs&&ht("event: "+n.toString()),ou(r)}}}var VF="repo_interrupt",p3=25,MD=class{constructor(e,n,r,i){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new xD,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Ag(),this.transactionQueueTree_=new Xl,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function g3(t,e,n){if(t.stats_=KD(t.repoInfo_),t.forceRestClient_||gW())t.server_=new cD(t.repoInfo_,(r,i,s,o)=>{PO(t,r,i,s,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>kO(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{ze(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}t.persistentConnection_=new ZD(t.repoInfo_,e,(r,i,s,o)=>{PO(t,r,i,s,o)},r=>{kO(t,r)},r=>{m3(t,r)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(r=>{t.server_.refreshAuthToken(r)}),t.appCheckProvider_.addTokenChangeListener(r=>{t.server_.refreshAppCheckToken(r.token)}),t.statsReporter_=yW(t.repoInfo_,()=>new pD(t.stats_,t.server_)),t.infoData_=new lD,t.infoSyncTree_=new Vg({startListening:(r,i,s,o)=>{let a=[],u=t.infoData_.getNode(r._path);return u.isEmpty()||(a=sd(t.infoSyncTree_,r._path,u),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),pT(t,"connected",!1),t.serverSyncTree_=new Vg({startListening:(r,i,s,o)=>(t.server_.listen(r,s,i,(a,u)=>{let c=o(a,u);en(t.eventQueue_,r._path,c)}),[]),stopListening:(r,i)=>{t.server_.unlisten(r,i)}})}function LF(t){let n=t.infoData_.getNode(new ge(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function cd(t){return n3({timestamp:LF(t)})}function PO(t,e,n,r,i){t.dataUpdateCount++;let s=new ge(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(i)if(r){let u=hu(n,c=>Fe(c));o=Y9(t.serverSyncTree_,s,u,i)}else{let u=Fe(n);o=TF(t.serverSyncTree_,s,u,i)}else if(r){let u=hu(n,c=>Fe(c));o=W9(t.serverSyncTree_,s,u)}else{let u=Fe(n);o=sd(t.serverSyncTree_,s,u)}let a=s;o.length>0&&(a=iu(t,s)),en(t.eventQueue_,a,o)}function kO(t,e){pT(t,"connected",e),e===!1&&v3(t)}function m3(t,e){ft(e,(n,r)=>{pT(t,n,r)})}function pT(t,e,n){let r=new ge("/.info/"+e),i=Fe(n);t.infoData_.updateSnapshot(r,i);let s=sd(t.infoSyncTree_,r,i);en(t.eventQueue_,r,s)}function nm(t){return t.nextWriteId_++}function y3(t,e,n){let r=Z9(t.serverSyncTree_,e);return r!=null?Promise.resolve(r):t.server_.get(e).then(i=>{let s=Fe(i).withIndex(e._queryParams.getIndex());TD(t.serverSyncTree_,e,n,!0);let o;if(e._queryParams.loadsAllData())o=sd(t.serverSyncTree_,e._path,s);else{let a=Zl(t.serverSyncTree_,e);o=TF(t.serverSyncTree_,e._path,s,a)}return en(t.eventQueue_,e._path,o),Lg(t.serverSyncTree_,e,n,null,!0),s},i=>(lu(t,"get for query "+ze(e)+" failed: "+i),Promise.reject(new Error(i))))}function gT(t,e,n,r,i){lu(t,"set",{path:e.toString(),value:n,priority:r});let s=cd(t),o=Fe(n,r),a=Yg(t.serverSyncTree_,e),u=lT(o,a,s),c=nm(t),l=oT(t.serverSyncTree_,e,u,c,!0);tm(t.eventQueue_,l),t.server_.put(e.toString(),o.val(!0),(h,f)=>{let p=h==="ok";p||At("set at "+e+" failed: "+h);let g=Pi(t.serverSyncTree_,c,!p);en(t.eventQueue_,e,g),ji(t,i,h,f)});let d=yT(t,e);iu(t,d),en(t.eventQueue_,d,[])}function _3(t,e,n,r){lu(t,"update",{path:e.toString(),value:n});let i=!0,s=cd(t),o={};if(ft(n,(a,u)=>{i=!1,o[a]=xF(Pe(e,a),Fe(u),t.serverSyncTree_,s)}),i)ht("update() called with empty data.  Don't do anything."),ji(t,r,"ok",void 0);else{let a=nm(t),u=z9(t.serverSyncTree_,e,o,a);tm(t.eventQueue_,u),t.server_.merge(e.toString(),n,(c,l)=>{let d=c==="ok";d||At("update at "+e+" failed: "+c);let h=Pi(t.serverSyncTree_,a,!d),f=h.length>0?iu(t,e):e;en(t.eventQueue_,f,h),ji(t,r,c,l)}),ft(n,c=>{let l=yT(t,Pe(e,c));iu(t,l)}),en(t.eventQueue_,e,[])}}function v3(t){lu(t,"onDisconnectEvents");let e=cd(t),n=Ag();hD(t.onDisconnect_,pe(),(i,s)=>{let o=xF(i,s,t.serverSyncTree_,e);au(n,i,o)});let r=[];hD(n,pe(),(i,s)=>{r=r.concat(sd(t.serverSyncTree_,i,s));let o=yT(t,i);iu(t,o)}),t.onDisconnect_=Ag(),en(t.eventQueue_,pe(),r)}function w3(t,e,n){t.server_.onDisconnectCancel(e.toString(),(r,i)=>{r==="ok"&&dD(t.onDisconnect_,e),ji(t,n,r,i)})}function OO(t,e,n,r){let i=Fe(n);t.server_.onDisconnectPut(e.toString(),i.val(!0),(s,o)=>{s==="ok"&&au(t.onDisconnect_,e,i),ji(t,r,s,o)})}function E3(t,e,n,r,i){let s=Fe(n,r);t.server_.onDisconnectPut(e.toString(),s.val(!0),(o,a)=>{o==="ok"&&au(t.onDisconnect_,e,s),ji(t,i,o,a)})}function I3(t,e,n,r){if(yd(n)){ht("onDisconnect().update() called with empty data.  Don't do anything."),ji(t,r,"ok",void 0);return}t.server_.onDisconnectMerge(e.toString(),n,(i,s)=>{i==="ok"&&ft(n,(o,a)=>{let u=Fe(a);au(t.onDisconnect_,Pe(e,o),u)}),ji(t,r,i,s)})}function C3(t,e,n){let r;ee(e._path)===".info"?r=TD(t.infoSyncTree_,e,n):r=TD(t.serverSyncTree_,e,n),OF(t.eventQueue_,e._path,r)}function RD(t,e,n){let r;ee(e._path)===".info"?r=Lg(t.infoSyncTree_,e,n):r=Lg(t.serverSyncTree_,e,n),OF(t.eventQueue_,e._path,r)}function jF(t){t.persistentConnection_&&t.persistentConnection_.interrupt(VF)}function D3(t){t.persistentConnection_&&t.persistentConnection_.resume(VF)}function lu(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),ht(n,...e)}function ji(t,e,n,r){e&&ou(()=>{if(n==="ok")e(null);else{let i=(n||"error").toUpperCase(),s=i;r&&(s+=": "+r);let o=new Error(s);o.code=i,e(o)}})}function T3(t,e,n,r,i,s){lu(t,"transaction on "+e);let o={path:e,update:n,onComplete:r,status:null,order:LO(),applyLocally:s,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=mT(t,e,void 0);o.currentInputSnapshot=a;let u=o.update(a.val());if(u===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{ad("transaction failed: Data returned ",u,o.path),o.status=0;let c=Xg(t.transactionQueueTree_,e),l=Js(c)||[];l.push(o),hT(c,l);let d;typeof u=="object"&&u!==null&&sn(u,".priority")?(d=Gr(u,".priority"),D(Jl(d),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):d=(Yg(t.serverSyncTree_,e)||Q.EMPTY_NODE).getPriority().val();let h=cd(t),f=Fe(u,d),p=lT(f,a,h);o.currentOutputSnapshotRaw=f,o.currentOutputSnapshotResolved=p,o.currentWriteId=nm(t);let g=oT(t.serverSyncTree_,e,p,o.currentWriteId,o.applyLocally);en(t.eventQueue_,e,g),rm(t,t.transactionQueueTree_)}}function mT(t,e,n){return Yg(t.serverSyncTree_,e,n)||Q.EMPTY_NODE}function rm(t,e=t.transactionQueueTree_){if(e||im(t,e),Js(e)){let n=BF(t,e);D(n.length>0,"Sending zero length transaction queue"),n.every(i=>i.status===0)&&b3(t,od(e),n)}else MF(e)&&Jg(e,n=>{rm(t,n)})}function b3(t,e,n){let r=n.map(c=>c.currentWriteId),i=mT(t,e,r),s=i,o=i.hash();for(let c=0;c<n.length;c++){let l=n[c];D(l.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),l.status=1,l.retryCount++;let d=kt(e,l.path);s=s.updateChild(d,l.currentOutputSnapshotRaw)}let a=s.val(!0),u=e;t.server_.put(u.toString(),a,c=>{lu(t,"transaction put response",{path:u.toString(),status:c});let l=[];if(c==="ok"){let d=[];for(let h=0;h<n.length;h++)n[h].status=2,l=l.concat(Pi(t.serverSyncTree_,n[h].currentWriteId)),n[h].onComplete&&d.push(()=>n[h].onComplete(null,!0,n[h].currentOutputSnapshotResolved)),n[h].unwatcher();im(t,Xg(t.transactionQueueTree_,e)),rm(t,t.transactionQueueTree_),en(t.eventQueue_,e,l);for(let h=0;h<d.length;h++)ou(d[h])}else{if(c==="datastale")for(let d=0;d<n.length;d++)n[d].status===3?n[d].status=4:n[d].status=0;else{At("transaction at "+u.toString()+" failed: "+c);for(let d=0;d<n.length;d++)n[d].status=4,n[d].abortReason=c}iu(t,e)}},o)}function iu(t,e){let n=UF(t,e),r=od(n),i=BF(t,n);return S3(t,i,r),r}function S3(t,e,n){if(e.length===0)return;let r=[],i=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let u=e[a],c=kt(n,u.path),l=!1,d;if(D(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),u.status===4)l=!0,d=u.abortReason,i=i.concat(Pi(t.serverSyncTree_,u.currentWriteId,!0));else if(u.status===0)if(u.retryCount>=p3)l=!0,d="maxretry",i=i.concat(Pi(t.serverSyncTree_,u.currentWriteId,!0));else{let h=mT(t,u.path,o);u.currentInputSnapshot=h;let f=e[a].update(h.val());if(f!==void 0){ad("transaction failed: Data returned ",f,u.path);let p=Fe(f);typeof f=="object"&&f!=null&&sn(f,".priority")||(p=p.updatePriority(h.getPriority()));let _=u.currentWriteId,C=cd(t),M=lT(p,h,C);u.currentOutputSnapshotRaw=p,u.currentOutputSnapshotResolved=M,u.currentWriteId=nm(t),o.splice(o.indexOf(_),1),i=i.concat(oT(t.serverSyncTree_,u.path,M,u.currentWriteId,u.applyLocally)),i=i.concat(Pi(t.serverSyncTree_,_,!0))}else l=!0,d="nodata",i=i.concat(Pi(t.serverSyncTree_,u.currentWriteId,!0))}en(t.eventQueue_,n,i),i=[],l&&(e[a].status=2,function(h){setTimeout(h,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(d==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(d),!1,null))))}im(t,t.transactionQueueTree_);for(let a=0;a<r.length;a++)ou(r[a]);rm(t,t.transactionQueueTree_)}function UF(t,e){let n,r=t.transactionQueueTree_;for(n=ee(e);n!==null&&Js(r)===void 0;)r=Xg(r,n),e=De(e),n=ee(e);return r}function BF(t,e){let n=[];return $F(t,e,n),n.sort((r,i)=>r.order-i.order),n}function $F(t,e,n){let r=Js(e);if(r)for(let i=0;i<r.length;i++)n.push(r[i]);Jg(e,i=>{$F(t,i,n)})}function im(t,e){let n=Js(e);if(n){let r=0;for(let i=0;i<n.length;i++)n[i].status!==2&&(n[r]=n[i],r++);n.length=r,hT(e,n.length>0?n:void 0)}Jg(e,r=>{im(t,r)})}function yT(t,e){let n=od(UF(t,e)),r=Xg(t.transactionQueueTree_,e);return o3(r,i=>{UC(t,i)}),UC(t,r),RF(r,i=>{UC(t,i)}),n}function UC(t,e){let n=Js(e);if(n){let r=[],i=[],s=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(D(s===o-1,"All SENT items should be at beginning of queue."),s=o,n[o].status=3,n[o].abortReason="set"):(D(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),i=i.concat(Pi(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&r.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?hT(e,void 0):n.length=s+1,en(t.eventQueue_,od(e),i);for(let o=0;o<r.length;o++)ou(r[o])}}function A3(t){let e="",n=t.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function x3(t){let e={};t.charAt(0)==="?"&&(t=t.substring(1));for(let n of t.split("&")){if(n.length===0)continue;let r=n.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):At(`Invalid query segment '${n}' in query '${t}'`)}return e}var ND=function(t,e){let n=M3(t),r=n.namespace;n.domain==="firebase.com"&&vr(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&n.domain!=="localhost"&&vr("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||oW();let i=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new wg(n.host,n.secure,r,i,e,"",r!==n.subdomain),path:new ge(n.pathString)}},M3=function(t){let e="",n="",r="",i="",s="",o=!0,a="https",u=443;if(typeof t=="string"){let c=t.indexOf("//");c>=0&&(a=t.substring(0,c-1),t=t.substring(c+2));let l=t.indexOf("/");l===-1&&(l=t.length);let d=t.indexOf("?");d===-1&&(d=t.length),e=t.substring(0,Math.min(l,d)),l<d&&(i=A3(t.substring(l,d)));let h=x3(t.substring(Math.min(t.length,d)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",u=parseInt(e.substring(c+1),10)):c=e.length;let f=e.slice(0,c);if(f.toLowerCase()==="localhost")n="localhost";else if(f.split(".").length<=2)n=f;else{let p=e.indexOf(".");r=e.substring(0,p).toLowerCase(),n=e.substring(p+1),s=r}"ns"in h&&(s=h.ns)}return{host:e,port:u,domain:n,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};var FO="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",R3=function(){let t=0,e=[];return function(n){let r=n===t;t=n;let i,s=new Array(8);for(i=7;i>=0;i--)s[i]=FO.charAt(n%64),n=Math.floor(n/64);D(n===0,"Cannot push at time == 0");let o=s.join("");if(r){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=FO.charAt(e[i]);return D(o.length===20,"nextPushId: Length should be 20."),o}}();var jg=class{constructor(e,n,r,i){this.eventType=e,this.eventRegistration=n,this.snapshot=r,this.prevName=i}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+ze(this.snapshot.exportVal())}},Ug=class{constructor(e,n,r){this.eventRegistration=e,this.error=n,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var ed=class{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return D(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var Bg=class{constructor(e,n){this._repo=e,this._path=n}cancel(){let e=new ot;return w3(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Jt("OnDisconnect.remove",this._path);let e=new ot;return OO(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Jt("OnDisconnect.set",this._path),Er("OnDisconnect.set",e,this._path,!1);let n=new ot;return OO(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}setWithPriority(e,n){Jt("OnDisconnect.setWithPriority",this._path),Er("OnDisconnect.setWithPriority",e,this._path,!1),fT("OnDisconnect.setWithPriority",n,!1);let r=new ot;return E3(this._repo,this._path,e,n,r.wrapCallback(()=>{})),r.promise}update(e){Jt("OnDisconnect.update",this._path),PF("OnDisconnect.update",e,this._path,!1);let n=new ot;return I3(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}};var Ft=class t{constructor(e,n,r,i){this._repo=e,this._path=n,this._queryParams=r,this._orderByCalled=i}get key(){return te(this._path)?null:QD(this._path)}get ref(){return new tn(this._repo,this._path)}get _queryIdentifier(){let e=IO(this._queryParams),n=WD(e);return n==="{}"?"default":n}get _queryObject(){return IO(this._queryParams)}isEqual(e){if(e=ie(e),!(e instanceof t))return!1;let n=this._repo===e._repo,r=YD(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return n&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+LW(this._path)}};function sm(t,e){if(t._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Bi(t){let e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===_r){let r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!==Fi)throw new Error(r);if(typeof e!="string")throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!==Hr)throw new Error(r);if(typeof n!="string")throw new Error(i)}}else if(t.getIndex()===be){if(e!=null&&!Jl(e)||n!=null&&!Jl(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(D(t.getIndex()instanceof ql||t.getIndex()===JD,"unknown index type."),e!=null&&typeof e=="object"||n!=null&&typeof n=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function om(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var tn=class t extends Ft{constructor(e,n){super(e,n,new Kl,!1)}get parent(){let e=sF(this._path);return e===null?null:new t(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},su=class t{constructor(e,n,r){this._node=e,this.ref=n,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let n=new ge(e),r=Ui(this.ref,e);return new t(this._node.getChild(n),r,be)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,i)=>e(new t(i,Ui(this.ref,r),be)))}hasChild(e){let n=new ge(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function _T(t,e){return t=ie(t),t._checkNotDeleted("ref"),e!==void 0?Ui(t._root,e):t._root}function vT(t,e){t=ie(t),t._checkNotDeleted("refFromURL");let n=ND(e,t._repo.repoInfo_.nodeAdmin);kF("refFromURL",n);let r=n.repoInfo;return!t._repo.repoInfo_.isCustomHost()&&r.host!==t._repo.repoInfo_.host&&vr("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+t._repo.repoInfo_.host+")"),_T(t,n.path.toString())}function Ui(t,e){return t=ie(t),ee(t._path)===null?h3("child","path",e,!1):cu("child","path",e,!1),new tn(t._repo,Pe(t._path,e))}function HF(t,e){t=ie(t),Jt("push",t._path),Er("push",e,t._path,!0);let n=LF(t._repo),r=R3(n),i=Ui(t,r),s=Ui(t,r),o;return e!=null?o=am(s,e).then(()=>s):o=Promise.resolve(s),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function qF(t){return Jt("remove",t._path),am(t,null)}function am(t,e){t=ie(t),Jt("set",t._path),Er("set",e,t._path,!1);let n=new ot;return gT(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function GF(t,e){t=ie(t),Jt("setPriority",t._path),fT("setPriority",e,!1);let n=new ot;return gT(t._repo,Pe(t._path,".priority"),e,null,n.wrapCallback(()=>{})),n.promise}function zF(t,e,n){if(Jt("setWithPriority",t._path),Er("setWithPriority",e,t._path,!1),fT("setWithPriority",n,!1),t.key===".length"||t.key===".keys")throw"setWithPriority failed: "+t.key+" is a read-only object.";let r=new ot;return gT(t._repo,t._path,e,n,r.wrapCallback(()=>{})),r.promise}function WF(t,e){PF("update",e,t._path,!1);let n=new ot;return _3(t._repo,t._path,e,n.wrapCallback(()=>{})),n.promise}function KF(t){t=ie(t);let e=new ed(()=>{}),n=new td(e);return y3(t._repo,t,n).then(r=>new su(r,new tn(t._repo,t._path),t._queryParams.getIndex()))}var td=class t{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){let r=n._queryParams.getIndex();return new jg("value",this,new su(e.snapshotNode,new tn(n._repo,n._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new Ug(this,e,n):null}matches(e){return e instanceof t?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},$g=class t{constructor(e,n){this.eventType=e,this.callbackContext=n}respondsTo(e){let n=e==="children_added"?"child_added":e;return n=n==="children_removed"?"child_removed":n,this.eventType===n}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new Ug(this,e,n):null}createEvent(e,n){D(e.childName!=null,"Child events should have a childName.");let r=Ui(new tn(n._repo,n._path),e.childName),i=n._queryParams.getIndex();return new jg(e.type,this,new su(e.snapshotNode,r,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof t?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function ld(t,e,n,r,i){let s;if(typeof r=="object"&&(s=void 0,i=r),typeof r=="function"&&(s=r),i&&i.onlyOnce){let u=n,c=(l,d)=>{RD(t._repo,t,a),u(l,d)};c.userCallback=n.userCallback,c.context=n.context,n=c}let o=new ed(n,s||void 0),a=e==="value"?new td(o):new $g(e,o);return C3(t._repo,t,a),()=>RD(t._repo,t,a)}function um(t,e,n,r){return ld(t,"value",e,n,r)}function wT(t,e,n,r){return ld(t,"child_added",e,n,r)}function ET(t,e,n,r){return ld(t,"child_changed",e,n,r)}function IT(t,e,n,r){return ld(t,"child_moved",e,n,r)}function CT(t,e,n,r){return ld(t,"child_removed",e,n,r)}function DT(t,e,n){let r=null,i=n?new ed(n):null;e==="value"?r=new td(i):e&&(r=new $g(e,i)),RD(t._repo,t,r)}var nn=class{},Hg=class extends nn{constructor(e,n){super(),this._value=e,this._key=n,this.type="endAt"}_apply(e){Er("endAt",this._value,e._path,!0);let n=uD(e._queryParams,this._value,this._key);if(om(n),Bi(n),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Ft(e._repo,e._path,n,e._orderByCalled)}};function QF(t,e){return ud("endAt","key",e,!0),new Hg(t,e)}var PD=class extends nn{constructor(e,n){super(),this._value=e,this._key=n,this.type="endBefore"}_apply(e){Er("endBefore",this._value,e._path,!1);let n=r9(e._queryParams,this._value,this._key);if(om(n),Bi(n),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Ft(e._repo,e._path,n,e._orderByCalled)}};function YF(t,e){return ud("endBefore","key",e,!0),new PD(t,e)}var qg=class extends nn{constructor(e,n){super(),this._value=e,this._key=n,this.type="startAt"}_apply(e){Er("startAt",this._value,e._path,!0);let n=aD(e._queryParams,this._value,this._key);if(om(n),Bi(n),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Ft(e._repo,e._path,n,e._orderByCalled)}};function ZF(t=null,e){return ud("startAt","key",e,!0),new qg(t,e)}var kD=class extends nn{constructor(e,n){super(),this._value=e,this._key=n,this.type="startAfter"}_apply(e){Er("startAfter",this._value,e._path,!1);let n=n9(e._queryParams,this._value,this._key);if(om(n),Bi(n),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Ft(e._repo,e._path,n,e._orderByCalled)}};function XF(t,e){return ud("startAfter","key",e,!0),new kD(t,e)}var OD=class extends nn{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Ft(e._repo,e._path,e9(e._queryParams,this._limit),e._orderByCalled)}};function JF(t){if(typeof t!="number"||Math.floor(t)!==t||t<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new OD(t)}var FD=class extends nn{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Ft(e._repo,e._path,t9(e._queryParams,this._limit),e._orderByCalled)}};function e1(t){if(typeof t!="number"||Math.floor(t)!==t||t<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new FD(t)}var VD=class extends nn{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){sm(e,"orderByChild");let n=new ge(this._path);if(te(n))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let r=new ql(n),i=zg(e._queryParams,r);return Bi(i),new Ft(e._repo,e._path,i,!0)}};function t1(t){if(t==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(t==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(t==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return cu("orderByChild","path",t,!1),new VD(t)}var LD=class extends nn{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){sm(e,"orderByKey");let n=zg(e._queryParams,_r);return Bi(n),new Ft(e._repo,e._path,n,!0)}};function n1(){return new LD}var jD=class extends nn{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){sm(e,"orderByPriority");let n=zg(e._queryParams,be);return Bi(n),new Ft(e._repo,e._path,n,!0)}};function r1(){return new jD}var UD=class extends nn{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){sm(e,"orderByValue");let n=zg(e._queryParams,JD);return Bi(n),new Ft(e._repo,e._path,n,!0)}};function i1(){return new UD}var BD=class extends nn{constructor(e,n){super(),this._value=e,this._key=n,this.type="equalTo"}_apply(e){if(Er("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Hg(this._value,this._key)._apply(new qg(this._value,this._key)._apply(e))}};function s1(t,e){return ud("equalTo","key",e,!0),new BD(t,e)}function Cn(t,...e){let n=ie(t);for(let r of e)n=r._apply(n);return n}L9(tn);H9(tn);var N3="FIREBASE_DATABASE_EMULATOR_HOST",$D={},P3=!1;function k3(t,e,n,r){t.repoInfo_=new wg(`${e}:${n}`,!1,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0),r&&(t.authTokenProvider_=r)}function TT(t,e,n,r,i){let s=r||t.options.databaseURL;s===void 0&&(t.options.projectId||vr("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),ht("Using default host for project ",t.options.projectId),s=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=ND(s,i),a=o.repoInfo,u,c;typeof process<"u"&&process.env&&(c=process.env[N3]),c?(u=!0,s=`http://${c}?ns=${a.namespace}`,o=ND(s,i),a=o.repoInfo):u=!o.repoInfo.secure;let l=i&&u?new Ll(Ll.OWNER):new zC(t.name,t.options,e);kF("Invalid Firebase Database URL",o),te(o.path)||vr("Database URL must point to the root of a Firebase Database (not including a child path).");let d=F3(a,t,l,new GC(t.name,n));return new HD(d,t)}function O3(t,e){let n=$D[e];(!n||n[t.key]!==t)&&vr(`Database ${e}(${t.repoInfo_}) has already been deleted.`),jF(t),delete n[t.key]}function F3(t,e,n,r){let i=$D[e.name];i||(i={},$D[e.name]=i);let s=i[t.toURLString()];return s&&vr("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new MD(t,P3,n,r),i[t.toURLString()]=s,s}var HD=class{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(g3(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new tn(this._repo,pe())),this._rootInternal}_delete(){return this._rootInternal!==null&&(O3(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&vr("Cannot call "+e+" on a deleted database.")}};function o1(){iF.IS_TRANSPORT_INITIALIZED&&At("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function a1(){o1(),$l.forceDisallow()}function u1(){o1(),Qa.forceDisallow(),$l.forceAllow()}function c1(t,e,n,r={}){t=ie(t),t._checkNotDeleted("useEmulator"),t._instanceStarted&&vr("Cannot call useEmulator() after instance has already been initialized.");let i=t._repoInternal,s;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&vr('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new Ll(Ll.OWNER);else if(r.mockUserToken){let o=typeof r.mockUserToken=="string"?r.mockUserToken:pd(r.mockUserToken,t.app.options.projectId);s=new Ll(o)}k3(i,e,n,s)}function l1(t){t=ie(t),t._checkNotDeleted("goOffline"),jF(t._repo)}function d1(t){t=ie(t),t._checkNotDeleted("goOnline"),D3(t._repo)}function h1(t,e){UO(t,e)}function V3(t){zD(vd),$i(new qt("database",(e,{instanceIdentifier:n})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return TT(r,i,s,n)},"PUBLIC").setMultipleInstances(!0)),Dn(sO,oO,t),Dn(sO,oO,"esm2017")}var L3={".sv":"timestamp"};function f1(){return L3}function p1(t){return{".sv":{increment:t}}}var qD=class{constructor(e,n){this.committed=e,this.snapshot=n}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function g1(t,e,n){var r;if(t=ie(t),Jt("Reference.transaction",t._path),t.key===".length"||t.key===".keys")throw"Reference.transaction failed: "+t.key+" is a read-only object.";let i=(r=n?.applyLocally)!==null&&r!==void 0?r:!0,s=new ot,o=(u,c,l)=>{let d=null;u?s.reject(u):(d=new su(l,new tn(t._repo,t._path),be),s.resolve(new qD(c,d)))},a=um(t,()=>{});return T3(t._repo,t._path,e,o,a,i),s.promise}ZD.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};ZD.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};V3();var j3="@firebase/database-compat",U3="1.0.3";var B3=new zr("@firebase/database-compat"),m1=function(t){let e="FIREBASE WARNING: "+t;B3.warn(e)};var $3=function(t,e,n,r){if(!(r&&n===void 0)&&typeof n!="boolean")throw new Error(Vt(t,e)+"must be a boolean.")},H3=function(t,e,n){if(!(n&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Vt(t,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var bT=class{constructor(e){this._delegate=e}cancel(e){B("OnDisconnect.cancel",0,1,arguments.length),nt("OnDisconnect.cancel","onComplete",e,!0);let n=this._delegate.cancel();return e&&n.then(()=>e(null),r=>e(r)),n}remove(e){B("OnDisconnect.remove",0,1,arguments.length),nt("OnDisconnect.remove","onComplete",e,!0);let n=this._delegate.remove();return e&&n.then(()=>e(null),r=>e(r)),n}set(e,n){B("OnDisconnect.set",1,2,arguments.length),nt("OnDisconnect.set","onComplete",n,!0);let r=this._delegate.set(e);return n&&r.then(()=>n(null),i=>n(i)),r}setWithPriority(e,n,r){B("OnDisconnect.setWithPriority",2,3,arguments.length),nt("OnDisconnect.setWithPriority","onComplete",r,!0);let i=this._delegate.setWithPriority(e,n);return r&&i.then(()=>r(null),s=>r(s)),i}update(e,n){if(B("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,m1("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}nt("OnDisconnect.update","onComplete",n,!0);let r=this._delegate.update(e);return n&&r.then(()=>n(null),i=>n(i)),r}};var ST=class{constructor(e,n){this.committed=e,this.snapshot=n}toJSON(){return B("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var eo=class t{constructor(e,n){this._database=e,this._delegate=n}val(){return B("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return B("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return B("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return B("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return B("DataSnapshot.child",0,1,arguments.length),e=String(e),cu("DataSnapshot.child","path",e,!1),new t(this._database,this._delegate.child(e))}hasChild(e){return B("DataSnapshot.hasChild",1,1,arguments.length),cu("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return B("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return B("DataSnapshot.forEach",1,1,arguments.length),nt("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(n=>e(new t(this._database,n)))}hasChildren(){return B("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return B("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return B("DataSnapshot.ref",0,0,arguments.length),new qr(this._database,this._delegate.ref)}get ref(){return this.getRef()}},cm=class t{constructor(e,n){this.database=e,this._delegate=n}on(e,n,r,i){var s;B("Query.on",2,4,arguments.length),nt("Query.on","callback",n,!1);let o=t.getCancelAndContextArgs_("Query.on",r,i),a=(c,l)=>{n.call(o.context,new eo(this.database,c),l)};a.userCallback=n,a.context=o.context;let u=(s=o.cancel)===null||s===void 0?void 0:s.bind(o.context);switch(e){case"value":return um(this._delegate,a,u),n;case"child_added":return wT(this._delegate,a,u),n;case"child_removed":return CT(this._delegate,a,u),n;case"child_changed":return ET(this._delegate,a,u),n;case"child_moved":return IT(this._delegate,a,u),n;default:throw new Error(Vt("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,n,r){if(B("Query.off",0,3,arguments.length),H3("Query.off",e,!0),nt("Query.off","callback",n,!0),gm("Query.off","context",r,!0),n){let i=()=>{};i.userCallback=n,i.context=r,DT(this._delegate,e,i)}else DT(this._delegate,e)}get(){return KF(this._delegate).then(e=>new eo(this.database,e))}once(e,n,r,i){B("Query.once",1,4,arguments.length),nt("Query.once","callback",n,!0);let s=t.getCancelAndContextArgs_("Query.once",r,i),o=new ot,a=(c,l)=>{let d=new eo(this.database,c);n&&n.call(s.context,d,l),o.resolve(d)};a.userCallback=n,a.context=s.context;let u=c=>{s.cancel&&s.cancel.call(s.context,c),o.reject(c)};switch(e){case"value":um(this._delegate,a,u,{onlyOnce:!0});break;case"child_added":wT(this._delegate,a,u,{onlyOnce:!0});break;case"child_removed":CT(this._delegate,a,u,{onlyOnce:!0});break;case"child_changed":ET(this._delegate,a,u,{onlyOnce:!0});break;case"child_moved":IT(this._delegate,a,u,{onlyOnce:!0});break;default:throw new Error(Vt("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return B("Query.limitToFirst",1,1,arguments.length),new t(this.database,Cn(this._delegate,JF(e)))}limitToLast(e){return B("Query.limitToLast",1,1,arguments.length),new t(this.database,Cn(this._delegate,e1(e)))}orderByChild(e){return B("Query.orderByChild",1,1,arguments.length),new t(this.database,Cn(this._delegate,t1(e)))}orderByKey(){return B("Query.orderByKey",0,0,arguments.length),new t(this.database,Cn(this._delegate,n1()))}orderByPriority(){return B("Query.orderByPriority",0,0,arguments.length),new t(this.database,Cn(this._delegate,r1()))}orderByValue(){return B("Query.orderByValue",0,0,arguments.length),new t(this.database,Cn(this._delegate,i1()))}startAt(e=null,n){return B("Query.startAt",0,2,arguments.length),new t(this.database,Cn(this._delegate,ZF(e,n)))}startAfter(e=null,n){return B("Query.startAfter",0,2,arguments.length),new t(this.database,Cn(this._delegate,XF(e,n)))}endAt(e=null,n){return B("Query.endAt",0,2,arguments.length),new t(this.database,Cn(this._delegate,QF(e,n)))}endBefore(e=null,n){return B("Query.endBefore",0,2,arguments.length),new t(this.database,Cn(this._delegate,YF(e,n)))}equalTo(e,n){return B("Query.equalTo",1,2,arguments.length),new t(this.database,Cn(this._delegate,s1(e,n)))}toString(){return B("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return B("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(B("Query.isEqual",1,1,arguments.length),!(e instanceof t)){let n="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(n)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,n,r){let i={cancel:void 0,context:void 0};if(n&&r)i.cancel=n,nt(e,"cancel",i.cancel,!0),i.context=r,gm(e,"context",i.context,!0);else if(n)if(typeof n=="object"&&n!==null)i.context=n;else if(typeof n=="function")i.cancel=n;else throw new Error(Vt(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return i}get ref(){return new qr(this.database,new tn(this._delegate._repo,this._delegate._path))}},qr=class t extends cm{constructor(e,n){super(e,new Ft(n._repo,n._path,new Kl,!1)),this.database=e,this._delegate=n}getKey(){return B("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return B("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new t(this.database,Ui(this._delegate,e))}getParent(){B("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new t(this.database,e):null}getRoot(){return B("Reference.root",0,0,arguments.length),new t(this.database,this._delegate.root)}set(e,n){B("Reference.set",1,2,arguments.length),nt("Reference.set","onComplete",n,!0);let r=am(this._delegate,e);return n&&r.then(()=>n(null),i=>n(i)),r}update(e,n){if(B("Reference.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,m1("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Jt("Reference.update",this._delegate._path),nt("Reference.update","onComplete",n,!0);let r=WF(this._delegate,e);return n&&r.then(()=>n(null),i=>n(i)),r}setWithPriority(e,n,r){B("Reference.setWithPriority",2,3,arguments.length),nt("Reference.setWithPriority","onComplete",r,!0);let i=zF(this._delegate,e,n);return r&&i.then(()=>r(null),s=>r(s)),i}remove(e){B("Reference.remove",0,1,arguments.length),nt("Reference.remove","onComplete",e,!0);let n=qF(this._delegate);return e&&n.then(()=>e(null),r=>e(r)),n}transaction(e,n,r){B("Reference.transaction",1,3,arguments.length),nt("Reference.transaction","transactionUpdate",e,!1),nt("Reference.transaction","onComplete",n,!0),$3("Reference.transaction","applyLocally",r,!0);let i=g1(this._delegate,e,{applyLocally:r}).then(s=>new ST(s.committed,new eo(this.database,s.snapshot)));return n&&i.then(s=>n(null,s.committed,s.snapshot),s=>n(s,!1,null)),i}setPriority(e,n){B("Reference.setPriority",1,2,arguments.length),nt("Reference.setPriority","onComplete",n,!0);let r=GF(this._delegate,e);return n&&r.then(()=>n(null),i=>n(i)),r}push(e,n){B("Reference.push",0,2,arguments.length),nt("Reference.push","onComplete",n,!0);let r=HF(this._delegate,e),i=r.then(o=>new t(this.database,o));n&&i.then(()=>n(null),o=>n(o));let s=new t(this.database,r);return s.then=i.then.bind(i),s.catch=i.catch.bind(i,void 0),s}onDisconnect(){return Jt("Reference.onDisconnect",this._delegate._path),new bT(new Bg(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var to=class{constructor(e,n){this._delegate=e,this.app=n,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:a1,forceLongPolling:u1}}useEmulator(e,n,r={}){c1(this._delegate,e,n,r)}ref(e){if(B("database.ref",0,1,arguments.length),e instanceof qr){let n=vT(this._delegate,e.toString());return new qr(this,n)}else{let n=_T(this._delegate,e);return new qr(this,n)}}refFromURL(e){B("database.refFromURL",1,1,arguments.length);let r=vT(this._delegate,e);return new qr(this,r)}goOffline(){return B("database.goOffline",0,0,arguments.length),l1(this._delegate)}goOnline(){return B("database.goOnline",0,0,arguments.length),d1(this._delegate)}};to.ServerValue={TIMESTAMP:f1(),increment:t=>p1(t)};function q3({app:t,url:e,version:n,customAuthImpl:r,customAppCheckImpl:i,namespace:s,nodeAdmin:o=!1}){zD(n);let a=new mm("database-standalone"),u=new _d("auth-internal",a);u.setComponent(new qt("auth-internal",()=>r,"PRIVATE"));let c;return i&&(c=new _d("app-check-internal",a),c.setComponent(new qt("app-check-internal",()=>i,"PRIVATE"))),{instance:new to(TT(t,u,c,e,o),t),namespace:s}}var G3=Object.freeze({__proto__:null,initStandalone:q3});var z3=to.ServerValue;function W3(t){t.INTERNAL.registerComponent(new qt("database-compat",(e,{instanceIdentifier:n})=>{let r=e.getProvider("app-compat").getImmediate(),i=e.getProvider("database").getImmediate({identifier:n});return new to(i,r)},"PUBLIC").setServiceProps({Reference:qr,Query:cm,Database:to,DataSnapshot:eo,enableLogging:h1,INTERNAL:G3,ServerValue:z3}).setMultipleInstances(!0)),t.registerVersion(j3,U3)}W3(pt);function dd(t,e,n="on",r=Wi){return new J(i=>{let s=null;return s=t[n](e,(o,a)=>{r.schedule(()=>{i.next({snapshot:o,prevKey:a})}),n==="once"&&r.schedule(()=>i.complete())},o=>{r.schedule(()=>i.error(o))}),n==="on"?{unsubscribe(){s!=null&&t.off(e,s)}}:{unsubscribe(){}}}).pipe(F(i=>{let{snapshot:s,prevKey:o}=i,a=null;return s.exists()&&(a=s.key),{type:e,payload:s,prevKey:o,key:a}}),wu())}function K3(t){return typeof t=="string"}function Q3(t){return typeof t.exportVal=="function"}function E1(t){return t==null}function I1(t){return typeof t.set=="function"}function y1(t,e){return I1(e)?e:t.ref(e)}function C1(t,e){if(K3(t))return e.stringCase();if(I1(t))return e.firebaseCase();if(Q3(t))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof t}`)}function D1(t){return(E1(t)||t.length===0)&&(t=["child_added","child_removed","child_changed","child_moved"]),t}function T1(t,e,n){e=D1(e);let r=e.map(i=>dd(t,i,"on",n));return mo(...r)}function Y3(t,e,n){let r=T1(t,e).pipe(Gn((i,s)=>[...i,s],[]));return X3(t,r,n)}function Z3(t,e){return dd(t,"value","on",e).pipe(F(n=>{let r;return n.payload.forEach(i=>(r=i.key,!1)),{data:n,lastKeyToLoad:r}}))}function X3(t,e,n){return Z3(t,n).pipe(jm(e),F(([i,s])=>{let o=i.lastKeyToLoad,a=s.map(u=>u.key);return{actions:s,lastKeyToLoad:o,loadedKeys:a}}),Vm(i=>i.loadedKeys.indexOf(i.lastKeyToLoad)===-1),F(i=>i.actions))}function _1(t,e){return function(r,i){return C1(r,{stringCase:()=>t.child(r)[e](i),firebaseCase:()=>r[e](i),snapshotCase:()=>r.ref[e](i)})}}function J3(t){return function(n){return n?C1(n,{stringCase:()=>t.child(n).remove(),firebaseCase:()=>n.remove(),snapshotCase:()=>n.ref.remove()}):t.remove()}}function e6(t,e,n){return dd(t,"value","once",n).pipe(Me(r=>{let i=[V(r)];return e.forEach(s=>i.push(dd(t,s,"on",n))),mo(...i).pipe(Gn(n6,[]))}),yu())}function b1(t,e){let n=t.length;for(let r=0;r<n;r++)if(t[r].payload.key===e)return r;return-1}function t6(t,e){if(E1(e))return 0;{let n=b1(t,e);return n===-1?t.length:n+1}}function n6(t,e){let{payload:n,prevKey:r,key:i}=e,s=b1(t,i),o=t6(t,r);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(u=>{let c={payload:u,type:"value",prevKey:a,key:u.key};return a=u.key,t=[...t,c],!1})}return t;case"child_added":if(s>-1)(t[s-1]?.key||null)!==r&&(t=t.filter(u=>u.payload.key!==n.key),t.splice(o,0,e));else{if(r==null)return[e,...t];t=t.slice(),t.splice(o,0,e)}return t;case"child_removed":return t.filter(a=>a.payload.key!==n.key);case"child_changed":return t.map(a=>a.payload.key===i?e:a);case"child_moved":if(s>-1){let a=t.splice(s,1)[0];return t=t.slice(),t.splice(o,0,a),t}return t;default:return t}}function v1(t,e,n){return e=D1(e),e6(t,e,n)}function r6(t,e){let n=e.schedulers.outsideAngular,r=e.schedulers.ngZone.run(()=>t.ref);return{query:t,update:_1(r,"update"),set:_1(r,"set"),push:i=>r.push(i),remove:J3(r),snapshotChanges(i){return v1(t,i,n).pipe($e)},stateChanges(i){return T1(t,i,n).pipe($e)},auditTrail(i){return Y3(t,i,n).pipe($e)},valueChanges(i,s){return v1(t,i,n).pipe(F(a=>a.map(u=>s&&s.idField?he(x({},u.payload.val()),{[s.idField]:u.key}):u.payload.val())),$e)}}}function w1(t,e){return function(){return dd(t,"value","on",e)}}function i6(t,e){return{query:t,snapshotChanges(){return w1(t,e.schedulers.outsideAngular)().pipe($e)},update(n){return t.ref.update(n)},set(n){return t.ref.set(n)},remove(){return t.ref.remove()},valueChanges(){return w1(t,e.schedulers.outsideAngular)().pipe($e,F(r=>r.payload.exists()?r.payload.val():null))}}}var s6=new P("angularfire2.realtimeDatabaseURL"),o6=new P("angularfire2.database.use-emulator"),a6=(()=>{class t{schedulers;database;constructor(n,r,i,s,o,a,u,c,l,d,h,f,p,g,_){this.schedulers=a;let C=u,M=gs(n,o,r);c&&_c(M,o,l,h,f,p,d,g),this.database=ta(`${M.name}.database.${i}`,"AngularFireDatabase",M.name,()=>{let T=o.runOutsideAngular(()=>M.database(i||void 0));return C&&T.useEmulator(...C),T},[C])}list(n,r){let i=this.schedulers.ngZone.runOutsideAngular(()=>y1(this.database,n)),s=i;return r&&(s=r(i)),r6(s,this)}object(n){let r=this.schedulers.ngZone.runOutsideAngular(()=>y1(this.database,n));return i6(r,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(r){return new(r||t)(I(li),I(di,8),I(s6,8),I(Ct),I(se),I(ea),I(o6,8),I(yf,8),I(hc,8),I(fc,8),I(pc,8),I(gc,8),I(mc,8),I(yc,8),I(Rr,8))};static \u0275prov=k({token:t,factory:t.\u0275fac,providedIn:"any"})}return t})(),S1=(()=>{class t{constructor(){pt.registerVersion("angularfire",ps.full,"rtdb-compat")}static \u0275fac=function(r){return new(r||t)};static \u0275mod=Ye({type:t});static \u0275inj=Qe({providers:[a6]})}return t})();var A1={production:!1,firebaseConfig:{apiKey:"AIzaSyAaGiNu_NpjiJ4-5riPSIGhR4kIobyCiR8",authDomain:"tareasbd-330a7.firebaseapp.com",projectId:"tareasbd-330a7",storageBucket:"tareasbd-330a7.appspot.com",messagingSenderId:"323871413388",appId:"1:323871413388:web:12648ed0946a5b885957a9"}};var x1=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Ye({type:e,bootstrap:[iO]}),e.\u0275inj=Qe({imports:[NA,Cx,nO,jx.initializeApp(A1.firebaseConfig),S1]});let t=e;return t})();RA().bootstrapModule(x1).catch(t=>console.error(t));
